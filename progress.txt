# Progress Log
Run: copilot-showstopper
Started: 2026-01-23T10:30:00.000Z

## Codebase Patterns
(Add reusable patterns/gotchas discovered during implementation)

### Key Files
- `supabase/functions/api-copilot/index.ts` - Main edge function (~5000 lines), workflow router goes here
- `src/lib/contexts/CopilotContext.tsx` - Copilot state management, tool call tracking
- `src/components/copilot/CopilotRightPanel.tsx` - Right panel with Progress, Action Items, Context
- `src/components/copilot/ToolCallIndicator.tsx` - Tool call progress display
- `src/components/copilot/ChatMessage.tsx` - Individual chat message component
- `src/components/copilot/CopilotResponse.tsx` - Structured response type router
- `src/components/copilot/responses/` - Individual response type components
- `src/components/assistant/AssistantShell.tsx` - Central action handler for clickable items

### Existing Sequences (scaffolded, need validation)
- `seq-next-meeting-command-center` - Meeting prep workflow
- `seq-post-meeting-followup-pack` - Post-meeting actions
- `seq-followup-zero-inbox` - Email follow-up workflow
- `seq-pipeline-focus-tasks` - Deal prioritization

### New Components to Create
- `src/components/copilot/responses/DailyBriefResponse.tsx` - Catch me up panel
- `src/lib/utils/toolUtils.ts` - Icon/label utilities for stepper

### Database Gotchas (from CLAUDE.md)
- `meetings` table uses `owner_user_id` NOT `user_id`
- Use `maybeSingle()` when record might not exist
- Edge functions: explicit column selection (no `select('*')`)

### Action Contract Vocabulary
Standard actions (all components should use these):
- `open_contact` - Navigate to contact detail
- `open_deal` - Navigate to deal detail
- `open_meeting` - Navigate to meeting detail
- `open_task` - Navigate to task detail
- `open_external_url` - Open URL in new tab

Legacy aliases (backwards compatibility):
- `open_meeting_url` → `open_meeting`
- `view_meeting` → `open_meeting`
- `view_task` → `open_task`

### V1 Workflow Router Pattern
The unified router `routeToV1Workflow()` returns a `V1WorkflowRoute` object with:
- `workflow`: Workflow type identifier
- `sequenceKey`: Sequence to execute (or empty for direct actions like meetings_for_period)
- `sequenceContext`: Context params for the sequence

Detection functions follow naming pattern: `is{WorkflowName}Question(messageLower: string): boolean`

---

## 2026-01-23 21:45 - US-001
- What was implemented:
  - Added `routeToV1Workflow()` unified router function that maps user intent to V1 workflows
  - Added intent detection functions: `isCatchMeUpQuestion`, `isEmailZeroInboxQuestion`, `isPipelineFocusQuestion`
  - Updated deterministic workflow handling to use unified router
  - Added deterministic execution paths for email zero inbox, pipeline focus, and catch me up workflows
  - All 5 V1 workflows now bypass Gemini reasoning when detected
- Files changed:
  - `supabase/functions/api-copilot/index.ts` - Added ~200 lines for router + detection functions + execution handlers
- Quality gates:
  - build:check:strict: SKIPPED (user request)
  - lint: SKIPPED (user request)
  - tests: SKIPPED (user request)
  - browser verification (if UI): PENDING (backend-only change, will verify with US-004/US-005)
- Learnings for next iterations:
  - The `seq-catch-me-up` sequence doesn't exist yet - needs to be created in US-004
  - Existing sequences (seq-followup-zero-inbox, seq-pipeline-focus-tasks) are already seeded
  - Detection functions should be ordered from most specific to least specific in the router
---
