// Lighthouse CI Configuration for Performance Testing\n// Optimized for SPA with aggressive performance thresholds\n\nmodule.exports = {\n  ci: {\n    collect: {\n      // URLs to test\n      url: [\n        'http://localhost:4173',\n        'http://localhost:4173/dashboard',\n        'http://localhost:4173/pipeline',\n        'http://localhost:4173/companies',\n      ],\n      // Lighthouse settings\n      settings: {\n        // Chrome flags for consistent testing\n        chromeFlags: [\n          '--headless',\n          '--no-sandbox',\n          '--disable-dev-shm-usage',\n          '--disable-web-security',\n          '--disable-features=TranslateUI',\n          '--disable-ipc-flooding-protection',\n          '--disable-background-timer-throttling',\n          '--disable-backgrounding-occluded-windows',\n          '--disable-renderer-backgrounding',\n        ],\n        // Network throttling simulation\n        throttling: {\n          rttMs: 40,\n          throughputKbps: 10 * 1024, // 10 Mbps\n          cpuSlowdownMultiplier: 1,\n          requestLatencyMs: 0,\n          downloadThroughputKbps: 0,\n          uploadThroughputKbps: 0,\n        },\n        // Device emulation\n        emulatedFormFactor: 'mobile',\n        // Audit categories to run\n        onlyCategories: ['performance', 'accessibility', 'best-practices', 'seo'],\n        // Skip certain audits that might be flaky in CI\n        skipAudits: [\n          'bf-cache', // Back/forward cache can be inconsistent in CI\n        ],\n      },\n      // Number of runs per URL\n      numberOfRuns: 3,\n      // Maximum wait time for page to load\n      maxWaitForLoad: 60000,\n    },\n    assert: {\n      // Performance assertions (strict for production app)\n      assertions: {\n        // Core Web Vitals\n        'largest-contentful-paint': ['error', {minScore: 0.8}],\n        'first-contentful-paint': ['error', {minScore: 0.8}],\n        'cumulative-layout-shift': ['error', {minScore: 0.9}],\n        'max-potential-fid': ['warn', {minScore: 0.8}],\n        \n        // Performance category overall\n        'categories:performance': ['error', {minScore: 0.8}],\n        \n        // Resource loading\n        'speed-index': ['warn', {minScore: 0.7}],\n        'interactive': ['error', {minScore: 0.7}],\n        'total-blocking-time': ['error', {minScore: 0.7}],\n        \n        // Resource optimization\n        'render-blocking-resources': 'off', // We handle this with Vite\n        'unused-css-rules': ['warn', {minScore: 0.8}],\n        'unused-javascript': ['warn', {minScore: 0.8}],\n        'modern-image-formats': ['warn', {minScore: 0.8}],\n        'uses-webp-images': ['warn', {minScore: 0.8}],\n        'efficient-animated-content': ['warn', {minScore: 0.8}],\n        'uses-optimized-images': ['warn', {minScore: 0.8}],\n        'uses-text-compression': ['error', {minScore: 0.9}],\n        'uses-responsive-images': ['warn', {minScore: 0.8}],\n        \n        // Caching\n        'uses-long-cache-ttl': ['warn', {minScore: 0.7}],\n        \n        // Bundle analysis\n        'total-byte-weight': ['warn', {maxNumericValue: 2000000}], // 2MB\n        'dom-size': ['warn', {maxNumericValue: 3000}], // 3000 DOM nodes\n        \n        // Accessibility (important for SaaS)\n        'categories:accessibility': ['error', {minScore: 0.9}],\n        'color-contrast': ['error', {minScore: 1}],\n        'heading-order': ['error', {minScore: 1}],\n        'html-has-lang': ['error', {minScore: 1}],\n        'image-alt': ['error', {minScore: 1}],\n        'label': ['error', {minScore: 1}],\n        'link-name': ['error', {minScore: 1}],\n        \n        // SEO basics\n        'categories:seo': ['warn', {minScore: 0.8}],\n        'meta-description': ['warn', {minScore: 1}],\n        'document-title': ['error', {minScore: 1}],\n        \n        // Best practices\n        'categories:best-practices': ['error', {minScore: 0.9}],\n        'is-on-https': ['error', {minScore: 1}],\n        'uses-http2': ['warn', {minScore: 1}],\n        'no-vulnerable-libraries': ['error', {minScore: 1}],\n        \n        // PWA (if applicable)\n        'service-worker': 'off', // Enable if implementing PWA\n        'installable-manifest': 'off', // Enable if implementing PWA\n        'splash-screen': 'off', // Enable if implementing PWA\n        'themed-omnibox': 'off', // Enable if implementing PWA\n      },\n      // Assertion matrix for different page types\n      matrix: [\n        {\n          matchingUrlPattern: '.*dashboard.*',\n          assertions: {\n            // Dashboard might be heavier, slightly relaxed thresholds\n            'categories:performance': ['warn', {minScore: 0.75}],\n            'largest-contentful-paint': ['warn', {minScore: 0.75}],\n            'total-byte-weight': ['warn', {maxNumericValue: 2500000}], // 2.5MB for dashboard\n          },\n        },\n        {\n          matchingUrlPattern: '.*pipeline.*',\n          assertions: {\n            // Pipeline with drag-and-drop might need more JS\n            'unused-javascript': ['warn', {minScore: 0.6}],\n            'total-blocking-time': ['warn', {minScore: 0.6}],\n          },\n        },\n      ],\n    },\n    upload: {\n      // Upload results to temporary public storage\n      target: 'temporary-public-storage',\n      // GitHub status check integration\n      githubStatusContextSuffix: '/performance',\n    },\n    server: {\n      // Don't start a server (we'll start our own)\n      command: null,\n    },\n  },\n  // Budget configuration for bundle size tracking\n  budgets: [\n    {\n      path: '/*',\n      timings: [\n        {\n          metric: 'first-contentful-paint',\n          budget: 2000, // 2s\n        },\n        {\n          metric: 'largest-contentful-paint',\n          budget: 2500, // 2.5s\n        },\n        {\n          metric: 'interactive',\n          budget: 5000, // 5s\n        },\n        {\n          metric: 'speed-index',\n          budget: 3000, // 3s\n        },\n      ],\n      resourceSizes: [\n        {\n          resourceType: 'script',\n          budget: 400, // 400KB for all scripts\n        },\n        {\n          resourceType: 'stylesheet',\n          budget: 100, // 100KB for all styles\n        },\n        {\n          resourceType: 'image',\n          budget: 500, // 500KB for all images\n        },\n        {\n          resourceType: 'font',\n          budget: 200, // 200KB for all fonts\n        },\n        {\n          resourceType: 'total',\n          budget: 2000, // 2MB total\n        },\n      ],\n      resourceCounts: [\n        {\n          resourceType: 'script',\n          budget: 10, // Max 10 script files\n        },\n        {\n          resourceType: 'stylesheet',\n          budget: 5, // Max 5 CSS files\n        },\n        {\n          resourceType: 'third-party',\n          budget: 5, // Max 5 third-party requests\n        },\n      ],\n    },\n  ],\n};"