# Production Deployment Guide\n## Sixty Sales Dashboard - CDN & Infrastructure\n\nComprehensive deployment guide for production-ready infrastructure with CDN optimization, zero-downtime deployments, and 99.9% uptime SLA.\n\n## 📋 Prerequisites\n\n### Required Services\n- **Domain**: Configured with DNS management\n- **Cloudflare Account**: For CDN and security\n- **GitHub Repository**: With Actions enabled\n- **Docker Registry**: GitHub Container Registry (GHCR)\n- **Kubernetes Cluster** OR **Docker Swarm** OR **VPS with Docker**\n\n### Required Secrets\n```bash\n# GitHub Secrets (Settings > Secrets and variables > Actions)\nPROD_DATABASE_URL\nPROD_SUPABASE_URL\nPROD_SUPABASE_ANON_KEY\nPROD_JWT_SECRET\nCLOUDFLARE_EMAIL\nCLOUDFLARE_API_KEY\nPROD_KUBECONFIG  # If using Kubernetes\nSLACK_WEBHOOK_URL  # For notifications\nLHCI_GITHUB_APP_TOKEN  # Lighthouse CI\n```\n\n### Local Requirements\n```bash\nnpm install\ndocker --version\ndocker-compose --version\nkubectl version  # If using Kubernetes\n```\n\n## 🚀 Quick Start Deployment\n\n### 1. Environment Setup\n```bash\n# Clone repository\ngit clone https://github.com/your-org/sixty-sales-dashboard.git\ncd sixty-sales-dashboard\n\n# Copy and configure environment\ncp .env.production .env.local\n# Edit .env.local with your production values\n```\n\n### 2. DNS Configuration\n```bash\n# Add these DNS records in your domain provider:\nA     yourdomain.com        -> YOUR_SERVER_IP\nA     www.yourdomain.com    -> YOUR_SERVER_IP\nA     api.yourdomain.com    -> YOUR_SERVER_IP\nCNAME staging.yourdomain.com -> yourdomain.com\nCNAME admin.yourdomain.com   -> yourdomain.com\n```\n\n### 3. Cloudflare Setup\n```bash\n# 1. Add your domain to Cloudflare\n# 2. Update nameservers at your domain registrar\n# 3. Configure SSL/TLS (Full Strict mode)\n# 4. Apply the provided cloudflare.json configuration\n# 5. Enable Bot Fight Mode, DDoS Protection\n```\n\n### 4. SSL Certificates\n```bash\n# Option A: Let's Encrypt with Certbot\ncertbot certonly --nginx -d yourdomain.com -d www.yourdomain.com -d api.yourdomain.com\n\n# Option B: Cloudflare Origin Certificate (Recommended)\n# 1. Generate Origin Certificate in Cloudflare Dashboard\n# 2. Save certificate files:\nmkdir -p ssl\n# Save certificate as ssl/yourdomain.com.crt\n# Save private key as ssl/yourdomain.com.key\n# Save chain as ssl/yourdomain.com.chain.crt\n```\n\n## 🎯 Deployment Methods\n\n### Method 1: Docker Compose (Recommended for Single Server)\n\n```bash\n# 1. Build and deploy\ndocker-compose -f docker-compose.production.yml up -d\n\n# 2. Verify deployment\ndocker-compose -f docker-compose.production.yml ps\ncurl -f https://yourdomain.com/health\n\n# 3. View logs\ndocker-compose -f docker-compose.production.yml logs -f\n```\n\n### Method 2: Kubernetes Deployment\n\n```bash\n# 1. Create namespace\nkubectl create namespace sixty-sales\n\n# 2. Apply configurations\nkubectl apply -f k8s/ -n sixty-sales\n\n# 3. Verify deployment\nkubectl get pods -n sixty-sales\nkubectl get services -n sixty-sales\n\n# 4. Check ingress\nkubectl get ingress -n sixty-sales\n```\n\n### Method 3: GitHub Actions (Automated)\n\n```bash\n# 1. Push to main branch triggers production deployment\ngit push origin main\n\n# 2. Monitor deployment in GitHub Actions\n# 3. Check deployment status\ncurl -f https://yourdomain.com/health\n```\n\n## 🔧 Configuration Details\n\n### Nginx Configuration\n- **Location**: `nginx.conf`\n- **Features**: HTTP/2, Brotli compression, caching, security headers\n- **Cache Policy**: Static assets (1 year), HTML (5 min), API (no cache)\n\n### Docker Configuration\n- **Multi-stage build**: Optimized for production\n- **Security**: Non-root user, minimal base image\n- **Health checks**: Built-in health monitoring\n\n### Performance Optimization\n- **Bundle splitting**: Intelligent code splitting\n- **Image optimization**: WebP/AVIF support\n- **Compression**: Gzip + Brotli\n- **Caching**: Multi-level caching strategy\n\n## 📊 Monitoring Setup\n\n### 1. Prometheus Configuration\n```bash\n# Configure prometheus.yml with your targets\n# Start monitoring stack\ndocker-compose -f docker-compose.production.yml up prometheus grafana\n\n# Access dashboards:\n# Prometheus: http://your-server:9090\n# Grafana: http://your-server:3001 (admin/admin123)\n```\n\n### 2. Alerting Setup\n```bash\n# Configure alert rules in monitoring/alert_rules.yml\n# Set up notification channels (Slack, email, PagerDuty)\n# Test alerts:\ncurl -X POST http://prometheus:9090/-/reload\n```\n\n### 3. Log Aggregation\n```bash\n# Logs are collected by Promtail and sent to Loki\n# View logs in Grafana Explore\n# Log retention: 30 days (configurable)\n```\n\n## 🔒 Security Checklist\n\n### SSL/TLS Configuration\n- [ ] SSL certificates installed and valid\n- [ ] HSTS headers enabled\n- [ ] Perfect Forward Secrecy enabled\n- [ ] TLS 1.3 enabled\n- [ ] SSL Labs grade A+ achieved\n\n### Security Headers\n- [ ] Content Security Policy configured\n- [ ] X-Frame-Options set to DENY\n- [ ] X-Content-Type-Options set to nosniff\n- [ ] Referrer Policy configured\n- [ ] Permissions Policy configured\n\n### Access Control\n- [ ] Rate limiting enabled\n- [ ] CORS properly configured\n- [ ] API authentication working\n- [ ] Admin access restricted\n\n### Data Protection\n- [ ] Database encryption enabled\n- [ ] Backup encryption enabled\n- [ ] Secrets properly managed\n- [ ] Audit logging enabled\n\n## 🔄 Blue-Green Deployment\n\n### Overview\nZero-downtime deployment strategy using two identical environments.\n\n### Process\n1. **Prepare Blue Environment**\n   ```bash\n   # Deploy new version to blue environment\n   docker-compose -f docker-compose.blue.yml up -d\n   ```\n\n2. **Health Check & Validation**\n   ```bash\n   # Run health checks\n   curl -f https://blue.yourdomain.com/health\n   \n   # Run performance tests\n   npm run test:performance -- --base-url=https://blue.yourdomain.com\n   ```\n\n3. **Switch Traffic**\n   ```bash\n   # Update load balancer or DNS\n   # Switch Cloudflare DNS to point to blue environment\n   ```\n\n4. **Monitor & Rollback if Needed**\n   ```bash\n   # Monitor for 10 minutes\n   # If issues detected, switch back to green\n   ```\n\n### Automated Blue-Green (GitHub Actions)\nThe CI/CD pipeline automatically handles blue-green deployments:\n- Builds new version in \"blue\" environment\n- Runs health checks and performance tests\n- Switches traffic if all checks pass\n- Monitors for issues and auto-rollback if needed\n\n## 🆘 Rollback Procedures\n\n### Quick Rollback (DNS)\n```bash\n# 1. Identify last known good version\ngit log --oneline -10\n\n# 2. Switch DNS back to green environment\n# Update Cloudflare DNS or load balancer\n\n# 3. Verify rollback\ncurl -f https://yourdomain.com/health\n```\n\n### Database Rollback\n```bash\n# 1. Stop application\ndocker-compose -f docker-compose.production.yml stop\n\n# 2. Restore database backup\npsql $DATABASE_URL < backup-$(date +%Y%m%d).sql\n\n# 3. Deploy previous version\ngit checkout PREVIOUS_COMMIT\ndocker-compose -f docker-compose.production.yml up -d\n```\n\n### Emergency Rollback (GitHub Actions)\n```bash\n# Trigger emergency rollback workflow\ngh workflow run deploy.yml --field deploy_environment=rollback\n```\n\n## 📈 Performance Optimization\n\n### Core Web Vitals Targets\n- **LCP (Largest Contentful Paint)**: < 2.5s\n- **FID (First Input Delay)**: < 100ms\n- **CLS (Cumulative Layout Shift)**: < 0.1\n\n### Monitoring Performance\n```bash\n# Run Lighthouse audit\nnpm run lighthouse -- --url=https://yourdomain.com\n\n# Monitor Core Web Vitals\n# Check Grafana dashboard: Performance Overview\n```\n\n### Performance Budget\n- **Total bundle size**: < 2MB\n- **JavaScript**: < 400KB\n- **CSS**: < 100KB\n- **Images**: < 500KB\n- **Fonts**: < 200KB\n\n## 🔍 Troubleshooting\n\n### Common Issues\n\n#### 1. SSL Certificate Issues\n```bash\n# Check certificate validity\nopenssl x509 -in ssl/yourdomain.com.crt -text -noout\n\n# Test SSL connection\nopenssl s_client -connect yourdomain.com:443\n\n# Renew certificate\ncertbot renew --nginx\n```\n\n#### 2. High Memory Usage\n```bash\n# Check container memory usage\ndocker stats\n\n# Scale down if needed\ndocker-compose -f docker-compose.production.yml up -d --scale api=1\n\n# Check memory leaks in application\n```\n\n#### 3. Database Connection Issues\n```bash\n# Check database connectivity\npsql $DATABASE_URL -c \"SELECT 1;\"\n\n# Check connection pool\npsql $DATABASE_URL -c \"SELECT count(*) FROM pg_stat_activity;\"\n\n# Restart database if needed\ndocker-compose -f docker-compose.production.yml restart postgres\n```\n\n#### 4. CDN Cache Issues\n```bash\n# Purge Cloudflare cache\ncurl -X POST \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID/purge_cache\" \\\n  -H \"X-Auth-Email: $EMAIL\" \\\n  -H \"X-Auth-Key: $API_KEY\" \\\n  -H \"Content-Type: application/json\" \\\n  --data '{\"purge_everything\":true}'\n\n# Clear Nginx cache\nsudo rm -rf /var/cache/nginx/*\nsudo systemctl reload nginx\n```\n\n### Debug Commands\n```bash\n# Check service status\ndocker-compose -f docker-compose.production.yml ps\n\n# View application logs\ndocker-compose -f docker-compose.production.yml logs -f api\n\n# Check system resources\nhtop\ndf -h\nfree -m\n\n# Test API endpoints\ncurl -v https://yourdomain.com/api/health\ncurl -v https://yourdomain.com/api/dashboard\n\n# Check network connectivity\nping yourdomain.com\ntraceroute yourdomain.com\n```\n\n## 📋 Maintenance Tasks\n\n### Daily Tasks\n- [ ] Check monitoring dashboards\n- [ ] Review error logs\n- [ ] Verify backup completion\n- [ ] Monitor performance metrics\n\n### Weekly Tasks\n- [ ] Review security alerts\n- [ ] Check SSL certificate expiry\n- [ ] Analyze performance trends\n- [ ] Update dependencies (security patches)\n\n### Monthly Tasks\n- [ ] Review infrastructure costs\n- [ ] Capacity planning review\n- [ ] Disaster recovery testing\n- [ ] Security audit\n\n### Quarterly Tasks\n- [ ] Full security penetration test\n- [ ] Infrastructure optimization review\n- [ ] Disaster recovery drill\n- [ ] Performance benchmark comparison\n\n## 🆘 Emergency Contacts\n\n### On-Call Rotation\n- **Primary**: DevOps Team Lead\n- **Secondary**: Backend Team Lead\n- **Escalation**: CTO\n\n### Emergency Procedures\n1. **Assess Impact**: Determine severity level\n2. **Immediate Response**: Execute appropriate runbook\n3. **Communicate**: Notify stakeholders via Slack\n4. **Resolve**: Implement fix or rollback\n5. **Post-Mortem**: Document incident and lessons learned\n\n### Runbooks\n- **Service Down**: /runbooks/service-down.md\n- **Database Issues**: /runbooks/database-emergency.md\n- **Security Breach**: /runbooks/security-incident.md\n- **Performance Degradation**: /runbooks/performance-issues.md\n\n---\n\n## 📚 Additional Resources\n\n- [Nginx Configuration Reference](https://nginx.org/en/docs/)\n- [Cloudflare Security Settings](https://developers.cloudflare.com/security/)\n- [Docker Production Best Practices](https://docs.docker.com/develop/dev-best-practices/)\n- [Prometheus Monitoring Guide](https://prometheus.io/docs/guides/)\n- [Grafana Dashboard Examples](https://grafana.com/grafana/dashboards/)\n\n**Deployment completed successfully! 🎉**\n\nMonitor the dashboards and alerts for the first 24 hours to ensure stability."