#!/bin/bash
# Repair migration history to match development-v2 branch

echo "ðŸ”§ Repairing migration history..."
echo ""

# Mark reverted migrations
echo "ðŸ“‹ Marking reverted migrations..."
supabase migration repair --status reverted 20241228
supabase migration repair --status reverted 20250515

# Mark all applied migrations (this is a long list)
echo ""
echo "ðŸ“‹ Marking applied migrations..."

# All the migrations that exist in remote
migrations=(
  "20240101000000"
  "20240102000000"
  "20240109"
  "20240115"
  "20240315"
  "20241231000000"
  "20250101000001"
  "20250102000000"
  "20250102"
  "20250103000000"
  "20250103000001"
  "20250103000002"
  "20250104000000"
  "20250107"
  "20250108"
  "20250110"
  "20250113180730"
  "20250113180731"
  "20250113180732"
  "20250113180733"
  "20250113180734"
  "20250113180735"
  "20250113"
  "20250115000000"
  "20250115"
  "20250117200000"
  "20250117210000"
  "20250117220000"
  "20250117230000"
  "20250117"
  "20250120000000"
  "20250124000001"
  "20250124000002"
  "20250124000003"
  "20250125000001"
  "20250125000002"
  "20250125000003"
  "20250125000004"
  "20250127000000"
  "20250127000005"
  "20250127000006"
  "20250127000007"
  "20250127120000"
  "20250127120100"
  "20250127120200"
  "20250127120300"
  "20250127120400"
  "20250127120500"
  "20250127130000"
  "20250127140000"
  "20250127150000"
  "20250127170000"
  "20250128000000"
  "20250204000000"
  "20250205000000"
  "20250427202354"
  "20250427203258"
  "20250427203526"
  "20250427203955"
  "20250601000000"
  "20250601200000"
  "20250701000000"
  "20250717162134"
  "20250717170000"
  "20250717175000"
  "20250717180000"
  "20250815000000"
  "20250815120000"
  "20250815130000"
  "20250815140000"
  "20250815150000"
  "20250817000000"
  "20250817000001"
  "20250817200000"
  "20250818000000"
  "20250818150000"
  "20250818160000"
  "20250818170000"
  "20250820"
  "20250824210900"
  "20250824212000"
  "20250827120000"
  "20250827130000"
  "20250827140000"
  "20250827141000"
  "20250827"
  "20250828000000"
  "20250829000000"
  "20250830000000"
  "20250830000001"
  "20250831000000"
  "20250831000001"
  "20250831000002"
  "20250831000003"
  "20250901"
  "20250902"
  "20250903160000"
  "20250903170000"
  "20250903190000"
  "20250903210000"
  "20250904000000"
  "20250904220000"
  "20250905000000"
  "20250905100000"
  "20250905101000"
  "20250905203303"
  "20250911205435"
  "20250913000000"
  "20250914000000"
  "20250915000000"
  "20250916000000"
  "20250917122529"
  "20250917130000"
  "20251024"
  "20251025000001"
  "20251025000002"
  "20251025000003"
  "20251025000004"
  "20251025000005"
  "20251025000006"
  "20251025000007"
  "20251025200000"
  "20251025201000"
  "20251025202000"
  "20251025203000"
  "20251025210000"
  "20251025210500"
  "20251025"
  "20251026"
  "20251027000000"
  "20251027000001"
  "20251028000000"
  "20251031000001"
  "20251031000002"
  "20251031000003"
  "20251031000004"
  "20251031000005"
  "20251031120000"
  "20251031120001"
  "20251101000001"
  "20251101000002"
  "20251101000003"
  "20251101000004"
  "20251101000005"
  "20251101000006"
  "20251101000007"
  "20251101000008"
  "20251101000009"
  "20251101000010"
  "20251101000011"
  "20251101000012"
  "20251101000013"
  "20251101000014"
  "20251101000015"
  "20251101000016"
  "20251101000017"
  "20251101000018"
  "20251101000019"
  "20251101000020"
  "20251101000021"
  "20251101000022"
  "20251101000023"
  "20251101000024"
  "20251101000025"
  "20251101000026"
  "20251101000027"
  "20251101000028"
  "20251101000029"
  "20251101000030"
  "20251101000031"
  "20251103125342"
  "20251105000000"
  "20251106000001"
  "20251106"
  "20251110"
  "20251112"
  "20251114"
  "20251119000000"
  "20251120000000"
  "20251122000001"
  "20251122000002"
  "20251122000003"
  "20251122000004"
  "20251122000005"
  "20251122000006"
  "20251122000007"
  "20251122122129"
  "20251122123249"
  "20251122130000"
  "20251122140000"
  "20251122140100"
  "20251122150000"
  "20251122160000"
  "20251123000001"
  "20251123000002"
  "20251123000003"
  "20251124000001"
  "20251124000002"
  "20251125000001"
  "20251125000002"
  "20251125000003"
  "20251125000004"
  "20251126000001"
  "20251126000002"
  "20251127000001"
  "20251127000002"
  "20251127000003"
  "20251127000004"
  "20251127000005"
  "20251127144243"
  "20251127200000"
  "20251127"
  "20251128000001"
  "20251128000002"
  "20251128100000"
  "20251128200001"
  "20251128200002"
  "20251128200003"
  "20251128200004"
  "20251128200005"
  "20251128200006"
  "20251128200007"
  "20251128200008"
  "20251128300000"
  "20251128300001"
  "20251128400000"
  "20251128500000"
  "20251129000001"
  "20251129000002"
  "20251130000001"
  "20251130000002"
  "20251130000003"
  "20251202000001"
  "20251202000002"
  "20251202000003"
  "20251202000004"
  "20251202000005"
  "20251202120000"
  "20251202120001"
  "20251202120002"
  "20251202180000"
  "20251202180001"
  "20251203000001"
  "20251203000002"
  "20251203000003"
  "20251203000004"
  "20251203000005"
  "20251203000006"
  "20251203000007"
)

# Run repair for each migration
count=0
total=${#migrations[@]}

for migration in "${migrations[@]}"; do
  ((count++))
  echo "[$count/$total] Marking $migration as applied..."
  supabase migration repair --status applied "$migration" 2>&1 | grep -v "^$"
done

echo ""
echo "âœ… Migration repair complete!"
echo ""
echo "Next steps:"
echo "1. Run: supabase db pull"
echo "2. Verify local migration state matches remote"
