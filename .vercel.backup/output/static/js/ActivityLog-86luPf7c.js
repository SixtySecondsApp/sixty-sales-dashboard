import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as p,a as qe}from"./vendor-react-DoYyFkVR.js";import{T as Ke,a as Qe,b as Ne,c as we}from"./tabs-C3YOVIlH.js";import{u as Be,B as _,l as I,a as S,s as Ce,b as He,c as Ge,d as Ae,S as Je}from"./index.html-Cwo_Unfk.js";import{DialogHeader as ye,DialogTitle as fe,DialogFooter as ve,Dialog as ge,DialogContent as he,DialogDescription as Xe,DialogClose as Ye,DialogTrigger as Ze}from"./dialog-BBMx1wit.js";import{p as et}from"./vendor-parsing-Di7camYH.js";import{A as Se,a as Te,b as Re}from"./alert-DhiZyWgi.js";import{O as tt,I as st,d as at,Q as _e,V as rt,W as nt,Y as lt,_ as ot,$ as it,a0 as ct,X as dt,S as ut,e as De,U as ke,F as ue,z as mt,P as pt,a1 as xt}from"./vendor-icons-HRBKouGg.js";import{D as gt,g as ht,e as yt}from"./date-filter-BIFPvFKu.js";import{s as ae,e as re,M as ft,a as J,k as ne,O as X,C as le,A as oe,P as vt,p as Y}from"./vendor-utils-Cb9OXVhE.js";import{motion as ie,AnimatePresence as bt}from"./ui-animation-Dzb4KUJ1.js";import{ActivityProcessingPage as jt}from"./ActivityProcessingPage-CB6W46ue.js";import{u as Nt}from"./vendor-router-CQXjpROx.js";import"./ui-radix-extended-CHWFg20j.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-supabase-BuXd-BBn.js";import"./vendor-charts-D4YcUEy1.js";import"./input-CeE6qNqI.js";import"./label-B9drN7Ag.js";import"./ui-forms-D2VzSQqQ.js";import"./popover-BxJ1Vfi_.js";import"./select-BFsZCfaH.js";import"./table-C4c75fDG.js";import"./badge-C6MYiXDB.js";import"./avatar-pcXzE_pF.js";function wt({activity:l,onSave:m,onCancel:x}){const{updateDeal:y}=Be(),[n,h]=p.useState({client_name:l.client_name,details:l.details,amount:l.amount,status:l.status,contactIdentifier:l.contactIdentifier,contactIdentifierType:l.contactIdentifierType,type:l.type,date:l.date,priority:l.priority,quantity:l.quantity,sales_rep:l.sales_rep,monthlyMrr:l.deals?.monthly_mrr||0,oneOffRevenue:l.deals?.one_off_revenue||0,company_website:"",proposalValue:l.type==="proposal"?l.amount:0});p.useEffect(()=>{h({client_name:l.client_name,details:l.details,amount:l.amount,status:l.status,contactIdentifier:l.contactIdentifier,contactIdentifierType:l.contactIdentifierType,type:l.type,date:l.date,priority:l.priority,quantity:l.quantity,sales_rep:l.sales_rep,monthlyMrr:l.deals?.monthly_mrr||0,oneOffRevenue:l.deals?.one_off_revenue||0,company_website:"",proposalValue:l.type==="proposal"?l.amount:0})},[l]);const T=s=>{const{name:u,value:D}=s.target;h(g=>({...g,[u]:D}))},R=s=>{const{name:u,value:D}=s.target,g=parseFloat(D),j=D===""||isNaN(g)?void 0:g;h(c=>({...c,[u]:j}))},E=s=>{const{name:u,value:D}=s.target,g=parseFloat(D),j=D===""||isNaN(g)?0:g;h(c=>({...c,[u]:j}))},W=async()=>{const s={client_name:n.client_name,details:n.details,status:n.status,priority:n.priority,quantity:n.quantity,date:n.date};if(n.type!=="outbound"?(s.contactIdentifier=n.contactIdentifier,s.contactIdentifierType=n.contactIdentifierType):(s.contactIdentifier=void 0,s.contactIdentifierType=void 0),n.type==="sale"){const u=n.oneOffRevenue||0,g=(n.monthlyMrr||0)*3+u;s.amount=g}else n.type==="proposal"?s.amount=n.proposalValue:s.amount=n.amount;if(s.amount===void 0&&delete s.amount,!(!s.client_name||!s.details||!s.status)){if(n.type==="sale"&&l.deal_id)try{const u={monthly_mrr:n.monthlyMrr||null,one_off_revenue:n.oneOffRevenue||null,value:s.amount,company:n.client_name};I.log("Updating linked deal:",l.deal_id,u),await y(l.deal_id,u)}catch{}await m(l.id,s)}};return e.jsxs(e.Fragment,{children:[e.jsx(ye,{children:e.jsx(fe,{children:"Edit Activity"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Client Name"}),e.jsx("input",{type:"text",name:"client_name",value:n.client_name||"",onChange:T,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Details"}),e.jsx("input",{type:"text",name:"details",value:n.details||"",onChange:T,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]}),n.amount!==void 0&&n.amount!==null&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Amount"}),e.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",step:"0.01",name:"amount",value:n.amount??"",onChange:R,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Status"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{value:"completed",label:"Completed",icon:"âœ…",color:"bg-green-500/20 text-green-400 border-green-500/30"},{value:"pending",label:"Scheduled",icon:"ðŸ“…",color:"bg-blue-500/20 text-blue-400 border-blue-500/30"},{value:"cancelled",label:"Cancelled",icon:"âŒ",color:"bg-red-500/20 text-red-400 border-red-500/30"},{value:"no_show",label:"No Show",icon:"ðŸš«",color:"bg-orange-500/20 text-orange-400 border-orange-500/30"},...n.type==="meeting"?[{value:"discovery",label:"Discovery",icon:"ðŸ”",color:"bg-purple-500/20 text-purple-400 border-purple-500/30"}]:[]].map(s=>e.jsx("button",{type:"button",onClick:()=>h(u=>({...u,status:s.value})),className:`p-3 rounded-xl border transition-all ${n.status===s.value?`${s.color} ring-2 ring-opacity-50`:"bg-gray-800/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-base",children:s.icon}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]})},s.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Company Website"}),e.jsx("input",{type:"url",placeholder:"https://company.com",name:"company_website",value:n.company_website||"",onChange:T,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]}),n.type==="sale"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300 border-b border-gray-700 pb-2",children:"Revenue Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Monthly MRR"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500 text-sm",children:"Â£"}),e.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",name:"monthlyMrr",value:n.monthlyMrr||"",onChange:E,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl pl-8 pr-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"One-Off Revenue"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500 text-sm",children:"Â£"}),e.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",name:"oneOffRevenue",value:n.oneOffRevenue||"",onChange:E,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl pl-8 pr-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]})]})]}),(n.monthlyMrr||n.oneOffRevenue)&&e.jsxs("div",{className:"bg-gray-900/50 border border-gray-700/50 rounded-xl p-3",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:"Calculated LTV"}),e.jsxs("div",{className:"text-lg font-semibold text-[#37bd7e]",children:["Â£",((n.monthlyMrr||0)*3+(n.oneOffRevenue||0)).toLocaleString()]})]})]}),n.type==="proposal"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Proposal Value"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2.5 text-gray-500 text-sm",children:"Â£"}),e.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",name:"proposalValue",value:n.proposalValue||"",onChange:E,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl pl-8 pr-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]})]}),n.type!=="outbound"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Contact Identifier"}),e.jsx("input",{type:"text",placeholder:"Enter email or phone",name:"contactIdentifier",value:n.contactIdentifier||"",onChange:T,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent mb-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Identifier Type"}),e.jsx("input",{type:"text",placeholder:"Identifier Type (e.g., email, phone)",name:"contactIdentifierType",value:n.contactIdentifierType||"",onChange:T,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2 text-white focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]})]})]}),e.jsxs(ve,{children:[e.jsx(_,{variant:"outline",onClick:x,className:"text-black border-gray-600 hover:bg-gray-700",children:"Cancel"}),e.jsx(_,{onClick:W,children:"Save Changes"})]})]})}const ce=["id","user_id","type","status","priority","client_name","sales_rep","details","amount","date","created_at","updated_at","quantity","contact_identifier","contact_identifier_type"];function Ct({open:l,setOpen:m}){const[x,y]=p.useState(!1),[n,h]=p.useState(null),T=p.useRef(null),[R,E]=p.useState(null),W=g=>{E(g),h(null),T.current?.click()},s=g=>{const j=g.target.files?.[0];!j||!R||(y(!0),h(null),et.parse(j,{header:!1,skipEmptyLines:!0,delimiter:R==="csv"?",":"	",complete:async c=>{if(I.log("Parsed data:",c.data),!Array.isArray(c.data)||c.data.length===0||!Array.isArray(c.data[0])){S.error("Parsing failed or file is empty. Please check file format."),y(!1);return}const b=c.data.map((F,ee)=>{const Q={};return F.length!==ce.length?(I.warn(`Row ${ee+1}: Incorrect column count (${F.length}), expected ${ce.length}. Skipping.`),S.warning(`Row ${ee+1} has an incorrect number of columns (${F.length}). It will be skipped.`),null):(ce.forEach((z,me)=>{let w=F[me]?.trim();if((w==="\\N"||w==="")&&(w=null),w!==null&&(z==="amount"||z==="quantity")&&typeof w=="string"){const se=z==="amount"?parseFloat(w):parseInt(w,10);w=isNaN(se)?null:se}Q[z]=w}),!Q.id||!Q.user_id?(S.warning(`Row ${ee+1} is missing required 'id' or 'user_id'. It will be skipped.`),null):Q)}).filter(F=>F!==null);if(b.length===0){S.warning("No valid activity rows found in the file after parsing."),y(!1);return}await u(b)},error:c=>{S.error(`Error parsing ${R?.toUpperCase()} file: ${c.message}`),y(!1)}}),g.target&&(g.target.value=""))},u=async g=>{y(!0),h(null);try{const{data:{session:j},error:c}=await Ce.auth.getSession();if(c||!j){S.error("Authentication error. Please log in again."),y(!1);return}I.log("Invoking function with:",g);const{data:M,error:b}=await Ce.functions.invoke("bulk-import-activities",{body:JSON.stringify(g),headers:{"Content-Type":"application/json"}});if(b)I.error("Function Invoke Error:",b),S.error(`Function invocation failed: ${b.message}`),h({type:"error",message:`Invocation failed: ${b.message}`});else if(I.log("Function Response:",M),M.error||M.databaseError){const F=M.databaseError||M.message||M.error||"Unknown import error.";S.error(`Import failed: ${F}`),h({type:"error",...M})}else S.success(M.message||"Import completed successfully."),h({type:"success",...M})}catch(j){S.error("An unexpected error occurred during import."),h({type:"error",message:`Unexpected error: ${j.message}`})}finally{y(!1)}},D=g=>{g||(h(null),E(null)),m(g)};return e.jsx(ge,{open:l,onOpenChange:D,children:e.jsxs(he,{className:"sm:max-w-[625px] bg-gray-900 border-gray-800/50 text-white",children:[e.jsxs(ye,{children:[e.jsxs(fe,{className:"text-xl flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"})," Bulk Import Activities"]}),e.jsx(Xe,{className:"text-gray-400 pt-2 text-left",children:"Upload a CSV or TSV file to import multiple activities at once. Ensure your file adheres to the required format and column order."})]}),e.jsxs("div",{className:"py-4 space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["Required columns in order: ",e.jsx("code",{className:"text-xs bg-gray-700/50 px-1 py-0.5 rounded",children:ce.join(", ")}),".",e.jsx("br",{})," Use empty fields or ",e.jsx("code",{className:"text-xs bg-gray-700/50 px-1 py-0.5 rounded",children:"\\N"})," for null values. No header row expected."]}),e.jsxs(Se,{variant:"default",className:"border-blue-500/30 bg-blue-900/10",children:[e.jsx(st,{className:"h-4 w-4 text-blue-400"}),e.jsx(Te,{className:"text-blue-300",children:"Example File Format"}),e.jsxs(Re,{className:"text-blue-400/80 text-xs",children:[e.jsx("code",{className:"block bg-gray-700/30 px-1 py-0.5 rounded my-1",children:'ca2e54a1-...,ac4efca2-...,meeting,completed,medium,"Client Name","User Name","Notes...",,\\N,2025-01-27...,2025-01-27...,2025-01-27...,1,\\N,\\N'})," (CSV row)",e.jsx("br",{}),e.jsx("code",{className:"block bg-gray-700/30 px-1 py-0.5 rounded my-1",children:"ca2e54a1-...\\tac4efca2-...\\tmeeting\\tcompleted\\tmedium\\tClient Name\\tUser Name\\tNotes...\\t\\N\\t2025-01-27...\\t2025-01-27...\\t2025-01-27...\\t1\\t\\N\\t\\N"})," (TSV row)",e.jsx("br",{}),"Quotes may be needed for CSV fields containing commas."]})]})]}),e.jsx("input",{type:"file",ref:T,onChange:s,accept:".csv,.tsv",style:{display:"none"},disabled:x}),n&&e.jsxs(Se,{variant:n.type==="success"?"default":"destructive",className:"my-4",children:[n.type==="success"?e.jsx(at,{className:"h-4 w-4"}):e.jsx(_e,{className:"h-4 w-4"}),e.jsx(Te,{children:n.type==="success"?"Import Summary":"Import Error"}),e.jsxs(Re,{children:[n.message,e.jsx("br",{}),n.insertedCount!==void 0&&`Rows successfully inserted: ${n.insertedCount}`,e.jsx("br",{}),n.skippedLinesCount!==void 0&&`Rows skipped (parsing/validation): ${n.skippedLinesCount}`,e.jsx("br",{}),n.parsingErrors&&n.parsingErrors.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold",children:"First few parsing errors:"}),e.jsx("ul",{className:"list-disc list-inside text-xs max-h-20 overflow-y-auto",children:n.parsingErrors.map((g,j)=>e.jsx("li",{children:g},j))})]}),n.databaseError&&`Database Error: ${n.databaseError}`]})]}),e.jsxs(ve,{className:"sm:justify-start gap-2",children:[e.jsx(_,{type:"button",onClick:()=>W("csv"),disabled:x,children:x&&R==="csv"?"Processing...":"Upload CSV File"}),e.jsx(_,{type:"button",onClick:()=>W("tsv"),disabled:x,children:x&&R==="tsv"?"Processing...":"Upload TSV File"}),e.jsx(Ye,{asChild:!0,children:e.jsx(_,{type:"button",variant:"outline",disabled:x,children:"Close"})})]})]})})}function de(l,m,x=1){if(!l)return m||0;if(!(l.one_off_revenue||l.monthly_mrr||l.annual_value)&&m)return m;const n=l.one_off_revenue||0,h=l.monthly_mrr||0,T=l.annual_value||0;return T>0&&!n&&!h?T:m&&n>0&&h===0&&m!==n&&m>0?m:h*3+n}function Z(l){return l==null?"Â£0":new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(l)}function Me(l,m,x){const y=l!=null&&l>0,n=m!=null&&m>0;return x==="proposal"?n?Z(m):y?Z(l):"-":!y&&!n?"-":n&&(!y||l===m)?Z(m):y&&!n?Z(l):`${Z(l)} (LTV: ${Z(m)})`}function St(){const[l,m]=p.useState(null),{activities:x,removeActivity:y,updateActivity:n}=He(),{userData:h}=Ge(),[T,R]=p.useState(!1),[E,W]=p.useState(null),{filters:s,setFilters:u,resetFilters:D}=Ae(),j=(()=>{if(s.dateRange){const t=new Date,a=new Date(s.dateRange.start),r=new Date(s.dateRange.end);return I.log("[SalesTable] Initializing with filter date range:",{start:Y(a,"yyyy-MM-dd"),end:Y(r,"yyyy-MM-dd")}),J(a).getTime()===J(t).getTime()&&X(r).getTime()===X(t).getTime()?{type:"today",custom:null}:le(a).getTime()===le(t).getTime()&&oe(r).getTime()===oe(t).getTime()?{type:"thisWeek",custom:null}:ae(a).getTime()===ae(t).getTime()&&re(r).getTime()===re(t).getTime()?{type:"thisMonth",custom:null}:{type:"custom",custom:{start:a,end:r}}}return{type:"thisMonth",custom:null}})(),[c,M]=p.useState(j.type),[b,F]=p.useState(j.custom),[ee,Q]=p.useState(!1),[z,me]=p.useState(!1),[w,se]=p.useState(!1),{currentDateRange:O,previousDateRange:B}=p.useMemo(()=>{if(c==="custom"&&b)return{currentDateRange:b,previousDateRange:{start:new Date(b.start.getTime()-(b.end.getTime()-b.start.getTime())),end:new Date(b.start.getTime()-1)}};const t=new Date;let a,r,d,i;switch(c){case"today":a=J(t),r=X(t);const C=ne(t,1);d=J(C),i=X(C);break;case"thisWeek":a=le(t,{weekStartsOn:0}),r=oe(t,{weekStartsOn:0});const N=vt(t);d=le(N,{weekStartsOn:0}),i=oe(N,{weekStartsOn:0});break;case"last30Days":a=J(ne(t,29)),r=X(t),d=J(ne(t,59)),i=X(ne(t,30));break;case"thisMonth":default:a=ae(t),r=re(t);const $=ft(t,1);d=ae($),i=re($);break}return{currentDateRange:{start:a,end:r},previousDateRange:{start:d,end:i}}},[c,b]);p.useEffect(()=>{u({dateRange:{start:O.start,end:O.end}})},[O,u]);const L=p.useMemo(()=>x.filter(t=>{try{const a=new Date(t.date),r=a>=O.start&&a<=O.end,d=!s.type||t.type===s.type,i=!s.salesRep||t.sales_rep===s.salesRep,C=!s.clientName||t.client_name===s.clientName,N=!s.status||t.status===s.status,$=!s.priority||t.priority===s.priority,q=(!s.minAmount||t.amount&&t.amount>=s.minAmount)&&(!s.maxAmount||t.amount&&t.amount<=s.maxAmount);let A=!0;if(s.type==="sale"&&s.saleType)A=t.details?.toLowerCase().includes(s.saleType.toLowerCase())||!1;else if(s.type==="meeting"&&s.meetingType){const o=s.meetingType.toLowerCase(),v=t.details?.toLowerCase()||"";o==="discovery call"||o==="discovery meeting"?A=v.includes("discovery call")||v.includes("discovery meeting"):o==="demo"?A=v.includes("demo"):A=v.includes(o)}else s.type==="outbound"&&s.outboundType&&(A=t.details?.toLowerCase().includes(s.outboundType.toLowerCase())||!1);const K=!s.searchQuery||t.client_name?.toLowerCase().includes(s.searchQuery.toLowerCase())||t.type?.toLowerCase().includes(s.searchQuery.toLowerCase())||t.sales_rep?.toLowerCase().includes(s.searchQuery.toLowerCase())||t.details?.toLowerCase().includes(s.searchQuery.toLowerCase());return r&&d&&i&&C&&N&&$&&q&&A&&K}catch(a){return I.error("Error parsing activity date:",t.date,a),!1}}),[x,O,s]),k=p.useMemo(()=>x.filter(t=>{try{const a=new Date(t.date);return a>=O.start&&a<=O.end}catch(a){return I.error("Error parsing activity date:",t.date,a),!1}}),[x,O]),V=p.useMemo(()=>B?x.filter(t=>{try{const a=new Date(t.date);return B.start&&B.end&&a>=B.start&&a<=B.end}catch(a){return I.error("Error parsing activity date for previous period:",t.date,a),!1}}):[],[x,B]),f=p.useMemo(()=>{const t=k.filter(o=>o.type==="sale").reduce((o,v)=>{const U=v.deals?de(v.deals,v.amount):0,xe=U>(v.amount||0)?U:v.amount||0;return o+xe},0),a=k.filter(o=>o.type==="sale"&&o.status==="completed").length,r=k.filter(o=>o.type==="sale").length,d=k.filter(o=>o.type==="proposal").length,i=k.filter(o=>o.type==="meeting").length,C=k.filter(o=>o.status==="no_show").length,N=k.filter(o=>["meeting","proposal","sale"].includes(o.type)).length,$=Math.round(C/Math.max(1,N)*100)||0,q=Math.round(r/Math.max(1,d)*100)||0,A=Math.round(d/Math.max(1,i)*100)||0,K=t/(r||1);return{totalRevenue:t,activeDeals:a,proposalWinRate:q,meetingToProposalRate:A,avgDeal:K,noShowRate:$,noShowCount:C,totalScheduledCount:N}},[k]),H=p.useMemo(()=>{const t=V.filter(o=>o.type==="sale").reduce((o,v)=>{const U=v.deals?de(v.deals,v.amount):0,xe=U>(v.amount||0)?U:v.amount||0;return o+xe},0),a=V.filter(o=>o.type==="sale"&&o.status==="completed").length,r=V.filter(o=>o.type==="sale").length,d=V.filter(o=>o.type==="proposal").length,i=V.filter(o=>o.type==="meeting").length,C=V.filter(o=>o.status==="no_show").length,N=V.filter(o=>["meeting","proposal","sale"].includes(o.type)).length,$=Math.round(C/Math.max(1,N)*100)||0,q=Math.round(r/Math.max(1,d)*100)||0,A=Math.round(d/Math.max(1,i)*100)||0,K=t/(r||1);return{totalRevenue:t,activeDeals:a,proposalWinRate:q,meetingToProposalRate:A,avgDeal:K,noShowRate:$,noShowCount:C,totalScheduledCount:N}},[V]),G=(t,a)=>{if(a===0)return t===0?0:t>0?100:-100;const r=(t-a)/a*100;return Math.round(r)},$e=G(f.totalRevenue,H.totalRevenue);G(f.activeDeals,H.activeDeals);const Fe=G(f.proposalWinRate,H.proposalWinRate),Ie=G(f.meetingToProposalRate,H.meetingToProposalRate),Oe=G(f.avgDeal,H.avgDeal),Pe=G(f.noShowRate,H.noShowRate),Ee=t=>{m(t)},Le=t=>{t&&(y(t),R(!1),W(null))},Ve=t=>{W(t),R(!0)},Ue=async(t,a)=>{a.amount===void 0&&delete a.amount;try{await n({id:t,updates:a}),m(null)}catch{S.error("Failed to update activity. Please try again.")}},We=t=>{switch(t){case"sale":return De;case"outbound":return pt;case"meeting":return ke;case"proposal":return ue;default:return ue}},P=t=>{switch(t){case"sale":return"emerald";case"outbound":return"blue";case"meeting":return"violet";case"proposal":return"orange";default:return"gray"}},be=t=>{u({type:t})},pe=!!s.type,je=p.useMemo(()=>[{accessorKey:"sales_rep",header:"Sales Rep",size:200,cell:t=>{const a=t.getValue(),r=a?.split(" ").map(d=>d[0]).join("");return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-[#37bd7e]/10 border border-[#37bd7e]/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xs sm:text-sm font-medium text-[#37bd7e]",children:r||"??"})}),e.jsx("span",{className:"text-sm sm:text-base text-white",children:a||"Loading..."})]})}},{accessorKey:"type",header:"Activity Type",cell:({row:t,getValue:a})=>{const r=t.original;if(!r)return null;const d=r.quantity||1,i=a();return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`p-1.5 sm:p-2 rounded-lg ${P(i)==="blue"?"bg-blue-400/5":P(i)==="orange"?"bg-orange-500/10":`bg-${P(i)}-500/10`} border ${P(i)==="blue"?"border-blue-500/10":P(i)==="orange"?"border-orange-500/20":`border-${P(i)}-500/20`}`,children:qe.createElement(We(i),{className:`w-4 h-4 ${P(i)==="blue"?"text-blue-400":P(i)==="orange"?"text-orange-500":`text-${P(i)}-500`}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white capitalize",children:[i,i==="outbound"&&d>1&&e.jsxs("span",{className:"ml-2 text-xs text-blue-400",children:["Ã—",d]})]}),e.jsx("div",{className:"text-[10px] text-gray-400",children:Y(new Date(r.date),"MMM d")})]}),(r.amount||r.deals)&&e.jsx("div",{className:"ml-auto text-sm font-medium text-emerald-500",children:Me(r.amount,r.deals?de(r.deals,r.amount):r.type==="proposal"&&r.amount?r.amount:null,r.type)})]})}},{accessorKey:"client_name",header:"Client",size:250,enableHiding:!0,cell:t=>{const a=t.row.original;if(!a)return null;const r=t.getValue();return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-lg bg-gray-800/50 flex items-center justify-center text-white text-xs sm:text-sm font-medium",children:r?.split(" ").map(d=>d?.[0]).join("")||"??"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm sm:text-base font-medium text-white",children:r||"Unknown"}),e.jsxs("div",{className:"text-[10px] sm:text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(rt,{className:"w-2.5 h-2.5 sm:w-3 sm:h-3"}),a.details||"No details"]})]})]})}},{accessorKey:"amount",header:"Amount",size:150,enableHiding:!0,cell:t=>{const a=t.row.original;if(!a)return null;const r=t.getValue(),d=a.status,i=a.deals?de(a.deals,r):a.type==="proposal"&&r?r:null,C=Me(r,i,a.type);return e.jsxs("div",{className:"font-medium",children:[e.jsx("div",{className:"text-sm sm:text-base text-white",children:C}),e.jsx("div",{className:`text-[10px] sm:text-xs capitalize ${d==="no_show"?"text-red-400":d==="completed"?"text-green-400":d==="cancelled"?"text-yellow-400":"text-gray-400"}`,children:d==="no_show"?"No Show":d||"Unknown"}),a.deals&&e.jsxs("div",{className:"text-[10px] text-blue-400 truncate",title:a.deals.name,children:["ðŸ”— ",a.deals.name]})]})}},{accessorKey:"details",header:"Details",size:200,enableHiding:!0,cell:t=>{if(!t.row.original)return null;const r=t.getValue();return e.jsx("div",{className:"text-xs sm:text-sm text-gray-400",children:r||"No details"})}},{accessorKey:"actions",header:"",size:80,enableHiding:!0,cell:t=>{const a=t.row.original;return a?e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsxs(ge,{open:l?.id===a.id,onOpenChange:r=>{r||m(null)},children:[e.jsx(Ze,{asChild:!0,children:e.jsx(ie.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Ee(a),className:"p-2 hover:bg-[#37bd7e]/20 rounded-lg transition-colors",children:e.jsx(nt,{className:"w-4 h-4 text-gray-400 hover:text-[#37bd7e]"})})}),e.jsx(he,{className:"bg-gray-900/95 backdrop-blur-xl border-gray-800/50 text-white p-6 rounded-xl",children:l&&l.id===a.id&&e.jsx(wt,{activity:l,onSave:Ue,onCancel:()=>m(null)})})]}),e.jsx(ie.button,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",onClick:r=>{r.stopPropagation(),Ve(a.id)},children:e.jsx(lt,{className:"w-4 h-4 text-gray-400 hover:text-red-500"})})]}):null}}],[l]),te=({title:t,value:a,amount:r,percentage:d,trendPercentage:i,icon:C,color:N,contextInfo:$,period:q="vs last period"})=>{const A=i>0?`+${i}%`:`${i}%`,K=i>0?"text-emerald-500":i<0?"text-red-500":"text-gray-500",o=i>0?"â†—":i<0?"â†˜":"â†’";return e.jsxs("div",{className:`bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50 cursor-pointer hover:border-${N}-500/50 transition-all duration-300 relative min-h-[120px] flex flex-col`,onClick:()=>{const U={"Total Revenue":"sale","Meeting Conversion":"meeting","Proposal Win Rate":"proposal","No-Show Rate":void 0,"Won Deals":"sale","Average Deal Value":"sale"}[t];U===s.type?be(void 0):be(U)},children:[e.jsxs("div",{className:"absolute top-3 right-3 flex flex-col items-end",children:[e.jsxs("div",{className:`flex items-center gap-1 text-xs font-medium ${K}`,children:[e.jsx("span",{children:o}),e.jsx("span",{children:A})]}),e.jsx("div",{className:"text-[10px] text-gray-500 mt-0.5",children:q})]}),e.jsxs("div",{className:"flex items-start gap-3 pr-16 flex-1",children:[e.jsx("div",{className:`p-2.5 rounded-xl bg-${N}-500/10 border border-${N}-500/20`,children:e.jsx(C,{className:`w-5 h-5 text-${N}-500`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-gray-400 uppercase tracking-wide mb-1",children:t}),e.jsxs("div",{className:"space-y-1",children:[r&&e.jsx("div",{className:"text-2xl font-bold text-white tracking-tight",children:r}),d&&e.jsx("div",{className:"text-2xl font-bold text-white tracking-tight",children:d}),!r&&!d&&e.jsx("div",{className:"text-2xl font-bold text-white tracking-tight",children:a})]}),e.jsx("div",{className:"flex-1"}),$&&e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:$})]})]})]})},ze=()=>{try{if(L.length===0){S.error("No data to export. Please adjust your filters.");return}const t=ht(L),r=`sales-activities-${t.dateRange.start&&t.dateRange.end?`${Y(t.dateRange.start,"yyyy-MM-dd")}-to-${Y(t.dateRange.end,"yyyy-MM-dd")}`:Y(new Date,"yyyy-MM-dd")}.csv`;yt(L,{filename:r}),S.success(`Exported ${L.length} activities to ${r}`)}catch{S.error("Failed to export data. Please try again.")}};return e.jsxs("div",{className:"min-h-screen text-gray-100 p-4 sm:p-6 lg:p-8",children:[e.jsx("div",{className:"max-w-7xl mx-auto space-y-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:gap-6 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:pe?`${s.type?.charAt(0).toUpperCase()??""}${s.type?.slice(1)??""} Activities`:"Activity Log"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:pe?`Showing ${s.type||""} activities for the selected period`:"Track and manage your sales activities"})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3",children:[pe&&e.jsx(_,{variant:"secondary",onClick:D,size:"sm",children:"Show All Types"}),e.jsxs(_,{onClick:()=>se(!w),variant:"outline",size:"sm",className:`transition-colors ${w?"bg-violet-500/20 border-violet-500/40 text-violet-300 hover:bg-violet-500/30":"bg-gray-800/50 border-gray-700/50 text-gray-400 hover:bg-gray-700/50 hover:text-white"}`,children:[e.jsx(ot,{className:"w-4 h-4 mr-2"}),w?"Hide":"Show"," Subscription Stats"]}),e.jsxs(_,{onClick:ze,variant:"outline",size:"sm",className:"bg-emerald-500/10 border-emerald-500/20 text-emerald-400 hover:bg-emerald-500/20 hover:text-emerald-300 transition-colors",disabled:L.length===0,children:[e.jsx(it,{className:"w-4 h-4 mr-2"}),"Export CSV (",L.length,")"]}),e.jsx(gt,{value:c,customRange:b,onPresetChange:M,onCustomRangeChange:F,label:"Activity Date",compact:!0,className:"min-w-[160px]"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{variant:"outline",onClick:()=>me(!z),className:"bg-gray-800/50 border-gray-700/50 text-white hover:bg-gray-700/50",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Advanced Filters",(s.type||s.salesRep||s.status||s.priority||s.searchQuery)&&e.jsx("span",{className:"ml-2 bg-emerald-500 text-white text-xs rounded-full px-2 py-0.5",children:"Active"})]}),(s.type||s.salesRep||s.status||s.priority||s.searchQuery)&&e.jsxs(_,{variant:"ghost",size:"sm",onClick:D,className:"text-gray-400 hover:text-white",children:[e.jsx(dt,{className:"w-4 h-4 mr-1"}),"Clear All"]})]}),e.jsx(bt,{children:z&&e.jsx(ie.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ut,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search activities, clients, details...",value:s.searchQuery,onChange:t=>u({searchQuery:t.target.value}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg pl-10 pr-4 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Activity Type"}),e.jsxs("select",{value:s.type||"all",onChange:t=>u({type:t.target.value==="all"?void 0:t.target.value}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"sale",children:"Sales"}),e.jsx("option",{value:"outbound",children:"Outbound"}),e.jsx("option",{value:"meeting",children:"Meetings"}),e.jsx("option",{value:"proposal",children:"Proposals"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Sales Rep"}),e.jsxs("select",{value:s.salesRep||"all",onChange:t=>u({salesRep:t.target.value==="all"?void 0:t.target.value}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Sales Reps"}),Array.from(new Set(x.map(t=>t.sales_rep).filter(Boolean))).sort().map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Status"}),e.jsxs("select",{value:s.status||"all",onChange:t=>u({status:t.target.value==="all"?void 0:t.target.value}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"no_show",children:"No Show"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Priority"}),e.jsxs("select",{value:s.priority||"all",onChange:t=>u({priority:t.target.value==="all"?void 0:t.target.value}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Priorities"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"low",children:"Low"})]})]})]}),s.type&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:s.type==="sale"?"Sale Type":s.type==="meeting"?"Meeting Type":s.type==="outbound"?"Outbound Type":"Sub Type"}),e.jsxs("select",{value:s.type==="sale"?s.saleType||"all":s.type==="meeting"?s.meetingType||"all":s.type==="outbound"&&s.outboundType||"all",onChange:t=>{const a=t.target.value==="all"?void 0:t.target.value;s.type==="sale"?u({saleType:a}):s.type==="meeting"?u({meetingType:a}):s.type==="outbound"&&u({outboundType:a})},className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),s.type==="sale"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"one-off",children:"One-off"}),e.jsx("option",{value:"subscription",children:"Subscription"}),e.jsx("option",{value:"lifetime",children:"Lifetime"})]}),s.type==="meeting"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"Discovery",children:"Discovery"}),e.jsx("option",{value:"Demo",children:"Demo"}),e.jsx("option",{value:"Follow-up",children:"Follow-up"}),e.jsx("option",{value:"Proposal",children:"Proposal"}),e.jsx("option",{value:"Client Call",children:"Client Call"}),e.jsx("option",{value:"Other",children:"Other"})]}),s.type==="outbound"&&e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"Call",children:"Phone Call"}),e.jsx("option",{value:"Email",children:"Email"}),e.jsx("option",{value:"LinkedIn",children:"LinkedIn"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Amount Range"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",placeholder:"Min amount",value:s.minAmount||"",onChange:t=>u({minAmount:t.target.value?parseFloat(t.target.value):void 0}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent"}),e.jsx("input",{type:"number",placeholder:"Max amount",value:s.maxAmount||"",onChange:t=>u({maxAmount:t.target.value?parseFloat(t.target.value):void 0}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Client"}),e.jsxs("select",{value:s.clientName||"all",onChange:t=>u({clientName:t.target.value==="all"?void 0:t.target.value}),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Clients"}),Array.from(new Set(x.map(t=>t.client_name).filter(Boolean))).sort().map(t=>e.jsx("option",{value:t,children:t},t))]})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4 px-4 sm:px-0 auto-rows-fr",children:[e.jsx(te,{title:"Total Revenue",value:f.totalRevenue,amount:`Â£${f.totalRevenue.toLocaleString()}`,trendPercentage:$e,icon:De,color:"emerald",contextInfo:`From ${k.filter(t=>t.type==="sale").length} completed sales`,period:c==="today"?"vs yesterday":c==="thisWeek"?"vs last week":c==="last30Days"?"vs prev 30 days":"vs last month"},"revenue"),e.jsx(te,{title:"Meeting Conversion",value:f.meetingToProposalRate,percentage:`${f.meetingToProposalRate}%`,trendPercentage:Ie,icon:ke,color:"cyan",contextInfo:`${k.filter(t=>t.type==="proposal").length} proposals from ${k.filter(t=>t.type==="meeting").length} meetings`,period:c==="today"?"vs yesterday":c==="thisWeek"?"vs last week":c==="last30Days"?"vs prev 30 days":"vs last month"},"meetingConversion"),e.jsx(te,{title:"Proposal Win Rate",value:f.proposalWinRate,percentage:`${f.proposalWinRate}%`,trendPercentage:Fe,icon:ue,color:"blue",contextInfo:`${k.filter(t=>t.type==="sale").length} wins from ${k.filter(t=>t.type==="proposal").length} proposals`,period:c==="today"?"vs yesterday":c==="thisWeek"?"vs last week":c==="last30Days"?"vs prev 30 days":"vs last month"},"proposalWinRate"),e.jsx(te,{title:"No-Show Rate",value:f.noShowRate,percentage:`${f.noShowRate}%`,trendPercentage:Pe,icon:_e,color:"red",contextInfo:`${f.noShowCount} no-shows from ${f.totalScheduledCount} scheduled`,period:c==="today"?"vs yesterday":c==="thisWeek"?"vs last week":c==="last30Days"?"vs prev 30 days":"vs last month"},"noShowRate"),e.jsx(te,{title:"Avg Deal Value",value:Math.round(f.avgDeal),amount:`Â£${Math.round(f.avgDeal).toLocaleString()}`,trendPercentage:Oe,icon:mt,color:"amber",contextInfo:`Average from ${f.activeDeals} won deals`,period:c==="today"?"vs yesterday":c==="thisWeek"?"vs last week":c==="last30Days"?"vs prev 30 days":"vs last month"},"avgdeal")]}),w&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Subscription Management"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Revenue Overview"})]}),e.jsx(Je,{className:"w-full"})]}),e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-lg border border-gray-800/50 overflow-hidden w-full",children:e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-gray-800/50",children:je.map(t=>e.jsx("th",{className:"px-2 py-2 text-left text-xs font-medium text-gray-400 whitespace-nowrap",style:{width:t.size?`${t.size}px`:"auto"},children:t.header?t.header.toString():""},t.accessorKey||t.id||Math.random()))})}),e.jsx("tbody",{children:L.map((t,a)=>e.jsx(ie.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:a*.02},className:"relative border-b border-gray-800/50 hover:bg-gray-800/20 cursor-pointer",children:je.map(r=>{const d={row:{original:t},getValue:()=>t[r.accessorKey]};return e.jsx("td",{className:"px-2 py-2",style:{width:r.size?`${r.size}px`:"auto"},children:r.cell?r.cell(d):JSON.stringify(t[r.accessorKey])},r.accessorKey||r.id||`${t.id}-${r.accessorKey}`)})},t.id))})]}),L.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-400",children:"No activities found for the selected period."})})]})})]})}),e.jsx(ge,{open:T,onOpenChange:R,children:e.jsxs(he,{className:"bg-gray-900/95 backdrop-blur-xl border-gray-800/50 text-white p-6 rounded-xl",children:[e.jsx(ye,{children:e.jsx(fe,{children:"Delete Activity"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-gray-400",children:"Are you sure you want to delete this activity? This action cannot be undone."})}),e.jsxs(ve,{children:[e.jsx(_,{type:"button",variant:"ghost",onClick:()=>R(!1),className:"bg-gray-800/50 text-gray-300 hover:bg-gray-800 transition-colors",children:"Cancel"}),e.jsx(_,{type:"button",onClick:()=>{Le(E)},className:"bg-red-500 hover:bg-red-600 text-white",children:"Delete"})]})]})}),h?.is_admin&&e.jsx(Ct,{open:ee,setOpen:Q})]})}function Xt(){const{resetFilters:l}=Ae(),m=Nt(),x=p.useRef(!1),[y,n]=p.useState("log");return p.useEffect(()=>(!m.state||!m.state.preserveFilters?x.current||l():x.current=!0,()=>{x.current=!1}),[m,l]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 text-gray-100",children:e.jsx("div",{className:"p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Activity Management"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Track activities and process raw data"})]})}),e.jsxs(Ke,{value:y,onValueChange:n,className:"space-y-6",children:[e.jsxs(Qe,{className:"bg-gray-900/50 backdrop-blur-xl border border-gray-800/50",children:[e.jsxs(Ne,{value:"log",className:"flex items-center gap-2 data-[state=active]:bg-[#37bd7e]/10 data-[state=active]:text-white",children:[e.jsx(ue,{className:"w-4 h-4"}),"Activity Log"]}),e.jsxs(Ne,{value:"processing",className:"flex items-center gap-2 data-[state=active]:bg-[#37bd7e]/10 data-[state=active]:text-white",children:[e.jsx(xt,{className:"w-4 h-4"}),"Activity Processing"]})]}),e.jsx(we,{value:"log",className:"space-y-0",children:e.jsx(St,{})}),e.jsx(we,{value:"processing",className:"space-y-0",children:e.jsx(jt,{})})]})]})})})}export{Xt as default};
