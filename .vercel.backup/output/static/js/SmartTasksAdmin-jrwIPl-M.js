import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as i}from"./vendor-react-DoYyFkVR.js";import{e as R,s as c,w as L,a as r}from"./index.html-Cwo_Unfk.js";import{a as O}from"./vendor-router-CQXjpROx.js";import{a5 as Y,Z as M,c as W,k as f,X as H,a3 as X,A as v,h as Z,d as j,Q as w,i as $,W as z,Y as B}from"./vendor-icons-HRBKouGg.js";import"./vendor-supabase-BuXd-BBn.js";import"./vendor-utils-Cb9OXVhE.js";import"./ui-radix-core-CdvL28QE.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";const p=[{value:"proposal",label:"Proposal Sent",icon:"ðŸ“„"},{value:"meeting",label:"Meeting Scheduled",icon:"ðŸ“…"},{value:"outbound",label:"Outbound Activity",icon:"ðŸ“¤"},{value:"demo",label:"Demo Completed",icon:"ðŸ–¥ï¸"},{value:"signed",label:"Deal Signed",icon:"âœ…"},{value:"negotiation",label:"Negotiation Started",icon:"ðŸ’¬"},{value:"follow_up",label:"Follow Up",icon:"ðŸ“ž"},{value:"email",label:"Email Sent",icon:"âœ‰ï¸"},{value:"call",label:"Call Made",icon:"ðŸ“±"}],N=[{value:"follow_up",label:"Follow Up"},{value:"onboarding",label:"Onboarding"},{value:"check_in",label:"Check In"},{value:"reminder",label:"Reminder"},{value:"action",label:"Action Required"}],_=[{value:"low",label:"Low",color:"bg-blue-500/10 text-blue-400 border-blue-500/20"},{value:"medium",label:"Medium",color:"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"},{value:"high",label:"High",color:"bg-orange-500/10 text-orange-400 border-orange-500/20"},{value:"urgent",label:"Urgent",color:"bg-red-500/10 text-red-400 border-red-500/20"}];function ie(){const m=O(),{user:g}=R(),[h,k]=i.useState([]),[T,C]=i.useState(!0),[o,u]=i.useState(null),[b,n]=i.useState(!1),[K,A]=i.useState(null),[a,l]=i.useState({trigger_activity_type:"",task_title:"",task_description:"",days_after_trigger:3,task_type:"follow_up",priority:"medium",is_active:!0});i.useEffect(()=>{S(),d()},[]);const S=async()=>{if(!g){m("/");return}const{data:t}=await c.from("user_profiles").select("*").eq("id",g.id).single();t&&(A(t),L(t)||(r.error("Admin access required"),m("/")))},d=async()=>{try{const{data:t,error:s}=await c.from("smart_task_templates").select("*").order("trigger_activity_type",{ascending:!0});if(s)throw s;k(t||[])}catch{r.error("Failed to load smart task templates")}finally{C(!1)}},E=async()=>{try{const t={...a};if(delete t.id,delete t.created_at,delete t.updated_at,o){const{error:s}=await c.from("smart_task_templates").update(t).eq("id",o);if(s)throw s;r.success("Template updated successfully")}else{const{error:s}=await c.from("smart_task_templates").insert([{...t,created_by:g?.id}]);if(s)throw s;r.success("Template created successfully")}u(null),n(!1),y(),d()}catch(t){t.message?.includes("duplicate")?r.error("A template with this trigger and title already exists"):r.error("Failed to save template")}},F=async t=>{if(confirm("Are you sure you want to delete this template?"))try{const{error:s}=await c.from("smart_task_templates").delete().eq("id",t);if(s)throw s;r.success("Template deleted successfully"),d()}catch{r.error("Failed to delete template")}},D=async(t,s)=>{try{const{error:x}=await c.from("smart_task_templates").update({is_active:!s}).eq("id",t);if(x)throw x;r.success(`Template ${s?"deactivated":"activated"}`),d()}catch{r.error("Failed to update template status")}},I=t=>{l(t),u(t.id),n(!1)},y=()=>{l({trigger_activity_type:"",task_title:"",task_description:"",days_after_trigger:3,task_type:"follow_up",priority:"medium",is_active:!0})},P=()=>{u(null),n(!1),y()},q=t=>_.find(s=>s.value===t)?.color||"",U=t=>p.find(s=>s.value===t)?.icon||"ðŸ“Œ";return T?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 flex items-center justify-center",children:e.jsx("div",{className:"text-white",children:"Loading..."})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>m("/admin"),className:"mb-4 inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(Y,{className:"w-4 h-4"}),"Back to Admin"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx(M,{className:"w-8 h-8 text-purple-400"}),"Smart Tasks Administration"]}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Configure automated follow-up tasks based on activity triggers"})]}),!b&&!o&&e.jsxs("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"New Template"]})]})]}),(b||o)&&e.jsxs("div",{className:"mb-8 p-6 bg-gray-900/50 backdrop-blur-sm border border-gray-800 rounded-lg",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:o?"Edit Template":"Create New Template"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Trigger Activity Type"}),e.jsxs("select",{value:a.trigger_activity_type,onChange:t=>l({...a,trigger_activity_type:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0,children:[e.jsx("option",{value:"",children:"Select trigger..."}),p.map(t=>e.jsxs("option",{value:t.value,children:[t.icon," ",t.label]},t.value))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Task Type"}),e.jsx("select",{value:a.task_type,onChange:t=>l({...a,task_type:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:N.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Task Title"}),e.jsx("input",{type:"text",value:a.task_title,onChange:t=>l({...a,task_title:t.target.value}),placeholder:"e.g., Follow up on proposal",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Days After Trigger"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:a.days_after_trigger,onChange:t=>l({...a,days_after_trigger:parseInt(t.target.value)||0}),min:"0",max:"90",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"}),e.jsx(f,{className:"w-5 h-5 text-gray-400"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Priority"}),e.jsx("select",{value:a.priority,onChange:t=>l({...a,priority:t.target.value}),className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:_.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Status"}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.is_active,onChange:t=>l({...a,is_active:t.target.checked}),className:"w-4 h-4 text-purple-600 bg-gray-800 border-gray-600 rounded focus:ring-purple-500"}),e.jsx("span",{className:"text-white",children:"Active"})]})})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Task Description"}),e.jsx("textarea",{value:a.task_description,onChange:t=>l({...a,task_description:t.target.value}),placeholder:"Provide detailed instructions for this task...",rows:3,className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 resize-none"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsxs("button",{onClick:P,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(H,{className:"w-4 h-4"}),"Cancel"]}),e.jsxs("button",{onClick:E,disabled:!a.trigger_activity_type||!a.task_title,className:"px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg flex items-center gap-2 transition-colors",children:[e.jsx(X,{className:"w-4 h-4"}),o?"Update":"Create"]})]})]}),e.jsx("div",{className:"space-y-4",children:h.length===0?e.jsxs("div",{className:"text-center py-12 bg-gray-900/50 backdrop-blur-sm border border-gray-800 rounded-lg",children:[e.jsx(v,{className:"w-12 h-12 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"No smart task templates configured yet"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Create your first template to start automating follow-ups"})]}):h.map(t=>e.jsx("div",{className:"p-6 bg-gray-900/50 backdrop-blur-sm border border-gray-800 rounded-lg hover:border-gray-700 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:U(t.trigger_activity_type)}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:t.task_title}),e.jsxs("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${q(t.priority)}`,children:[e.jsx(Z,{className:"w-3 h-3 inline mr-1"}),t.priority]}),t.is_active?e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-500/10 text-green-400 border border-green-500/20",children:[e.jsx(j,{className:"w-3 h-3 inline mr-1"}),"Active"]}):e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-gray-500/10 text-gray-400 border border-gray-500/20",children:[e.jsx(w,{className:"w-3 h-3 inline mr-1"}),"Inactive"]})]}),e.jsx("p",{className:"text-gray-400 mb-3",children:t.task_description||"No description provided"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),e.jsxs("span",{children:["Trigger: ",p.find(s=>s.value===t.trigger_activity_type)?.label]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsxs("span",{children:["Create after: ",t.days_after_trigger," ",t.days_after_trigger===1?"day":"days"]})]}),e.jsxs("div",{children:["Type: ",N.find(s=>s.value===t.task_type)?.label]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx("button",{onClick:()=>D(t.id,t.is_active),className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",title:t.is_active?"Deactivate":"Activate",children:t.is_active?e.jsx(w,{className:"w-4 h-4 text-gray-400"}):e.jsx(j,{className:"w-4 h-4 text-green-400"})}),e.jsx("button",{onClick:()=>I(t),className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",title:"Edit",children:e.jsx(z,{className:"w-4 h-4 text-blue-400"})}),e.jsx("button",{onClick:()=>F(t.id),className:"p-2 hover:bg-gray-800 rounded-lg transition-colors",title:"Delete",children:e.jsx(B,{className:"w-4 h-4 text-red-400"})})]})]})},t.id))}),e.jsx("div",{className:"mt-8 p-6 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{className:"w-5 h-5 text-blue-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-medium mb-2",children:"How Smart Tasks Work"}),e.jsxs("ul",{className:"space-y-1 text-sm text-gray-300",children:[e.jsx("li",{children:"â€¢ When an activity matching a trigger type is created, the system automatically generates follow-up tasks"}),e.jsx("li",{children:"â€¢ Tasks are created with the specified delay (days after trigger)"}),e.jsx("li",{children:"â€¢ Each task is assigned to the same owner as the triggering activity"}),e.jsx("li",{children:"â€¢ Tasks are linked to the same deal as the activity for easy tracking"}),e.jsx("li",{children:"â€¢ Only active templates will generate tasks"})]})]})]})})]})})}export{ie as default};
