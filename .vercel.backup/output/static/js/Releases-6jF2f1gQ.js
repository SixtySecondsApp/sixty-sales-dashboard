import{j as e}from"./vendor-state-CpjwTZNq.js";import{r}from"./vendor-react-DoYyFkVR.js";import{l as d,B as D,a as L}from"./index.html-Cwo_Unfk.js";import{B as y}from"./badge-C6MYiXDB.js";import{u as H,H as U,ao as A,k as T,ap as M,R as P,$ as _,X as G,j as F,aq as q}from"./vendor-icons-HRBKouGg.js";import{AnimatePresence as z,motion as V}from"./ui-animation-Dzb4KUJ1.js";import"./vendor-router-CQXjpROx.js";import"./vendor-supabase-BuXd-BBn.js";import"./vendor-utils-Cb9OXVhE.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-charts-D4YcUEy1.js";const $=3e4,O=5e3;function W(){const[u,k]=r.useState(()=>{try{return localStorage.getItem("currentBuildId")||null}catch{return null}}),[f,h]=r.useState(!1),[p,b]=r.useState(null),[j,v]=r.useState([]),[I,C]=r.useState(!0),[B,x]=r.useState(null),n=r.useRef(null),w=r.useRef(!1),S=r.useCallback(async()=>{try{const a=new AbortController,l=setTimeout(()=>a.abort(),O),t=await fetch("/version.json",{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},signal:a.signal});if(clearTimeout(l),!t.ok)throw new Error(`Failed to fetch version: ${t.status} ${t.statusText}`);const i=await t.json();if(!i.buildId||!i.builtAt)throw new Error("Invalid version data structure");return i}catch(a){throw a instanceof Error?a.name==="AbortError"?new Error("Version check timeout"):a:new Error("Unknown error fetching version data")}},[]),g=r.useCallback(async()=>{try{const a=new AbortController,l=setTimeout(()=>a.abort(),O),t=await fetch("/releases.json",{method:"GET",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},signal:a.signal});if(clearTimeout(l),!t.ok)throw new Error(`Failed to fetch releases: ${t.status} ${t.statusText}`);const i=await t.json();if(!Array.isArray(i))throw new Error("Invalid releases data structure");const E=i.filter(s=>s.buildId&&s.date&&s.notes);return E.length!==i.length&&d.warn("Some release entries were filtered out due to invalid structure"),E}catch(a){throw a instanceof Error?a.name==="AbortError"?new Error("Releases fetch timeout"):a:new Error("Unknown error fetching releases data")}},[]),o=r.useCallback(async(a=!1)=>{if(!w.current){w.current=!0;try{a||C(!0),x(null);const l=await S();if(l){const t=l.buildId;if(u)t!==u?(d.log("ðŸ”„ Update detected:",{current:u,new:t}),h(!0),b(t)):(h(!1),b(null));else{k(t);try{localStorage.setItem("currentBuildId",t)}catch(i){d.warn("Failed to store current build ID:",i)}h(!1),b(null),d.log("ðŸ Initial version set:",t)}}if(j.length===0||!a){const t=await g();v(t)}}catch(l){const t=l instanceof Error?l.message:"Unknown error checking for updates";x(t)}finally{C(!1),w.current=!1}}},[u,S,g,j.length]),R=r.useCallback(async()=>{try{if(d.log("ðŸ§¹ Clearing caches and reloading..."),p&&typeof localStorage<"u")try{localStorage.setItem("currentBuildId",p),d.log("âœ… Updated current build ID to:",p)}catch(a){d.warn("Failed to update build ID:",a)}if(typeof localStorage<"u"){const a=localStorage.getItem("currentBuildId");localStorage.clear(),a&&localStorage.setItem("currentBuildId",a),d.log("âœ… localStorage cleared (keeping updated build ID)")}if(typeof sessionStorage<"u"&&(sessionStorage.clear(),d.log("âœ… sessionStorage cleared")),"caches"in window){const a=await caches.keys();await Promise.all(a.map(l=>caches.delete(l))),d.log("âœ… Cache Storage cleared")}if("indexedDB"in window)try{d.log("ðŸ” IndexedDB cleanup attempted")}catch(a){d.warn("IndexedDB cleanup failed:",a)}n.current&&(clearInterval(n.current),n.current=null),window.location.reload()}catch{throw new Error("Failed to clear caches")}},[p]);return r.useEffect(()=>(o(),n.current=setInterval(()=>{o(!0)},$),()=>{n.current&&(clearInterval(n.current),n.current=null)}),[o]),r.useEffect(()=>{const a=()=>{document.visibilityState==="visible"?n.current||(o(!0),n.current=setInterval(()=>{o(!0)},$)):n.current&&(clearInterval(n.current),n.current=null)};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[o]),{clientBuildId:u,updateAvailable:f,newBuildId:p,releases:j,clearCachesAndReload:R,isLoading:I,error:B}}function le(){const{clientBuildId:u,updateAvailable:k,newBuildId:f,releases:h,clearCachesAndReload:p,isLoading:b,error:j}=W(),[v,I]=r.useState(!1),[C,B]=r.useState(!1),[x,n]=r.useState(""),[w,S]=r.useState(!1),g=h.find(s=>s.buildId===u),o=h.find(s=>s.buildId===f),R=async()=>{try{I(!0),L.loading("Updating application..."),await new Promise(s=>setTimeout(s,1e3)),await p()}catch{L.error("Update failed. Please try refreshing manually."),I(!1)}},a=s=>{const c=s.match(/v\d+\.\d+\.\d+/);if(c)return c[0];const m=s.match(/(\d{4}-\d{2}-\d{2})/);return m?`Build ${m[1]}`:s},l=s=>{try{return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}},t=s=>{const c=s.match(/v(\d+)\.(\d+)\.(\d+)/);if(c){const[,,m,N]=c;return m==="0"&&N==="0"}return!1},i=h.filter(s=>{const c=!x||s.buildId.toLowerCase().includes(x.toLowerCase())||s.notes.toLowerCase().includes(x.toLowerCase())||l(s.date).toLowerCase().includes(x.toLowerCase()),m=!w||t(s.buildId);return c&&m}),E=s=>{const c=s.buildId===u,m=s.buildId===f,N=t(s.buildId);return c?e.jsxs(y,{className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",children:[e.jsx(F,{className:"w-3 h-3 mr-1"}),"Current"]}):m?e.jsxs(y,{className:"bg-blue-500/10 text-blue-400 border-blue-500/20",children:[e.jsx(q,{className:"w-3 h-3 mr-1"}),"Available"]}):N?e.jsxs(y,{variant:"outline",className:"text-purple-400 border-purple-500/30",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Major"]}):null};return b&&h.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-800 rounded-lg w-64"}),e.jsx("div",{className:"h-32 bg-gray-800 rounded-xl"}),e.jsx("div",{className:"grid gap-4",children:Array.from({length:5}).map((s,c)=>e.jsx("div",{className:"h-24 bg-gray-800 rounded-xl"},c))})]})})}):j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Releases"}),e.jsx("p",{className:"text-gray-400",children:j})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white",children:e.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-8",children:[e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10 border border-blue-500/20",children:e.jsx(U,{className:"w-6 h-6 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Releases & Updates"}),e.jsx("p",{className:"text-gray-400",children:"Version history, release notes, and system updates"})]})]})})}),e.jsx(z,{children:k&&!C&&e.jsx(V.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-gradient-to-r from-emerald-500/10 to-blue-500/10 border border-emerald-500/20 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:e.jsx(A,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-3",children:["New Version Available",f&&e.jsx(y,{variant:"outline",className:"text-emerald-400 border-emerald-500/30",children:a(f)})]}),e.jsx("p",{className:"text-gray-300",children:"A new version of the application is ready to install"})]}),o&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:[e.jsx("p",{className:"text-gray-300 font-medium mb-2",children:"What's New:"}),e.jsx("p",{className:"text-gray-400 mb-3",children:o.notes}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-500 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),l(o.date)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"}),a(o.buildId)]})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{onClick:R,disabled:v,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:v?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Update Now"]})}),e.jsx(D,{onClick:()=>B(!0),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:e.jsx(G,{className:"w-4 h-4"})})]})]})})}),g&&e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:e.jsx(F,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Current Version"}),e.jsx(y,{className:"bg-emerald-500/10 text-emerald-400 border-emerald-500/20",children:a(g.buildId)}),t(g.buildId)&&e.jsxs(y,{variant:"outline",className:"text-purple-400 border-purple-500/30",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Major Release"]})]}),e.jsx("p",{className:"text-gray-400 mb-3",children:g.notes}),e.jsx("div",{className:"flex items-center gap-4 text-gray-500 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),l(g.date)]})})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx("input",{type:"text",placeholder:"Search releases...",value:x,onChange:s=>n(s.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:s=>S(s.target.checked),className:"rounded border-gray-600 bg-gray-800 text-blue-500 focus:ring-blue-500"}),"Major releases only"]})})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"text-gray-400",children:["Showing ",i.length," of ",h.length," releases"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(U,{className:"w-6 h-6"}),"Release History"]}),e.jsx("div",{className:"space-y-3",children:i.map((s,c)=>{const m=s.buildId===u,N=s.buildId===f;return e.jsx(V.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.05},className:`p-4 rounded-lg border transition-all hover:bg-gray-800/30 ${m?"bg-emerald-500/5 border-emerald-500/30 ring-1 ring-emerald-500/20":N?"bg-blue-500/5 border-blue-500/30":"bg-gray-800/20 border-gray-700/30"}`,children:e.jsx("div",{className:"flex items-start justify-between gap-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"font-semibold text-white text-lg",children:a(s.buildId)}),E(s)]}),e.jsx("p",{className:"text-gray-300 mb-3 leading-relaxed",children:s.notes}),e.jsxs("div",{className:"flex items-center gap-4 text-gray-500 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),l(s.date)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-4 h-4"}),s.buildId]})]})]})})},s.buildId)})}),i.length===0&&x&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"No releases found"}),e.jsx("p",{className:"text-gray-500",children:"No releases match your search criteria. Try adjusting your filters."})]})]}),b&&e.jsxs("div",{className:"flex items-center justify-center gap-2 text-gray-400 py-8",children:[e.jsx(P,{className:"w-5 h-5 animate-spin"}),"Checking for updates..."]})]})})}export{le as default};
