import{j as t}from"./vendor-state-CpjwTZNq.js";import{r as f,a as v}from"./vendor-react-DoYyFkVR.js";import{l,s as p,c as b}from"./index.html-Cwo_Unfk.js";import{U as x,a4 as j,x as N}from"./vendor-icons-HRBKouGg.js";function $(){const[s,r]=f.useState([]),[h,m]=f.useState(!0),[o,u]=f.useState(null);return f.useEffect(()=>{async function n(){try{m(!0),u(null),l.log("ðŸ”„ Fetching owners from database...");const{data:{user:i},error:c}=await p.auth.getUser();if(c||!i){l.warn("No authenticated user, skipping owners fetch"),r([]);return}const{data:e,error:d}=await p.from("profiles").select("*").order("created_at",{ascending:!0});if(d)throw l.error("Database error fetching profiles:",d),d;if(!e||e.length===0){l.warn("No profiles found in database, trying to get at least current user");const{data:a,error:_}=await p.from("profiles").select("*").eq("id",i.id).single();if(a&&!_){l.log("Found current user profile, using as single owner");const y={id:a.id,first_name:a.first_name,last_name:a.last_name,full_name:a.full_name||(a.first_name||a.last_name?`${a.first_name||""} ${a.last_name||""}`.trim():null),stage:a.stage||"Sales Rep",email:a.email||i.email||`user_${a.id.slice(0,8)}@private.local`};r([y])}else l.warn("No profiles found at all, setting empty list"),r([]);return}const g=e.map(a=>({id:a.id,first_name:a.first_name,last_name:a.last_name,full_name:a.full_name||(a.first_name||a.last_name?`${a.first_name||""} ${a.last_name||""}`.trim():null),stage:a.stage||"Sales Rep",email:a.email||`user_${a.id.slice(0,8)}@private.local`}));l.log(`âœ… Successfully fetched ${g.length} owners from database`),l.log("Owners data:",g.map(a=>({id:a.id,name:a.full_name,email:a.email}))),r(g)}catch(i){r([]),u(i instanceof Error?i:new Error("Failed to fetch owners from database"))}finally{m(!1)}}n()},[]),{owners:s,isLoading:h,error:o}}function F({selectedOwnerId:s,onOwnerChange:r,placeholder:h="Filter by sales rep...",className:m=""}){const{owners:o,isLoading:u}=$(),{userData:n}=b();v.useEffect(()=>{n?.id&&s===void 0&&r(n.id)},[n?.id,s,r]);const i=e=>e.full_name?e.full_name:e.first_name||e.last_name?`${e.first_name||""} ${e.last_name||""}`.trim():e.email,c=e=>e.first_name&&e.last_name?`${e.first_name[0]}${e.last_name[0]}`.toUpperCase():e.first_name?e.first_name[0].toUpperCase():e.last_name?e.last_name[0].toUpperCase():e.email[0].toUpperCase();return u?t.jsx("div",{className:`relative ${m}`,children:t.jsxs("div",{className:"flex items-center gap-2 px-3 py-3 bg-gray-900/80 border border-gray-700 rounded-lg text-gray-400",children:[t.jsx(x,{className:"w-4 h-4"}),t.jsx("span",{children:"Loading sales reps..."})]})}):t.jsxs("div",{className:`relative ${m}`,children:[t.jsxs("select",{value:s||"",onChange:e=>r(e.target.value===""?void 0:e.target.value),className:"appearance-none w-full px-3 py-3 pl-10 pr-10 bg-gray-900/80 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-1 focus:ring-violet-500 focus:border-violet-500 hover:bg-gray-800/70 transition-colors cursor-pointer",children:[n&&t.jsx("option",{value:n.id,className:"bg-gray-800 text-white",children:"ðŸ‘¤ My Items Only"}),t.jsx("option",{value:"",className:"bg-gray-800 text-white",children:"ðŸ“‹ All Sales Representatives"}),o.length>0&&t.jsx("option",{disabled:!0,className:"bg-gray-700 text-gray-400 font-medium",children:"â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"}),o.map(e=>t.jsxs("option",{value:e.id,className:"bg-gray-800 text-white",children:[i(e),e.stage&&` (${e.stage})`]},e.id))]}),t.jsx("div",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:t.jsx(x,{className:"w-4 h-4 text-gray-400"})}),s&&t.jsx("div",{className:"absolute right-8 top-1/2 transform -translate-y-1/2 pointer-events-none",children:s===n?.id?t.jsx(j,{className:"w-4 h-4 text-violet-400"}):t.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-xs font-medium text-white",children:o.find(e=>e.id===s)&&c(o.find(e=>e.id===s))})}),t.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:t.jsx(N,{className:"w-4 h-4 text-gray-400"})})]})}export{F as O,$ as u};
