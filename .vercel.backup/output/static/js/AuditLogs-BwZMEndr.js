import{j as e}from"./vendor-state-CpjwTZNq.js";import{r}from"./vendor-react-DoYyFkVR.js";import{u as B,f as I,g as U}from"./useAuditLogs-CoIXGfwI.js";import{B as C}from"./badge-C6MYiXDB.js";import{B as S}from"./index.html-Cwo_Unfk.js";import{I as A}from"./input-CeE6qNqI.js";import{C as x,a as m,b as D,c as E,d as V}from"./card-B2-KTHtJ.js";import{A as H,a0 as P,S as J,F as O,x as Y,C as q,aF as z,k as G}from"./vendor-icons-HRBKouGg.js";import{p as h}from"./vendor-utils-Cb9OXVhE.js";import"./vendor-router-CQXjpROx.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";function oe(){const{isAdmin:n,loading:g,error:u,getRecentAuditLogs:T,searchAuditLogs:L}=B(),[i,j]=r.useState([]),[p,k]=r.useState(new Set),[K,Q]=r.useState(""),[d,y]=r.useState(""),[c,b]=r.useState(""),[t,o]=r.useState({start:null,end:null}),[v,N]=r.useState(!1),f=async()=>{try{const s=await T(100);j(s),N(!0)}catch{N(!0)}};r.useEffect(()=>{n&&!v&&f()},[n,v]);const _=async()=>{try{const s={};d&&(s.tableName=d),c&&(s.action=c),t.start&&(s.startDate=t.start),t.end&&(s.endDate=t.end);const a=await L(s);j(a)}catch{}},R=s=>{const a=new Set(p);a.has(s)?a.delete(s):a.add(s),k(a)},M=s=>{switch(s){case"INSERT":return"bg-green-500/20 text-green-400 border-green-500/30";case"UPDATE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"DELETE":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}};return n?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Audit Logs"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Track all data changes across the system"})]}),e.jsxs(C,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:[i.length," records"]})]}),e.jsxs(x,{children:[e.jsx(D,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"Filters"]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Table"}),e.jsxs("select",{value:d,onChange:s=>y(s.target.value),className:"w-full bg-gray-900/80 border border-gray-700 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"All Tables"}),e.jsx("option",{value:"activities",children:"Activities"}),e.jsx("option",{value:"deals",children:"Deals"}),e.jsx("option",{value:"contacts",children:"Contacts"}),e.jsx("option",{value:"companies",children:"Companies"}),e.jsx("option",{value:"tasks",children:"Tasks"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Action"}),e.jsxs("select",{value:c,onChange:s=>b(s.target.value),className:"w-full bg-gray-900/80 border border-gray-700 rounded-lg px-3 py-2 text-white",children:[e.jsx("option",{value:"",children:"All Actions"}),e.jsx("option",{value:"INSERT",children:"Insert"}),e.jsx("option",{value:"UPDATE",children:"Update"}),e.jsx("option",{value:"DELETE",children:"Delete"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Start Date"}),e.jsx(A,{type:"date",value:t.start?h(t.start,"yyyy-MM-dd"):"",onChange:s=>o(a=>({...a,start:s.target.value?new Date(s.target.value):null})),className:"bg-gray-900/80 border-gray-700"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"End Date"}),e.jsx(A,{type:"date",value:t.end?h(t.end,"yyyy-MM-dd"):"",onChange:s=>o(a=>({...a,end:s.target.value?new Date(s.target.value):null})),className:"bg-gray-900/80 border-gray-700"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsxs(S,{onClick:_,disabled:g,children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Search"]}),e.jsx(S,{variant:"secondary",onClick:()=>{y(""),b(""),o({start:null,end:null}),f()},children:"Clear Filters"})]})]})]}),e.jsxs(x,{children:[e.jsxs(D,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Audit Trail"]}),e.jsx(V,{children:"Click on any entry to see detailed changes"})]}),e.jsx(m,{children:g?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"Loading audit logs..."}):u?e.jsxs("div",{className:"text-center py-8 text-red-400",children:["Error: ",u]}):i.length===0?e.jsx("div",{className:"text-center py-8 text-gray-400",children:"No audit logs found"}):e.jsx("div",{className:"space-y-2",children:i.map(s=>{const a=p.has(s.id),w=I(s.old_data,s.new_data,s.changed_fields);return e.jsxs("div",{className:"border border-gray-800 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>R(s.id),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(Y,{className:"w-4 h-4 text-gray-400"}):e.jsx(q,{className:"w-4 h-4 text-gray-400"}),e.jsx(C,{className:M(s.action),children:s.action})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-300",children:s.table_name})]}),e.jsx("div",{className:"text-sm text-gray-400",children:U(s.action,s.table_name,s.changed_fields)})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:h(new Date(s.changed_at),"MMM dd, yyyy HH:mm")})]})})]}),a&&e.jsx("div",{className:"px-4 pb-4 border-t border-gray-800",children:e.jsxs("div",{className:"mt-3 space-y-3",children:[w.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Changes:"}),e.jsx("div",{className:"space-y-2",children:w.map((l,F)=>e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-gray-400",children:[l.field,":"]}),e.jsx("div",{className:"text-red-400",children:l.oldValue!==null?JSON.stringify(l.oldValue):"(empty)"}),e.jsx("div",{className:"text-green-400",children:l.newValue!==null?JSON.stringify(l.newValue):"(empty)"})]},F))})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["ID: ",s.record_id]}),s.user_id&&e.jsxs("span",{children:["User: ",s.user_id]})]})]})})]},s.id)})})})]})]}):e.jsx("div",{className:"container mx-auto py-6",children:e.jsx(x,{className:"bg-red-900/20 border-red-700",children:e.jsxs(m,{className:"flex items-center gap-3 p-6",children:[e.jsx(H,{className:"w-5 h-5 text-red-400"}),e.jsx("p",{className:"text-red-300",children:"You must be an administrator to view audit logs."})]})})})}export{oe as default};
