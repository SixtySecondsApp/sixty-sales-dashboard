import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as f,a as Ee}from"./vendor-react-DoYyFkVR.js";import{c as Ie,l as x,s as he,t as Pe,a as ie,g as F,B as I}from"./index.html-Cwo_Unfk.js";import{B as ue,aQ as Ue,M as W,P as H,aU as Oe,k as Q,E as G,z as Z,aJ as U,U as fe,A as le,Q as je,ar as Re,d as L,an as Fe,au as be,F as qe,C as Ve,a as Be,a8 as Le,a7 as ge,i as We,c as He,a5 as pe}from"./vendor-icons-HRBKouGg.js";import{motion as w,AnimatePresence as Qe}from"./ui-animation-Dzb4KUJ1.js";import{p as P,Q as Ge,S as Ze,W as Ke}from"./vendor-utils-Cb9OXVhE.js";import{a as Ne,c as Je}from"./vendor-router-CQXjpROx.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-charts-D4YcUEy1.js";var Xe=Object.defineProperty,Ye=(s,r,n)=>r in s?Xe(s,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[r]=n,es=(s,r,n)=>Ye(s,r+"",n);function ve(s,r={}){const{maxLength:n=255,allowWildcards:l=!1,allowSpecialChars:h=!1,fieldName:d="input"}=r;if(!s)return{isValid:!1,sanitized:"",error:`${d} is required`};const c=s.trim();if(c.length>n)return{isValid:!1,sanitized:"",error:`${d} is too long (maximum ${n} characters)`};let m;return h?m=/^[a-zA-Z0-9\s\-_@.'"\(\)&\[\]]+$/:l?m=/^[a-zA-Z0-9\s\-_%*]+$/:m=/^[a-zA-Z0-9\s\-_]+$/,m.test(c)?{isValid:!0,sanitized:c}:{isValid:!1,sanitized:"",error:`${d} contains invalid characters. Only ${h?"letters, numbers, spaces, hyphens, underscores, @, periods, quotes, parentheses, and brackets":l?"letters, numbers, spaces, hyphens, underscores, and wildcards (%, *)":"letters, numbers, spaces, hyphens, and underscores"} are allowed.`}}function ss(s){return s.map(({field:n,operator:l,value:h,useWildcards:d=!1})=>{if(!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(n))throw new Error(`Invalid field name: ${n}`);if(!["eq","ilike","like","gt","gte","lt","lte","neq"].includes(l))throw new Error(`Invalid operator: ${l}`);const m=ve(h,{allowWildcards:d&&(l==="ilike"||l==="like"),allowSpecialChars:l==="ilike"||l==="like",fieldName:`value for ${n}`});if(!m.isValid)throw new Error(m.error||`Invalid value for ${n}`);let u=m.sanitized;return(l==="ilike"||l==="like")&&d&&(u=`%${u}%`),`${n}.${l}.${u}`}).join(",")}function ts(s){return ve(s,{maxLength:255,allowWildcards:!1,allowSpecialChars:!1,fieldName:"Company ID"})}class ne{constructor(){es(this,"conditions",[])}addEqualCondition(r,n){return this.conditions.push({field:r,operator:"eq",value:n}),this}addSearchCondition(r,n){return this.conditions.push({field:r,operator:"ilike",value:n,useWildcards:!0}),this}buildOrClause(){if(this.conditions.length===0)throw new Error("No conditions added to query builder");return ss(this.conditions)}reset(){return this.conditions=[],this}}function ye(s){const r=s?.message||"Unknown error";return x.error("Company operation error (sanitized for user):",{message:r,timestamp:new Date().toISOString()}),r.includes("duplicate key")?"A record with this information already exists":r.includes("foreign key")?"Referenced record not found":r.includes("PGRST")?"Database connection error":r.includes("JWT")?"Authentication required":"Operation failed. Please try again."}function as(s){const{userData:r}=Ie(),[n,l]=f.useState(null),[h,d]=f.useState([]),[c,m]=f.useState([]),[u,k]=f.useState([]),[$,i]=f.useState(!0),[g,N]=f.useState(null),[p,S]=f.useState(null),t=f.useRef(new Map),M=5*60*1e3,V=50,we=j=>{const y=t.current.get(j);if(y&&Date.now()-y.timestamp<M){if(y.data.company&&y.data.company.name!=="Unknown Company"&&y.data.company.name.trim()!=="")return y;t.current.delete(j)}return y&&t.current.delete(j),null},_e=f.useCallback((j,y)=>{if(y.company&&y.company.name!=="Unknown Company"&&y.company.name.trim()!==""){const b=t.current;if(b.size>=V){const _=b.keys().next().value;_&&b.delete(_)}b.set(j,{data:y,timestamp:Date.now(),companyId:s}),x.log("ðŸ’¾ Cached valid company data:",y.company.name)}},[s]),Ce=f.useCallback(async(j,y=1,A=500)=>{for(let b=0;b<=y;b++)try{return await j()}catch(_){if(b===y)throw _;await new Promise(T=>setTimeout(T,A*Math.pow(1.5,b)))}throw new Error("Max retries exceeded")},[]),Y=f.useCallback(async()=>{if(!s){i(!1);return}const j=`${s}-${r?.id||"anonymous"}`,y=`fetching-${j}`;if(t.current.has(y))return;const A=performance.now(),b=we(j);if(b){const _=performance.now();S({queryStartTime:A,queryEndTime:_,duration:_-A,cacheHit:!0,queryType:"cached"}),l(b.data.company),d(b.data.deals),m(b.data.activities),k(b.data.clients),i(!1),x.log("âš¡ Using cached company data for ID:",s,`(${(_-A).toFixed(2)}ms)`);return}try{t.current.set(y,{timestamp:Date.now()}),i(!0),N(null),x.log("ðŸ¢ Fetching company data for ID:",s);const{data:{session:_}}=await he.auth.getSession(),T=_?he:Pe,K=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(s);x.log("ðŸ” Company ID format:",{companyId:s,isValidUUID:K});const ee=ts(s);if(!ee.isValid)throw new Error(ee.error||"Invalid company ID");let B=ee.sanitized;/^[a-z0-9]+(-[a-z0-9]+)*$/.test(B)&&(B=B.replace(/-/g," "));const Se=new ne().addSearchCondition("company",B).buildOrClause(),[se,te]=await Promise.allSettled([Ce(async()=>{let a=T.from("deals").select(`
              *,
              clients!clients_deal_id_fkey (
                id,
                company_name,
                contact_name,
                contact_email,
                subscription_amount,
                status,
                subscription_start_date,
                churn_date,
                deal_id,
                owner_id,
                created_at,
                updated_at
              )
            `).or(Se);return r?.id&&(a=a.eq("owner_id",r.id)),a}),(async()=>{const a=new ne().addSearchCondition("client_name",B).buildOrClause();let o=T.from("activities").select("*").or(a);return r?.id&&(o=o.eq("user_id",r.id)),o})()]),{data:ae,error:re}=se.status==="fulfilled"?se.value:{data:null,error:se.reason},{data:q,error:ce}=te.status==="fulfilled"?te.value:{data:null,error:te.reason};if(re)throw x.error("âŒ Error fetching deals with clients:",re),re;ce&&x.error("âŒ Error fetching activities:",ce);let J=[];if(K)x.log("ðŸ†” Skipping clients query for UUID company ID"),J=[];else{const a=new ne().addSearchCondition("company_name",B).buildOrClause();let o=T.from("clients").select("*").or(a).is("deal_id",null);r?.id&&(o=o.eq("owner_id",r.id));const{data:D,error:R}=await o;J=D||[],R&&(x.error("âŒ Error fetching standalone clients:",R),J=[])}const C=ae?.map(a=>({id:a.id,name:a.name,company:a.company,value:a.value,stage:a.stage_id,status:a.status==="won"?"won":a.status==="lost"?"lost":"in_progress",signed_date:a.status==="won"?a.updated_at:void 0,created_at:a.created_at,monthly_mrr:a.monthly_mrr,one_off_revenue:a.one_off_revenue,annual_value:a.annual_value,owner_id:a.owner_id,assigned_to:a.owner_id}))||[],v=[...ae?.flatMap(a=>a.clients?a.clients.map(o=>({...o})):[])||[],...J||[]].filter((a,o,D)=>o===D.findIndex(R=>R.id===a.id));let z="Unknown Company",O={};x.log("ðŸ¢ Attempting to fetch company from companies table with ID:",s),x.log("ðŸ” Using client type:",_?"authenticated supabase":"supabaseAdmin");try{let a=null,o=null;if(K){x.log("ðŸ†” Querying companies table by UUID:",s);const D=await T.from("companies").select("name, website, industry, size, description, address, phone").eq("id",s).single();a=D.data,o=D.error}else{x.log("ðŸ”¤ Querying companies table by name/domain:",s);const D=s.replace(/-/g," "),R=await T.from("companies").select("name, website, industry, size, description, address, phone").or(`name.ilike.%${D}%,domain.ilike.%${D}%`).limit(1);R.data&&R.data.length>0?a=R.data[0]:a=null,o=R.error}x.log("ðŸ“Š Companies table query result:",{hasData:!!a,error:o?.message,errorCode:o?.code,companyName:a?.name,queryType:K?"UUID":"name/domain",fullRecord:a}),!o&&a?(z=a.name,O={website:a.website,industry:a.industry,size:a.size,description:a.description,address:a.address,primary_phone:a.phone},x.log("âœ… Found company in companies table:",z)):o?x.log("âš ï¸ Companies table query error:",o.message):x.log("âš ï¸ No company record found in companies table")}catch(a){x.log("ðŸ“‹ Companies table error (catch):",a),x.log("ðŸ“‹ Falling back to deals/clients data")}if(z==="Unknown Company"&&C.length>0){const a=ae[0],o=a.company||"Unknown Company";x.log("ðŸ“‹ Using company name from first deal:",o),z=o,O={primary_contact:a.contact_name,primary_email:a.contact_email,primary_phone:a.contact_phone,...O}}if(v.length>0){const a=v[0],o=a.company_name||z;o!==z&&x.log("ðŸ‘¤ Using company name from first client:",o,"(was:",z+")"),z=o,O={primary_contact:a.contact_name||O.primary_contact,primary_email:a.contact_email||O.primary_email,primary_phone:O.primary_phone,...O}}x.log("ðŸ¢ Final company name resolved:",z,{fromCompaniesTable:z!=="Unknown Company"&&!C.length&&!v.length,fromDeals:C.length>0,fromClients:v.length>0,dealsCount:C.length,clientsCount:v.length});const de=C.reduce((a,o)=>(a.totalValue+=o.value||0,o.status==="in_progress"&&a.activeDeals++,a),{totalValue:0,activeDeals:0}),Me=q?.length||0,oe=q&&q.length>0?Math.max(...q.map(a=>new Date(a.date).getTime())):null;let X="prospect";if(v.length>0){const a=v.some(D=>D.status==="active"),o=v.some(D=>D.status==="churned");X=a?"client":o?"churned":"prospect"}else C.some(a=>a.status==="won")?X="client":C.some(a=>a.status==="in_progress")&&(X="active");const E={id:s,name:z,created_at:C[0]?.created_at||v[0]?.created_at||new Date().toISOString(),updated_at:new Date().toISOString(),...O,total_deal_value:de.totalValue,active_deals_count:de.activeDeals,total_activities_count:Me,last_activity_date:oe?new Date(oe).toISOString():void 0,status:X,owner_id:r?.id},me=performance.now(),xe=me-A;S({queryStartTime:A,queryEndTime:me,duration:xe,cacheHit:!1,queryType:"optimized_join"}),x.log("âœ… Company data compiled (optimized):",{name:E.name,deals:C.length,activities:q?.length||0,clients:v.length,status:E.status,duration:`${xe.toFixed(2)}ms`,cacheHit:!1}),_e(j,{company:E,deals:C,activities:q||[],clients:v});const Ae=!n||n.id!==E.id||n.name!==E.name||n.status!==E.status,ze=h.length!==C.length||!h.every((a,o)=>a.id===C[o]?.id),$e=c.length!==(q||[]).length,Te=u.length!==v.length||!u.every((a,o)=>a.id===v[o]?.id);Ae&&(x.log("ðŸ”„ Company data changed - updating state:",{oldName:n?.name,newName:E.name,oldId:n?.id,newId:E.id,oldStatus:n?.status,newStatus:E.status}),l(E)),ze&&d(C),$e&&m(q||[]),Te&&k(v)}catch(_){const T=ye(_);N(T),ie.error(T)}finally{t.current.delete(y),i(!1)}},[s]);f.useEffect(()=>{x.log("ðŸ”„ useCompany useEffect triggered:",{companyId:s,userDataId:r?.id,isStrictMode:!1}),Y()},[s,r?.id]);const De=async j=>{if(!n)return!1;try{return l({...n,...j,updated_at:new Date().toISOString()}),ie.success("Company updated successfully"),!0}catch(y){const A=ye(y);return ie.error(A),!1}},ke=f.useCallback(()=>{const j=`${s}-${r?.id||"anonymous"}`;return s&&t.current.delete(j),Y()},[Y,s,r?.id]);return f.useEffect(()=>{t.current.clear()},[r?.id]),f.useEffect(()=>{x.log("ðŸ¢ Company state changed:",{companyId:s,name:n?.name,status:n?.status,hasData:!!n})},[n,s]),{company:n,deals:h,activities:c,clients:u,isLoading:$,error:g,updateCompany:De,refreshCompanyData:ke,performanceMetrics:p}}function rs({company:s,deals:r,activities:n,clients:l}){const h=r.reduce((p,S)=>p+(S.value||0),0),d=r.filter(p=>p.status==="won"),c=d.reduce((p,S)=>p+(S.value||0),0),m=d.reduce((p,S)=>p+(S.monthly_mrr||0),0),u=l.filter(p=>p.status==="active").length,k=n.filter(p=>{const S=new Date(p.date),t=new Date;return t.setDate(t.getDate()-30),S>=t}).length,$=p=>{switch(p){case"client":return"text-emerald-400 bg-emerald-500/10 border-emerald-500/20";case"active":return"text-blue-400 bg-blue-500/10 border-blue-500/20";case"prospect":return"text-yellow-400 bg-yellow-500/10 border-yellow-500/20";case"churned":return"text-red-400 bg-red-500/10 border-red-500/20";default:return"text-gray-400 bg-gray-500/10 border-gray-500/20"}},i=p=>{switch(p){case"client":return L;case"active":return Re;case"prospect":return le;case"churned":return je;default:return le}},g=p=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(p),N=i(s.status);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center",children:e.jsx(ue,{className:"w-8 h-8 text-blue-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:s.name}),e.jsxs("div",{className:F("inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium border",$(s.status)),children:[e.jsx(N,{className:"w-4 h-4"}),s.status.charAt(0).toUpperCase()+s.status.slice(1)]})]}),s.description&&e.jsx("p",{className:"text-gray-400 mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm",children:[s.website&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(Ue,{className:"w-4 h-4 text-gray-500"}),e.jsx("a",{href:s.website.startsWith("http")?s.website:`https://${s.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 transition-colors",children:s.website})]}),s.primary_email&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(W,{className:"w-4 h-4 text-gray-500"}),e.jsx("a",{href:`mailto:${s.primary_email}`,className:"text-blue-400 hover:text-blue-300 transition-colors",children:s.primary_email})]}),s.primary_phone&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(H,{className:"w-4 h-4 text-gray-500"}),e.jsx("a",{href:`tel:${s.primary_phone}`,className:"text-blue-400 hover:text-blue-300 transition-colors",children:s.primary_phone})]}),(s.city||s.country)&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(Oe,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:[s.city,s.country].filter(Boolean).join(", ")})]}),s.industry&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(ue,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{children:s.industry})]}),s.last_activity_date&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(Q,{className:"w-4 h-4 text-gray-500"}),e.jsxs("span",{children:["Last activity: ",P(new Date(s.last_activity_date),"MMM d, yyyy")]})]})]})]})]})}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"Primary Contact"}),s.primary_contact?e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-medium text-emerald-500",children:s.primary_contact.split(" ").map(p=>p[0]).join("")})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:s.primary_contact}),s.primary_email&&e.jsx("div",{className:"text-xs text-gray-400",children:s.primary_email})]})]})}):e.jsx("div",{className:"text-sm text-gray-500",children:"No primary contact set"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-6 gap-4",children:[e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Total Value"})]}),e.jsx("div",{className:"text-xl font-bold text-white",children:g(h)})]}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Won Value"})]}),e.jsx("div",{className:"text-xl font-bold text-emerald-400",children:g(c)})]}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Monthly MRR"})]}),e.jsx("div",{className:"text-xl font-bold text-blue-400",children:g(m)})]}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Active Deals"})]}),e.jsx("div",{className:"text-xl font-bold text-white",children:s.active_deals_count||0})]}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"Active Clients"})]}),e.jsx("div",{className:"text-xl font-bold text-white",children:u})]}),e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(U,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-400",children:"30d Activity"})]}),e.jsx("div",{className:"text-xl font-bold text-white",children:k})]})]})]})}function is({activeTab:s,onTabChange:r,company:n,deals:l,activities:h}){const d=[{id:"overview",label:"Overview",icon:Fe,count:null,description:"Company summary and key metrics"},{id:"deals",label:"Deals",icon:be,count:l.length,description:"Sales opportunities and pipeline"},{id:"contacts",label:"Contacts",icon:fe,count:n.primary_contact?1:0,description:"People and relationships"},{id:"activities",label:"Activities",icon:U,count:h.length,description:"Sales activities and interactions"},{id:"documents",label:"Documents",icon:qe,count:0,description:"Files and documentation"}];return e.jsx("div",{className:"flex space-x-1 overflow-x-auto scrollbar-hide",children:d.map(c=>{const m=s===c.id,u=c.icon;return e.jsxs("button",{onClick:()=>r(c.id),className:F("relative flex items-center gap-3 px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 whitespace-nowrap",m?"text-white bg-gray-800/50 border border-gray-700/50":"text-gray-400 hover:text-white hover:bg-gray-800/30"),children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:c.label}),c.count!==null&&c.count>0&&e.jsx("span",{className:F("px-2 py-0.5 text-xs font-medium rounded-full",m?"bg-emerald-500 text-white":"bg-gray-700/50 text-gray-300"),children:c.count}),m&&e.jsx(w.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-emerald-500 rounded-full",initial:!1,transition:{type:"spring",stiffness:500,damping:30}})]},c.id)})})}function ns({company:s,collapsed:r,onToggle:n}){const h=[{label:"Total Value",value:(d=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(d))(s.total_deal_value||0),icon:G,color:"text-emerald-400"},{label:"Active Deals",value:s.active_deals_count||0,icon:Z,color:"text-blue-400"},{label:"Activities",value:s.total_activities_count||0,icon:U,color:"text-purple-400"}];return e.jsxs(w.div,{initial:!1,animate:{width:r?60:280},transition:{duration:.3,ease:"easeInOut"},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800/50 h-fit sticky top-6",children:[e.jsx("div",{className:"p-4 border-b border-gray-800/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[!r&&e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Company Info"}),e.jsx(I,{variant:"ghost",size:"sm",onClick:n,className:"p-2 hover:bg-gray-800/50",children:r?e.jsx(Ve,{className:"w-4 h-4 text-gray-400"}):e.jsx(Be,{className:"w-4 h-4 text-gray-400"})})]})}),e.jsx("div",{className:"p-4 space-y-6",children:r?e.jsx("div",{className:"space-y-4",children:h.map((d,c)=>{const m=d.icon;return e.jsx("div",{className:"flex items-center justify-center p-2 rounded-lg bg-gray-800/30",title:`${d.label}: ${d.value}`,children:e.jsx(m,{className:F("w-4 h-4",d.color)})},c)})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Type"}),e.jsx("span",{className:"text-sm text-white capitalize",children:s.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Created"}),e.jsx("span",{className:"text-sm text-white",children:P(new Date(s.created_at),"MMM yyyy")})]}),s.last_activity_date&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Last Activity"}),e.jsx("span",{className:"text-sm text-white",children:P(new Date(s.last_activity_date),"MMM d")})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Quick Stats"}),e.jsx("div",{className:"space-y-2",children:h.map((d,c)=>{const m=d.icon;return e.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-gray-800/30",children:[e.jsx(m,{className:F("w-4 h-4",d.color)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-gray-400",children:d.label}),e.jsx("div",{className:"text-sm font-medium text-white truncate",children:d.value})]})]},c)})})]}),(s.industry||s.size||s.website)&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Details"}),e.jsxs("div",{className:"space-y-2",children:[s.industry&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Industry"}),e.jsx("span",{className:"text-sm text-white text-right truncate ml-2",children:s.industry})]}),s.size&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Size"}),e.jsx("span",{className:"text-sm text-white",children:s.size})]}),s.website&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Website"}),e.jsx("a",{href:s.website.startsWith("http")?s.website:`https://${s.website}`,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-400 hover:text-blue-300 transition-colors truncate ml-2",children:s.website.replace(/^https?:\/\//,"")})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-400 hover:text-white hover:bg-gray-800/50",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Edit Company"]}),e.jsxs(I,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-400 hover:text-white hover:bg-gray-800/50",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Schedule Meeting"]}),e.jsxs(I,{variant:"ghost",size:"sm",className:"w-full justify-start text-gray-400 hover:text-white hover:bg-gray-800/50",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Log Activity"]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Notes"}),e.jsx("div",{className:"text-sm text-gray-500 italic",children:"No notes available"})]})]})})]})}function ls({activeTab:s,company:r,deals:n,activities:l,clients:h}){const d=Ne(),c=t=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),m=t=>{switch(t){case"won":return"text-emerald-400 bg-emerald-500/10 border-emerald-500/20";case"in_progress":return"text-blue-400 bg-blue-500/10 border-blue-500/20";case"lost":return"text-red-400 bg-red-500/10 border-red-500/20";default:return"text-gray-400 bg-gray-500/10 border-gray-500/20"}},u=t=>{switch(t){case"won":return L;case"in_progress":return We;case"lost":return je;default:return le}},k=t=>{switch(t.toLowerCase()){case"sale":return G;case"meeting":return Q;case"call":return H;case"email":return W;default:return U}},$=()=>e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(Z,{className:"w-5 h-5 text-emerald-400"}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Revenue Overview"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Deals"}),e.jsx("span",{className:"text-sm font-medium text-white",children:c(r.total_deal_value||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Won Deals"}),e.jsx("span",{className:"text-sm font-medium text-emerald-400",children:c(n.filter(t=>t.status==="won").reduce((t,M)=>t+M.value,0))})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Monthly MRR"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:c(n.filter(t=>t.status==="won").reduce((t,M)=>t+(M.monthly_mrr||0),0))})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-blue-400"}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Deal Pipeline"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Deals"}),e.jsx("span",{className:"text-sm font-medium text-white",children:n.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Won"}),e.jsx("span",{className:"text-sm font-medium text-emerald-400",children:n.filter(t=>t.status==="won").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"In Progress"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:n.filter(t=>t.status==="in_progress").length})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-purple-400"}),e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Activity Summary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Total Activities"}),e.jsx("span",{className:"text-sm font-medium text-white",children:l.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Sales Activities"}),e.jsx("span",{className:"text-sm font-medium text-emerald-400",children:l.filter(t=>t.type==="sale").length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Last 30 Days"}),e.jsx("span",{className:"text-sm font-medium text-blue-400",children:l.filter(t=>{const M=new Date(t.date),V=new Date;return V.setDate(V.getDate()-30),M>=V}).length})]})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800/50",children:[e.jsx("div",{className:"p-6 border-b border-gray-800/50",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Recent Activity"})}),e.jsx("div",{className:"p-6",children:l.length>0?e.jsx("div",{className:"space-y-4",children:l.slice(0,5).map((t,M)=>{const V=k(t.type);return e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-gray-800/30",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-gray-700/50 flex items-center justify-center",children:e.jsx(V,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-white capitalize",children:t.type}),e.jsx("span",{className:"text-xs text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-xs text-gray-400",children:P(new Date(t.date),"MMM d, yyyy")})]}),e.jsx("p",{className:"text-sm text-gray-400",children:t.details||"No details available"}),t.amount&&e.jsx("p",{className:"text-sm text-emerald-400 mt-1",children:c(t.amount)})]})]},t.id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No activities found for this company."})})]})]},"overview"),i=()=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800/50",children:[e.jsx("div",{className:"p-6 border-b border-gray-800/50",children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Deals (",n.length,")"]})}),e.jsx("div",{className:"p-6",children:n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(t=>{const M=u(t.status);return e.jsxs("div",{className:"p-4 rounded-lg bg-gray-800/30 border border-gray-700/50 hover:border-gray-600/50 hover:bg-gray-800/50 transition-all cursor-pointer group",onClick:()=>d(`/crm/deals/${t.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-1 group-hover:text-blue-400 transition-colors",children:t.name}),e.jsx(ge,{className:"w-4 h-4 text-gray-500 group-hover:text-blue-400 transition-colors opacity-0 group-hover:opacity-100"})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Stage: ",t.stage]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-white mb-1",children:c(t.value)}),e.jsxs("div",{className:F("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border",m(t.status)),children:[e.jsx(M,{className:"w-3 h-3"}),t.status.replace("_"," ")]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[t.monthly_mrr&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Monthly MRR:"}),e.jsx("span",{className:"text-blue-400 font-medium",children:c(t.monthly_mrr)})]}),t.one_off_revenue&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"One-off:"}),e.jsx("span",{className:"text-emerald-400 font-medium",children:c(t.one_off_revenue)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Created:"}),e.jsx("span",{className:"text-white",children:P(new Date(t.created_at),"MMM d, yyyy")})]})]})]},t.id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No deals found for this company."})})]})},"deals"),g=()=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800/50",children:[e.jsx("div",{className:"p-6 border-b border-gray-800/50",children:e.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Activities (",l.length,")"]})}),e.jsx("div",{className:"p-6",children:l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(t=>{const M=k(t.type);return e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-lg bg-gray-800/30",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-700/50 flex items-center justify-center",children:e.jsx(M,{className:"w-5 h-5 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-base font-medium text-white capitalize",children:t.type}),e.jsx("span",{className:"text-sm text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-sm text-gray-400",children:P(new Date(t.date),"MMM d, yyyy HH:mm")}),t.sales_rep&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-sm text-gray-400",children:"â€¢"}),e.jsx("span",{className:"text-sm text-blue-400",children:t.sales_rep})]})]}),e.jsx("p",{className:"text-sm text-gray-300 mb-2",children:t.details||"No details available"}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsx("span",{className:F("px-2 py-1 rounded-full text-xs font-medium",t.status==="completed"?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-yellow-500/10 text-yellow-400 border border-yellow-500/20"),children:t.status}),t.amount&&e.jsx("span",{className:"text-emerald-400 font-medium",children:c(t.amount)})]})]})]},t.id)})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No activities found for this company."})})]})},"activities"),N=()=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800/50",children:[e.jsx("div",{className:"p-6 border-b border-gray-800/50",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Contacts"})}),e.jsx("div",{className:"p-6",children:r.primary_contact?e.jsx("div",{className:"p-4 rounded-lg bg-gray-800/30 border border-gray-700/50 hover:border-gray-600/50 hover:bg-gray-800/50 transition-all cursor-pointer group",onClick:()=>d(`/crm/contacts?search=${encodeURIComponent(r.primary_contact||"")}`),children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-emerald-500",children:r.primary_contact.split(" ").map(t=>t[0]).join("")})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-1 group-hover:text-emerald-400 transition-colors",children:r.primary_contact}),e.jsx(ge,{className:"w-4 h-4 text-gray-500 group-hover:text-emerald-400 transition-colors opacity-0 group-hover:opacity-100"})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:"Primary Contact â€¢ Click to view in contacts"}),e.jsxs("div",{className:"space-y-2",children:[r.primary_email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-500"}),e.jsx("a",{href:`mailto:${r.primary_email}`,className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",onClick:t=>t.stopPropagation(),children:r.primary_email})]}),r.primary_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-gray-500"}),e.jsx("a",{href:`tel:${r.primary_phone}`,className:"text-sm text-blue-400 hover:text-blue-300 transition-colors",onClick:t=>t.stopPropagation(),children:r.primary_phone})]})]})]})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No contacts found for this company."})})]})},"contacts"),p=()=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800/50",children:[e.jsx("div",{className:"p-6 border-b border-gray-800/50",children:e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Documents"})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Document management coming soon."})})]})},"documents"),S=()=>{switch(s){case"overview":return $();case"deals":return i();case"contacts":return N();case"activities":return g();case"documents":return p();default:return $()}};return e.jsx(Qe,{mode:"wait",children:S()})}function cs({company:s,deals:r,activities:n}){const l=i=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),h=i=>{const g=new Date(i);return Ge(g)?"Today":Ze(g)?"Yesterday":Ke(g)?P(g,"EEEE"):P(g,"MMM d")},d=n.filter(i=>{const g=new Date(i.date),N=new Date;return N.setDate(N.getDate()-7),g>=N}).sort((i,g)=>new Date(g.date).getTime()-new Date(i.date).getTime()).slice(0,5),c=r.filter(i=>i.status==="in_progress").sort((i,g)=>new Date(i.created_at).getTime()-new Date(g.created_at).getTime()).slice(0,3),u=(()=>{let i=50;d.length>0&&(i+=20),d.length>3&&(i+=10),c.length>0&&(i+=15);const g=r.filter(N=>N.status==="won");return g.length>0&&(i+=15),g.length>2&&(i+=10),Math.min(i,100)})(),k=i=>i>=80?"text-emerald-400":i>=60?"text-yellow-400":"text-red-400",$=i=>{switch(i.toLowerCase()){case"sale":return G;case"meeting":return Q;case"call":return H;case"email":return W;default:return U}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(I,{variant:"outline",size:"sm",className:"w-full justify-start bg-gray-800/50 border-gray-700/50 text-white hover:bg-gray-700/50",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Schedule Call"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"w-full justify-start bg-gray-800/50 border-gray-700/50 text-white hover:bg-gray-700/50",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Send Email"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"w-full justify-start bg-gray-800/50 border-gray-700/50 text-white hover:bg-gray-700/50",children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Create Deal"]}),e.jsxs(I,{variant:"outline",size:"sm",className:"w-full justify-start bg-gray-800/50 border-gray-700/50 text-white hover:bg-gray-700/50",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Log Activity"]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Relationship Health"}),e.jsxs("span",{className:F("text-lg font-bold",k(u)),children:[u,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-800 rounded-full h-2 mb-3",children:e.jsx(w.div,{initial:{width:0},animate:{width:`${u}%`},transition:{duration:1,ease:"easeOut"},className:F("h-2 rounded-full",u>=80?"bg-emerald-500":u>=60?"bg-yellow-500":"bg-red-500")})}),e.jsxs("div",{className:"space-y-1 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsxs("span",{children:[d.length," recent activities"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsxs("span",{children:[r.filter(i=>i.status==="won").length," closed deals"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsxs("span",{children:[c.length," active opportunities"]})]})]})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"Active Opportunities"}),c.length>0?e.jsx("div",{className:"space-y-3",children:c.map(i=>e.jsxs("div",{className:"p-3 rounded-lg bg-gray-800/30 border border-gray-700/30",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-white truncate",children:i.name}),e.jsx("span",{className:"text-sm font-bold text-emerald-400",children:l(i.value)})]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Stage: ",i.stage]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Created ",P(new Date(i.created_at),"MMM d")]})]},i.id))}):e.jsx("div",{className:"text-sm text-gray-500",children:"No active opportunities"})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"Recent Activity"}),d.length>0?e.jsx("div",{className:"space-y-3",children:d.map((i,g)=>{const N=$(i.type);return e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-700/50 flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"w-3 h-3 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-white capitalize",children:i.type}),e.jsx("span",{className:"text-xs text-gray-500",children:h(i.date)})]}),e.jsx("p",{className:"text-xs text-gray-400 truncate",children:i.details||"No details available"}),i.amount&&e.jsx("p",{className:"text-xs text-emerald-400 mt-1",children:l(i.amount)})]})]},i.id)})}):e.jsx("div",{className:"text-sm text-gray-500",children:"No recent activity"})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-3",children:"Key Metrics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4 text-emerald-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Total Value"})]}),e.jsx("span",{className:"text-sm font-medium text-white",children:l(s.total_deal_value||0)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Won Rate"})]}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[r.length>0?Math.round(r.filter(i=>i.status==="won").length/r.length*100):0,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Customer Since"})]}),e.jsx("span",{className:"text-sm font-medium text-white",children:P(new Date(s.created_at),"MMM yyyy")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4 text-orange-400"}),e.jsx("span",{className:"text-sm text-gray-400",children:"Last Contact"})]}),e.jsx("span",{className:"text-sm font-medium text-white",children:s.last_activity_date?h(s.last_activity_date):"Never"})]})]})]})]})}function vs({className:s}){const{companyId:r}=Je(),n=Ne(),{company:l,deals:h,activities:d,clients:c,isLoading:m,error:u}=as(r);Ee.useEffect(()=>{x.log("ðŸ“‹ CompanyProfile render:",{companyId:r,companyName:l?.name,companyStatus:l?.status,isLoading:m,error:u,dealsCount:h?.length,clientsCount:c?.length})},[r,l?.name,l?.status,m,u,h?.length,c?.length]);const[k,$]=f.useState("overview"),[i,g]=f.useState(!1);return m?e.jsx("div",{className:"min-h-screen bg-gray-950 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-800 rounded w-1/4"}),e.jsx("div",{className:"h-64 bg-gray-800 rounded"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 h-96 bg-gray-800 rounded"}),e.jsx("div",{className:"h-96 bg-gray-800 rounded"})]})]})})}):u||!l?e.jsx("div",{className:"min-h-screen bg-gray-950 p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-red-900/20 border border-red-800/50 rounded-xl p-6 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-400 mb-2",children:"Company Not Found"}),e.jsx("p",{className:"text-gray-400 mb-4",children:u||"The company you are looking for does not exist or you do not have permission to view it."}),e.jsxs(I,{onClick:()=>n("/companies"),className:"bg-gray-800 hover:bg-gray-700 text-white",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Back to Companies"]})]})})}):e.jsxs("div",{className:"min-h-screen bg-gray-950",children:[e.jsx("div",{className:"border-b border-gray-800/50 bg-gray-900/50 backdrop-blur-xl",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(I,{variant:"outline",size:"sm",onClick:()=>n("/companies"),className:"bg-gray-800/50 border-gray-700/50 text-white hover:bg-gray-700/50",children:[e.jsx(pe,{className:"w-4 h-4 mr-2"}),"Back"]})}),e.jsx(rs,{company:l,deals:h,activities:d,clients:c})]})}),e.jsx("div",{className:"border-b border-gray-800/50 bg-gray-900/30",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsx(is,{activeTab:k,onTabChange:$,company:l,deals:h,activities:d})})}),e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 transition-all duration-300",children:e.jsx(ns,{company:l,collapsed:i,onToggle:()=>g(!i)})}),e.jsx("div",{className:"lg:col-span-2 transition-all duration-300",children:e.jsx(ls,{activeTab:k,company:l,deals:h,activities:d,clients:c})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(cs,{company:l,deals:h,activities:d})})]})})]})}export{vs as default};
