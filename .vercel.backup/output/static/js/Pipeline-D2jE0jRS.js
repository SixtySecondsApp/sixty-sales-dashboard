import{j as t}from"./vendor-state-CpjwTZNq.js";import{r as w,a as Ie}from"./vendor-react-DoYyFkVR.js";import{e as nn,C as sn,d as rn,S as ln,v as an,u as on,a as dn,D as cn,M as un,c as gn,b as mn,P as pn}from"./sortable.esm-Dal5CmSK.js";import{u as fn,a as Ze,P as xn,E as hn}from"./EditDealModal-LmzFMvbO.js";import{O as xt}from"./OwnerFilter-bkhDp6eP.js";import{D as ht}from"./date-filter-BIFPvFKu.js";import{j as vn,k as yn,l as wn,m as Rt}from"./ui-radix-extended-CHWFg20j.js";import{E as bn,a as le,g as Sn,B as ee,l as Q,c as Cn,G as jn,I as Nn,n as _n,s as ye,J as vt,C as Rn}from"./index.html-Cwo_Unfk.js";import{S as Fn,a as Dn,b as In,c as Mn,d as _e}from"./select-BFsZCfaH.js";import{I as Ft}from"./input-CeE6qNqI.js";import{A as Dt,i as qe,B as Je,a4 as It,aX as Pn,k as Pe,E as Mt,aY as yt,P as $n,aZ as Vn,X as et,F as Pt,ay as kn,U as Me,e as Ue,I as En,S as An,aT as Ln,a_ as zn,aa as On,am as $t,$ as Gn,a0 as Tn,ab as Hn,z as wt,u as Bn,Z as qn,a$ as bt,T as Un,b0 as Kn,a8 as Wn,b1 as Ae,x as Xn,al as Qn,aW as Yn,ao as Zn,d as St}from"./vendor-icons-HRBKouGg.js";import{AnimatePresence as Jn,motion as Vt}from"./ui-animation-Dzb4KUJ1.js";import{p as fe,n as es,j as ts,d as ns}from"./vendor-utils-Cb9OXVhE.js";import{Dialog as tt,DialogContent as nt,DialogHeader as st,DialogTitle as rt,DialogFooter as kt}from"./dialog-BBMx1wit.js";import{L as Ct}from"./label-B9drN7Ag.js";import{C as ss,a as rs}from"./card-B2-KTHtJ.js";function Et({deal:e,onClick:r,onConvertToSubscription:n,isDragOverlay:s=!1}){const l=String(e.id),{splits:a,calculateSplitTotals:i}=fn({dealId:e.id}),d=w.useMemo(()=>{const k=i(e.id),H=k.splitCount>0,y=a.find(N=>N.user_id===e.owner_id);return{hasSplits:H,totalSplits:k.splitCount,remainingPercentage:k.remainingPercentage,userSplitPercentage:y?.percentage||(H?k.remainingPercentage:100),userSplitAmount:y?.amount||e.value*(H?k.remainingPercentage:100)/100}},[a,i,e.id,e.value,e.owner_id]),{attributes:u,listeners:o,setNodeRef:m,transform:h,transition:g,isDragging:c}=nn({id:l,data:{...e,id:l},disabled:s}),f={transform:sn.Transform.toString(h),transition:g,opacity:c?"0.3":"1",...s?{zIndex:9999}:{}},p=w.useMemo(()=>e.companies?{name:e.companies.name,domain:e.companies.domain,size:e.companies.size,isNormalized:!0}:{name:e.company||"Unknown Company",domain:null,size:null,isNormalized:!1},[e.companies,e.company]),v=w.useMemo(()=>e.contacts?{name:e.contacts.full_name||`${e.contacts.first_name||""} ${e.contacts.last_name||""}`.trim(),email:e.contacts.email,phone:e.contacts.phone,title:e.contacts.title,isNormalized:!0}:{name:e.contact_name||"No contact",email:e.contact_email,phone:e.contact_phone,title:null,isNormalized:!1},[e.contacts,e.contact_name,e.contact_email,e.contact_phone]),C=w.useMemo(()=>e.deal_contacts&&Array.isArray(e.deal_contacts)&&e.deal_contacts.length>1,[e.deal_contacts]),_=w.useMemo(()=>e.daysInStage?e.daysInStage>14?{status:"danger",text:`${e.daysInStage}d`,icon:Dt}:e.daysInStage>7?{status:"warning",text:`${e.daysInStage}d`,icon:qe}:{status:"normal",text:`${e.daysInStage}d`,icon:qe}:{status:"normal",text:"New",icon:null},[e.daysInStage]),R=w.useMemo(()=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(e.value),[e.value]),A=e.probability||e.deal_stages?.default_probability||0,L=e.deal_stages?.color||"#3b82f6",T=w.useMemo(()=>{if(e.deal_stages?.name)return e.deal_stages.name;e.stage_id&&(!e.deal_stages||(e.stage_id,e.deal_stages.id));const k={lead:"Lead",sql:"SQL",discovery:"Discovery",proposal:"Proposal",negotiation:"Negotiation",closed:"Closed/Won"};return e.stage_id&&k[e.stage_id.toLowerCase()]?k[e.stage_id.toLowerCase()]:e.stage_id||"Unknown Stage"},[e.deal_stages,e.id,e.stage_id]);w.useMemo(()=>e.deal_stages?.color?{backgroundColor:`${e.deal_stages.color}20`,color:e.deal_stages.color,borderWidth:"1px",borderStyle:"solid",borderColor:`${e.deal_stages.color}40`}:{},[e.deal_stages?.color]);const Y=w.useMemo(()=>{const k=["closed","won","closed/won","closed-won","signed"],H=T?.toLowerCase()||"",y=e.stage_id?.toLowerCase()||"";return k.some(N=>H.includes(N)||y.includes(N))&&n},[T,e.stage_id,n]);return t.jsxs("div",{ref:m,...u,...o,onClick:()=>c?null:r(e),className:`
        bg-gray-800/50 rounded-xl p-4 hover:bg-gray-800/70
        transition-all border border-gray-800/80
        hover:border-gray-700 shadow-sm hover:shadow-md group
        ${c||s?"shadow-lg cursor-grabbing z-[9999]":"cursor-grab"}
        relative overflow-hidden
      `,style:f,children:[!c&&!s&&t.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-transparent
          via-white/[0.02] to-transparent translate-x-[-200%]
          group-hover:translate-x-[200%] transition-transform duration-1000 pointer-events-none
          z-[1]`}),t.jsxs("div",{className:"relative z-[2]",children:[t.jsxs("div",{className:"flex items-start justify-between mb-3",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(Je,{className:"w-4 h-4 text-blue-400 flex-shrink-0"}),t.jsx("h3",{className:"font-medium text-white text-base truncate",title:p.name,children:p.name})]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[t.jsx(It,{className:"w-3.5 h-3.5 flex-shrink-0"}),t.jsx("span",{className:"truncate",title:v.name,children:v.name}),C&&t.jsxs("span",{className:"text-xs bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded text-[10px]",children:["+",e.deal_contacts.length-1]})]})]}),t.jsx("div",{className:"ml-3 flex-shrink-0 text-right",children:d.hasSplits?t.jsxs("div",{className:"space-y-1",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx(Pn,{className:"w-3.5 h-3.5 text-blue-400"}),t.jsx("span",{className:"text-emerald-400 font-semibold text-base",children:new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(d.userSplitAmount)})]}),t.jsxs("div",{className:"text-xs text-gray-400",children:[d.userSplitPercentage,"% of ",R]}),t.jsxs("div",{className:"text-xs text-blue-400",children:["Split with ",d.totalSplits," other",d.totalSplits===1?"":"s"]})]}):t.jsx("div",{className:"text-emerald-400 font-semibold text-lg",children:R})})]}),t.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-3",children:[e.expected_close_date&&t.jsxs("span",{className:`
              inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
              ${ls(e.expected_close_date)?"bg-red-500/20 text-red-400 border border-red-500/30":"bg-blue-500/20 text-blue-400 border border-blue-500/30"}
            `,children:[t.jsx(Pe,{className:"w-3 h-3 mr-1"}),fe(new Date(e.expected_close_date),"MMM d")]}),p.isNormalized&&p.size&&t.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
              bg-gray-500/20 text-gray-400 border border-gray-500/30`,children:p.size}),p.isNormalized&&v.isNormalized&&t.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
              bg-emerald-500/20 text-emerald-400 border border-emerald-500/30`,children:"CRM"})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:`
            flex items-center gap-1.5 text-xs
            ${_.status==="danger"?"text-red-400":_.status==="warning"?"text-yellow-400":"text-gray-400"}
          `,children:[_.icon&&t.jsx(_.icon,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:_.text})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-12 h-1.5 bg-gray-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full",style:{width:`${A}%`,backgroundColor:L}})}),t.jsxs("span",{className:"text-xs font-medium text-gray-300",children:[A,"%"]})]})]}),Y&&t.jsx("div",{className:"mt-3 pt-3 border-t border-gray-700/50",children:t.jsxs("button",{onClick:k=>{k.stopPropagation(),n?.(e)},className:`w-full flex items-center justify-center gap-2 px-3 py-2 bg-emerald-500/10 
                         hover:bg-emerald-500/20 border border-emerald-500/20 hover:border-emerald-500/30 
                         rounded-lg transition-all text-emerald-400 hover:text-emerald-300 text-sm font-medium`,children:[t.jsx(Mt,{className:"w-4 h-4"}),"Convert to Subscription"]})})]})]})}function ls(e){return new Date(e)<new Date}function as({value:e,onChange:r,required:n=!1,placeholder:s="Enter email address",label:l="Email Address"}){const[a,i]=w.useState("unknown"),[d,u]=w.useState(!1);w.useEffect(()=>{if(!e){i("unknown");return}if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){i("email");return}if(e.includes("linkedin.com/")||e.startsWith("linkedin.com/")){i("linkedin");return}if(/^[\d\+\-\(\)\s]{6,20}$/.test(e)){i("phone");return}i("unknown")},[e]),w.useEffect(()=>{e&&r(e,a)},[a,e,r]);const o=m=>{const h=m.target.value;u(!0),r(h,a)};return t.jsxs("div",{className:"space-y-2",children:[l&&t.jsxs("label",{className:"block text-sm font-medium text-gray-400/90",children:[l,n&&t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsxs("div",{className:`flex items-center border ${d&&n&&!e?"border-red-500/50":"border-gray-700/30"} rounded-xl 
        bg-gray-800/30 focus-within:ring-2 focus-within:ring-[#37bd7e] 
        focus-within:border-transparent transition-colors hover:bg-gray-800/50`,children:[t.jsxs("span",{className:"pl-3 text-gray-500",children:[a==="email"&&t.jsx(yt,{className:"w-5 h-5 text-blue-400"}),a==="phone"&&t.jsx($n,{className:"w-5 h-5 text-green-400"}),a==="linkedin"&&t.jsx(Vn,{className:"w-5 h-5 text-blue-600"}),a==="unknown"&&t.jsx(yt,{className:"w-5 h-5"})]}),t.jsx("input",{type:"text",required:n,className:`w-full bg-transparent border-none px-4 py-2.5 
            text-white/90 focus:outline-none`,value:e,onChange:o,onBlur:()=>u(!0),placeholder:s,"aria-required":n})]}),d&&n&&!e&&t.jsx("p",{className:"text-red-500 text-xs mt-1",children:"This field is required"}),e&&a==="unknown"&&t.jsx("p",{className:"text-yellow-500 text-xs mt-1",children:"Please enter a valid email, phone number, or LinkedIn URL"})]})}function os({deal:e=null,onSave:r,onCancel:n,initialStageId:s=null}){const{stages:l}=bn(),[a,i]=w.useState({name:"",company:"",contact_name:"",contact_email:"",contact_phone:"",value:"",stage_id:"",expected_close_date:"",description:"",probability:"",contactIdentifier:"",contactIdentifierType:"unknown"});w.useEffect(()=>{e?i({name:e.name||"",company:e.company||"",contact_name:e.contact_name||"",contact_email:e.contact_email||"",contact_phone:e.contact_phone||"",value:e.value||"",stage_id:e.stage_id||"",expected_close_date:e.expected_close_date||"",description:e.description||"",probability:e.probability||"",contactIdentifier:e.contact_identifier||e.contactIdentifier||"",contactIdentifierType:e.contact_identifier_type||e.contactIdentifierType||"unknown"}):s&&i(o=>({...o,stage_id:s}))},[e,s]),w.useEffect(()=>{if(a.stage_id&&!a.probability){const o=l?.find(m=>m.id===a.stage_id);o&&i(m=>({...m,probability:o.default_probability}))}},[a.stage_id,l,a.probability]);const d=o=>{const{name:m,value:h}=o.target;i(g=>({...g,[m]:h}))},u=o=>{if(o.preventDefault(),!a.contactIdentifier){le.error("Please provide a contact identifier (email, phone number, or LinkedIn URL)");return}if(a.contactIdentifierType==="unknown"){le.error("Please enter a valid email, phone number, or LinkedIn URL");return}const{contactIdentifier:m,contactIdentifierType:h,...g}=a,c={...g,expected_close_date:a.expected_close_date===""?null:a.expected_close_date,contact_identifier:m,contact_identifier_type:h};r(c)};return t.jsxs("form",{onSubmit:u,className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:e?"Edit Deal":"New Deal"}),t.jsx("button",{type:"button",onClick:n,className:"text-gray-400 hover:text-gray-300",children:t.jsx(et,{className:"w-5 h-5"})})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Deal Name"}),t.jsxs("div",{className:`flex items-center border border-gray-700 rounded-lg
            bg-gray-900/80 focus-within:border-violet-500/50 transition-colors`,children:[t.jsx("span",{className:"pl-3 text-gray-500",children:t.jsx(Pt,{className:"w-5 h-5"})}),t.jsx("input",{type:"text",name:"name",value:a.name,onChange:d,required:!0,placeholder:"Enter deal name",className:`w-full p-2.5 bg-transparent border-none
                outline-none text-white`})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Company"}),t.jsxs("div",{className:`flex items-center border border-gray-700 rounded-lg
            bg-gray-900/80 focus-within:border-violet-500/50 transition-colors`,children:[t.jsx("span",{className:"pl-3 text-gray-500",children:t.jsx(kn,{className:"w-5 h-5"})}),t.jsx("input",{type:"text",name:"company",value:a.company,onChange:d,required:!0,placeholder:"Enter company name",className:`w-full p-2.5 bg-transparent border-none
                outline-none text-white`})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Contact Name"}),t.jsxs("div",{className:`flex items-center border border-gray-700 rounded-lg
            bg-gray-900/80 focus-within:border-violet-500/50 transition-colors`,children:[t.jsx("span",{className:"pl-3 text-gray-500",children:t.jsx(Me,{className:"w-5 h-5"})}),t.jsx("input",{type:"text",name:"contact_name",value:a.contact_name,onChange:d,placeholder:"Enter contact name",className:`w-full p-2.5 bg-transparent border-none
                outline-none text-white`})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"block text-sm font-medium text-gray-400 mb-1 flex items-center",children:["Email Address",t.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),t.jsx(as,{value:a.contactIdentifier,onChange:(o,m)=>i({...a,contactIdentifier:o,contactIdentifierType:m}),required:!0,placeholder:"Required: Enter email address",label:""})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Deal Revenue"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"One-off Revenue (Â£)"}),t.jsxs("div",{className:`flex items-center border border-gray-700 rounded-lg
                bg-gray-900/80 focus-within:border-violet-500/50 transition-colors`,children:[t.jsx("span",{className:"pl-3 text-gray-500",children:t.jsx(Ue,{className:"w-5 h-5"})}),t.jsx("input",{type:"number",name:"one_off_revenue",value:a.one_off_revenue||"",onChange:d,min:"0",step:"0.01",placeholder:"0",className:`w-full p-2.5 bg-transparent border-none
                    outline-none text-white`})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Monthly Recurring Revenue (Â£)"}),t.jsxs("div",{className:`flex items-center border border-gray-700 rounded-lg
                bg-gray-900/80 focus-within:border-violet-500/50 transition-colors`,children:[t.jsx("span",{className:"pl-3 text-gray-500",children:t.jsx(Ue,{className:"w-5 h-5"})}),t.jsx("input",{type:"number",name:"monthly_mrr",value:a.monthly_mrr||"",onChange:d,min:"0",step:"0.01",placeholder:"0",className:`w-full p-2.5 bg-transparent border-none
                    outline-none text-white`})]})]})]}),(a.one_off_revenue||a.monthly_mrr)&&t.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:[t.jsxs("div",{className:"text-sm text-emerald-400",children:[t.jsx("span",{className:"font-medium",children:"Total Deal Value: "}),"Â£",((parseFloat(a.one_off_revenue)||0)+(parseFloat(a.monthly_mrr)||0)*3).toLocaleString("en-GB",{minimumFractionDigits:0,maximumFractionDigits:0})]}),a.monthly_mrr&&parseFloat(a.monthly_mrr)>0&&t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Annual Value: Â£",((parseFloat(a.one_off_revenue)||0)+(parseFloat(a.monthly_mrr)||0)*12).toLocaleString("en-GB",{minimumFractionDigits:0,maximumFractionDigits:0})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Pipeline Stage"}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2",children:l&&l.map(o=>t.jsxs("button",{type:"button",onClick:()=>i(m=>({...m,stage_id:o.id})),className:`p-3 rounded-xl border transition-all ${a.stage_id===o.id?"bg-violet-500/20 border-violet-500/50 text-violet-300 ring-2 ring-violet-500/30":"bg-gray-800/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50"}`,children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:o.color||"#6366f1"}}),t.jsx("span",{className:"text-sm font-medium",children:o.name})]}),t.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[o.default_probability,"% probability"]})]},o.id))}),!a.stage_id&&t.jsx("p",{className:"text-red-400 text-sm mt-1",children:"Please select a pipeline stage"})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Expected Close Date"}),t.jsxs("div",{className:`flex items-center border border-gray-700 rounded-lg
              bg-gray-900/80 focus-within:border-violet-500/50 transition-colors`,children:[t.jsx("span",{className:"pl-3 text-gray-500",children:t.jsx(Pe,{className:"w-5 h-5"})}),t.jsx("input",{type:"date",name:"expected_close_date",value:a.expected_close_date,onChange:d,className:`w-full p-2.5 bg-transparent border-none
                  outline-none text-white`})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Win Probability (%)"}),t.jsx("input",{type:"number",name:"probability",value:a.probability,onChange:d,min:"0",max:"100",step:"1",placeholder:"Enter probability",className:`w-full p-2.5 bg-gray-900/80 border border-gray-700
                rounded-lg text-white outline-none focus:border-violet-500/50
                transition-colors`}),t.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:a.probability||0,onChange:o=>i(m=>({...m,probability:o.target.value})),className:"w-full mt-2 bg-gray-700 rounded-lg appearance-none h-2 outline-none"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Description"}),t.jsx("textarea",{name:"description",value:a.description,onChange:d,rows:3,placeholder:"Enter deal description",className:`w-full p-2.5 bg-gray-900/80 border border-gray-700
              rounded-lg text-white outline-none focus:border-violet-500/50
              transition-colors resize-none`})]})]}),t.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-800",children:[t.jsx("button",{type:"button",onClick:n,className:`px-4 py-2 bg-gray-800 text-gray-300 rounded-lg
            hover:bg-gray-700 transition-colors`,children:"Cancel"}),t.jsx("button",{type:"submit",className:`px-4 py-2 bg-emerald-500/20 text-emerald-400 rounded-lg
            border border-emerald-500/30 hover:bg-emerald-500/30 transition-colors`,children:e?"Update Deal":"Create Deal"})]})]})}const is=vn,ds=yn,cs=wn,At=w.forwardRef(({className:e,sideOffset:r=4,...n},s)=>t.jsx(Rt,{ref:s,sideOffset:r,className:Sn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...n}));At.displayName=Rt.displayName;function us({onAddDealClick:e,view:r,onViewChange:n,selectedOwnerId:s,onOwnerChange:l,sortBy:a,onSortChange:i}){const{searchTerm:d,setSearchTerm:u,filterOptions:o,setFilterOptions:m,pipelineValue:h,weightedPipelineValue:g,activePipelineValue:c,stages:f,exportPipeline:p,getExportSummary:v,dateFilterPreset:C,setDateFilterPreset:_,customDateRange:R,setCustomDateRange:A,stageMetrics:L}=Ze(),[T,Y]=w.useState(!1),[k,H]=w.useState("basic");new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(h),new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(g);const y=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(c),N=o.minValue||o.maxValue||o.probability||o.tags.length||s||o.stages.length||o.priorities.length||o.dealSizes.length||o.leadSources.types.length||o.leadSources.channels.length||o.dateRange.field||o.daysInStage.min||o.daysInStage.max||o.timeStatus.length||o.quickFilter,K=[o.minValue?1:0,o.maxValue?1:0,o.probability?1:0,o.tags.length,s?1:0,o.stages.length,o.priorities.length,o.dealSizes.length,o.leadSources.types.length,o.leadSources.channels.length,o.dateRange.field?1:0,o.daysInStage.min?1:0,o.daysInStage.max?1:0,o.timeStatus.length,o.quickFilter?1:0].reduce((x,$)=>x+$,0),Z=[{id:"all",label:"All Deals",icon:Hn,colorClass:"text-gray-400 bg-gray-800/30 border-gray-700/50 hover:bg-gray-700/30",tooltip:"Show all deals in the pipeline without any filters applied"},{id:"my_deals",label:"My Deals",icon:Me,colorClass:"text-blue-400 bg-blue-500/20 border-blue-500/30",tooltip:"Show only deals assigned to the currently logged-in user"},{id:"hot_deals",label:"Hot Deals",icon:wt,colorClass:"text-red-400 bg-red-500/20 border-red-500/30",tooltip:`Show deals with either:
â€¢ Probability â‰¥ 50% OR
â€¢ Deal value â‰¥ Â£5,000

These are high-potential opportunities worth prioritizing`},{id:"closing_soon",label:"Closing Soon",icon:qe,colorClass:"text-orange-400 bg-orange-500/20 border-orange-500/30",tooltip:`Show deals with expected close dates within the next 30 days

Requires either "Expected Close Date" or "Close Date" to be set`},{id:"stale_deals",label:"Stale Deals",icon:Bn,colorClass:"text-yellow-400 bg-yellow-500/20 border-yellow-500/30",tooltip:`Show deals that haven't had a stage change in 30+ days

Based on "Stage Changed At" date or creation date if no stage changes`},{id:"recent",label:"Recent",icon:qn,colorClass:"text-green-400 bg-green-500/20 border-green-500/30",tooltip:`Show deals created within the last 30 days

Based on the deal creation date`}],U=["low","medium","high","critical"],Se=["small","medium","large","strategic"],pe=["inbound","outbound","referral","partner"],Ve=["website","email","phone","linkedin","facebook","google","event","other"],ce=x=>{const $=x==="all"?null:x,J=Z.find(X=>X.id===x);Q.log(`ðŸŽ¯ Quick filter selected: ${x}`,{newQuickFilter:$,criteria:J?.tooltip,currentDeals:h}),m({...o,quickFilter:$})},xe=()=>{m({minValue:null,maxValue:null,probability:null,tags:[],dateRange:{field:null,from:null,to:null},stages:[],priorities:[],dealSizes:[],leadSources:{types:[],channels:[]},daysInStage:{min:null,max:null},timeStatus:[],quickFilter:null}),l(void 0)},ne=(x,$,J)=>{x.includes($)?J(x.filter(X=>X!==$)):J([...x,$])},ue=async()=>{try{await p();const x=v();Q.log("Export Summary:",{totalDeals:x.totalDeals,totalValue:x.totalValue,weightedValue:x.totalWeightedValue,stages:Object.keys(x.stageBreakdown)})}catch{}},Ce=[{id:"basic",label:"Basic",icon:Un},{id:"advanced",label:"Advanced",icon:bt},{id:"source",label:"Sources",icon:wt}];return t.jsxs("div",{className:"mb-6 space-y-4",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[t.jsx("div",{className:"flex items-center gap-6",children:t.jsx(is,{children:t.jsxs(ds,{children:[t.jsx(cs,{asChild:!0,children:t.jsxs("div",{className:"flex flex-col justify-center px-4 py-2.5 bg-gray-800/50 rounded-lg border border-gray-700/50 min-h-[44px] cursor-help",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-xs text-gray-400",children:"Total Pipeline"}),t.jsx(En,{className:"w-3 h-3 text-gray-500"})]}),t.jsx("div",{className:"text-lg font-bold text-emerald-400 leading-tight",children:y}),t.jsx("div",{className:"text-xs text-gray-500 leading-tight",children:f&&f.length>0&&(()=>{const x=["sql","opportunity","verbal"];return f.filter(X=>x.includes(X.name.toLowerCase())).map(X=>{const ve=L?.find(je=>je.stageId===X.id)?.weightedValue||0;return`${X.name}: Â£${Math.round(ve).toLocaleString()}`}).join(" + ")||"SQL + Opportunity + Verbal (Weighted)"})()})]})}),t.jsx(At,{className:"max-w-sm",children:t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"font-medium",children:"Active Pipeline Calculation"}),t.jsx("p",{className:"text-sm",children:"This shows the weighted total of active pipeline stages (SQL, Opportunity, and Verbal only). Each stage's total value is multiplied by its probability percentage."}),f&&L&&t.jsx("div",{className:"space-y-1 text-xs",children:f.filter(x=>{const $=x.name.toLowerCase();return["sql","opportunity","verbal"].includes($)}).map(x=>{const $=L.find(ve=>ve.stageId===x.id),J=$?.value||0,X=$?.weightedValue||0,he=$?.count||0;return t.jsxs("div",{className:"flex justify-between",children:[t.jsxs("span",{children:[x.name," (",he," deals):"]}),t.jsxs("span",{children:["Â£",Math.round(J).toLocaleString()," Ã— ",x.default_probability,"% = Â£",Math.round(X).toLocaleString()]})]},x.id)})})]})})]})})}),t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"relative flex-1 max-w-md",children:[t.jsx(An,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),t.jsx(Ft,{type:"text",placeholder:"Search deals...",value:d,onChange:x=>u(x.target.value),className:"pl-10 bg-gray-800/50 border-gray-700 text-white placeholder-gray-400 focus:border-emerald-500 transition-colors"})]}),t.jsx("div",{className:"w-px h-6 bg-gray-700"}),t.jsx(ht,{value:C,customRange:R,onPresetChange:_,onCustomRangeChange:A,label:"Deals Added",compact:!0,className:"min-w-[160px]"}),t.jsx(xt,{selectedOwnerId:s,onOwnerChange:l}),t.jsxs(Fn,{value:a,onValueChange:i,children:[t.jsxs(Dn,{className:"w-40 bg-gray-800/50 border-gray-700 text-white hover:bg-gray-700/50 focus:border-emerald-500 transition-colors",children:[t.jsx(Ln,{className:"w-4 h-4 mr-2"}),t.jsx(In,{placeholder:"Sort by"})]}),t.jsxs(Mn,{className:"bg-gray-800 border-gray-700",children:[t.jsx(_e,{value:"none",className:"text-white hover:bg-gray-700",children:"No Sorting"}),t.jsx(_e,{value:"value",className:"text-white hover:bg-gray-700",children:"Value (High to Low)"}),t.jsx(_e,{value:"date",className:"text-white hover:bg-gray-700",children:"Date Created"}),t.jsx(_e,{value:"alpha",className:"text-white hover:bg-gray-700",children:"Alphabetical"})]})]}),t.jsx("div",{className:"w-px h-6 bg-gray-700"}),t.jsxs("div",{className:"flex bg-gray-800/50 rounded-lg p-1 border border-gray-700",children:[t.jsx(ee,{variant:r==="kanban"?"default":"ghost",size:"sm",onClick:()=>n("kanban"),className:r==="kanban"?"bg-emerald-600 text-white hover:bg-emerald-700":"text-gray-400 hover:text-white hover:bg-gray-700/50",children:t.jsx(zn,{className:"w-4 h-4"})}),t.jsx(ee,{variant:r==="table"?"default":"ghost",size:"sm",onClick:()=>n("table"),className:r==="table"?"bg-emerald-600 text-white hover:bg-emerald-700":"text-gray-400 hover:text-white hover:bg-gray-700/50",children:t.jsx(On,{className:"w-4 h-4"})})]})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center justify-between gap-4 bg-gray-800/30 rounded-lg p-4 border border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("button",{onClick:e,className:`flex items-center gap-2 px-4 py-2.5 rounded-lg
              bg-emerald-500/10 text-emerald-400 border border-emerald-500/20
              hover:bg-emerald-500/20 transition-colors font-medium`,children:[t.jsx($t,{className:"w-4 h-4"}),t.jsx("span",{children:"New Deal"})]}),t.jsxs("button",{onClick:ue,className:`flex items-center gap-2 px-4 py-2.5 rounded-lg
              bg-blue-500/10 text-blue-400 border border-blue-500/20
              hover:bg-blue-500/20 transition-colors font-medium`,title:"Export current pipeline view to CSV",children:[t.jsx(Gn,{className:"w-4 h-4"}),t.jsx("span",{className:"hidden sm:inline",children:"Export CSV"}),t.jsx("span",{className:"sm:hidden",children:"Export"})]})]}),t.jsx("div",{className:"flex items-center gap-3",children:t.jsxs("button",{onClick:()=>Y(!T),className:`
              flex items-center gap-2 px-4 py-2.5 rounded-lg
              border transition-colors relative font-medium
              ${N?"bg-violet-500/20 text-violet-400 border-violet-500/30 hover:bg-violet-500/30":"bg-gray-800/50 text-gray-400 border-gray-700 hover:bg-gray-700/50"}
            `,children:[t.jsx(Tn,{className:`w-4 h-4 ${T?"text-violet-400":""}`}),t.jsx("span",{children:"Filters"}),K>0&&t.jsx("span",{className:"absolute -top-2 -right-2 bg-violet-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-medium",children:K})]})})]}),t.jsx("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-none pb-2",children:Z.map(x=>{const $=x.icon,J=o.quickFilter===x.id||x.id==="all"&&!o.quickFilter;return t.jsxs("div",{className:"relative group",children:[t.jsxs("button",{onClick:()=>ce(x.id),className:`
                  flex items-center gap-2 px-3 py-1.5 rounded-full whitespace-nowrap
                  text-sm font-medium transition-all duration-200 flex-shrink-0 border
                  ${J?x.colorClass:"bg-gray-800/30 text-gray-400 border-gray-700/50 hover:bg-gray-700/30"}
                `,children:[t.jsx($,{className:"w-4 h-4"}),x.label]}),t.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-black text-white text-xs rounded-md shadow-lg border border-gray-600 whitespace-pre-line max-w-sm opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 pointer-events-none z-[9999]",children:[x.tooltip,t.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-black"})]})]},x.id)})}),t.jsx(Jn,{children:T&&t.jsx(Vt.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"overflow-hidden",children:t.jsxs("div",{className:"p-4 rounded-xl border border-gray-700/50 bg-gray-800/80 backdrop-blur-md shadow-xl",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(bt,{className:"w-5 h-5 text-violet-400"}),t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Advanced Filters"}),K>0&&t.jsxs("span",{className:"text-xs text-violet-400",children:[K," active"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[N&&t.jsx("button",{onClick:xe,className:"px-3 py-1.5 text-xs rounded-md text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:"Clear All"}),t.jsx("button",{onClick:()=>Y(!1),className:"p-1.5 rounded-md hover:bg-gray-700/50 text-gray-400 hover:text-white transition-colors",children:t.jsx(et,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"flex space-x-1 mb-4 bg-gray-900/50 p-1 rounded-lg",children:Ce.map(x=>{const $=x.icon;return t.jsxs("button",{onClick:()=>H(x.id),className:`
                        flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-all flex-1
                        ${k===x.id?"bg-violet-500/20 text-violet-400 border border-violet-500/30":"text-gray-400 hover:text-white hover:bg-gray-700/30"}
                      `,children:[t.jsx($,{className:"w-4 h-4"}),x.label]},x.id)})}),t.jsxs("div",{className:"space-y-4",children:[k==="basic"&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"text-sm font-medium text-white flex items-center gap-2",children:[t.jsx(Ue,{className:"w-4 h-4 text-emerald-400"}),"Deal Value"]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"number",placeholder:"Min Â£",value:o.minValue||"",onChange:x=>m({...o,minValue:x.target.value?Number(x.target.value):null}),className:"flex-1 p-2 text-sm rounded-md border border-gray-600 bg-gray-900/50 text-white focus:border-emerald-500 focus:outline-none transition-all"}),t.jsx("input",{type:"number",placeholder:"Max Â£",value:o.maxValue||"",onChange:x=>m({...o,maxValue:x.target.value?Number(x.target.value):null}),className:"flex-1 p-2 text-sm rounded-md border border-gray-600 bg-gray-900/50 text-white focus:border-emerald-500 focus:outline-none transition-all"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"text-sm font-medium text-white flex items-center gap-2",children:[t.jsx(Kn,{className:"w-4 h-4 text-blue-400"}),"Min Probability"]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:o.probability||0,onChange:x=>m({...o,probability:Number(x.target.value)||null}),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),t.jsx("div",{className:"text-center",children:t.jsxs("span",{className:"text-xs px-2 py-1 rounded bg-blue-500/20 text-blue-400",children:[o.probability||0,"%+"]})})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("label",{className:"text-sm font-medium text-white flex items-center gap-2",children:[t.jsx(Me,{className:"w-4 h-4 text-purple-400"}),"Sales Rep"]}),t.jsx(xt,{selectedOwnerId:s,onOwnerChange:l,className:"w-full"})]})]}),k==="advanced"&&t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[t.jsxs("select",{value:o.dateRange.field||"",onChange:x=>m({...o,dateRange:{...o.dateRange,field:x.target.value||null}}),className:"p-2 text-sm rounded-md border border-gray-600 bg-gray-900/50 text-white focus:border-orange-500 focus:outline-none transition-all",children:[t.jsx("option",{value:"",children:"Select Date Field"}),t.jsx("option",{value:"created_at",children:"Created Date"}),t.jsx("option",{value:"expected_close_date",children:"Close Date"}),t.jsx("option",{value:"stage_changed_at",children:"Stage Change Date"})]}),t.jsx("input",{type:"date",value:o.dateRange.from||"",onChange:x=>m({...o,dateRange:{...o.dateRange,from:x.target.value||null}}),className:"p-2 text-sm rounded-md border border-gray-600 bg-gray-900/50 text-white focus:border-orange-500 focus:outline-none transition-all"}),t.jsx("input",{type:"date",value:o.dateRange.to||"",onChange:x=>m({...o,dateRange:{...o.dateRange,to:x.target.value||null}}),className:"p-2 text-sm rounded-md border border-gray-600 bg-gray-900/50 text-white focus:border-orange-500 focus:outline-none transition-all"})]}),t.jsx("div",{className:"pt-4 border-t border-gray-700",children:t.jsx(ht,{value:C,customRange:R,onPresetChange:_,onCustomRangeChange:A,label:"Deals Added",compact:!1})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Stages"}),t.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto scrollbar-none",children:f?.slice(0,4).map(x=>t.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:o.stages.includes(x.id),onChange:()=>ne(o.stages,x.id,$=>m({...o,stages:$})),className:"w-3 h-3 text-indigo-500 bg-gray-700 border-gray-600 rounded"}),t.jsx("span",{className:"text-white",children:x.name})]},x.id))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Priority"}),t.jsx("div",{className:"space-y-1",children:U.map(x=>t.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:o.priorities.includes(x),onChange:()=>ne(o.priorities,x,$=>m({...o,priorities:$})),className:"w-3 h-3 text-red-500 bg-gray-700 border-gray-600 rounded"}),t.jsx("span",{className:"text-white capitalize",children:x})]},x))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Deal Size"}),t.jsx("div",{className:"space-y-1",children:Se.map(x=>t.jsxs("label",{className:"flex items-center gap-2 text-xs cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:o.dealSizes.includes(x),onChange:()=>ne(o.dealSizes,x,$=>m({...o,dealSizes:$})),className:"w-3 h-3 text-yellow-500 bg-gray-700 border-gray-600 rounded"}),t.jsx("span",{className:"text-white capitalize",children:x})]},x))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-white mb-2 block",children:"Days in Stage"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("input",{type:"number",placeholder:"Min",value:o.daysInStage.min||"",onChange:x=>m({...o,daysInStage:{...o.daysInStage,min:x.target.value?Number(x.target.value):null}}),className:"w-full p-1.5 text-xs rounded border border-gray-600 bg-gray-900/50 text-white focus:border-cyan-500 focus:outline-none"}),t.jsx("input",{type:"number",placeholder:"Max",value:o.daysInStage.max||"",onChange:x=>m({...o,daysInStage:{...o.daysInStage,max:x.target.value?Number(x.target.value):null}}),className:"w-full p-1.5 text-xs rounded border border-gray-600 bg-gray-900/50 text-white focus:border-cyan-500 focus:outline-none"})]})]})]})]}),k==="source"&&t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-white mb-3 block",children:"Lead Source Type"}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:pe.map(x=>t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:o.leadSources.types.includes(x),onChange:()=>ne(o.leadSources.types,x,$=>m({...o,leadSources:{...o.leadSources,types:$}})),className:"w-4 h-4 text-green-500 bg-gray-700 border-gray-600 rounded"}),t.jsx("span",{className:"text-white capitalize",children:x})]},x))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-sm font-medium text-white mb-3 block",children:"Lead Source Channel"}),t.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-32 overflow-y-auto scrollbar-none",children:Ve.map(x=>t.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:o.leadSources.channels.includes(x),onChange:()=>ne(o.leadSources.channels,x,$=>m({...o,leadSources:{...o.leadSources,channels:$}})),className:"w-4 h-4 text-green-500 bg-gray-700 border-gray-600 rounded"}),t.jsx("span",{className:"text-white capitalize",children:x})]},x))})]})]})]}),t.jsx("div",{className:"flex items-center justify-end pt-4 mt-4 border-t border-gray-700/50",children:t.jsx("button",{onClick:()=>Y(!1),className:"px-4 py-2 rounded-lg text-sm font-medium bg-violet-500/20 text-violet-400 border border-violet-500/30 hover:bg-violet-500/30 transition-colors",children:"Apply Filters"})})]})})})]})}function gs({stage:e,deals:r,onDealClick:n,onAddDealClick:s,onConvertToSubscription:l}){const{setNodeRef:a,isOver:i}=rn({id:e.id}),d=r.map(g=>String(g.id)),u=w.useMemo(()=>r.reduce((g,c)=>g+parseFloat(c.value||0),0),[r]),o=w.useMemo(()=>{const g=e.default_probability/100;return u*g},[u,e.default_probability]),m=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0,notation:o>=1e6?"compact":"standard"}).format(o),h=new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0,notation:u>=1e6?"compact":"standard"}).format(u);return t.jsxs("div",{"data-testid":`pipeline-column-${e.id}`,className:`flex-1 min-w-[280px] max-w-[400px] bg-gray-900/50 backdrop-blur-xl
        rounded-xl border border-gray-800/50 flex flex-col max-h-[calc(100vh-250px)]`,style:{isolation:"isolate",transition:"border-color 150ms ease"},children:[t.jsxs("div",{className:"p-4 border-b border-gray-800/50 sticky top-0 z-10 bg-gray-900/80 backdrop-blur-xl",style:{borderBottomColor:i?`${e.color}80`:void 0},children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-4 h-4 rounded-md",style:{backgroundColor:e.color}}),t.jsx("h3",{className:"font-semibold text-white text-lg",children:e.name}),r.length===0&&t.jsx("span",{className:"text-xs text-gray-500 bg-gray-800/50 px-2 py-0.5 rounded-full",children:"Empty"})]}),t.jsx("div",{className:"bg-gray-800/50 px-2.5 py-0.5 rounded-full text-xs text-gray-400",children:r.length})]}),t.jsxs("div",{className:"text-sm text-gray-400",children:[t.jsx("span",{className:"font-medium text-emerald-400",children:m}),t.jsx("span",{className:"text-gray-500",children:" of "}),t.jsx("span",{className:"text-gray-300",children:h})]})]}),t.jsxs("div",{ref:a,className:`
          flex-1 overflow-y-auto p-4 space-y-3
          ${i?"bg-gray-800/30 ring-1 ring-inset":""}
          scrollbar-none
          transition-all duration-150
        `,style:{position:"relative",zIndex:1,...i?{"--ring-color":`${e.color}40`}:{}},children:[r.length===0&&!i&&t.jsxs("div",{className:"text-gray-500 text-center text-sm space-y-2",children:[t.jsx("div",{className:"h-20 flex items-center justify-center border border-dashed border-gray-800/50 rounded-lg",children:"Drop deals here"}),t.jsxs("div",{className:"text-xs text-gray-600",children:[e.default_probability,"% probability â€¢ Included in pipeline total"]})]}),t.jsx(ln,{items:d,strategy:an,children:r.map((g,c)=>t.jsx(Et,{deal:g,index:c,onClick:n,onConvertToSubscription:l},g.id))}),t.jsxs("button",{onClick:()=>s(e.id),className:`w-full h-12 flex items-center justify-center gap-2
            bg-transparent border border-dashed border-gray-700 rounded-lg
            text-gray-400 hover:text-gray-300 hover:bg-gray-800/30
            transition-colors mt-3`,children:[t.jsx($t,{className:"w-4 h-4"}),t.jsx("span",{className:"text-sm",children:"Add deal"})]})]}),r.length>0&&t.jsx("div",{className:"p-3 border-t border-gray-800/50 bg-gray-900/70",children:t.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[t.jsxs("span",{children:["Probability: ",e.default_probability,"%"]}),t.jsxs("span",{children:["Total Deals: ",r.length]})]})})]})}function ge(e,r){return typeof e=="function"?e(r):e}function te(e,r){return n=>{r.setState(s=>({...s,[e]:ge(n,s[e])}))}}function $e(e){return e instanceof Function}function ms(e){return Array.isArray(e)&&e.every(r=>typeof r=="number")}function ps(e,r){const n=[],s=l=>{l.forEach(a=>{n.push(a);const i=r(a);i!=null&&i.length&&s(i)})};return s(e),n}function b(e,r,n){let s=[],l;return a=>{let i;n.key&&n.debug&&(i=Date.now());const d=e(a);if(!(d.length!==s.length||d.some((m,h)=>s[h]!==m)))return l;s=d;let o;if(n.key&&n.debug&&(o=Date.now()),l=r(...d),n==null||n.onChange==null||n.onChange(l),n.key&&n.debug&&n!=null&&n.debug()){const m=Math.round((Date.now()-i)*100)/100,g=Math.round((Date.now()-o)*100)/100/16,c=(f,p)=>{for(f=String(f);f.length<p;)f=" "+f;return f}}return l}}function S(e,r,n,s){return{debug:()=>{var l;return(l=e?.debugAll)!=null?l:e[r]},key:!1,onChange:s}}function fs(e,r,n,s){const l=()=>{var i;return(i=a.getValue())!=null?i:e.options.renderFallbackValue},a={id:`${r.id}_${n.id}`,row:r,column:n,getValue:()=>r.getValue(s),renderValue:l,getContext:b(()=>[e,n,r,a],(i,d,u,o)=>({table:i,column:d,row:u,cell:o,getValue:o.getValue,renderValue:o.renderValue}),S(e.options,"debugCells"))};return e._features.forEach(i=>{i.createCell==null||i.createCell(a,n,r,e)},{}),a}function xs(e,r,n,s){var l,a;const d={...e._getDefaultColumnDef(),...r},u=d.accessorKey;let o=(l=(a=d.id)!=null?a:u?typeof String.prototype.replaceAll=="function"?u.replaceAll(".","_"):u.replace(/\./g,"_"):void 0)!=null?l:typeof d.header=="string"?d.header:void 0,m;if(d.accessorFn?m=d.accessorFn:u&&(u.includes(".")?m=g=>{let c=g;for(const p of u.split(".")){var f;c=(f=c)==null?void 0:f[p]}return c}:m=g=>g[d.accessorKey]),!o)throw new Error;let h={id:`${String(o)}`,accessorFn:m,parent:s,depth:n,columnDef:d,columns:[],getFlatColumns:b(()=>[!0],()=>{var g;return[h,...(g=h.columns)==null?void 0:g.flatMap(c=>c.getFlatColumns())]},S(e.options,"debugColumns")),getLeafColumns:b(()=>[e._getOrderColumnsFn()],g=>{var c;if((c=h.columns)!=null&&c.length){let f=h.columns.flatMap(p=>p.getLeafColumns());return g(f)}return[h]},S(e.options,"debugColumns"))};for(const g of e._features)g.createColumn==null||g.createColumn(h,e);return h}const W="debugHeaders";function jt(e,r,n){var s;let a={id:(s=n.id)!=null?s:r.id,column:r,index:n.index,isPlaceholder:!!n.isPlaceholder,placeholderId:n.placeholderId,depth:n.depth,subHeaders:[],colSpan:0,rowSpan:0,headerGroup:null,getLeafHeaders:()=>{const i=[],d=u=>{u.subHeaders&&u.subHeaders.length&&u.subHeaders.map(d),i.push(u)};return d(a),i},getContext:()=>({table:e,header:a,column:r})};return e._features.forEach(i=>{i.createHeader==null||i.createHeader(a,e)}),a}const hs={createTable:e=>{e.getHeaderGroups=b(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(r,n,s,l)=>{var a,i;const d=(a=s?.map(h=>n.find(g=>g.id===h)).filter(Boolean))!=null?a:[],u=(i=l?.map(h=>n.find(g=>g.id===h)).filter(Boolean))!=null?i:[],o=n.filter(h=>!(s!=null&&s.includes(h.id))&&!(l!=null&&l.includes(h.id)));return Re(r,[...d,...o,...u],e)},S(e.options,W)),e.getCenterHeaderGroups=b(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(r,n,s,l)=>(n=n.filter(a=>!(s!=null&&s.includes(a.id))&&!(l!=null&&l.includes(a.id))),Re(r,n,e,"center")),S(e.options,W)),e.getLeftHeaderGroups=b(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.left],(r,n,s)=>{var l;const a=(l=s?.map(i=>n.find(d=>d.id===i)).filter(Boolean))!=null?l:[];return Re(r,a,e,"left")},S(e.options,W)),e.getRightHeaderGroups=b(()=>[e.getAllColumns(),e.getVisibleLeafColumns(),e.getState().columnPinning.right],(r,n,s)=>{var l;const a=(l=s?.map(i=>n.find(d=>d.id===i)).filter(Boolean))!=null?l:[];return Re(r,a,e,"right")},S(e.options,W)),e.getFooterGroups=b(()=>[e.getHeaderGroups()],r=>[...r].reverse(),S(e.options,W)),e.getLeftFooterGroups=b(()=>[e.getLeftHeaderGroups()],r=>[...r].reverse(),S(e.options,W)),e.getCenterFooterGroups=b(()=>[e.getCenterHeaderGroups()],r=>[...r].reverse(),S(e.options,W)),e.getRightFooterGroups=b(()=>[e.getRightHeaderGroups()],r=>[...r].reverse(),S(e.options,W)),e.getFlatHeaders=b(()=>[e.getHeaderGroups()],r=>r.map(n=>n.headers).flat(),S(e.options,W)),e.getLeftFlatHeaders=b(()=>[e.getLeftHeaderGroups()],r=>r.map(n=>n.headers).flat(),S(e.options,W)),e.getCenterFlatHeaders=b(()=>[e.getCenterHeaderGroups()],r=>r.map(n=>n.headers).flat(),S(e.options,W)),e.getRightFlatHeaders=b(()=>[e.getRightHeaderGroups()],r=>r.map(n=>n.headers).flat(),S(e.options,W)),e.getCenterLeafHeaders=b(()=>[e.getCenterFlatHeaders()],r=>r.filter(n=>{var s;return!((s=n.subHeaders)!=null&&s.length)}),S(e.options,W)),e.getLeftLeafHeaders=b(()=>[e.getLeftFlatHeaders()],r=>r.filter(n=>{var s;return!((s=n.subHeaders)!=null&&s.length)}),S(e.options,W)),e.getRightLeafHeaders=b(()=>[e.getRightFlatHeaders()],r=>r.filter(n=>{var s;return!((s=n.subHeaders)!=null&&s.length)}),S(e.options,W)),e.getLeafHeaders=b(()=>[e.getLeftHeaderGroups(),e.getCenterHeaderGroups(),e.getRightHeaderGroups()],(r,n,s)=>{var l,a,i,d,u,o;return[...(l=(a=r[0])==null?void 0:a.headers)!=null?l:[],...(i=(d=n[0])==null?void 0:d.headers)!=null?i:[],...(u=(o=s[0])==null?void 0:o.headers)!=null?u:[]].map(m=>m.getLeafHeaders()).flat()},S(e.options,W))}};function Re(e,r,n,s){var l,a;let i=0;const d=function(g,c){c===void 0&&(c=1),i=Math.max(i,c),g.filter(f=>f.getIsVisible()).forEach(f=>{var p;(p=f.columns)!=null&&p.length&&d(f.columns,c+1)},0)};d(e);let u=[];const o=(g,c)=>{const f={depth:c,id:[s,`${c}`].filter(Boolean).join("_"),headers:[]},p=[];g.forEach(v=>{const C=[...p].reverse()[0],_=v.column.depth===f.depth;let R,A=!1;if(_&&v.column.parent?R=v.column.parent:(R=v.column,A=!0),C&&C?.column===R)C.subHeaders.push(v);else{const L=jt(n,R,{id:[s,c,R.id,v?.id].filter(Boolean).join("_"),isPlaceholder:A,placeholderId:A?`${p.filter(T=>T.column===R).length}`:void 0,depth:c,index:p.length});L.subHeaders.push(v),p.push(L)}f.headers.push(v),v.headerGroup=f}),u.push(f),c>0&&o(p,c-1)},m=r.map((g,c)=>jt(n,g,{depth:i,index:c}));o(m,i-1),u.reverse();const h=g=>g.filter(f=>f.column.getIsVisible()).map(f=>{let p=0,v=0,C=[0];f.subHeaders&&f.subHeaders.length?(C=[],h(f.subHeaders).forEach(R=>{let{colSpan:A,rowSpan:L}=R;p+=A,C.push(L)})):p=1;const _=Math.min(...C);return v=v+_,f.colSpan=p,f.rowSpan=v,{colSpan:p,rowSpan:v}});return h((l=(a=u[0])==null?void 0:a.headers)!=null?l:[]),u}const lt=(e,r,n,s,l,a,i)=>{let d={id:r,index:s,original:n,depth:l,parentId:i,_valuesCache:{},_uniqueValuesCache:{},getValue:u=>{if(d._valuesCache.hasOwnProperty(u))return d._valuesCache[u];const o=e.getColumn(u);if(o!=null&&o.accessorFn)return d._valuesCache[u]=o.accessorFn(d.original,s),d._valuesCache[u]},getUniqueValues:u=>{if(d._uniqueValuesCache.hasOwnProperty(u))return d._uniqueValuesCache[u];const o=e.getColumn(u);if(o!=null&&o.accessorFn)return o.columnDef.getUniqueValues?(d._uniqueValuesCache[u]=o.columnDef.getUniqueValues(d.original,s),d._uniqueValuesCache[u]):(d._uniqueValuesCache[u]=[d.getValue(u)],d._uniqueValuesCache[u])},renderValue:u=>{var o;return(o=d.getValue(u))!=null?o:e.options.renderFallbackValue},subRows:[],getLeafRows:()=>ps(d.subRows,u=>u.subRows),getParentRow:()=>d.parentId?e.getRow(d.parentId,!0):void 0,getParentRows:()=>{let u=[],o=d;for(;;){const m=o.getParentRow();if(!m)break;u.push(m),o=m}return u.reverse()},getAllCells:b(()=>[e.getAllLeafColumns()],u=>u.map(o=>fs(e,d,o,o.id)),S(e.options,"debugRows")),_getAllCellsByColumnId:b(()=>[d.getAllCells()],u=>u.reduce((o,m)=>(o[m.column.id]=m,o),{}),S(e.options,"debugRows"))};for(let u=0;u<e._features.length;u++){const o=e._features[u];o==null||o.createRow==null||o.createRow(d,e)}return d},vs={createColumn:(e,r)=>{e._getFacetedRowModel=r.options.getFacetedRowModel&&r.options.getFacetedRowModel(r,e.id),e.getFacetedRowModel=()=>e._getFacetedRowModel?e._getFacetedRowModel():r.getPreFilteredRowModel(),e._getFacetedUniqueValues=r.options.getFacetedUniqueValues&&r.options.getFacetedUniqueValues(r,e.id),e.getFacetedUniqueValues=()=>e._getFacetedUniqueValues?e._getFacetedUniqueValues():new Map,e._getFacetedMinMaxValues=r.options.getFacetedMinMaxValues&&r.options.getFacetedMinMaxValues(r,e.id),e.getFacetedMinMaxValues=()=>{if(e._getFacetedMinMaxValues)return e._getFacetedMinMaxValues()}}},Lt=(e,r,n)=>{var s,l;const a=n==null||(s=n.toString())==null?void 0:s.toLowerCase();return!!(!((l=e.getValue(r))==null||(l=l.toString())==null||(l=l.toLowerCase())==null)&&l.includes(a))};Lt.autoRemove=e=>oe(e);const zt=(e,r,n)=>{var s;return!!(!((s=e.getValue(r))==null||(s=s.toString())==null)&&s.includes(n))};zt.autoRemove=e=>oe(e);const Ot=(e,r,n)=>{var s;return((s=e.getValue(r))==null||(s=s.toString())==null?void 0:s.toLowerCase())===n?.toLowerCase()};Ot.autoRemove=e=>oe(e);const Gt=(e,r,n)=>{var s;return(s=e.getValue(r))==null?void 0:s.includes(n)};Gt.autoRemove=e=>oe(e);const Tt=(e,r,n)=>!n.some(s=>{var l;return!((l=e.getValue(r))!=null&&l.includes(s))});Tt.autoRemove=e=>oe(e)||!(e!=null&&e.length);const Ht=(e,r,n)=>n.some(s=>{var l;return(l=e.getValue(r))==null?void 0:l.includes(s)});Ht.autoRemove=e=>oe(e)||!(e!=null&&e.length);const Bt=(e,r,n)=>e.getValue(r)===n;Bt.autoRemove=e=>oe(e);const qt=(e,r,n)=>e.getValue(r)==n;qt.autoRemove=e=>oe(e);const at=(e,r,n)=>{let[s,l]=n;const a=e.getValue(r);return a>=s&&a<=l};at.resolveFilterValue=e=>{let[r,n]=e,s=typeof r!="number"?parseFloat(r):r,l=typeof n!="number"?parseFloat(n):n,a=r===null||Number.isNaN(s)?-1/0:s,i=n===null||Number.isNaN(l)?1/0:l;if(a>i){const d=a;a=i,i=d}return[a,i]};at.autoRemove=e=>oe(e)||oe(e[0])&&oe(e[1]);const de={includesString:Lt,includesStringSensitive:zt,equalsString:Ot,arrIncludes:Gt,arrIncludesAll:Tt,arrIncludesSome:Ht,equals:Bt,weakEquals:qt,inNumberRange:at};function oe(e){return e==null||e===""}const ys={getDefaultColumnDef:()=>({filterFn:"auto"}),getInitialState:e=>({columnFilters:[],...e}),getDefaultOptions:e=>({onColumnFiltersChange:te("columnFilters",e),filterFromLeafRows:!1,maxLeafRowFilterDepth:100}),createColumn:(e,r)=>{e.getAutoFilterFn=()=>{const n=r.getCoreRowModel().flatRows[0],s=n?.getValue(e.id);return typeof s=="string"?de.includesString:typeof s=="number"?de.inNumberRange:typeof s=="boolean"||s!==null&&typeof s=="object"?de.equals:Array.isArray(s)?de.arrIncludes:de.weakEquals},e.getFilterFn=()=>{var n,s;return $e(e.columnDef.filterFn)?e.columnDef.filterFn:e.columnDef.filterFn==="auto"?e.getAutoFilterFn():(n=(s=r.options.filterFns)==null?void 0:s[e.columnDef.filterFn])!=null?n:de[e.columnDef.filterFn]},e.getCanFilter=()=>{var n,s,l;return((n=e.columnDef.enableColumnFilter)!=null?n:!0)&&((s=r.options.enableColumnFilters)!=null?s:!0)&&((l=r.options.enableFilters)!=null?l:!0)&&!!e.accessorFn},e.getIsFiltered=()=>e.getFilterIndex()>-1,e.getFilterValue=()=>{var n;return(n=r.getState().columnFilters)==null||(n=n.find(s=>s.id===e.id))==null?void 0:n.value},e.getFilterIndex=()=>{var n,s;return(n=(s=r.getState().columnFilters)==null?void 0:s.findIndex(l=>l.id===e.id))!=null?n:-1},e.setFilterValue=n=>{r.setColumnFilters(s=>{const l=e.getFilterFn(),a=s?.find(m=>m.id===e.id),i=ge(n,a?a.value:void 0);if(Nt(l,i,e)){var d;return(d=s?.filter(m=>m.id!==e.id))!=null?d:[]}const u={id:e.id,value:i};if(a){var o;return(o=s?.map(m=>m.id===e.id?u:m))!=null?o:[]}return s!=null&&s.length?[...s,u]:[u]})}},createRow:(e,r)=>{e.columnFilters={},e.columnFiltersMeta={}},createTable:e=>{e.setColumnFilters=r=>{const n=e.getAllLeafColumns(),s=l=>{var a;return(a=ge(r,l))==null?void 0:a.filter(i=>{const d=n.find(u=>u.id===i.id);if(d){const u=d.getFilterFn();if(Nt(u,i.value,d))return!1}return!0})};e.options.onColumnFiltersChange==null||e.options.onColumnFiltersChange(s)},e.resetColumnFilters=r=>{var n,s;e.setColumnFilters(r?[]:(n=(s=e.initialState)==null?void 0:s.columnFilters)!=null?n:[])},e.getPreFilteredRowModel=()=>e.getCoreRowModel(),e.getFilteredRowModel=()=>(!e._getFilteredRowModel&&e.options.getFilteredRowModel&&(e._getFilteredRowModel=e.options.getFilteredRowModel(e)),e.options.manualFiltering||!e._getFilteredRowModel?e.getPreFilteredRowModel():e._getFilteredRowModel())}};function Nt(e,r,n){return(e&&e.autoRemove?e.autoRemove(r,n):!1)||typeof r>"u"||typeof r=="string"&&!r}const ws=(e,r,n)=>n.reduce((s,l)=>{const a=l.getValue(e);return s+(typeof a=="number"?a:0)},0),bs=(e,r,n)=>{let s;return n.forEach(l=>{const a=l.getValue(e);a!=null&&(s>a||s===void 0&&a>=a)&&(s=a)}),s},Ss=(e,r,n)=>{let s;return n.forEach(l=>{const a=l.getValue(e);a!=null&&(s<a||s===void 0&&a>=a)&&(s=a)}),s},Cs=(e,r,n)=>{let s,l;return n.forEach(a=>{const i=a.getValue(e);i!=null&&(s===void 0?i>=i&&(s=l=i):(s>i&&(s=i),l<i&&(l=i)))}),[s,l]},js=(e,r)=>{let n=0,s=0;if(r.forEach(l=>{let a=l.getValue(e);a!=null&&(a=+a)>=a&&(++n,s+=a)}),n)return s/n},Ns=(e,r)=>{if(!r.length)return;const n=r.map(a=>a.getValue(e));if(!ms(n))return;if(n.length===1)return n[0];const s=Math.floor(n.length/2),l=n.sort((a,i)=>a-i);return n.length%2!==0?l[s]:(l[s-1]+l[s])/2},_s=(e,r)=>Array.from(new Set(r.map(n=>n.getValue(e))).values()),Rs=(e,r)=>new Set(r.map(n=>n.getValue(e))).size,Fs=(e,r)=>r.length,Le={sum:ws,min:bs,max:Ss,extent:Cs,mean:js,median:Ns,unique:_s,uniqueCount:Rs,count:Fs},Ds={getDefaultColumnDef:()=>({aggregatedCell:e=>{var r,n;return(r=(n=e.getValue())==null||n.toString==null?void 0:n.toString())!=null?r:null},aggregationFn:"auto"}),getInitialState:e=>({grouping:[],...e}),getDefaultOptions:e=>({onGroupingChange:te("grouping",e),groupedColumnMode:"reorder"}),createColumn:(e,r)=>{e.toggleGrouping=()=>{r.setGrouping(n=>n!=null&&n.includes(e.id)?n.filter(s=>s!==e.id):[...n??[],e.id])},e.getCanGroup=()=>{var n,s;return((n=e.columnDef.enableGrouping)!=null?n:!0)&&((s=r.options.enableGrouping)!=null?s:!0)&&(!!e.accessorFn||!!e.columnDef.getGroupingValue)},e.getIsGrouped=()=>{var n;return(n=r.getState().grouping)==null?void 0:n.includes(e.id)},e.getGroupedIndex=()=>{var n;return(n=r.getState().grouping)==null?void 0:n.indexOf(e.id)},e.getToggleGroupingHandler=()=>{const n=e.getCanGroup();return()=>{n&&e.toggleGrouping()}},e.getAutoAggregationFn=()=>{const n=r.getCoreRowModel().flatRows[0],s=n?.getValue(e.id);if(typeof s=="number")return Le.sum;if(Object.prototype.toString.call(s)==="[object Date]")return Le.extent},e.getAggregationFn=()=>{var n,s;if(!e)throw new Error;return $e(e.columnDef.aggregationFn)?e.columnDef.aggregationFn:e.columnDef.aggregationFn==="auto"?e.getAutoAggregationFn():(n=(s=r.options.aggregationFns)==null?void 0:s[e.columnDef.aggregationFn])!=null?n:Le[e.columnDef.aggregationFn]}},createTable:e=>{e.setGrouping=r=>e.options.onGroupingChange==null?void 0:e.options.onGroupingChange(r),e.resetGrouping=r=>{var n,s;e.setGrouping(r?[]:(n=(s=e.initialState)==null?void 0:s.grouping)!=null?n:[])},e.getPreGroupedRowModel=()=>e.getFilteredRowModel(),e.getGroupedRowModel=()=>(!e._getGroupedRowModel&&e.options.getGroupedRowModel&&(e._getGroupedRowModel=e.options.getGroupedRowModel(e)),e.options.manualGrouping||!e._getGroupedRowModel?e.getPreGroupedRowModel():e._getGroupedRowModel())},createRow:(e,r)=>{e.getIsGrouped=()=>!!e.groupingColumnId,e.getGroupingValue=n=>{if(e._groupingValuesCache.hasOwnProperty(n))return e._groupingValuesCache[n];const s=r.getColumn(n);return s!=null&&s.columnDef.getGroupingValue?(e._groupingValuesCache[n]=s.columnDef.getGroupingValue(e.original),e._groupingValuesCache[n]):e.getValue(n)},e._groupingValuesCache={}},createCell:(e,r,n,s)=>{e.getIsGrouped=()=>r.getIsGrouped()&&r.id===n.groupingColumnId,e.getIsPlaceholder=()=>!e.getIsGrouped()&&r.getIsGrouped(),e.getIsAggregated=()=>{var l;return!e.getIsGrouped()&&!e.getIsPlaceholder()&&!!((l=n.subRows)!=null&&l.length)}}};function Is(e,r,n){if(!(r!=null&&r.length)||!n)return e;const s=e.filter(a=>!r.includes(a.id));return n==="remove"?s:[...r.map(a=>e.find(i=>i.id===a)).filter(Boolean),...s]}const Ms={getInitialState:e=>({columnOrder:[],...e}),getDefaultOptions:e=>({onColumnOrderChange:te("columnOrder",e)}),createColumn:(e,r)=>{e.getIndex=b(n=>[be(r,n)],n=>n.findIndex(s=>s.id===e.id),S(r.options,"debugColumns")),e.getIsFirstColumn=n=>{var s;return((s=be(r,n)[0])==null?void 0:s.id)===e.id},e.getIsLastColumn=n=>{var s;const l=be(r,n);return((s=l[l.length-1])==null?void 0:s.id)===e.id}},createTable:e=>{e.setColumnOrder=r=>e.options.onColumnOrderChange==null?void 0:e.options.onColumnOrderChange(r),e.resetColumnOrder=r=>{var n;e.setColumnOrder(r?[]:(n=e.initialState.columnOrder)!=null?n:[])},e._getOrderColumnsFn=b(()=>[e.getState().columnOrder,e.getState().grouping,e.options.groupedColumnMode],(r,n,s)=>l=>{let a=[];if(!(r!=null&&r.length))a=l;else{const i=[...r],d=[...l];for(;d.length&&i.length;){const u=i.shift(),o=d.findIndex(m=>m.id===u);o>-1&&a.push(d.splice(o,1)[0])}a=[...a,...d]}return Is(a,n,s)},S(e.options,"debugTable"))}},ze=()=>({left:[],right:[]}),Ps={getInitialState:e=>({columnPinning:ze(),...e}),getDefaultOptions:e=>({onColumnPinningChange:te("columnPinning",e)}),createColumn:(e,r)=>{e.pin=n=>{const s=e.getLeafColumns().map(l=>l.id).filter(Boolean);r.setColumnPinning(l=>{var a,i;if(n==="right"){var d,u;return{left:((d=l?.left)!=null?d:[]).filter(h=>!(s!=null&&s.includes(h))),right:[...((u=l?.right)!=null?u:[]).filter(h=>!(s!=null&&s.includes(h))),...s]}}if(n==="left"){var o,m;return{left:[...((o=l?.left)!=null?o:[]).filter(h=>!(s!=null&&s.includes(h))),...s],right:((m=l?.right)!=null?m:[]).filter(h=>!(s!=null&&s.includes(h)))}}return{left:((a=l?.left)!=null?a:[]).filter(h=>!(s!=null&&s.includes(h))),right:((i=l?.right)!=null?i:[]).filter(h=>!(s!=null&&s.includes(h)))}})},e.getCanPin=()=>e.getLeafColumns().some(s=>{var l,a,i;return((l=s.columnDef.enablePinning)!=null?l:!0)&&((a=(i=r.options.enableColumnPinning)!=null?i:r.options.enablePinning)!=null?a:!0)}),e.getIsPinned=()=>{const n=e.getLeafColumns().map(d=>d.id),{left:s,right:l}=r.getState().columnPinning,a=n.some(d=>s?.includes(d)),i=n.some(d=>l?.includes(d));return a?"left":i?"right":!1},e.getPinnedIndex=()=>{var n,s;const l=e.getIsPinned();return l?(n=(s=r.getState().columnPinning)==null||(s=s[l])==null?void 0:s.indexOf(e.id))!=null?n:-1:0}},createRow:(e,r)=>{e.getCenterVisibleCells=b(()=>[e._getAllVisibleCells(),r.getState().columnPinning.left,r.getState().columnPinning.right],(n,s,l)=>{const a=[...s??[],...l??[]];return n.filter(i=>!a.includes(i.column.id))},S(r.options,"debugRows")),e.getLeftVisibleCells=b(()=>[e._getAllVisibleCells(),r.getState().columnPinning.left],(n,s)=>(s??[]).map(a=>n.find(i=>i.column.id===a)).filter(Boolean).map(a=>({...a,position:"left"})),S(r.options,"debugRows")),e.getRightVisibleCells=b(()=>[e._getAllVisibleCells(),r.getState().columnPinning.right],(n,s)=>(s??[]).map(a=>n.find(i=>i.column.id===a)).filter(Boolean).map(a=>({...a,position:"right"})),S(r.options,"debugRows"))},createTable:e=>{e.setColumnPinning=r=>e.options.onColumnPinningChange==null?void 0:e.options.onColumnPinningChange(r),e.resetColumnPinning=r=>{var n,s;return e.setColumnPinning(r?ze():(n=(s=e.initialState)==null?void 0:s.columnPinning)!=null?n:ze())},e.getIsSomeColumnsPinned=r=>{var n;const s=e.getState().columnPinning;if(!r){var l,a;return!!((l=s.left)!=null&&l.length||(a=s.right)!=null&&a.length)}return!!((n=s[r])!=null&&n.length)},e.getLeftLeafColumns=b(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left],(r,n)=>(n??[]).map(s=>r.find(l=>l.id===s)).filter(Boolean),S(e.options,"debugColumns")),e.getRightLeafColumns=b(()=>[e.getAllLeafColumns(),e.getState().columnPinning.right],(r,n)=>(n??[]).map(s=>r.find(l=>l.id===s)).filter(Boolean),S(e.options,"debugColumns")),e.getCenterLeafColumns=b(()=>[e.getAllLeafColumns(),e.getState().columnPinning.left,e.getState().columnPinning.right],(r,n,s)=>{const l=[...n??[],...s??[]];return r.filter(a=>!l.includes(a.id))},S(e.options,"debugColumns"))}};function $s(e){return e||(typeof document<"u"?document:null)}const Fe={size:150,minSize:20,maxSize:Number.MAX_SAFE_INTEGER},Oe=()=>({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),Vs={getDefaultColumnDef:()=>Fe,getInitialState:e=>({columnSizing:{},columnSizingInfo:Oe(),...e}),getDefaultOptions:e=>({columnResizeMode:"onEnd",columnResizeDirection:"ltr",onColumnSizingChange:te("columnSizing",e),onColumnSizingInfoChange:te("columnSizingInfo",e)}),createColumn:(e,r)=>{e.getSize=()=>{var n,s,l;const a=r.getState().columnSizing[e.id];return Math.min(Math.max((n=e.columnDef.minSize)!=null?n:Fe.minSize,(s=a??e.columnDef.size)!=null?s:Fe.size),(l=e.columnDef.maxSize)!=null?l:Fe.maxSize)},e.getStart=b(n=>[n,be(r,n),r.getState().columnSizing],(n,s)=>s.slice(0,e.getIndex(n)).reduce((l,a)=>l+a.getSize(),0),S(r.options,"debugColumns")),e.getAfter=b(n=>[n,be(r,n),r.getState().columnSizing],(n,s)=>s.slice(e.getIndex(n)+1).reduce((l,a)=>l+a.getSize(),0),S(r.options,"debugColumns")),e.resetSize=()=>{r.setColumnSizing(n=>{let{[e.id]:s,...l}=n;return l})},e.getCanResize=()=>{var n,s;return((n=e.columnDef.enableResizing)!=null?n:!0)&&((s=r.options.enableColumnResizing)!=null?s:!0)},e.getIsResizing=()=>r.getState().columnSizingInfo.isResizingColumn===e.id},createHeader:(e,r)=>{e.getSize=()=>{let n=0;const s=l=>{if(l.subHeaders.length)l.subHeaders.forEach(s);else{var a;n+=(a=l.column.getSize())!=null?a:0}};return s(e),n},e.getStart=()=>{if(e.index>0){const n=e.headerGroup.headers[e.index-1];return n.getStart()+n.getSize()}return 0},e.getResizeHandler=n=>{const s=r.getColumn(e.column.id),l=s?.getCanResize();return a=>{if(!s||!l||(a.persist==null||a.persist(),Ge(a)&&a.touches&&a.touches.length>1))return;const i=e.getSize(),d=e?e.getLeafHeaders().map(C=>[C.column.id,C.column.getSize()]):[[s.id,s.getSize()]],u=Ge(a)?Math.round(a.touches[0].clientX):a.clientX,o={},m=(C,_)=>{typeof _=="number"&&(r.setColumnSizingInfo(R=>{var A,L;const T=r.options.columnResizeDirection==="rtl"?-1:1,Y=(_-((A=R?.startOffset)!=null?A:0))*T,k=Math.max(Y/((L=R?.startSize)!=null?L:0),-.999999);return R.columnSizingStart.forEach(H=>{let[y,N]=H;o[y]=Math.round(Math.max(N+N*k,0)*100)/100}),{...R,deltaOffset:Y,deltaPercentage:k}}),(r.options.columnResizeMode==="onChange"||C==="end")&&r.setColumnSizing(R=>({...R,...o})))},h=C=>m("move",C),g=C=>{m("end",C),r.setColumnSizingInfo(_=>({..._,isResizingColumn:!1,startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,columnSizingStart:[]}))},c=$s(n),f={moveHandler:C=>h(C.clientX),upHandler:C=>{c?.removeEventListener("mousemove",f.moveHandler),c?.removeEventListener("mouseup",f.upHandler),g(C.clientX)}},p={moveHandler:C=>(C.cancelable&&(C.preventDefault(),C.stopPropagation()),h(C.touches[0].clientX),!1),upHandler:C=>{var _;c?.removeEventListener("touchmove",p.moveHandler),c?.removeEventListener("touchend",p.upHandler),C.cancelable&&(C.preventDefault(),C.stopPropagation()),g((_=C.touches[0])==null?void 0:_.clientX)}},v=ks()?{passive:!1}:!1;Ge(a)?(c?.addEventListener("touchmove",p.moveHandler,v),c?.addEventListener("touchend",p.upHandler,v)):(c?.addEventListener("mousemove",f.moveHandler,v),c?.addEventListener("mouseup",f.upHandler,v)),r.setColumnSizingInfo(C=>({...C,startOffset:u,startSize:i,deltaOffset:0,deltaPercentage:0,columnSizingStart:d,isResizingColumn:s.id}))}}},createTable:e=>{e.setColumnSizing=r=>e.options.onColumnSizingChange==null?void 0:e.options.onColumnSizingChange(r),e.setColumnSizingInfo=r=>e.options.onColumnSizingInfoChange==null?void 0:e.options.onColumnSizingInfoChange(r),e.resetColumnSizing=r=>{var n;e.setColumnSizing(r?{}:(n=e.initialState.columnSizing)!=null?n:{})},e.resetHeaderSizeInfo=r=>{var n;e.setColumnSizingInfo(r?Oe():(n=e.initialState.columnSizingInfo)!=null?n:Oe())},e.getTotalSize=()=>{var r,n;return(r=(n=e.getHeaderGroups()[0])==null?void 0:n.headers.reduce((s,l)=>s+l.getSize(),0))!=null?r:0},e.getLeftTotalSize=()=>{var r,n;return(r=(n=e.getLeftHeaderGroups()[0])==null?void 0:n.headers.reduce((s,l)=>s+l.getSize(),0))!=null?r:0},e.getCenterTotalSize=()=>{var r,n;return(r=(n=e.getCenterHeaderGroups()[0])==null?void 0:n.headers.reduce((s,l)=>s+l.getSize(),0))!=null?r:0},e.getRightTotalSize=()=>{var r,n;return(r=(n=e.getRightHeaderGroups()[0])==null?void 0:n.headers.reduce((s,l)=>s+l.getSize(),0))!=null?r:0}}};let De=null;function ks(){if(typeof De=="boolean")return De;let e=!1;try{const r={get passive(){return e=!0,!1}},n=()=>{};window.addEventListener("test",n,r),window.removeEventListener("test",n)}catch{e=!1}return De=e,De}function Ge(e){return e.type==="touchstart"}const Es={getInitialState:e=>({columnVisibility:{},...e}),getDefaultOptions:e=>({onColumnVisibilityChange:te("columnVisibility",e)}),createColumn:(e,r)=>{e.toggleVisibility=n=>{e.getCanHide()&&r.setColumnVisibility(s=>({...s,[e.id]:n??!e.getIsVisible()}))},e.getIsVisible=()=>{var n,s;const l=e.columns;return(n=l.length?l.some(a=>a.getIsVisible()):(s=r.getState().columnVisibility)==null?void 0:s[e.id])!=null?n:!0},e.getCanHide=()=>{var n,s;return((n=e.columnDef.enableHiding)!=null?n:!0)&&((s=r.options.enableHiding)!=null?s:!0)},e.getToggleVisibilityHandler=()=>n=>{e.toggleVisibility==null||e.toggleVisibility(n.target.checked)}},createRow:(e,r)=>{e._getAllVisibleCells=b(()=>[e.getAllCells(),r.getState().columnVisibility],n=>n.filter(s=>s.column.getIsVisible()),S(r.options,"debugRows")),e.getVisibleCells=b(()=>[e.getLeftVisibleCells(),e.getCenterVisibleCells(),e.getRightVisibleCells()],(n,s,l)=>[...n,...s,...l],S(r.options,"debugRows"))},createTable:e=>{const r=(n,s)=>b(()=>[s(),s().filter(l=>l.getIsVisible()).map(l=>l.id).join("_")],l=>l.filter(a=>a.getIsVisible==null?void 0:a.getIsVisible()),S(e.options,"debugColumns"));e.getVisibleFlatColumns=r("getVisibleFlatColumns",()=>e.getAllFlatColumns()),e.getVisibleLeafColumns=r("getVisibleLeafColumns",()=>e.getAllLeafColumns()),e.getLeftVisibleLeafColumns=r("getLeftVisibleLeafColumns",()=>e.getLeftLeafColumns()),e.getRightVisibleLeafColumns=r("getRightVisibleLeafColumns",()=>e.getRightLeafColumns()),e.getCenterVisibleLeafColumns=r("getCenterVisibleLeafColumns",()=>e.getCenterLeafColumns()),e.setColumnVisibility=n=>e.options.onColumnVisibilityChange==null?void 0:e.options.onColumnVisibilityChange(n),e.resetColumnVisibility=n=>{var s;e.setColumnVisibility(n?{}:(s=e.initialState.columnVisibility)!=null?s:{})},e.toggleAllColumnsVisible=n=>{var s;n=(s=n)!=null?s:!e.getIsAllColumnsVisible(),e.setColumnVisibility(e.getAllLeafColumns().reduce((l,a)=>({...l,[a.id]:n||!(a.getCanHide!=null&&a.getCanHide())}),{}))},e.getIsAllColumnsVisible=()=>!e.getAllLeafColumns().some(n=>!(n.getIsVisible!=null&&n.getIsVisible())),e.getIsSomeColumnsVisible=()=>e.getAllLeafColumns().some(n=>n.getIsVisible==null?void 0:n.getIsVisible()),e.getToggleAllColumnsVisibilityHandler=()=>n=>{var s;e.toggleAllColumnsVisible((s=n.target)==null?void 0:s.checked)}}};function be(e,r){return r?r==="center"?e.getCenterVisibleLeafColumns():r==="left"?e.getLeftVisibleLeafColumns():e.getRightVisibleLeafColumns():e.getVisibleLeafColumns()}const As={createTable:e=>{e._getGlobalFacetedRowModel=e.options.getFacetedRowModel&&e.options.getFacetedRowModel(e,"__global__"),e.getGlobalFacetedRowModel=()=>e.options.manualFiltering||!e._getGlobalFacetedRowModel?e.getPreFilteredRowModel():e._getGlobalFacetedRowModel(),e._getGlobalFacetedUniqueValues=e.options.getFacetedUniqueValues&&e.options.getFacetedUniqueValues(e,"__global__"),e.getGlobalFacetedUniqueValues=()=>e._getGlobalFacetedUniqueValues?e._getGlobalFacetedUniqueValues():new Map,e._getGlobalFacetedMinMaxValues=e.options.getFacetedMinMaxValues&&e.options.getFacetedMinMaxValues(e,"__global__"),e.getGlobalFacetedMinMaxValues=()=>{if(e._getGlobalFacetedMinMaxValues)return e._getGlobalFacetedMinMaxValues()}}},Ls={getInitialState:e=>({globalFilter:void 0,...e}),getDefaultOptions:e=>({onGlobalFilterChange:te("globalFilter",e),globalFilterFn:"auto",getColumnCanGlobalFilter:r=>{var n;const s=(n=e.getCoreRowModel().flatRows[0])==null||(n=n._getAllCellsByColumnId()[r.id])==null?void 0:n.getValue();return typeof s=="string"||typeof s=="number"}}),createColumn:(e,r)=>{e.getCanGlobalFilter=()=>{var n,s,l,a;return((n=e.columnDef.enableGlobalFilter)!=null?n:!0)&&((s=r.options.enableGlobalFilter)!=null?s:!0)&&((l=r.options.enableFilters)!=null?l:!0)&&((a=r.options.getColumnCanGlobalFilter==null?void 0:r.options.getColumnCanGlobalFilter(e))!=null?a:!0)&&!!e.accessorFn}},createTable:e=>{e.getGlobalAutoFilterFn=()=>de.includesString,e.getGlobalFilterFn=()=>{var r,n;const{globalFilterFn:s}=e.options;return $e(s)?s:s==="auto"?e.getGlobalAutoFilterFn():(r=(n=e.options.filterFns)==null?void 0:n[s])!=null?r:de[s]},e.setGlobalFilter=r=>{e.options.onGlobalFilterChange==null||e.options.onGlobalFilterChange(r)},e.resetGlobalFilter=r=>{e.setGlobalFilter(r?void 0:e.initialState.globalFilter)}}},zs={getInitialState:e=>({expanded:{},...e}),getDefaultOptions:e=>({onExpandedChange:te("expanded",e),paginateExpandedRows:!0}),createTable:e=>{let r=!1,n=!1;e._autoResetExpanded=()=>{var s,l;if(!r){e._queue(()=>{r=!0});return}if((s=(l=e.options.autoResetAll)!=null?l:e.options.autoResetExpanded)!=null?s:!e.options.manualExpanding){if(n)return;n=!0,e._queue(()=>{e.resetExpanded(),n=!1})}},e.setExpanded=s=>e.options.onExpandedChange==null?void 0:e.options.onExpandedChange(s),e.toggleAllRowsExpanded=s=>{s??!e.getIsAllRowsExpanded()?e.setExpanded(!0):e.setExpanded({})},e.resetExpanded=s=>{var l,a;e.setExpanded(s?{}:(l=(a=e.initialState)==null?void 0:a.expanded)!=null?l:{})},e.getCanSomeRowsExpand=()=>e.getPrePaginationRowModel().flatRows.some(s=>s.getCanExpand()),e.getToggleAllRowsExpandedHandler=()=>s=>{s.persist==null||s.persist(),e.toggleAllRowsExpanded()},e.getIsSomeRowsExpanded=()=>{const s=e.getState().expanded;return s===!0||Object.values(s).some(Boolean)},e.getIsAllRowsExpanded=()=>{const s=e.getState().expanded;return typeof s=="boolean"?s===!0:!(!Object.keys(s).length||e.getRowModel().flatRows.some(l=>!l.getIsExpanded()))},e.getExpandedDepth=()=>{let s=0;return(e.getState().expanded===!0?Object.keys(e.getRowModel().rowsById):Object.keys(e.getState().expanded)).forEach(a=>{const i=a.split(".");s=Math.max(s,i.length)}),s},e.getPreExpandedRowModel=()=>e.getSortedRowModel(),e.getExpandedRowModel=()=>(!e._getExpandedRowModel&&e.options.getExpandedRowModel&&(e._getExpandedRowModel=e.options.getExpandedRowModel(e)),e.options.manualExpanding||!e._getExpandedRowModel?e.getPreExpandedRowModel():e._getExpandedRowModel())},createRow:(e,r)=>{e.toggleExpanded=n=>{r.setExpanded(s=>{var l;const a=s===!0?!0:!!(s!=null&&s[e.id]);let i={};if(s===!0?Object.keys(r.getRowModel().rowsById).forEach(d=>{i[d]=!0}):i=s,n=(l=n)!=null?l:!a,!a&&n)return{...i,[e.id]:!0};if(a&&!n){const{[e.id]:d,...u}=i;return u}return s})},e.getIsExpanded=()=>{var n;const s=r.getState().expanded;return!!((n=r.options.getIsRowExpanded==null?void 0:r.options.getIsRowExpanded(e))!=null?n:s===!0||s?.[e.id])},e.getCanExpand=()=>{var n,s,l;return(n=r.options.getRowCanExpand==null?void 0:r.options.getRowCanExpand(e))!=null?n:((s=r.options.enableExpanding)!=null?s:!0)&&!!((l=e.subRows)!=null&&l.length)},e.getIsAllParentsExpanded=()=>{let n=!0,s=e;for(;n&&s.parentId;)s=r.getRow(s.parentId,!0),n=s.getIsExpanded();return n},e.getToggleExpandedHandler=()=>{const n=e.getCanExpand();return()=>{n&&e.toggleExpanded()}}}},Ke=0,We=10,Te=()=>({pageIndex:Ke,pageSize:We}),Os={getInitialState:e=>({...e,pagination:{...Te(),...e?.pagination}}),getDefaultOptions:e=>({onPaginationChange:te("pagination",e)}),createTable:e=>{let r=!1,n=!1;e._autoResetPageIndex=()=>{var s,l;if(!r){e._queue(()=>{r=!0});return}if((s=(l=e.options.autoResetAll)!=null?l:e.options.autoResetPageIndex)!=null?s:!e.options.manualPagination){if(n)return;n=!0,e._queue(()=>{e.resetPageIndex(),n=!1})}},e.setPagination=s=>{const l=a=>ge(s,a);return e.options.onPaginationChange==null?void 0:e.options.onPaginationChange(l)},e.resetPagination=s=>{var l;e.setPagination(s?Te():(l=e.initialState.pagination)!=null?l:Te())},e.setPageIndex=s=>{e.setPagination(l=>{let a=ge(s,l.pageIndex);const i=typeof e.options.pageCount>"u"||e.options.pageCount===-1?Number.MAX_SAFE_INTEGER:e.options.pageCount-1;return a=Math.max(0,Math.min(a,i)),{...l,pageIndex:a}})},e.resetPageIndex=s=>{var l,a;e.setPageIndex(s?Ke:(l=(a=e.initialState)==null||(a=a.pagination)==null?void 0:a.pageIndex)!=null?l:Ke)},e.resetPageSize=s=>{var l,a;e.setPageSize(s?We:(l=(a=e.initialState)==null||(a=a.pagination)==null?void 0:a.pageSize)!=null?l:We)},e.setPageSize=s=>{e.setPagination(l=>{const a=Math.max(1,ge(s,l.pageSize)),i=l.pageSize*l.pageIndex,d=Math.floor(i/a);return{...l,pageIndex:d,pageSize:a}})},e.setPageCount=s=>e.setPagination(l=>{var a;let i=ge(s,(a=e.options.pageCount)!=null?a:-1);return typeof i=="number"&&(i=Math.max(-1,i)),{...l,pageCount:i}}),e.getPageOptions=b(()=>[e.getPageCount()],s=>{let l=[];return s&&s>0&&(l=[...new Array(s)].fill(null).map((a,i)=>i)),l},S(e.options,"debugTable")),e.getCanPreviousPage=()=>e.getState().pagination.pageIndex>0,e.getCanNextPage=()=>{const{pageIndex:s}=e.getState().pagination,l=e.getPageCount();return l===-1?!0:l===0?!1:s<l-1},e.previousPage=()=>e.setPageIndex(s=>s-1),e.nextPage=()=>e.setPageIndex(s=>s+1),e.firstPage=()=>e.setPageIndex(0),e.lastPage=()=>e.setPageIndex(e.getPageCount()-1),e.getPrePaginationRowModel=()=>e.getExpandedRowModel(),e.getPaginationRowModel=()=>(!e._getPaginationRowModel&&e.options.getPaginationRowModel&&(e._getPaginationRowModel=e.options.getPaginationRowModel(e)),e.options.manualPagination||!e._getPaginationRowModel?e.getPrePaginationRowModel():e._getPaginationRowModel()),e.getPageCount=()=>{var s;return(s=e.options.pageCount)!=null?s:Math.ceil(e.getRowCount()/e.getState().pagination.pageSize)},e.getRowCount=()=>{var s;return(s=e.options.rowCount)!=null?s:e.getPrePaginationRowModel().rows.length}}},He=()=>({top:[],bottom:[]}),Gs={getInitialState:e=>({rowPinning:He(),...e}),getDefaultOptions:e=>({onRowPinningChange:te("rowPinning",e)}),createRow:(e,r)=>{e.pin=(n,s,l)=>{const a=s?e.getLeafRows().map(u=>{let{id:o}=u;return o}):[],i=l?e.getParentRows().map(u=>{let{id:o}=u;return o}):[],d=new Set([...i,e.id,...a]);r.setRowPinning(u=>{var o,m;if(n==="bottom"){var h,g;return{top:((h=u?.top)!=null?h:[]).filter(p=>!(d!=null&&d.has(p))),bottom:[...((g=u?.bottom)!=null?g:[]).filter(p=>!(d!=null&&d.has(p))),...Array.from(d)]}}if(n==="top"){var c,f;return{top:[...((c=u?.top)!=null?c:[]).filter(p=>!(d!=null&&d.has(p))),...Array.from(d)],bottom:((f=u?.bottom)!=null?f:[]).filter(p=>!(d!=null&&d.has(p)))}}return{top:((o=u?.top)!=null?o:[]).filter(p=>!(d!=null&&d.has(p))),bottom:((m=u?.bottom)!=null?m:[]).filter(p=>!(d!=null&&d.has(p)))}})},e.getCanPin=()=>{var n;const{enableRowPinning:s,enablePinning:l}=r.options;return typeof s=="function"?s(e):(n=s??l)!=null?n:!0},e.getIsPinned=()=>{const n=[e.id],{top:s,bottom:l}=r.getState().rowPinning,a=n.some(d=>s?.includes(d)),i=n.some(d=>l?.includes(d));return a?"top":i?"bottom":!1},e.getPinnedIndex=()=>{var n,s;const l=e.getIsPinned();if(!l)return-1;const a=(n=l==="top"?r.getTopRows():r.getBottomRows())==null?void 0:n.map(i=>{let{id:d}=i;return d});return(s=a?.indexOf(e.id))!=null?s:-1}},createTable:e=>{e.setRowPinning=r=>e.options.onRowPinningChange==null?void 0:e.options.onRowPinningChange(r),e.resetRowPinning=r=>{var n,s;return e.setRowPinning(r?He():(n=(s=e.initialState)==null?void 0:s.rowPinning)!=null?n:He())},e.getIsSomeRowsPinned=r=>{var n;const s=e.getState().rowPinning;if(!r){var l,a;return!!((l=s.top)!=null&&l.length||(a=s.bottom)!=null&&a.length)}return!!((n=s[r])!=null&&n.length)},e._getPinnedRows=(r,n,s)=>{var l;return((l=e.options.keepPinnedRows)==null||l?(n??[]).map(i=>{const d=e.getRow(i,!0);return d.getIsAllParentsExpanded()?d:null}):(n??[]).map(i=>r.find(d=>d.id===i))).filter(Boolean).map(i=>({...i,position:s}))},e.getTopRows=b(()=>[e.getRowModel().rows,e.getState().rowPinning.top],(r,n)=>e._getPinnedRows(r,n,"top"),S(e.options,"debugRows")),e.getBottomRows=b(()=>[e.getRowModel().rows,e.getState().rowPinning.bottom],(r,n)=>e._getPinnedRows(r,n,"bottom"),S(e.options,"debugRows")),e.getCenterRows=b(()=>[e.getRowModel().rows,e.getState().rowPinning.top,e.getState().rowPinning.bottom],(r,n,s)=>{const l=new Set([...n??[],...s??[]]);return r.filter(a=>!l.has(a.id))},S(e.options,"debugRows"))}},Ts={getInitialState:e=>({rowSelection:{},...e}),getDefaultOptions:e=>({onRowSelectionChange:te("rowSelection",e),enableRowSelection:!0,enableMultiRowSelection:!0,enableSubRowSelection:!0}),createTable:e=>{e.setRowSelection=r=>e.options.onRowSelectionChange==null?void 0:e.options.onRowSelectionChange(r),e.resetRowSelection=r=>{var n;return e.setRowSelection(r?{}:(n=e.initialState.rowSelection)!=null?n:{})},e.toggleAllRowsSelected=r=>{e.setRowSelection(n=>{r=typeof r<"u"?r:!e.getIsAllRowsSelected();const s={...n},l=e.getPreGroupedRowModel().flatRows;return r?l.forEach(a=>{a.getCanSelect()&&(s[a.id]=!0)}):l.forEach(a=>{delete s[a.id]}),s})},e.toggleAllPageRowsSelected=r=>e.setRowSelection(n=>{const s=typeof r<"u"?r:!e.getIsAllPageRowsSelected(),l={...n};return e.getRowModel().rows.forEach(a=>{Xe(l,a.id,s,!0,e)}),l}),e.getPreSelectedRowModel=()=>e.getCoreRowModel(),e.getSelectedRowModel=b(()=>[e.getState().rowSelection,e.getCoreRowModel()],(r,n)=>Object.keys(r).length?Be(e,n):{rows:[],flatRows:[],rowsById:{}},S(e.options,"debugTable")),e.getFilteredSelectedRowModel=b(()=>[e.getState().rowSelection,e.getFilteredRowModel()],(r,n)=>Object.keys(r).length?Be(e,n):{rows:[],flatRows:[],rowsById:{}},S(e.options,"debugTable")),e.getGroupedSelectedRowModel=b(()=>[e.getState().rowSelection,e.getSortedRowModel()],(r,n)=>Object.keys(r).length?Be(e,n):{rows:[],flatRows:[],rowsById:{}},S(e.options,"debugTable")),e.getIsAllRowsSelected=()=>{const r=e.getFilteredRowModel().flatRows,{rowSelection:n}=e.getState();let s=!!(r.length&&Object.keys(n).length);return s&&r.some(l=>l.getCanSelect()&&!n[l.id])&&(s=!1),s},e.getIsAllPageRowsSelected=()=>{const r=e.getPaginationRowModel().flatRows.filter(l=>l.getCanSelect()),{rowSelection:n}=e.getState();let s=!!r.length;return s&&r.some(l=>!n[l.id])&&(s=!1),s},e.getIsSomeRowsSelected=()=>{var r;const n=Object.keys((r=e.getState().rowSelection)!=null?r:{}).length;return n>0&&n<e.getFilteredRowModel().flatRows.length},e.getIsSomePageRowsSelected=()=>{const r=e.getPaginationRowModel().flatRows;return e.getIsAllPageRowsSelected()?!1:r.filter(n=>n.getCanSelect()).some(n=>n.getIsSelected()||n.getIsSomeSelected())},e.getToggleAllRowsSelectedHandler=()=>r=>{e.toggleAllRowsSelected(r.target.checked)},e.getToggleAllPageRowsSelectedHandler=()=>r=>{e.toggleAllPageRowsSelected(r.target.checked)}},createRow:(e,r)=>{e.toggleSelected=(n,s)=>{const l=e.getIsSelected();r.setRowSelection(a=>{var i;if(n=typeof n<"u"?n:!l,e.getCanSelect()&&l===n)return a;const d={...a};return Xe(d,e.id,n,(i=s?.selectChildren)!=null?i:!0,r),d})},e.getIsSelected=()=>{const{rowSelection:n}=r.getState();return ot(e,n)},e.getIsSomeSelected=()=>{const{rowSelection:n}=r.getState();return Qe(e,n)==="some"},e.getIsAllSubRowsSelected=()=>{const{rowSelection:n}=r.getState();return Qe(e,n)==="all"},e.getCanSelect=()=>{var n;return typeof r.options.enableRowSelection=="function"?r.options.enableRowSelection(e):(n=r.options.enableRowSelection)!=null?n:!0},e.getCanSelectSubRows=()=>{var n;return typeof r.options.enableSubRowSelection=="function"?r.options.enableSubRowSelection(e):(n=r.options.enableSubRowSelection)!=null?n:!0},e.getCanMultiSelect=()=>{var n;return typeof r.options.enableMultiRowSelection=="function"?r.options.enableMultiRowSelection(e):(n=r.options.enableMultiRowSelection)!=null?n:!0},e.getToggleSelectedHandler=()=>{const n=e.getCanSelect();return s=>{var l;n&&e.toggleSelected((l=s.target)==null?void 0:l.checked)}}}},Xe=(e,r,n,s,l)=>{var a;const i=l.getRow(r,!0);n?(i.getCanMultiSelect()||Object.keys(e).forEach(d=>delete e[d]),i.getCanSelect()&&(e[r]=!0)):delete e[r],s&&(a=i.subRows)!=null&&a.length&&i.getCanSelectSubRows()&&i.subRows.forEach(d=>Xe(e,d.id,n,s,l))};function Be(e,r){const n=e.getState().rowSelection,s=[],l={},a=function(i,d){return i.map(u=>{var o;const m=ot(u,n);if(m&&(s.push(u),l[u.id]=u),(o=u.subRows)!=null&&o.length&&(u={...u,subRows:a(u.subRows)}),m)return u}).filter(Boolean)};return{rows:a(r.rows),flatRows:s,rowsById:l}}function ot(e,r){var n;return(n=r[e.id])!=null?n:!1}function Qe(e,r,n){var s;if(!((s=e.subRows)!=null&&s.length))return!1;let l=!0,a=!1;return e.subRows.forEach(i=>{if(!(a&&!l)&&(i.getCanSelect()&&(ot(i,r)?a=!0:l=!1),i.subRows&&i.subRows.length)){const d=Qe(i,r);d==="all"?a=!0:(d==="some"&&(a=!0),l=!1)}}),l?"all":a?"some":!1}const Ye=/([0-9]+)/gm,Hs=(e,r,n)=>Ut(me(e.getValue(n)).toLowerCase(),me(r.getValue(n)).toLowerCase()),Bs=(e,r,n)=>Ut(me(e.getValue(n)),me(r.getValue(n))),qs=(e,r,n)=>it(me(e.getValue(n)).toLowerCase(),me(r.getValue(n)).toLowerCase()),Us=(e,r,n)=>it(me(e.getValue(n)),me(r.getValue(n))),Ks=(e,r,n)=>{const s=e.getValue(n),l=r.getValue(n);return s>l?1:s<l?-1:0},Ws=(e,r,n)=>it(e.getValue(n),r.getValue(n));function it(e,r){return e===r?0:e>r?1:-1}function me(e){return typeof e=="number"?isNaN(e)||e===1/0||e===-1/0?"":String(e):typeof e=="string"?e:""}function Ut(e,r){const n=e.split(Ye).filter(Boolean),s=r.split(Ye).filter(Boolean);for(;n.length&&s.length;){const l=n.shift(),a=s.shift(),i=parseInt(l,10),d=parseInt(a,10),u=[i,d].sort();if(isNaN(u[0])){if(l>a)return 1;if(a>l)return-1;continue}if(isNaN(u[1]))return isNaN(i)?-1:1;if(i>d)return 1;if(d>i)return-1}return n.length-s.length}const we={alphanumeric:Hs,alphanumericCaseSensitive:Bs,text:qs,textCaseSensitive:Us,datetime:Ks,basic:Ws},Xs={getInitialState:e=>({sorting:[],...e}),getDefaultColumnDef:()=>({sortingFn:"auto",sortUndefined:1}),getDefaultOptions:e=>({onSortingChange:te("sorting",e),isMultiSortEvent:r=>r.shiftKey}),createColumn:(e,r)=>{e.getAutoSortingFn=()=>{const n=r.getFilteredRowModel().flatRows.slice(10);let s=!1;for(const l of n){const a=l?.getValue(e.id);if(Object.prototype.toString.call(a)==="[object Date]")return we.datetime;if(typeof a=="string"&&(s=!0,a.split(Ye).length>1))return we.alphanumeric}return s?we.text:we.basic},e.getAutoSortDir=()=>{const n=r.getFilteredRowModel().flatRows[0];return typeof n?.getValue(e.id)=="string"?"asc":"desc"},e.getSortingFn=()=>{var n,s;if(!e)throw new Error;return $e(e.columnDef.sortingFn)?e.columnDef.sortingFn:e.columnDef.sortingFn==="auto"?e.getAutoSortingFn():(n=(s=r.options.sortingFns)==null?void 0:s[e.columnDef.sortingFn])!=null?n:we[e.columnDef.sortingFn]},e.toggleSorting=(n,s)=>{const l=e.getNextSortingOrder(),a=typeof n<"u"&&n!==null;r.setSorting(i=>{const d=i?.find(c=>c.id===e.id),u=i?.findIndex(c=>c.id===e.id);let o=[],m,h=a?n:l==="desc";if(i!=null&&i.length&&e.getCanMultiSort()&&s?d?m="toggle":m="add":i!=null&&i.length&&u!==i.length-1?m="replace":d?m="toggle":m="replace",m==="toggle"&&(a||l||(m="remove")),m==="add"){var g;o=[...i,{id:e.id,desc:h}],o.splice(0,o.length-((g=r.options.maxMultiSortColCount)!=null?g:Number.MAX_SAFE_INTEGER))}else m==="toggle"?o=i.map(c=>c.id===e.id?{...c,desc:h}:c):m==="remove"?o=i.filter(c=>c.id!==e.id):o=[{id:e.id,desc:h}];return o})},e.getFirstSortDir=()=>{var n,s;return((n=(s=e.columnDef.sortDescFirst)!=null?s:r.options.sortDescFirst)!=null?n:e.getAutoSortDir()==="desc")?"desc":"asc"},e.getNextSortingOrder=n=>{var s,l;const a=e.getFirstSortDir(),i=e.getIsSorted();return i?i!==a&&((s=r.options.enableSortingRemoval)==null||s)&&(!(n&&(l=r.options.enableMultiRemove)!=null)||l)?!1:i==="desc"?"asc":"desc":a},e.getCanSort=()=>{var n,s;return((n=e.columnDef.enableSorting)!=null?n:!0)&&((s=r.options.enableSorting)!=null?s:!0)&&!!e.accessorFn},e.getCanMultiSort=()=>{var n,s;return(n=(s=e.columnDef.enableMultiSort)!=null?s:r.options.enableMultiSort)!=null?n:!!e.accessorFn},e.getIsSorted=()=>{var n;const s=(n=r.getState().sorting)==null?void 0:n.find(l=>l.id===e.id);return s?s.desc?"desc":"asc":!1},e.getSortIndex=()=>{var n,s;return(n=(s=r.getState().sorting)==null?void 0:s.findIndex(l=>l.id===e.id))!=null?n:-1},e.clearSorting=()=>{r.setSorting(n=>n!=null&&n.length?n.filter(s=>s.id!==e.id):[])},e.getToggleSortingHandler=()=>{const n=e.getCanSort();return s=>{n&&(s.persist==null||s.persist(),e.toggleSorting==null||e.toggleSorting(void 0,e.getCanMultiSort()?r.options.isMultiSortEvent==null?void 0:r.options.isMultiSortEvent(s):!1))}}},createTable:e=>{e.setSorting=r=>e.options.onSortingChange==null?void 0:e.options.onSortingChange(r),e.resetSorting=r=>{var n,s;e.setSorting(r?[]:(n=(s=e.initialState)==null?void 0:s.sorting)!=null?n:[])},e.getPreSortedRowModel=()=>e.getGroupedRowModel(),e.getSortedRowModel=()=>(!e._getSortedRowModel&&e.options.getSortedRowModel&&(e._getSortedRowModel=e.options.getSortedRowModel(e)),e.options.manualSorting||!e._getSortedRowModel?e.getPreSortedRowModel():e._getSortedRowModel())}},Qs=[hs,Es,Ms,Ps,vs,ys,As,Ls,Xs,Ds,zs,Os,Gs,Ts,Vs];function Ys(e){var r,n;const s=[...Qs,...(r=e._features)!=null?r:[]];let l={_features:s};const a=l._features.reduce((g,c)=>Object.assign(g,c.getDefaultOptions==null?void 0:c.getDefaultOptions(l)),{}),i=g=>l.options.mergeOptions?l.options.mergeOptions(a,g):{...a,...g};let u={...{},...(n=e.initialState)!=null?n:{}};l._features.forEach(g=>{var c;u=(c=g.getInitialState==null?void 0:g.getInitialState(u))!=null?c:u});const o=[];let m=!1;const h={_features:s,options:{...a,...e},initialState:u,_queue:g=>{o.push(g),m||(m=!0,Promise.resolve().then(()=>{for(;o.length;)o.shift()();m=!1}).catch(c=>setTimeout(()=>{throw c})))},reset:()=>{l.setState(l.initialState)},setOptions:g=>{const c=ge(g,l.options);l.options=i(c)},getState:()=>l.options.state,setState:g=>{l.options.onStateChange==null||l.options.onStateChange(g)},_getRowId:(g,c,f)=>{var p;return(p=l.options.getRowId==null?void 0:l.options.getRowId(g,c,f))!=null?p:`${f?[f.id,c].join("."):c}`},getCoreRowModel:()=>(l._getCoreRowModel||(l._getCoreRowModel=l.options.getCoreRowModel(l)),l._getCoreRowModel()),getRowModel:()=>l.getPaginationRowModel(),getRow:(g,c)=>{let f=(c?l.getPrePaginationRowModel():l.getRowModel()).rowsById[g];if(!f&&(f=l.getCoreRowModel().rowsById[g],!f))throw new Error;return f},_getDefaultColumnDef:b(()=>[l.options.defaultColumn],g=>{var c;return g=(c=g)!=null?c:{},{header:f=>{const p=f.header.column.columnDef;return p.accessorKey?p.accessorKey:p.accessorFn?p.id:null},cell:f=>{var p,v;return(p=(v=f.renderValue())==null||v.toString==null?void 0:v.toString())!=null?p:null},...l._features.reduce((f,p)=>Object.assign(f,p.getDefaultColumnDef==null?void 0:p.getDefaultColumnDef()),{}),...g}},S(e,"debugColumns")),_getColumnDefs:()=>l.options.columns,getAllColumns:b(()=>[l._getColumnDefs()],g=>{const c=function(f,p,v){return v===void 0&&(v=0),f.map(C=>{const _=xs(l,C,v,p),R=C;return _.columns=R.columns?c(R.columns,_,v+1):[],_})};return c(g)},S(e,"debugColumns")),getAllFlatColumns:b(()=>[l.getAllColumns()],g=>g.flatMap(c=>c.getFlatColumns()),S(e,"debugColumns")),_getAllFlatColumnsById:b(()=>[l.getAllFlatColumns()],g=>g.reduce((c,f)=>(c[f.id]=f,c),{}),S(e,"debugColumns")),getAllLeafColumns:b(()=>[l.getAllColumns(),l._getOrderColumnsFn()],(g,c)=>{let f=g.flatMap(p=>p.getLeafColumns());return c(f)},S(e,"debugColumns")),getColumn:g=>l._getAllFlatColumnsById()[g]};Object.assign(l,h);for(let g=0;g<l._features.length;g++){const c=l._features[g];c==null||c.createTable==null||c.createTable(l)}return l}function Zs(){return e=>b(()=>[e.options.data],r=>{const n={rows:[],flatRows:[],rowsById:{}},s=function(l,a,i){a===void 0&&(a=0);const d=[];for(let o=0;o<l.length;o++){const m=lt(e,e._getRowId(l[o],o,i),l[o],o,a,void 0,i?.id);if(n.flatRows.push(m),n.rowsById[m.id]=m,d.push(m),e.options.getSubRows){var u;m.originalSubRows=e.options.getSubRows(l[o],o),(u=m.originalSubRows)!=null&&u.length&&(m.subRows=s(m.originalSubRows,a+1,m))}}return d};return n.rows=s(r),n},S(e.options,"debugTable","getRowModel",()=>e._autoResetPageIndex()))}function Js(e,r,n){return n.options.filterFromLeafRows?er(e,r,n):tr(e,r,n)}function er(e,r,n){var s;const l=[],a={},i=(s=n.options.maxLeafRowFilterDepth)!=null?s:100,d=function(u,o){o===void 0&&(o=0);const m=[];for(let g=0;g<u.length;g++){var h;let c=u[g];const f=lt(n,c.id,c.original,c.index,c.depth,void 0,c.parentId);if(f.columnFilters=c.columnFilters,(h=c.subRows)!=null&&h.length&&o<i){if(f.subRows=d(c.subRows,o+1),c=f,r(c)&&!f.subRows.length){m.push(c),a[c.id]=c,l.push(c);continue}if(r(c)||f.subRows.length){m.push(c),a[c.id]=c,l.push(c);continue}}else c=f,r(c)&&(m.push(c),a[c.id]=c,l.push(c))}return m};return{rows:d(e),flatRows:l,rowsById:a}}function tr(e,r,n){var s;const l=[],a={},i=(s=n.options.maxLeafRowFilterDepth)!=null?s:100,d=function(u,o){o===void 0&&(o=0);const m=[];for(let g=0;g<u.length;g++){let c=u[g];if(r(c)){var h;if((h=c.subRows)!=null&&h.length&&o<i){const p=lt(n,c.id,c.original,c.index,c.depth,void 0,c.parentId);p.subRows=d(c.subRows,o+1),c=p}m.push(c),l.push(c),a[c.id]=c}}return m};return{rows:d(e),flatRows:l,rowsById:a}}function nr(){return e=>b(()=>[e.getPreFilteredRowModel(),e.getState().columnFilters,e.getState().globalFilter],(r,n,s)=>{if(!r.rows.length||!(n!=null&&n.length)&&!s){for(let g=0;g<r.flatRows.length;g++)r.flatRows[g].columnFilters={},r.flatRows[g].columnFiltersMeta={};return r}const l=[],a=[];(n??[]).forEach(g=>{var c;const f=e.getColumn(g.id);if(!f)return;const p=f.getFilterFn();p&&l.push({id:g.id,filterFn:p,resolvedValue:(c=p.resolveFilterValue==null?void 0:p.resolveFilterValue(g.value))!=null?c:g.value})});const i=(n??[]).map(g=>g.id),d=e.getGlobalFilterFn(),u=e.getAllLeafColumns().filter(g=>g.getCanGlobalFilter());s&&d&&u.length&&(i.push("__global__"),u.forEach(g=>{var c;a.push({id:g.id,filterFn:d,resolvedValue:(c=d.resolveFilterValue==null?void 0:d.resolveFilterValue(s))!=null?c:s})}));let o,m;for(let g=0;g<r.flatRows.length;g++){const c=r.flatRows[g];if(c.columnFilters={},l.length)for(let f=0;f<l.length;f++){o=l[f];const p=o.id;c.columnFilters[p]=o.filterFn(c,p,o.resolvedValue,v=>{c.columnFiltersMeta[p]=v})}if(a.length){for(let f=0;f<a.length;f++){m=a[f];const p=m.id;if(m.filterFn(c,p,m.resolvedValue,v=>{c.columnFiltersMeta[p]=v})){c.columnFilters.__global__=!0;break}}c.columnFilters.__global__!==!0&&(c.columnFilters.__global__=!1)}}const h=g=>{for(let c=0;c<i.length;c++)if(g.columnFilters[i[c]]===!1)return!1;return!0};return Js(r.rows,h,e)},S(e.options,"debugTable","getFilteredRowModel",()=>e._autoResetPageIndex()))}function sr(){return e=>b(()=>[e.getState().sorting,e.getPreSortedRowModel()],(r,n)=>{if(!n.rows.length||!(r!=null&&r.length))return n;const s=e.getState().sorting,l=[],a=s.filter(u=>{var o;return(o=e.getColumn(u.id))==null?void 0:o.getCanSort()}),i={};a.forEach(u=>{const o=e.getColumn(u.id);o&&(i[u.id]={sortUndefined:o.columnDef.sortUndefined,invertSorting:o.columnDef.invertSorting,sortingFn:o.getSortingFn()})});const d=u=>{const o=u.map(m=>({...m}));return o.sort((m,h)=>{for(let c=0;c<a.length;c+=1){var g;const f=a[c],p=i[f.id],v=p.sortUndefined,C=(g=f?.desc)!=null?g:!1;let _=0;if(v){const R=m.getValue(f.id),A=h.getValue(f.id),L=R===void 0,T=A===void 0;if(L||T){if(v==="first")return L?-1:1;if(v==="last")return L?1:-1;_=L&&T?0:L?v:-v}}if(_===0&&(_=p.sortingFn(m,h,f.id)),_!==0)return C&&(_*=-1),p.invertSorting&&(_*=-1),_}return m.index-h.index}),o.forEach(m=>{var h;l.push(m),(h=m.subRows)!=null&&h.length&&(m.subRows=d(m.subRows))}),o};return{rows:d(n.rows),flatRows:l,rowsById:n.rowsById}},S(e.options,"debugTable","getSortedRowModel",()=>e._autoResetPageIndex()))}function _t(e,r){return e?rr(e)?w.createElement(e,r):e:null}function rr(e){return lr(e)||typeof e=="function"||ar(e)}function lr(e){return typeof e=="function"&&(()=>{const r=Object.getPrototypeOf(e);return r.prototype&&r.prototype.isReactComponent})()}function ar(e){return typeof e=="object"&&typeof e.$$typeof=="symbol"&&["react.memo","react.forward_ref"].includes(e.$$typeof.description)}function or(e){const r={state:{},onStateChange:()=>{},renderFallbackValue:null,...e},[n]=w.useState(()=>({current:Ys(r)})),[s,l]=w.useState(()=>n.current.initialState);return n.current.setOptions(a=>({...a,...e,state:{...s,...e.state},onStateChange:i=>{l(i),e.onStateChange==null||e.onStateChange(i)}})),n.current}function ir({onDealClick:e,onDeleteDeal:r}){const{userData:n}=Cn(),[s,l]=w.useState([]),{deals:a,stages:i,searchTerm:d,filterOptions:u,deleteDeal:o}=Ze(),[m,h]=w.useState(null),[g,c]=w.useState(!1),[f,p]=w.useState(null),v=w.useMemo(()=>a.filter(y=>!(d&&!(y.name?.toLowerCase().includes(d.toLowerCase())||y.company?.toLowerCase().includes(d.toLowerCase())||y.contact_name?.toLowerCase().includes(d.toLowerCase()))||u.minValue&&y.value<u.minValue||u.maxValue&&y.value>u.maxValue||u.probability&&y.probability<u.probability)),[a,d,u]),C=y=>{h(m===y?null:y)},_=y=>{p(y),c(!0)},R=async()=>{f&&(await o(f),c(!1),p(null),r(f))},A=y=>i.find(N=>N.id===y),L=y=>A(y)?.color||"gray",T=y=>A(y)?.name||"Unknown",Y=y=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(y),k=w.useMemo(()=>[{accessorKey:"company",header:"Company",cell:({row:y})=>{const N=y.original;return t.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>C(N.id),children:[t.jsx("div",{className:"w-9 h-9 rounded-lg bg-gray-800/70 border border-gray-700/50 flex items-center justify-center",children:t.jsx("span",{className:"text-xs font-medium text-gray-300",children:N.company?.charAt(0)?.toUpperCase()||"#"})}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-white",children:N.company||"Unknown Company"}),t.jsx("div",{className:"text-xs text-gray-400",children:N.name})]})]})}},{accessorKey:"value",header:"Deal Value",cell:({row:y})=>{const N=parseFloat(y.original.value);return t.jsx("div",{className:"text-sm font-medium text-white",children:Y(N)})}},{accessorKey:"stage_id",header:"Stage",cell:({row:y})=>{const N=y.original.stage_id,K=T(N);L(N);const Z=A(N);let U={};return Z?.color&&(U={backgroundColor:Z.color}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"h-3 w-3 rounded-md",style:U}),t.jsx("span",{className:"text-sm text-white",children:K}),Z?.default_probability&&t.jsxs("span",{className:"text-xs text-gray-400 ml-1",children:["(",Z.default_probability,"%)"]})]})}},{accessorKey:"probability",header:"Probability",cell:({row:y})=>{const N=y.original.probability||0,K=y.original.stage_id;L(K);const Z=A(K);let U={};return Z?.color?U={backgroundColor:Z.color}:U={backgroundColor:"#10b981"},t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:t.jsx("div",{className:"h-2 rounded-full",style:{width:`${N}%`,...U}})}),t.jsxs("span",{className:"text-xs text-gray-400",children:[N,"%"]})]})}},{accessorKey:"contact_name",header:"Contact",cell:({row:y})=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Me,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-white",children:y.original.contact_name||"No contact"})]})},{accessorKey:"created_at",header:"Created",cell:({row:y})=>{const N=new Date(y.original.created_at);return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Pe,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-sm text-gray-300",children:fe(N,"MMM d, yyyy")})]})}},{id:"actions",cell:({row:y})=>{const N=y.original,K=jn(N,n),Z=Nn(N);return t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx(ee,{variant:"ghost",size:"icon",onClick:U=>{U.stopPropagation(),e(N)},className:"h-8 w-8 text-gray-400 hover:text-white",children:t.jsx(Wn,{className:"h-4 w-4"})}),K?t.jsx(ee,{variant:"ghost",size:"icon",onClick:U=>{U.stopPropagation(),_(N.id)},className:"h-8 w-8 text-gray-400 hover:text-red-500",children:t.jsx(Ae,{className:"h-4 w-4"})}):Z?t.jsx("div",{className:"h-8 w-8 flex items-center justify-center text-gray-500 cursor-not-allowed",title:"Split deals can only be deleted by administrators",children:t.jsx(Ae,{className:"h-4 w-4 opacity-30"})}):t.jsx("div",{className:"h-8 w-8 flex items-center justify-center text-gray-500 cursor-not-allowed",title:"You can only delete deals you own",children:t.jsx(Ae,{className:"h-4 w-4 opacity-30"})})]})}}],[i,n]),H=or({data:v,columns:k,state:{sorting:s},onSortingChange:l,getCoreRowModel:Zs(),getSortedRowModel:sr(),getFilteredRowModel:nr()});return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"rounded-xl border border-gray-800 overflow-hidden",children:t.jsx("div",{className:"overflow-x-auto scrollbar-none",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsx("tr",{className:"border-b border-gray-800 bg-gray-900/50",children:H.getFlatHeaders().map(y=>t.jsx("th",{className:"text-left p-4 text-xs font-medium text-gray-400 uppercase tracking-wider",children:y.isPlaceholder?null:t.jsxs("div",{className:`flex items-center gap-2 ${y.column.getCanSort()?"cursor-pointer select-none":""}`,onClick:y.column.getToggleSortingHandler(),children:[_t(y.column.columnDef.header,y.getContext()),{asc:t.jsx(Qn,{className:"h-4 w-4"}),desc:t.jsx(Xn,{className:"h-4 w-4"})}[y.column.getIsSorted()]??null]})},y.id))})}),t.jsx("tbody",{children:H.getRowModel().rows.length>0?H.getRowModel().rows.map(y=>t.jsxs(Ie.Fragment,{children:[t.jsx("tr",{className:"border-b border-gray-800/50 hover:bg-gray-800/30 cursor-pointer",onClick:()=>C(y.original.id),children:y.getVisibleCells().map(N=>t.jsx("td",{className:"p-4",children:_t(N.column.columnDef.cell,N.getContext())},N.id))}),m===y.original.id&&t.jsx("tr",{className:"bg-gray-800/20",children:t.jsx("td",{colSpan:k.length,className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-400",children:"Deal Details"}),t.jsx("p",{className:"text-sm text-white",children:y.original.description||"No description provided"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-400",children:"Contact Information"}),t.jsx("p",{className:"text-sm text-white",children:y.original.contact_name||"No contact"}),t.jsx("p",{className:"text-sm text-gray-400",children:y.original.contact_email||"No email"}),t.jsx("p",{className:"text-sm text-gray-400",children:y.original.contact_phone||"No phone"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"text-sm font-medium text-gray-400",children:"Next Steps"}),t.jsx("p",{className:"text-sm text-white",children:y.original.next_steps||"No next steps defined"})]})]})})})]},y.id)):t.jsx("tr",{children:t.jsx("td",{colSpan:k.length,className:"p-8 text-center text-gray-400",children:"No deals match your filters"})})})]})})}),t.jsx(tt,{open:g,onOpenChange:c,children:t.jsxs(nt,{children:[t.jsx(st,{children:t.jsx(rt,{children:"Delete Deal"})}),t.jsx("div",{className:"py-4",children:t.jsx("p",{className:"text-gray-300",children:"Are you sure you want to delete this deal? This action cannot be undone."})}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx(ee,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),t.jsx(ee,{variant:"destructive",onClick:R,children:"Delete"})]})]})})]})}function dr({open:e,onOpenChange:r,deal:n,onSave:s}){const[l,a]=w.useState(""),[i,d]=w.useState(!1);w.useEffect(()=>{if(e){const g=new Date;g.setDate(1),g.setMonth(g.getMonth()+1),a(fe(g,"yyyy-MM-dd"))}},[e]);const u=async()=>{try{d(!0);let g=null;if(l&&l.trim()!=="")try{const c=new Date(l);if(isNaN(c.getTime()))throw new Error("Invalid date format");g=l}catch{le.error("Please enter a valid first billing date");return}await s(g),r(!1)}catch{le.error("Failed to close deal. Please try again.")}finally{d(!1)}},o=async()=>{try{d(!0),await s(null),r(!1)}catch{le.error("Failed to close deal. Please try again.")}finally{d(!1)}},m=g=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",maximumFractionDigits:0}).format(g),h=()=>{const g=new Date;return[{label:"Next Month Start",value:(()=>{const c=new Date(g);return c.setDate(1),c.setMonth(c.getMonth()+1),fe(c,"yyyy-MM-dd")})(),description:"First day of next month"},{label:"In 2 Weeks",value:fe(es(g,2),"yyyy-MM-dd"),description:"14 days from now"},{label:"End of Month",value:fe(ts(ns(g,1),-1),"yyyy-MM-dd"),description:"Last day of this month"}]};return t.jsx(tt,{open:e,onOpenChange:r,children:t.jsxs(nt,{className:"max-w-2xl bg-gray-950 border border-gray-800",children:[t.jsx(st,{children:t.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-emerald-500/20 to-green-500/20 border border-emerald-500/30 flex items-center justify-center",children:t.jsx(Yn,{className:"w-6 h-6 text-emerald-400"})}),t.jsxs("div",{children:[t.jsxs(rt,{className:"text-2xl font-bold text-white flex items-center gap-2",children:["Deal Signed!",t.jsx(Zn,{className:"w-5 h-5 text-yellow-400"})]}),t.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Congratulations on getting this deal signed!"})]})]})}),t.jsxs("div",{className:"space-y-6",children:[t.jsx(ss,{className:"bg-gradient-to-r from-emerald-500/10 to-green-500/10 border-emerald-500/20",children:t.jsx(rs,{className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[t.jsx(Je,{className:"w-4 h-4 text-emerald-400"}),t.jsx("span",{className:"font-medium",children:n.company||n.name})]}),n.contact_name&&t.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[t.jsx(It,{className:"w-3.5 h-3.5"}),t.jsx("span",{children:n.contact_name})]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"flex items-center justify-end gap-2 text-emerald-400",children:[t.jsx(Mt,{className:"w-5 h-5"}),t.jsx("span",{className:"text-2xl font-bold",children:m(n.value)})]}),t.jsx("p",{className:"text-gray-400 text-sm",children:"Deal Value"})]})]})})}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx(Ct,{htmlFor:"firstBillingDate",className:"text-gray-300 font-medium",children:"When should billing begin for this deal?"}),t.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Set the date when invoicing should start (optional)"})]}),t.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:h().map(g=>t.jsxs("button",{type:"button",onClick:()=>a(g.value),className:`p-3 rounded-lg border text-left transition-all ${l===g.value?"bg-emerald-500/20 border-emerald-500/50 text-emerald-300":"bg-gray-800/50 border-gray-700 text-gray-300 hover:bg-gray-700/50"}`,children:[t.jsx("div",{className:"font-medium text-sm",children:g.label}),t.jsx("div",{className:"text-xs text-gray-400 mt-1",children:g.description})]},g.label))}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(Ct,{htmlFor:"customDate",className:"text-gray-400 text-sm",children:"Or choose a custom date:"}),t.jsxs("div",{className:"flex items-center border border-gray-700 rounded-lg bg-gray-800/50 focus-within:border-emerald-500/50 transition-colors",children:[t.jsx(Pe,{className:"w-5 h-5 text-gray-500 ml-3"}),t.jsx(Ft,{id:"customDate",type:"date",value:l,onChange:g=>a(g.target.value),className:"border-none bg-transparent text-white focus-visible:ring-0 focus-visible:ring-offset-0"})]})]}),l&&t.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:t.jsxs("div",{className:"text-sm text-blue-400",children:["ðŸ“… Billing will begin on ",fe(new Date(l),"EEEE, MMMM d, yyyy")]})})]})]}),t.jsxs(kt,{className:"gap-3",children:[t.jsx(ee,{variant:"outline",onClick:o,disabled:i,className:"border-gray-700 text-gray-300 hover:bg-gray-800",children:"Skip for Now"}),t.jsx(ee,{onClick:u,disabled:i,className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:i?"Closing Deal...":"Complete Deal Closure"})]})]})})}function cr({deal:e,isOpen:r,onClose:n,onSuccess:s}){const{convertDealToClient:l}=_n(),[a,i]=w.useState(!1),[d,u]=w.useState("confirm"),[o,m]=w.useState({company_name:"",contact_name:"",contact_email:"",subscription_amount:0,subscription_start_date:new Date().toISOString().split("T")[0],status:"active"});w.useEffect(()=>{e&&(m({company_name:e.company||"",contact_name:e.contact_name||e.contacts?.full_name||"",contact_email:e.contacts?.email||"",subscription_amount:e.monthly_mrr||e.value||0,subscription_start_date:new Date().toISOString().split("T")[0],status:"active"}),u("confirm"))},[e]);const h=()=>{u("confirm"),i(!1),n()},g=()=>{u("form")},c=async()=>{if(e){i(!0);try{const p={company_name:o.company_name,contact_name:o.contact_name,contact_email:o.contact_email,subscription_amount:o.subscription_amount,subscription_start_date:o.subscription_start_date,status:o.status};await l(e.id,p)&&(u("success"),s?.(),setTimeout(()=>{h()},2e3))}catch{}finally{i(!1)}}},f=p=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(p);return e?t.jsx(tt,{open:r,onOpenChange:p=>!p&&h(),children:t.jsxs(nt,{className:"bg-gray-900/95 backdrop-blur-xl border-gray-800/50 text-white rounded-xl max-w-2xl",children:[t.jsx(st,{children:t.jsxs(rt,{className:"flex items-center gap-2",children:[t.jsx(Je,{className:"w-5 h-5 text-emerald-500"}),"Convert Deal to Subscription"]})}),d==="confirm"&&t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4 space-y-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-white",children:"Deal Details"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Deal Name:"}),t.jsx("div",{className:"text-white font-medium",children:e.name})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Company:"}),t.jsx("div",{className:"text-white font-medium",children:e.company||"No company"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Contact:"}),t.jsx("div",{className:"text-white font-medium",children:e.contact_name||"No contact"})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Deal Value:"}),t.jsx("div",{className:"text-white font-medium",children:f(e.value)})]}),e.monthly_mrr&&t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-400",children:"Monthly MRR:"}),t.jsx("div",{className:"text-emerald-400 font-medium",children:f(e.monthly_mrr)})]})]})]}),t.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/20 rounded-lg p-4",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx(St,{className:"w-5 h-5 text-emerald-500 mt-0.5"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("h4",{className:"font-medium text-emerald-400",children:"Ready to Convert"}),t.jsx("p",{className:"text-sm text-gray-300",children:"This will create a new subscription client and mark the deal as converted. You'll be able to adjust the subscription details on the next step."}),e.monthly_mrr&&t.jsxs("p",{className:"text-sm text-emerald-300",children:[t.jsx("strong",{children:"Suggested MRR:"})," ",f(e.monthly_mrr)," per month"]})]})]})})]}),d==="form"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"text-sm text-gray-400",children:"Review and adjust the subscription details for the new client:"}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Company Name *"}),t.jsx("input",{type:"text",value:o.company_name,onChange:p=>m(v=>({...v,company_name:p.target.value})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Contact Name"}),t.jsx("input",{type:"text",value:o.contact_name,onChange:p=>m(v=>({...v,contact_name:p.target.value})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Contact Email"}),t.jsx("input",{type:"email",value:o.contact_email,onChange:p=>m(v=>({...v,contact_email:p.target.value})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Monthly Amount (Â£) *"}),t.jsx("input",{type:"number",min:"0",step:"0.01",value:o.subscription_amount,onChange:p=>m(v=>({...v,subscription_amount:parseFloat(p.target.value)||0})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Start Date"}),t.jsx("input",{type:"date",value:o.subscription_start_date,onChange:p=>m(v=>({...v,subscription_start_date:p.target.value})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Initial Status"}),t.jsxs("select",{value:o.status,onChange:p=>m(v=>({...v,status:p.target.value})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"paused",children:"Paused"})]})]})]}),t.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-4",children:[t.jsx("h4",{className:"font-medium text-white mb-2",children:"Conversion Summary"}),t.jsxs("div",{className:"space-y-1 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Monthly Revenue:"}),t.jsx("span",{className:"text-emerald-400 font-medium",children:f(o.subscription_amount)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-400",children:"Annual Value:"}),t.jsx("span",{className:"text-white font-medium",children:f(o.subscription_amount*12)})]})]})]})]}),d==="success"&&t.jsxs(Vt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"space-y-6 text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto",children:t.jsx(St,{className:"w-8 h-8 text-emerald-500"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Deal Converted Successfully!"}),t.jsxs("p",{className:"text-gray-400",children:[t.jsx("strong",{children:o.company_name})," has been added as a subscription client with ",f(o.subscription_amount)," monthly recurring revenue."]})]})]}),t.jsxs(kt,{children:[d==="confirm"&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{variant:"ghost",onClick:h,className:"bg-gray-800/50 text-gray-300 hover:bg-gray-800",children:"Cancel"}),t.jsx(ee,{onClick:g,className:"bg-emerald-500 hover:bg-emerald-600 text-white",children:"Continue"})]}),d==="form"&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{variant:"ghost",onClick:()=>u("confirm"),className:"bg-gray-800/50 text-gray-300 hover:bg-gray-800",disabled:a,children:"Back"}),t.jsx(ee,{onClick:c,disabled:a||!o.company_name||o.subscription_amount<=0,className:"bg-emerald-500 hover:bg-emerald-600 text-white disabled:opacity-50 disabled:cursor-not-allowed",children:a?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Converting..."]}):"Convert to Subscription"})]}),d==="success"&&t.jsx(ee,{onClick:h,className:"bg-emerald-500 hover:bg-emerald-600 text-white",children:"Close"})]})]})}):null}const ur=({isOpen:e,onClose:r,onConfirm:n,dealName:s,clientName:l})=>{const[a,i]=Ie.useState(null),[d,u]=Ie.useState(""),[o,m]=Ie.useState(!1);if(!e)return null;const h=()=>{a!==null&&(n(a,a?d:void 0),i(null),u(""),m(!1))},g=()=>{i(null),u(""),m(!1),r()};return t.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[t.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:g}),t.jsxs("div",{className:"relative w-full max-w-md bg-gray-900 rounded-lg shadow-xl border border-gray-800",children:[t.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-800",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 bg-purple-500/10 rounded-lg",children:t.jsx(Pt,{className:"w-5 h-5 text-purple-400"})}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-lg font-semibold text-white",children:"Moving to Opportunity Stage"}),t.jsxs("p",{className:"text-sm text-gray-400 mt-0.5",children:[s," ",l&&`â€¢ ${l}`]})]})]}),t.jsx("button",{onClick:g,className:"p-1 hover:bg-gray-800 rounded-lg transition-colors",children:t.jsx(et,{className:"w-5 h-5 text-gray-400"})})]}),t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("p",{className:"text-white font-medium mb-2",children:"Have you sent a proposal to this client?"}),t.jsx("p",{className:"text-sm text-gray-400",children:"The Opportunity stage now represents deals where a formal proposal has been submitted."})]}),t.jsxs("div",{className:"space-y-3",children:[t.jsx("button",{onClick:()=>{i(!0),m(!0)},className:`w-full p-4 rounded-lg border transition-all text-left group ${a===!0?"bg-purple-500/10 border-purple-500 shadow-lg shadow-purple-500/20":"bg-gray-800/50 border-gray-700 hover:border-gray-600 hover:bg-gray-800"}`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:`mt-0.5 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${a===!0?"border-purple-500 bg-purple-500":"border-gray-600 group-hover:border-gray-500"}`,children:a===!0&&t.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-white font-medium",children:"Yes, proposal sent"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"I've submitted a formal proposal to the client"})]})]})}),t.jsx("button",{onClick:()=>{i(!1),m(!1)},className:`w-full p-4 rounded-lg border transition-all text-left group ${a===!1?"bg-blue-500/10 border-blue-500 shadow-lg shadow-blue-500/20":"bg-gray-800/50 border-gray-700 hover:border-gray-600 hover:bg-gray-800"}`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:`mt-0.5 w-5 h-5 rounded-full border-2 flex items-center justify-center transition-colors ${a===!1?"border-blue-500 bg-blue-500":"border-gray-600 group-hover:border-gray-500"}`,children:a===!1&&t.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-white font-medium",children:"No, preparing proposal"}),t.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"I'm still working on the proposal"})]})]})})]}),o&&a===!0&&t.jsxs("div",{className:"mt-4 p-4 bg-purple-500/5 border border-purple-500/20 rounded-lg",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Proposal Details (Optional)"}),t.jsx("textarea",{value:d,onChange:c=>u(c.target.value),placeholder:"e.g., Sent pricing proposal via email, includes 3 package options...",className:"w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none",rows:3})]}),t.jsxs("div",{className:"mt-4 p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg flex gap-3",children:[t.jsx(Dt,{className:"w-4 h-4 text-blue-400 mt-0.5 flex-shrink-0"}),t.jsxs("div",{className:"text-sm text-gray-300",children:[t.jsx("p",{className:"font-medium mb-1",children:"Smart Task Creation"}),t.jsx("p",{className:"text-gray-400",children:a===!0?"We'll create a follow-up task for 3 days from now to check on the proposal status.":"The deal will move to Opportunity stage for proposal preparation."})]})]})]}),t.jsxs("div",{className:"flex gap-3 p-6 border-t border-gray-800",children:[t.jsx("button",{onClick:g,className:"flex-1 px-4 py-2 bg-gray-800 hover:bg-gray-700 text-white rounded-lg transition-colors",children:"Cancel"}),t.jsx("button",{onClick:h,disabled:a===null,className:"flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 disabled:cursor-not-allowed text-white rounded-lg transition-colors font-medium",children:"Confirm & Move"})]})]})]})};function gr({isOpen:e,onClose:r,children:n}){return e?t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:r,children:t.jsx("div",{className:"bg-gray-900 rounded-xl p-6 shadow-xl w-full max-w-xl border border-gray-800 max-h-[90vh] overflow-y-auto scrollbar-none",onClick:s=>s.stopPropagation(),children:n})}):null}function mr(){return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"mb-6 space-y-4",children:[t.jsx("div",{className:"h-8 bg-gray-800 rounded-lg w-48"}),t.jsx("div",{className:"h-4 bg-gray-800 rounded-lg w-80"}),t.jsxs("div",{className:"flex justify-between mt-4",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx("div",{className:"h-10 bg-gray-800 rounded-lg w-32"}),t.jsx("div",{className:"h-10 bg-gray-800 rounded-lg w-24"})]}),t.jsx("div",{className:"h-10 bg-gray-800 rounded-lg w-64"})]})]}),t.jsx("div",{className:"flex gap-4 overflow-x-auto scrollbar-none pb-6",children:[1,2,3,4,5].map(e=>t.jsxs("div",{className:"min-w-[320px] bg-gray-900/50 rounded-xl border border-gray-800/50 flex flex-col h-[600px]",children:[t.jsxs("div",{className:"p-4 border-b border-gray-800/50 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-4 h-4 rounded-md bg-gray-800"}),t.jsx("div",{className:"h-5 bg-gray-800 rounded-lg w-20"})]}),t.jsx("div",{className:"bg-gray-800/50 rounded-full w-8 h-5"})]}),t.jsx("div",{className:"p-4 space-y-3 flex-1",children:[1,2,3].map(r=>t.jsx("div",{className:"bg-gray-800/50 rounded-xl p-4 h-32"},r))})]},e))})]})}function pr(){const{deals:e,stages:r,isLoading:n,error:s,dealsByStage:l,createDeal:a,updateDeal:i,deleteDeal:d,moveDealToStage:u,forceUpdateDealStage:o,refreshDeals:m,selectedOwnerId:h,setSelectedOwnerId:g}=Ze(),[c,f]=w.useState("kanban"),[p,v]=w.useState({}),[C,_]=w.useState(!1),[R,A]=w.useState(null),[L,T]=w.useState(null),[Y,k]=w.useState(null),[H,y]=w.useState("none"),[N,K]=w.useState(0),[Z,U]=w.useState(null),[Se,pe]=w.useState(null),[Ve,ce]=w.useState(null),[xe,ne]=w.useState(null),ue=w.useRef(null),[Ce,x]=w.useState(!1),[$,J]=w.useState(!1),[X,he]=w.useState(null),[ve,je]=w.useState(!1),[Kt,dt]=w.useState(null),[Wt,ke]=w.useState(!1),[ie,Ee]=w.useState(null);w.useEffect(()=>{v(structuredClone(l))},[l]),w.useEffect(()=>{if(H==="none"){v(l);return}const F={...p};Object.keys(F).forEach(z=>{F[z]=[...F[z]].sort((D,E)=>{switch(H){case"value":return E.value-D.value;case"date":return new Date(E.created_at||0).getTime()-new Date(D.created_at||0).getTime();case"alpha":return(D.company||"").localeCompare(E.company||"");default:return 0}})}),v(F)},[H,l]),w.useEffect(()=>()=>{U(null),pe(null),ce(null),ne(null),ue.current=null,k(null)},[]);const Xt=on(dn(pn,{activationConstraint:{distance:8}})),ct=(F=null)=>{A(null),T(F),_(!0)},ut=F=>{const z=e.find(D=>D.id===F.id);A(z),x(!0),T(null)},gt=async F=>{let z=!1,D=null;R?z=await i(R.id,F):(D=await a(F),z=!!D),z&&(_(!1),x(!1),await m(),K(E=>E+1))},Ne=F=>F in p?F:Object.keys(p).find(z=>p[z].some(D=>D.id===F)),Qt=F=>{const{active:z}=F,D=String(z.id);U(D);const E=Ne(D);pe(E||null),ce(E||null),ne(E&&p[E]?p[E].findIndex(I=>I.id===D):null);let j=null;for(const I in p)if(j=p[I].find(O=>O.id===D),j)break;k(j),H!=="none"&&y("none")},Yt=F=>{const{active:z,over:D}=F;if(!D)return;const E=String(z.id),j=String(D.id),I=Ne(E);let O=Ne(j);if(!O&&r.find(G=>G.id===j)&&(O=j),!I||!O||I===O&&j===E)return;let B=p[O].findIndex(G=>G.id===j);(B===-1||j===O)&&(B=p[O].length),!(Z===E&&Se===I&&Ve===O&&xe===B)&&(ue.current=O,v(G=>{const M=[...G[I]],q=M.findIndex(P=>P.id===E);if(q===-1)return G;const[V]=M.splice(q,1),se=[...G[O]];return se.some(P=>P.id===E)||se.splice(B,0,{...V,stage_id:O}),{...G,[I]:M,[O]:se}}),ce(O),ne(B))},Zt=async F=>{const{active:z,over:D}=F,E=String(z.id);let j=D?Ne(String(D.id)):null;!j&&D&&r.find(M=>M.id===String(D.id))&&(j=String(D.id)),j||(j=ue.current);const I=Se;if(!I||!j||I===j){U(null),pe(null),ce(null),ne(null),k(null),ue.current=null;return}const O=r.find(M=>M.name.toLowerCase()==="opportunity"),B=Object.values(p).flat().find(M=>M.id===E);if(Q.log("ðŸŽ¯ Checking Opportunity stage move:",{opportunityStageFound:!!O,opportunityStageName:O?.name,opportunityStageId:O?.id,toStage:j,isMovingToOpportunity:O&&j===O.id,dealFound:!!B,dealName:B?.name||B?.company}),O&&j===O.id&&B){let M=xe;if(D){const q=String(D.id);M=p[j].findIndex(V=>V.id===q),(M===-1||q===j)&&(M=p[j].length)}else M==null&&(M=p[j].length);Ee({dealId:E,fromStage:I,toStage:j,deal:B,toIndex:M}),ke(!0),U(null),pe(null),ce(null),ne(null),k(null),ue.current=null;return}let G=xe;if(D){const M=String(D.id);G=p[j].findIndex(q=>q.id===M),(G===-1||M===j)&&(G=p[j].length)}else G==null&&(G=p[j].length);v(M=>{const q=[...M[I]],V=q.findIndex(ae=>ae.id===E);if(V===-1)return M;const[se]=q.splice(V,1),P=[...M[j]],re=P.findIndex(ae=>ae.id===E);return re!==-1&&P.splice(re,1),P.splice(G,0,{...se,stage_id:j}),{...M,[I]:q,[j]:P}});try{const M={stage_id:j,stage_changed_at:new Date().toISOString()},{error:q}=await ye.from("deals").update(M).eq("id",E).select();if(q)throw q;const V=Object.values(p).flat().find(P=>P.id===E);if(Q.log("ðŸŽ¬ Pipeline drag completed:",{dealId:E,fromStage:I,toStage:j,dealFound:!!V,dealName:V?.name||V?.company||"Unknown"}),V){const P=r.find(ae=>ae.id===I)||null,re=r.find(ae=>ae.id===j);if(Q.log("ðŸ“ Stage objects:",{fromStageName:P?.name||"null",toStageName:re?.name||"null"}),re){const ae=await vt({id:V.id,name:V.name,company:V.company,value:V.value,owner_id:V.owner_id,contact_email:V.contact_email},P,re);Q.log(`ðŸŽ¯ Activity creation result: ${ae?"SUCCESS":"FAILED"}`)}else Q.warn("âŒ Could not find target stage object")}else Q.warn("âŒ Could not find moved deal in localDealsByStage");const se=r.find(P=>P.name.toLowerCase()==="signed");if(se&&j===se.id){const P=Object.values(p).flat().find(re=>re.id===E);P&&(he(P),J(!0),Rn.celebrate(),le.success("ðŸŽ‰ Deal signed! Track payment status on the Payments page."))}setTimeout(()=>{K(P=>P+1)},100)}catch{le.error("Failed to move deal. Please try again.")}U(null),pe(null),ce(null),ne(null),k(null),ue.current=null},mt=async F=>{await d(F)},Jt=F=>{dt(F),je(!0)},en=async(F,z)=>{if(Q.log("ðŸ“„ Proposal confirmation handler called:",{sentProposal:F,hasNotes:!!z,pendingDealMove:!!ie,dealId:ie?.dealId,dealName:ie?.deal?.name||ie?.deal?.company}),ke(!1),!ie)return;const{dealId:D,fromStage:E,toStage:j,deal:I,toIndex:O}=ie;v(B=>{const G=[...B[E]],M=G.findIndex(P=>P.id===D);if(M===-1)return B;const[q]=G.splice(M,1),V=[...B[j]],se=V.findIndex(P=>P.id===D);return se!==-1&&V.splice(se,1),V.splice(O||V.length,0,{...q,stage_id:j}),{...B,[E]:G,[j]:V}});try{const B={stage_id:j,stage_changed_at:new Date().toISOString()},{error:G}=await ye.from("deals").update(B).eq("id",D).select();if(G)throw G;const M=r.find(V=>V.id===E)||null,q=r.find(V=>V.id===j);if(q){const V=r.find(P=>P.name.toLowerCase()==="opportunity");if(!(j===V?.id))await vt({id:I.id,name:I.name,company:I.company,value:I.value,owner_id:I.owner_id,contact_email:I.contact_email},M,q);else if(F){Q.log("âœ… User confirmed proposal was sent, creating activity...");const{data:{user:P}}=await ye.auth.getUser();if(Q.log("ðŸ‘¤ Current user:",P?.id,"Deal owner:",I.owner_id),P&&P.id===I.owner_id){const{data:re}=await ye.from("profiles").select("first_name, last_name").eq("id",P.id).single(),ae=re?`${re.first_name||""} ${re.last_name||""}`.trim():"",pt={user_id:P.id,type:"proposal",client_name:I.company||I.name||"Unknown Client",details:z||`Proposal sent for ${I.name||I.company||"deal"}`,amount:I.value||0,priority:"high",sales_rep:ae,date:new Date().toISOString(),status:"completed",quantity:1,deal_id:D,contact_identifier:I.contact_email||null,contact_identifier_type:I.contact_email?"email":null};Q.log("ðŸ“ Creating proposal activity:",pt);const{error:ft}=await ye.from("activities").insert(pt);ft?Q.error("âŒ Failed to create proposal activity:",ft):(Q.log("âœ… Proposal activity created successfully!"),le.success("ðŸ“„ Proposal activity logged and follow-up task created!"))}}else Q.log("ðŸ“ Deal moved to Opportunity stage for proposal preparation"),le.info("ðŸ“ Deal moved to Opportunity stage for proposal preparation")}setTimeout(()=>{K(V=>V+1)},100)}catch{le.error("Failed to move deal. Please try again.")}Ee(null)},tn=async F=>{if(X)try{const z={};if(F&&(z.first_billing_date=F),Object.keys(z).length>0&&!await i(X.id,z))throw new Error("Failed to update deal with billing information");le.success("ðŸŽ‰ Deal closed successfully!"),he(null),J(!1),await m(),K(D=>D+1)}catch(z){throw le.error("Failed to save deal closure information"),z}};return n?t.jsx(mr,{}):s?t.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[t.jsx("div",{className:"text-red-500 mb-4",children:"Error loading pipeline data"}),t.jsx("div",{className:"text-gray-400",children:s.message})]}):t.jsxs(t.Fragment,{children:[t.jsx(us,{onAddDealClick:()=>ct(),view:c,onViewChange:f,selectedOwnerId:h,onOwnerChange:g,sortBy:H,onSortChange:y}),c==="kanban"?t.jsx(t.Fragment,{children:t.jsxs(cn,{sensors:Xt,collisionDetection:gn,onDragStart:Qt,onDragOver:Yt,onDragEnd:Zt,measuring:{droppable:{strategy:un.Always}},autoScroll:{threshold:{x:.2,y:.2},interval:10},children:[t.jsx("div",{className:"grid gap-3 pb-6 overflow-x-auto scrollbar-none",style:{gridTemplateColumns:r.length<=4?`repeat(${r.length}, minmax(280px, 1fr))`:`repeat(${r.length}, minmax(280px, 350px))`,maxWidth:"100%",scrollbarWidth:"none",msOverflowStyle:"none"},children:r.map(F=>t.jsx(gs,{stage:F,deals:p[F.id]||[],onAddDealClick:()=>ct(F.id),onDealClick:ut,onConvertToSubscription:Jt},F.id))}),r.length>3&&t.jsx("div",{className:"text-center text-xs text-gray-500 mt-2 md:hidden",children:"â† Scroll horizontally to see all pipeline stages â†’"}),t.jsx(mn,{children:Y&&t.jsx(Et,{deal:Y,onClick:()=>{},isDragOverlay:!0},`overlay-${Y.id}`)})]},`dnd-context-${N}`)}):t.jsx(ir,{onDealClick:ut,onDeleteDeal:mt}),t.jsx(hn,{open:Ce,setOpen:x,deal:R,onSave:gt,onDelete:mt},R?.id),t.jsx(gr,{isOpen:C&&!Ce,onClose:()=>_(!1),children:t.jsx(os,{deal:R,onSave:gt,onCancel:()=>{_(!1),A(null),T(null)},initialStageId:L},L||"new-deal")}),X&&t.jsx(dr,{open:$,onOpenChange:J,deal:X,onSave:tn}),t.jsx(cr,{deal:Kt,isOpen:ve,onClose:()=>{je(!1),dt(null)},onSuccess:()=>{m()}}),t.jsx(ur,{isOpen:Wt,onClose:()=>{ke(!1),Ee(null)},onConfirm:en,dealName:ie?.deal?.name||ie?.deal?.company||"Deal",clientName:ie?.deal?.company})]})}function Mr(){return t.jsx(xn,{children:t.jsx("div",{className:"max-w-full w-full min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950",children:t.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-6 sm:py-8 overflow-hidden",children:t.jsx("div",{className:"relative",children:t.jsx(pr,{})})})})})}export{Et as D,Mr as P,os as a,gs as b,us as c,ir as d};
