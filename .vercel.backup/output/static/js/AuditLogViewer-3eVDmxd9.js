import{j as e}from"./vendor-state-CpjwTZNq.js";import{a as d}from"./vendor-react-DoYyFkVR.js";import{u as D}from"./useAuditLogs-CoIXGfwI.js";import{B as x}from"./badge-C6MYiXDB.js";import{H as N,A as S,Y as M,a8 as C,c as F}from"./vendor-icons-HRBKouGg.js";import{p}from"./vendor-utils-Cb9OXVhE.js";import"./index.html-Cwo_Unfk.js";import"./vendor-router-CQXjpROx.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";function f({tableName:a,recordId:t,fieldName:r,title:y="Change History"}){const{isAdmin:c,getFieldHistory:v,getAuditHistory:b,loading:w,error:H}=D(),[m,o]=d.useState([]),[g,h]=d.useState([]);d.useEffect(()=>{c&&t&&_()},[c,t,r]);const _=async()=>{try{if(r){const s=await v(a,t,r);o(s),h([])}else{const s=await b(a,t);h(s),o([])}}catch{}},E=s=>{switch(s){case"INSERT":return e.jsx(F,{className:"w-3 h-3"});case"UPDATE":return e.jsx(C,{className:"w-3 h-3"});case"DELETE":return e.jsx(M,{className:"w-3 h-3"});default:return e.jsx(N,{className:"w-3 h-3"})}},A=s=>{switch(s){case"INSERT":return"bg-green-500/20 text-green-400 border-green-500/30";case"UPDATE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"DELETE":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}},i=s=>s==null?e.jsx("span",{className:"text-gray-500 italic",children:"(empty)"}):typeof s=="object"?e.jsx("span",{className:"text-xs text-gray-400",children:JSON.stringify(s)}):e.jsx("span",{children:String(s)});if(!c)return null;const T=m.length>0||g.length>0;return e.jsxs("div",{className:"bg-gray-900/50 border border-gray-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(N,{className:"w-4 h-4 text-gray-400"}),e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:y})]}),w?e.jsx("div",{className:"text-sm text-gray-400",children:"Loading history..."}):H?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-400",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Failed to load history"})]}):T?e.jsxs("div",{className:"space-y-3",children:[m.map((s,n)=>e.jsx("div",{className:"text-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.old_value&&e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"bg-red-500/20 text-red-400 border-red-500/30 text-xs",children:s.old_value}),e.jsx("span",{className:"text-gray-500",children:"→"})]}),e.jsx(x,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:s.new_value||"(empty)"})]}),e.jsx("span",{className:"text-xs text-gray-500",children:p(new Date(s.changed_at),"MMM dd, HH:mm")})]})},`field-${n}`)),g.map((s,n)=>e.jsxs("div",{className:"border border-gray-700/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(x,{className:`text-xs ${A(s.action)}`,children:[E(s.action),e.jsx("span",{className:"ml-1",children:s.action})]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["by ",s.changed_by||"System"]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:p(new Date(s.changed_at),"MMM dd, yyyy HH:mm")})]}),s.changed_fields&&s.changed_fields.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-xs text-gray-400 font-medium",children:["Changed fields: ",s.changed_fields.join(", ")]}),s.action==="UPDATE"&&s.old_value&&s.new_value&&e.jsx("div",{className:"space-y-1",children:s.changed_fields.map(l=>{const u=s.old_value?.[l],j=s.new_value?.[l];return u!==j?e.jsxs("div",{className:"text-xs",children:[e.jsxs("span",{className:"text-gray-400",children:[l,":"]}),e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("div",{className:"text-red-400",children:i(u)}),e.jsx("span",{className:"text-gray-500",children:"→"}),e.jsx("div",{className:"text-green-400",children:i(j)})]})]},l):null})}),s.action==="INSERT"&&s.new_value&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Created with:"}),e.jsx("div",{className:"ml-2 text-green-400",children:i(s.new_value)})]}),s.action==="DELETE"&&s.old_value&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"text-gray-400",children:"Deleted data:"}),e.jsx("div",{className:"ml-2 text-red-400",children:i(s.old_value)})]})]})]},`audit-${n}`))]}):e.jsx("div",{className:"text-sm text-gray-400",children:"No history available"})]})}function k({activityId:a}){return e.jsx(f,{tableName:"activities",recordId:a,fieldName:"details",title:"Meeting Type History"})}function z({tableName:a,recordId:t,title:r="Full Change History"}){return e.jsx(f,{tableName:a,recordId:t,title:r})}export{f as AuditLogViewer,z as FullAuditHistory,k as MeetingTypeHistory};
