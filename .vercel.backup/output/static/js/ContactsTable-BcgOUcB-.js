const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/clientV3-optimized-DALCzK7c.js","js/vendor-supabase-BuXd-BBn.js","js/vendor-react-DoYyFkVR.js"])))=>i.map(i=>d[i]);
import{_ as Y}from"./vendor-supabase-BuXd-BBn.js";import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as c}from"./vendor-react-DoYyFkVR.js";import{a as ve,d as we}from"./vendor-router-CQXjpROx.js";import{B as V}from"./badge-C6MYiXDB.js";import{B as d,l as o,s as G,A as Ce,y as _e,a as q}from"./index.html-Cwo_Unfk.js";import{I as ke}from"./input-CeE6qNqI.js";import{S as Q,a as J,b as K,c as W,d as E}from"./select-BFsZCfaH.js";import{Table as Se,TableHeader as $e,TableRow as X,TableHead as u,TableBody as Ee,TableCell as g}from"./table-C4c75fDG.js";import{Dialog as Z,DialogContent as ee,DialogHeader as ae,DialogTitle as se,DialogDescription as te,DialogFooter as re}from"./dialog-BBMx1wit.js";import{C as Pe}from"./CRMNavigation-9kApijvP.js";import{U as le,S as Te,$ as De,c as Ae,aE as Ue,a7 as ne,M as Fe,P as Le,B as Re,a8 as Ie,Y as Be,aT as ie}from"./vendor-icons-HRBKouGg.js";import"./vendor-utils-Cb9OXVhE.js";import"./ui-radix-core-CdvL28QE.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";function sa(){const F=ve(),[L]=we(),[f,P]=c.useState([]),[ce,R]=c.useState(!0),[oe,I]=c.useState(!1),[H,B]=c.useState(null),[p,M]=c.useState(L.get("search")||""),[m,me]=c.useState(p),[j,de]=c.useState("all"),[b,xe]=c.useState("all"),[y,he]=c.useState("updated_at"),[N,z]=c.useState("desc"),[v,T]=c.useState(null),[w,D]=c.useState(null);c.useEffect(()=>{const a=L.get("search");a&&a!==p&&M(a)},[L]),c.useEffect(()=>{const a=setTimeout(()=>{me(p)},500);return()=>clearTimeout(a)},[p]),c.useEffect(()=>{(async()=>{try{f.length===0?R(!0):I(!0),B(null),o.log("ðŸ” Checking user authentication for contacts...");const{data:{session:s}}=await G.auth.getSession();if(!s){o.log("âš ï¸ No session found - using service key fallback for contacts...");const{supabaseAdmin:n}=await Y(async()=>{const{supabaseAdmin:l}=await import("./clientV3-optimized-DALCzK7c.js");return{supabaseAdmin:l}},__vite__mapDeps([0,1,2])),U=n;o.log("ðŸ›¡ï¸ Using service key fallback for contacts (no auth)...");let x=U.from("contacts").select("*");if(m&&m.trim()){const l=`%${m.trim()}%`;x=x.or(`first_name.ilike.${l},last_name.ilike.${l},email.ilike.${l},company.ilike.${l}`)}const{data:$,error:h}=await x.order("created_at",{ascending:!1});if(h)throw o.error("âŒ Service key contacts fallback failed:",h),h;o.log(`âœ… Service key contacts fallback successful: Retrieved ${$?.length||0} contacts`);const O=$?.map(l=>({...l,is_primary:l.is_primary||!1,company:l.company_name?{name:l.company_name}:null}))||[];P(O),R(!1),I(!1);return}o.log("ðŸŒ User authenticated - trying Edge Functions for contacts...");const r=new URLSearchParams({includeCompany:"true"});m&&r.append("search",m);try{const n=await fetch(`${Ce}/contacts?${r}`,{headers:await _e()});if(n.status===401){B("Authentication required. Please log in to view contacts.");return}if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const U=await n.json();P(U.data||[]);return}catch(n){o.warn("Contacts Edge Function failed, falling back to direct Supabase client:",n)}o.log("ðŸ›¡ï¸ Contacts fallback: Using direct Supabase client...");let i=G.from("contacts").select("*").order("created_at",{ascending:!1});if(m&&m.trim()){const n=`%${m.trim()}%`;i=i.or(`first_name.ilike.${n},last_name.ilike.${n},email.ilike.${n},company.ilike.${n}`)}const{data:t,error:S}=await i;if(S){o.error("âŒ Contacts anon fallback failed:",S),o.log("ðŸ”„ Trying contacts with service role key...");const{supabaseAdmin:n}=await Y(async()=>{const{supabaseAdmin:l}=await import("./clientV3-optimized-DALCzK7c.js");return{supabaseAdmin:l}},__vite__mapDeps([0,1,2]));let x=n.from("contacts").select("*");if(m&&m.trim()){const l=`%${m.trim()}%`;x=x.or(`first_name.ilike.${l},last_name.ilike.${l},email.ilike.${l},company.ilike.${l}`)}const{data:$,error:h}=await x.order("created_at",{ascending:!1});if(h)throw o.error("âŒ Service key contacts fallback failed:",h),h;o.log(`âœ… Service key contacts fallback successful: Retrieved ${$?.length||0} contacts`);const O=$?.map(l=>({...l,is_primary:l.is_primary||!1,company:null}))||[];P(O);return}o.log(`âœ… Contacts fallback successful: Retrieved ${t?.length||0} contacts`);const Ne=t?.map(n=>({...n,is_primary:n.is_primary||!1,company:n.company_name?{name:n.company_name}:null}))||[];P(Ne)}catch(s){B(s instanceof Error?s.message:"Failed to fetch contacts"),q.error("Failed to load contacts")}finally{R(!1),I(!1)}})()},[m]);const ue=(a,s)=>{const r=s.target;r.tagName==="A"||r.closest("button")||r.closest("a")||F(`/crm/contacts/${a}`)},A=c.useMemo(()=>{let a=f.filter(s=>{const r=s.company_name||s.company?.name,i=j==="all"||r===j,t=b==="all"||(b==="primary"?s.is_primary:!s.is_primary);return i&&t});return a.sort((s,r)=>{let i,t;switch(y){case"company_name":i=s.company?.name||"",t=r.company?.name||"";break;default:i=s[y],t=r[y]}return i==null&&(i=""),t==null&&(t=""),typeof i=="string"&&(i=i.toLowerCase()),typeof t=="string"&&(t=t.toLowerCase()),i<t?N==="asc"?-1:1:i>t?N==="asc"?1:-1:0}),a},[f,j,b,y,N]),ge=[...new Set(f.filter(a=>a.company_name||a.company?.name).map(a=>a.company_name||a.company?.name).filter(Boolean))],C=a=>{y===a?z(N==="asc"?"desc":"asc"):(he(a),z("asc"))},_=a=>y!==a?e.jsx(ie,{className:"w-4 h-4 text-gray-400"}):e.jsx(ie,{className:`w-4 h-4 ${N==="asc"?"text-blue-400":"text-blue-400 rotate-180"}`}),k=a=>{if(a.full_name&&a.full_name.trim())return a.full_name.trim();const s=a.first_name?.trim()||"",r=a.last_name?.trim()||"";return s&&r?`${s} ${r}`:s||r||(a.email?`${a.email.split("@")[0].replace(/[._-]/g," ").split(" ").map(S=>S.charAt(0).toUpperCase()+S.slice(1)).join(" ")} (from email)`:"Unnamed Contact")},pe=()=>{const a=[["Name","Email","Phone","Title","Company","Primary","Created"].join(","),...A.map(t=>[`"${k(t)}"`,`"${t.email||""}"`,`"${t.phone||""}"`,`"${t.title||""}"`,`"${t.company_name||t.company?.name||""}"`,t.is_primary?"Yes":"No",new Date(t.created_at).toLocaleDateString()].join(","))].join(`
`),s=new Blob([a],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),i=URL.createObjectURL(s);r.setAttribute("href",i),r.setAttribute("download",`contacts_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(r),r.click(),document.body.removeChild(r),q.success("Contacts exported successfully")},ye=(a,s)=>{a.stopPropagation(),T(s)},fe=(a,s)=>{a.stopPropagation(),D(s)},je=async()=>{w&&(q.success(`Contact "${k(w)}" deleted successfully`),D(null))},be=()=>{F("/contacts/new")};return ce?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"bg-gray-900/50 rounded-xl p-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-800 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-800 rounded w-1/2"}),e.jsx("div",{className:"space-y-3 mt-6",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"h-16 bg-gray-800/50 rounded-lg"},a))})]})})}):H?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"bg-red-900/20 border border-red-700 rounded-xl p-6",children:[e.jsx("h3",{className:"text-red-400 font-medium mb-2",children:"Error loading contacts"}),e.jsx("p",{className:"text-red-300 text-sm",children:H})]})}):e.jsxs("div",{children:[e.jsx(Pe,{}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(le,{className:"w-8 h-8 text-green-400"}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Contacts"})]}),e.jsxs("p",{className:"text-gray-400",children:["Manage your contact database â€¢ ",A.length," of ",f.length," contacts â€¢ Click any row to view details"]})]}),e.jsx("div",{className:"bg-gray-900/50 rounded-xl p-6 mb-6 border border-gray-800",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(ke,{placeholder:"Search contacts by name, email, or title...",value:p,onChange:a=>M(a.target.value),className:"pl-10 bg-gray-800/50 border-gray-700 text-white placeholder-gray-400"}),oe&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-600 border-t-violet-500 rounded-full animate-spin"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs(Q,{value:j,onValueChange:de,children:[e.jsx(J,{className:"w-full sm:w-[200px] bg-gray-800/50 border-gray-700 text-white",children:e.jsx(K,{placeholder:"All Companies"})}),e.jsxs(W,{className:"bg-gray-800 border-gray-700",children:[e.jsx(E,{value:"all",children:"All Companies"}),ge.map(a=>e.jsx(E,{value:a,children:a},a))]})]}),e.jsxs(Q,{value:b,onValueChange:xe,children:[e.jsx(J,{className:"w-full sm:w-[150px] bg-gray-800/50 border-gray-700 text-white",children:e.jsx(K,{placeholder:"All Contacts"})}),e.jsxs(W,{className:"bg-gray-800 border-gray-700",children:[e.jsx(E,{value:"all",children:"All Contacts"}),e.jsx(E,{value:"primary",children:"Primary Only"}),e.jsx(E,{value:"secondary",children:"Secondary Only"})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:pe,variant:"outline",size:"sm",children:[e.jsx(De,{className:"w-4 h-4 mr-2"}),"Export"]}),e.jsxs(d,{onClick:be,className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Add Contact"]})]})]})}),e.jsxs("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800 overflow-hidden",children:[e.jsxs(Se,{children:[e.jsx($e,{children:e.jsxs(X,{className:"border-gray-800 hover:bg-gray-800/50",children:[e.jsx(u,{className:"text-gray-300 cursor-pointer hover:text-white",onClick:()=>C("full_name"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Contact ",_("full_name")]})}),e.jsx(u,{className:"text-gray-300 cursor-pointer hover:text-white",onClick:()=>C("email"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Email ",_("email")]})}),e.jsx(u,{className:"text-gray-300",children:"Phone"}),e.jsx(u,{className:"text-gray-300 cursor-pointer hover:text-white",onClick:()=>C("title"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Title ",_("title")]})}),e.jsx(u,{className:"text-gray-300 cursor-pointer hover:text-white",onClick:()=>C("company_name"),children:e.jsxs("div",{className:"flex items-center gap-2",children:["Company ",_("company_name")]})}),e.jsx(u,{className:"text-gray-300 cursor-pointer hover:text-white text-center",onClick:()=>C("is_primary"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Primary ",_("is_primary")]})}),e.jsx(u,{className:"text-gray-300 text-center",children:"Actions"})]})}),e.jsx(Ee,{children:A.map(a=>e.jsxs(X,{className:"border-gray-800 hover:bg-gray-800/50 cursor-pointer",onClick:s=>ue(a.id,s),children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[a.is_primary&&e.jsx(Ue,{className:"w-4 h-4 text-yellow-400 fill-yellow-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"font-medium text-white",children:k(a)}),a.linkedin_url&&e.jsxs("a",{href:a.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 text-sm flex items-center gap-1",onClick:s=>s.stopPropagation(),children:["LinkedIn ",e.jsx(ne,{className:"w-3 h-3"})]})]})]})}),e.jsx(g,{children:a.email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4 text-gray-400"}),e.jsx("a",{href:`mailto:${a.email}`,className:"text-blue-400 hover:text-blue-300",onClick:s=>s.stopPropagation(),children:a.email})]})}),e.jsx(g,{children:a.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-400"}),e.jsx("a",{href:`tel:${a.phone}`,className:"text-gray-300 hover:text-white",onClick:s=>s.stopPropagation(),children:a.phone})]})}),e.jsx(g,{children:a.title&&e.jsx(V,{variant:"outline",className:"text-xs",children:a.title})}),e.jsx(g,{children:a.company&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-gray-300",children:a.company.name}),a.company.website&&e.jsx("a",{href:a.company.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300",onClick:s=>s.stopPropagation(),children:e.jsx(ne,{className:"w-3 h-3"})})]})}),e.jsx(g,{className:"text-center",children:a.is_primary?e.jsx(V,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Primary"}):e.jsx(V,{variant:"outline",className:"text-gray-400",children:"Secondary"})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:s=>ye(s,a),className:"text-gray-400 hover:text-blue-400 hover:bg-blue-400/10 transition-colors",title:"Edit contact",children:e.jsx(Ie,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"sm",onClick:s=>fe(s,a),className:"text-gray-400 hover:text-red-400 hover:bg-red-400/10 transition-colors",title:"Delete contact",children:e.jsx(Be,{className:"w-4 h-4"})})]})})]},a.id))})]}),A.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:"No contacts found"}),e.jsx("p",{className:"text-gray-500 text-sm",children:p||j!=="all"||b!=="all"?"Try adjusting your search criteria or filters":"Get started by adding your first contact"})]})]}),e.jsx(Z,{open:!!w,onOpenChange:()=>D(null),children:e.jsxs(ee,{className:"bg-gray-900 border-gray-800 text-white",children:[e.jsxs(ae,{children:[e.jsx(se,{className:"text-red-400",children:"Delete Contact"}),e.jsxs(te,{className:"text-gray-400",children:["Are you sure you want to delete ",e.jsxs("span",{className:"font-semibold text-white",children:['"',w?k(w):"",'"']}),"? This action cannot be undone and will remove all contact information and associated activities."]})]}),e.jsxs(re,{className:"gap-2 sm:gap-0",children:[e.jsx(d,{variant:"outline",onClick:()=>D(null),className:"bg-gray-800 border-gray-700 text-white hover:bg-gray-700",children:"Cancel"}),e.jsx(d,{onClick:je,className:"bg-red-600 hover:bg-red-700 text-white",children:"Delete Contact"})]})]})}),e.jsx(Z,{open:!!v,onOpenChange:()=>T(null),children:e.jsxs(ee,{className:"bg-gray-900 border-gray-800 text-white max-w-md",children:[e.jsxs(ae,{children:[e.jsx(se,{className:"text-blue-400",children:"Edit Contact"}),e.jsxs(te,{className:"text-gray-400",children:["Editing contact: ",e.jsxs("span",{className:"font-semibold text-white",children:['"',v?k(v):"",'"']})]})]}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"Full edit functionality coming soon. Click on the contact row to view the complete contact profile where you can edit all details."})}),e.jsxs(re,{className:"gap-2 sm:gap-0",children:[e.jsx(d,{variant:"outline",onClick:()=>T(null),className:"bg-gray-800 border-gray-700 text-white hover:bg-gray-700",children:"Close"}),e.jsx(d,{onClick:()=>{v&&(F(`/crm/contacts/${v.id}`),T(null))},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Open Profile"})]})]})})]})]})}export{sa as default};
