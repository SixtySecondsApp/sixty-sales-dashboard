import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as c}from"./vendor-react-DoYyFkVR.js";import{c as _,a as D,d as k}from"./vendor-router-CQXjpROx.js";import{B as l}from"./badge-C6MYiXDB.js";import{A as C}from"./index.html-Cwo_Unfk.js";import{a5 as o,T as b,B as h,a4 as j,a8 as S,M as E,aV as P,E as U,k as T,z as B}from"./vendor-icons-HRBKouGg.js";import"./vendor-utils-Cb9OXVhE.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";const z=()=>{const{id:n}=_(),p=D(),[f]=k(),i=f.get("returnTo"),[s,v]=c.useState(null),[y,d]=c.useState(!0),[u,r]=c.useState(null);c.useEffect(()=>{(async()=>{if(!n){r("Deal ID is required"),d(!1);return}try{d(!0),r(null);const t=await fetch(`${C}/deals/${n}?includeRelationships=true`);if(!t.ok){if(t.status===404)r("Deal not found");else throw new Error(`HTTP error! status: ${t.status}`);return}const x=await t.json();if(x.error){r(x.error);return}v(x.data)}catch(t){r(t instanceof Error?t.message:"Failed to load deal")}finally{d(!1)}})()},[n]);const m=()=>{p(i||"/crm/deals")},N=a=>`£${a?.toLocaleString()||0}`,g=a=>{try{return a?new Date(a).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}):"Unknown"}catch{return"Unknown"}},w=(a,t)=>{switch(a?.toLowerCase()){case"won":case"signed":case"closed won":return e.jsx(l,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Signed"});case"lost":case"closed lost":return e.jsx(l,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"Lost"});case"negotiation":case"negotiate":return e.jsx(l,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:"Negotiation"});case"proposal":case"quote":return e.jsx(l,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:"Proposal"});case"qualified":case"discovery":return e.jsx(l,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Qualified"});default:return e.jsx(l,{variant:"outline",children:a||"Unknown"})}};return y?e.jsx("div",{className:"min-h-screen text-gray-100",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Loading deal..."})]})})})}):u?e.jsx("div",{className:"min-h-screen text-gray-100",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("nav",{className:"breadcrumb-nav",children:e.jsxs("button",{onClick:m,className:"breadcrumb-item flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),"Back"]})}),e.jsxs("div",{className:"section-card bg-red-900/20 border-red-700 text-red-300",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Deal Error"})]}),e.jsx("p",{children:u})]})]})}):s?e.jsx("div",{className:"min-h-screen text-gray-100",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("nav",{className:"breadcrumb-nav",children:[e.jsxs("button",{onClick:m,className:"breadcrumb-item flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),i?.includes("/contacts/")?"Contact Record":"Deals"]}),e.jsx("span",{className:"breadcrumb-separator",children:"/"}),e.jsx("span",{className:"breadcrumb-current",children:s.title||`Deal ${s.id}`})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-3 border-purple-400 bg-gradient-to-r from-purple-500 to-blue-600 flex items-center justify-center text-white font-bold text-2xl shadow-lg",children:e.jsx(b,{className:"w-10 h-10"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:s.title||`Deal ${s.id}`}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-400 mb-2",children:[s.company_name&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-lg flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4"}),s.company_name]}),e.jsx("span",{className:"text-gray-600",children:"•"})]}),s.contact_name&&e.jsxs("span",{className:"text-lg flex items-center gap-1",children:[e.jsx(j,{className:"w-4 h-4"}),s.contact_name]})]}),e.jsxs("div",{className:"flex gap-2",children:[w(s.stage_name||"",s.stage_color),s.status&&e.jsx(l,{className:"bg-gray-500/20 text-gray-400 border-gray-500/30",children:s.status})]})]})]}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn-primary",children:[e.jsx(S,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit Deal"})]}),s.contact_email&&e.jsxs("button",{className:"btn-secondary",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Email Contact"})]}),e.jsxs("button",{className:"btn-secondary",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Note"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-green-400"}),"Deal Summary"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"activity-metric text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:N(s.value||0)}),e.jsx("div",{className:"text-xs text-gray-400",children:"Deal Value"})]}),e.jsxs("div",{className:"activity-metric text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-white mb-1",children:[s.default_probability||0,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Win Probability"})]}),e.jsxs("div",{className:"activity-metric text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:s.created_at?Math.ceil((new Date().getTime()-new Date(s.created_at).getTime())/(1e3*60*60*24)):0}),e.jsx("div",{className:"text-xs text-gray-400",children:"Days Active"})]})]})]}),s.description&&e.jsxs("div",{className:"section-card",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Description"}),e.jsx("p",{className:"text-gray-300 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-blue-400"}),"Timeline"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-gray-800/50",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:"Deal Created"}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.created_at?g(s.created_at):"Unknown"})]})]}),s.updated_at&&s.updated_at!==s.created_at&&e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-gray-800/50",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-white font-medium",children:"Last Updated"}),e.jsx("p",{className:"text-gray-400 text-sm",children:s.updated_at?g(s.updated_at):"Unknown"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[(s.contact_name||s.contact_email)&&e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-blue-400"}),"Primary Contact"]}),e.jsxs("div",{className:"space-y-3",children:[s.contact_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Name"}),e.jsx("p",{className:"text-white",children:s.contact_name})]}),s.contact_email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Email"}),e.jsx("p",{className:"text-white",children:s.contact_email})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{className:"btn-sm btn-secondary w-full",children:[e.jsx(j,{className:"w-4 h-4"}),e.jsx("span",{children:"View Contact Record"})]})})]})]}),s.company_name&&e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-purple-400"}),"Company"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Company Name"}),e.jsx("p",{className:"text-white",children:s.company_name})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("button",{className:"btn-sm btn-secondary w-full",children:[e.jsx(h,{className:"w-4 h-4"}),e.jsx("span",{children:"View Company Profile"})]})})]})]}),e.jsxs("div",{className:"section-card bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/20",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-purple-400"}),"Quick Stats"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Stage"}),e.jsx("span",{className:"text-white font-medium",children:s.stage_name||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Status"}),e.jsx("span",{className:"text-white font-medium",children:s.status||"Active"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Value"}),e.jsx("span",{className:"text-white font-medium",children:N(s.value||0)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Win Probability"}),e.jsxs("span",{className:"text-white font-medium",children:[s.default_probability||0,"%"]})]})]})]})]})]})]})}):e.jsx("div",{className:"min-h-screen text-gray-100",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("nav",{className:"breadcrumb-nav",children:e.jsxs("button",{onClick:m,className:"breadcrumb-item flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),"Back"]})}),e.jsx("div",{className:"section-card",children:e.jsx("p",{className:"text-gray-400",children:"Deal not found"})})]})})};export{z as default};
