import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as d,a as ne,d as Oe}from"./vendor-react-DoYyFkVR.js";import{c as oe,s as A,l as B,a as U,C as Le,B as ze}from"./index.html-Cwo_Unfk.js";import{e as Be,C as qe,d as Qe,S as He,v as We,u as Ge,a as Ke,D as Ye,M as Je,b as Xe,r as Ze,p as et,f as tt,P as st}from"./sortable.esm-Dal5CmSK.js";import{c as be,ab as rt,ac as at,a6 as it,ad as nt,x as lt,ae as de,af as ot,M as dt,ag as ct,ah as mt,ai as xt,a7 as ut,aj as ce,s as me,ak as Z,w as ae,A as gt,i as le,a4 as ye,al as je,U as ve,k as we,z as ht,am as pt,X as Ne,Y as ft,S as bt,u as he,o as yt,an as jt,j as vt,G as wt}from"./vendor-icons-HRBKouGg.js";import{p as Se}from"./vendor-utils-Cb9OXVhE.js";import{c as Nt,a as St}from"./vendor-router-CQXjpROx.js";import{motion as _t}from"./ui-animation-Dzb4KUJ1.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-charts-D4YcUEy1.js";function _e(){const[t,i]=d.useState([]),[o,m]=d.useState(!0),[g,h]=d.useState(null),[l,x]=d.useState(null),[u,r]=d.useState(!0),{userData:p}=oe();d.useEffect(()=>{(async()=>{const{data:{session:f}}=await A.auth.getSession();x(f)})();const{data:{subscription:c}}=A.auth.onAuthStateChange(async(f,n)=>{x(n)});return()=>c.unsubscribe()},[]);const j=async(s=!1)=>{if(!l?.user?.id){m(!1);return}try{!s&&u&&m(!0),h(null);const{data:c,error:f}=await A.from("roadmap_suggestions").select("*").order("created_at",{ascending:!1});if(f)throw B.error("Supabase error details:",{message:f.message,details:f.details,hint:f.hint,code:f.code}),new Error(`Database error: ${f.message}${f.details?` - ${f.details}`:""}`);if(!c||c.length===0){i([]);return}const n=[...new Set(c.map(N=>N.submitted_by).filter(Boolean))],$=[...new Set(c.map(N=>N.assigned_to).filter(Boolean))],R=[...new Set([...n,...$])];let E=[];if(R.length>0){const{data:N}=await A.from("profiles").select("id, first_name, last_name, email").in("id",R);E=N||[]}const{data:P}=await A.from("roadmap_votes").select("suggestion_id").eq("user_id",l.user.id),V=new Set((P||[]).map(N=>N.suggestion_id)),O=c.filter(N=>!N.id||typeof N.id!="string"||N.id.trim()===""?(B.warn("Filtering out suggestion with invalid ID:",N),!1):!0).map(N=>{B.log("Processing suggestion:",{id:N.id,ticket_id:N.ticket_id,title:N.title});const z=E.find(Q=>Q.id===N.submitted_by),L=E.find(Q=>Q.id===N.assigned_to);return{...N,ticket_id:N.ticket_id||c.length-c.indexOf(N),hasUserVoted:V.has(N.id),submitted_by_profile:z?{id:z.id,full_name:`${z.first_name||""} ${z.last_name||""}`.trim()||"Unknown User",email:z.email}:null,assigned_to_profile:L?{id:L.id,full_name:`${L.first_name||""} ${L.last_name||""}`.trim()||"Unknown User",email:L.email}:null}});i(O)}catch(c){h(c instanceof Error?c.message:"Failed to fetch suggestions")}finally{m(!1),r(!1)}},C=async s=>{if(!l?.user?.id)throw new Error("No authentication token");const{title:c,description:f,type:n,priority:$}=s;if(!c||!f||!n)throw new Error("Title, description, and type are required");const{data:R,error:E}=await A.from("roadmap_suggestions").insert({title:c,description:f,type:n,priority:$||"medium",submitted_by:l.user.id}).select("*").single();if(E)throw B.error("Create suggestion error:",{message:E.message,details:E.details,hint:E.hint,code:E.code}),new Error(`Failed to create suggestion: ${E.message}${E.details?` - ${E.details}`:""}`);const{data:P}=await A.from("profiles").select("id, first_name, last_name, email").eq("id",l.user.id).single(),V={...R,hasUserVoted:!1,votes_count:0,submitted_by_profile:P?{id:P.id,full_name:`${P.first_name||""} ${P.last_name||""}`.trim()||"Unknown User",email:P.email}:null};return i(O=>[V,...O]),V},v=async(s,c,f=!1)=>{if(!l?.user?.id)throw new Error("No authentication token");if(!s||s.trim()==="")throw new Error("Invalid suggestion ID provided");const{data:n}=await A.from("roadmap_suggestions").select("submitted_by").eq("id",s).single();if(!n)throw new Error("Suggestion not found");const $=p?.is_admin||!1;if(!$&&n.submitted_by!==l.user.id)throw new Error("Unauthorized to update this suggestion");let R={};if($)R={...c},(R.assigned_to===""||R.assigned_to===null)&&delete R.assigned_to,c.status==="completed"&&!c.completion_date&&(R.completion_date=new Date().toISOString());else{const{title:V,description:O,type:N,priority:z}=c;R={title:V,description:O,type:N,priority:z}}const{data:E,error:P}=await A.from("roadmap_suggestions").update(R).eq("id",s).select("*").single();if(P)throw new Error(P.message);return f||await j(),E},S=async s=>{if(!l?.user?.id)throw new Error("No authentication token");if(!(p?.is_admin||!1))throw new Error("Only admins can delete suggestions");const{error:f}=await A.from("roadmap_suggestions").delete().eq("id",s);if(f)throw new Error(f.message);i(n=>n.filter($=>$.id!==s))},M=async s=>{if(!l?.user?.id)throw new Error("No authentication token");i(c=>c.map(f=>f.id===s?{...f,votes_count:f.votes_count+1,hasUserVoted:!0}:f));try{const{error:c}=await A.from("roadmap_votes").insert({suggestion_id:s,user_id:l.user.id});if(c)throw i(f=>f.map(n=>n.id===s?{...n,votes_count:n.votes_count-1,hasUserVoted:!1}:n)),new Error(c.message)}catch(c){throw c}},a=async s=>{if(!l?.user?.id)throw new Error("No authentication token");i(c=>c.map(f=>f.id===s?{...f,votes_count:f.votes_count-1,hasUserVoted:!1}:f));try{const{error:c}=await A.from("roadmap_votes").delete().eq("suggestion_id",s).eq("user_id",l.user.id);if(c)throw i(f=>f.map(n=>n.id===s?{...n,votes_count:n.votes_count+1,hasUserVoted:!0}:n)),new Error(c.message)}catch(c){throw c}};return d.useEffect(()=>{j()},[l?.user?.id]),d.useEffect(()=>{l?.user?.id},[l?.user?.id]),{suggestions:t,loading:o,error:g,createSuggestion:C,updateSuggestion:v,deleteSuggestion:S,voteForSuggestion:M,removeVote:a,refetch:j}}const pe=[{id:"submitted",name:"Submitted",color:"#6b7280"},{id:"under_review",name:"Planned",color:"#3b82f6"},{id:"in_progress",name:"In Progress",color:"#f59e0b"},{id:"testing",name:"Testing",color:"#8b5cf6"},{id:"completed",name:"Completed",color:"#10b981"}],Ce=d.createContext(void 0);function Ct({children:t}){const{suggestions:i,loading:o,error:m,createSuggestion:g,updateSuggestion:h,deleteSuggestion:l,voteForSuggestion:x,removeVote:u,refetch:r}=_e(),p=d.useMemo(()=>{const v={};return pe.forEach(S=>{v[S.id]=[]}),i.forEach(S=>{v[S.status]&&v[S.status].push(S)}),v},[i]),C={suggestions:i,statuses:pe,isLoading:o,error:m,suggestionsByStatus:p,createSuggestion:g,updateSuggestion:h,deleteSuggestion:l,moveSuggestionToStatus:async(v,S)=>{await h(v,{status:S},!0)},voteForSuggestion:x,removeVote:u,refreshSuggestions:r};return e.jsx(Ce.Provider,{value:C,children:t})}function ke(){const t=d.useContext(Ce);if(t===void 0)throw new Error("useRoadmapContext must be used within a RoadmapProvider");return t}function kt({onAddSuggestionClick:t,view:i,onViewChange:o,sortBy:m,onSortChange:g}){return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Product Roadmap"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Track feature requests and development progress"})]}),e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Suggestion"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("kanban"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md transition-colors ${i==="kanban"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[e.jsx(rt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Kanban"})]}),e.jsxs("button",{onClick:()=>o("table"),className:`flex items-center gap-2 px-3 py-1.5 rounded-md transition-colors ${i==="table"?"bg-gray-700 text-white":"text-gray-400 hover:text-white"}`,children:[e.jsx(at,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Table"})]})]}),i==="kanban"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Sort by:"}),e.jsxs("select",{value:m,onChange:h=>g(h.target.value),className:"bg-gray-800 text-white rounded-lg px-3 py-1.5 text-sm border border-gray-700 focus:outline-none focus:border-gray-600",children:[e.jsx("option",{value:"none",children:"Default"}),e.jsx("option",{value:"votes",children:"Most Votes"}),e.jsx("option",{value:"date",children:"Newest First"}),e.jsx("option",{value:"priority",children:"Priority"})]})]})]})]})}function $t(t){const{ticketId:i,title:o,description:m,ticketUrl:g,type:h,priority:l,status:x}=t,u=()=>h==="bug"?"ðŸ›":h==="feature"?"âœ¨":h==="improvement"?"ðŸš€":l==="critical"?"ðŸš¨":l==="high"?"âš¡":"ðŸ“‹",r=()=>{switch(l){case"critical":return"ðŸ”´ Critical";case"high":return"ðŸŸ¡ High";case"medium":return"ðŸŸ¢ Medium";case"low":return"ðŸ”µ Low";default:return""}},p=u(),j=r();let C=`${p} *Roadmap Ticket #${i}*
`;if(C+=`*${o}*

`,m){const v=m.length>200?m.substring(0,200)+"...":m;C+=`${v}

`}return j&&(C+=`Priority: ${j}
`),h&&(C+=`Type: ${h.charAt(0).toUpperCase()+h.slice(1)}
`),x&&(C+=`Status: ${x.charAt(0).toUpperCase()+x.slice(1)}
`),C+=`
ðŸ”— <${g}|View Full Ticket>`,C}async function It(t){const i=$t(t);await navigator.clipboard.writeText(i)}function $e({suggestion:t,className:i="",size:o="medium"}){const[m,g]=d.useState(!1),[h,l]=d.useState(!1),[x,u]=d.useState(!1),r=`${window.location.origin}/roadmap/ticket/${t.ticket_id}`,p=`Roadmap Ticket #${t.ticket_id}: ${t.title}`,j=t.description,v={small:{button:"p-1",icon:"w-3 h-3",menu:"w-48",text:"text-xs"},medium:{button:"px-2 py-1",icon:"w-4 h-4",menu:"w-56",text:"text-sm"},large:{button:"px-3 py-2",icon:"w-5 h-5",menu:"w-64",text:"text-base"}}[o],S=async()=>{try{await navigator.clipboard.writeText(r),l(!0),U.success("Ticket URL copied to clipboard"),setTimeout(()=>l(!1),2e3),g(!1)}catch{U.error("Failed to copy to clipboard")}},M=()=>{const n=encodeURIComponent(p),$=encodeURIComponent(`Hi there,

I wanted to share this roadmap ticket with you:

${p}

Description: ${j}

View ticket: ${r}

Best regards`),R=`mailto:?subject=${n}&body=${$}`;window.open(R,"_blank"),g(!1),U.success("Email client opened")},a=async()=>{try{await It({ticketId:t.ticket_id,title:t.title,description:t.description,ticketUrl:r,type:t.type,priority:t.priority,status:t.status}),U.success("Slack message copied!",{duration:4e3,description:"Formatted message with priority and type info is ready to paste in Slack."})}catch{try{await navigator.clipboard.writeText(`${p}
${r}`),U.success("Ticket info copied for Slack sharing")}catch{U.error("Failed to copy to clipboard")}}g(!1)},s=()=>{const n=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(r)}`,$=window.open("","_blank","width=300,height=350,scrollbars=no,resizable=no");$&&($.document.write(`
        <html>
          <head><title>QR Code - Ticket #${t.ticket_id}</title></head>
          <body style="margin:20px;text-align:center;font-family:system-ui">
            <h3>Ticket #${t.ticket_id}</h3>
            <img src="${n}" alt="QR Code" style="border:1px solid #ccc;padding:10px;background:white;border-radius:8px"/>
            <p style="margin-top:15px;font-size:12px;color:#666;word-break:break-all;">${r}</p>
            <p style="font-size:14px;color:#333;">Scan to view ticket</p>
          </body>
        </html>
      `),$.document.close()),g(!1),U.success("QR code opened in new window")},c=async()=>{const n=`## ${p}

${j}

**Type:** ${t.type} | **Priority:** ${t.priority} | **Status:** ${t.status}

[View Ticket](${r})`;try{await navigator.clipboard.writeText(n),U.success("Markdown copied to clipboard")}catch{U.error("Failed to copy markdown")}g(!1)},f=async()=>{try{navigator.share?(await navigator.share({title:p,text:j,url:r}),g(!1)):S()}catch(n){n.name!=="AbortError"&&U.error("Sharing failed")}};return e.jsxs("div",{className:`relative ${i}`,children:[e.jsxs("button",{onClick:()=>g(!m),className:`
          flex items-center gap-1 ${v.button} rounded-md
          text-gray-400 hover:text-gray-300 
          bg-gray-800/50 hover:bg-gray-700/50 
          border border-gray-700/50 hover:border-gray-600/50
          transition-all duration-200
          ${m?"bg-gray-700/50 border-gray-600/50":""}
        `,title:"Share this ticket",children:[h?e.jsx(it,{className:`${v.icon} text-green-400`}):e.jsx(nt,{className:v.icon}),o!=="small"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:v.text,children:"Share"}),e.jsx(lt,{className:`w-3 h-3 transition-transform ${m?"rotate-180":""}`})]})]}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>g(!1)}),e.jsxs("div",{className:`
            absolute right-0 mt-1 ${v.menu} z-20
            bg-gray-800 border border-gray-700 rounded-lg shadow-xl
            py-1 
          `,children:[e.jsxs("div",{className:"px-3 py-2 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-mono",children:["#",t.ticket_id]})]}),e.jsx("div",{className:"text-xs text-gray-300 truncate mt-1",title:t.title,children:t.title})]}),e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:S,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:[e.jsx(ot,{className:"w-4 h-4 text-blue-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{children:"Copy Link"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Copy URL to clipboard"})]})]}),e.jsxs("button",{onClick:M,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:[e.jsx(dt,{className:"w-4 h-4 text-green-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{children:"Email"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Share via email"})]})]}),e.jsxs("button",{onClick:a,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:[e.jsx(ct,{className:"w-4 h-4 text-purple-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{children:"Slack"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Copy formatted message"})]})]}),e.jsx("div",{className:"border-t border-gray-700 my-1"}),e.jsxs("button",{onClick:s,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:[e.jsx(mt,{className:"w-4 h-4 text-orange-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{children:"QR Code"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Generate QR for mobile"})]})]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:[e.jsx(xt,{className:"w-4 h-4 text-cyan-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{children:"Markdown"}),e.jsx("div",{className:"text-xs text-gray-400",children:"Copy as markdown"})]})]}),navigator.share&&e.jsxs("button",{onClick:f,className:"w-full flex items-center gap-3 px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700/50 transition-colors",children:[e.jsx(ut,{className:"w-4 h-4 text-emerald-400"}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{children:"More Options"}),e.jsx("div",{className:"text-xs text-gray-400",children:"System share menu"})]})]})]}),e.jsx("div",{className:"px-3 py-2 border-t border-gray-700",children:e.jsx("div",{className:"text-xs text-gray-400 break-all",children:r})})]})]})]})}function Ie({suggestion:t,onClick:i,isDragOverlay:o=!1}){const m=String(t.id),{attributes:g,listeners:h,setNodeRef:l,transform:x,transition:u,isDragging:r}=Be({id:m,data:{...t,id:m},disabled:o}),p={transform:qe.Transform.toString(x),transition:u,opacity:r?"0.3":"1",...o?{zIndex:9999}:{}},j=d.useMemo(()=>{switch(t.type){case"bug":return{icon:ae,color:"text-red-400",bgColor:"bg-red-500/20"};case"feature":return{icon:Z,color:"text-blue-400",bgColor:"bg-blue-500/20"};case"improvement":return{icon:me,color:"text-emerald-400",bgColor:"bg-emerald-500/20"};default:return{icon:ce,color:"text-gray-400",bgColor:"bg-gray-500/20"}}},[t.type]),C=d.useMemo(()=>{switch(t.priority){case"critical":return{color:"text-red-400",bgColor:"bg-red-500/20",borderColor:"border-red-500/30"};case"high":return{color:"text-orange-400",bgColor:"bg-orange-500/20",borderColor:"border-orange-500/30"};case"medium":return{color:"text-yellow-400",bgColor:"bg-yellow-500/20",borderColor:"border-yellow-500/30"};default:return{color:"text-gray-400",bgColor:"bg-gray-500/20",borderColor:"border-gray-500/30"}}},[t.priority]),v=d.useMemo(()=>{const a=new Date(t.submitted_at),c=new Date().getTime()-a.getTime();return Math.floor(c/(1e3*60*60*24))},[t.submitted_at]),S=d.useMemo(()=>v>30?{status:"danger",text:`${v}d ago`,icon:gt}:v>14?{status:"warning",text:`${v}d ago`,icon:le}:{status:"normal",text:v===0?"Today":`${v}d ago`,icon:le},[v]),M=j.icon;return e.jsxs("div",{ref:l,...g,...h,onClick:()=>r?null:i(t),className:`
        bg-gray-800/50 rounded-xl p-4 hover:bg-gray-800/70
        transition-all border border-gray-800/80
        hover:border-gray-700 shadow-sm hover:shadow-md group
        ${r||o?"shadow-lg cursor-grabbing z-[9999]":"cursor-grab"}
        relative overflow-hidden
      `,style:p,children:[!r&&!o&&e.jsx("div",{className:`absolute inset-0 bg-gradient-to-r from-transparent
          via-white/[0.02] to-transparent translate-x-[-200%]
          group-hover:translate-x-[200%] transition-transform duration-1000 pointer-events-none
          z-[1]`}),e.jsxs("div",{className:"relative z-[2]",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(de,{className:"w-3 h-3"}),e.jsxs("span",{className:"font-mono",children:["#",t.ticket_id||"N/A"]})]}),t.ticket_id&&e.jsx("div",{onClick:a=>a.stopPropagation(),children:e.jsx($e,{suggestion:t,size:"small",className:"opacity-0 group-hover:opacity-100 transition-opacity"})})]}),e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:`w-4 h-4 ${j.color} flex-shrink-0`}),e.jsx("h3",{className:"font-medium text-white text-base truncate",title:t.title,children:t.title})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(ye,{className:"w-3.5 h-3.5 flex-shrink-0"}),e.jsx("span",{className:"truncate",title:t.submitted_by_profile?.full_name,children:t.submitted_by_profile?.full_name||"Unknown"})]})]}),e.jsxs("div",{className:`flex items-center gap-1 ml-3 px-2 py-1 rounded-lg ${t.hasUserVoted?"bg-emerald-500/20 text-emerald-400":"bg-gray-700/50 text-gray-300"}`,children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold text-sm",children:t.votes_count||0})]})]}),e.jsx("p",{className:"text-sm text-gray-400 mb-3 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 mb-3",children:[e.jsx("span",{className:`
            inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
            ${C.bgColor} ${C.color} border ${C.borderColor}
          `,children:t.priority}),e.jsx("span",{className:`
            inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
            ${j.bgColor} ${j.color} border ${j.color.replace("text-","border-")}/30
          `,children:t.type}),t.estimated_effort&&e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium
              bg-purple-500/20 text-purple-400 border border-purple-500/30`,children:t.estimated_effort}),t.assigned_to_profile&&e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs font-medium
              bg-blue-500/20 text-blue-400 border border-blue-500/30`,children:[e.jsx(ve,{className:"w-3 h-3"}),t.assigned_to_profile.full_name?.split(" ")[0]||"Assigned"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:`
            flex items-center gap-1.5 text-xs
            ${S.status==="danger"?"text-red-400":S.status==="warning"?"text-yellow-400":"text-gray-400"}
          `,children:[S.icon&&e.jsx(S.icon,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:S.text})]}),t.target_version?e.jsxs("span",{className:"text-xs font-medium text-gray-300",children:["v",t.target_version]}):t.completion_date?e.jsxs("span",{className:"text-xs text-emerald-400",children:[e.jsx(we,{className:"w-3 h-3 inline mr-1"}),Se(new Date(t.completion_date),"MMM d")]}):null]})]})]})}function Tt({status:t,suggestions:i,onSuggestionClick:o,onAddSuggestionClick:m}){const{setNodeRef:g,isOver:h}=Qe({id:t.id,data:{type:"column",statusId:t.id}}),l=i.length>0?i.map(r=>String(r.id)):[],x=d.useMemo(()=>i.reduce((r,p)=>r+(p.votes_count||0),0),[i]),u=d.useMemo(()=>{const r={critical:0,high:0,medium:0,low:0};return i.forEach(p=>{r[p.priority]!==void 0&&r[p.priority]++}),r},[i]);return e.jsxs("div",{"data-testid":`roadmap-column-${t.id}`,className:`flex-1 min-w-[280px] max-w-[400px] bg-gray-900/50 backdrop-blur-xl
        rounded-xl border border-gray-800/50 flex flex-col max-h-[calc(100vh-250px)]`,style:{isolation:"isolate",transition:"border-color 150ms ease"},children:[e.jsxs("div",{className:"p-4 border-b border-gray-800/50 sticky top-0 z-10 bg-gray-900/80 backdrop-blur-xl",style:{borderBottomColor:h?`${t.color}80`:void 0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-md",style:{backgroundColor:t.color}}),e.jsx("h3",{className:"font-semibold text-white text-lg",children:t.name})]}),e.jsx("div",{className:"bg-gray-800/50 px-2.5 py-0.5 rounded-full text-xs text-gray-400",children:i.length})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(ht,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"font-medium text-emerald-400",children:x}),e.jsx("span",{className:"text-gray-500",children:"votes"}),u.critical>0&&e.jsxs("span",{className:"ml-auto text-xs bg-red-500/20 text-red-400 px-1.5 py-0.5 rounded",children:[u.critical," critical"]})]})]}),e.jsxs("div",{ref:g,"data-droppable-id":t.id,"data-column-status":t.id,className:`
          flex-1 overflow-y-auto p-4 space-y-3
          ${h?"bg-gray-800/30 ring-2 ring-inset":""}
          scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-transparent
          transition-all duration-150
        `,style:{position:"relative",zIndex:1,minHeight:"250px",...h?{"--ring-color":t.color,borderColor:t.color,backgroundColor:`${t.color}10`}:{}},children:[e.jsx(He,{items:i.length===0?[`${t.id}-placeholder`]:l,strategy:We,children:i.length===0?e.jsx("div",{className:`
                text-gray-500 text-center text-sm flex flex-col items-center justify-center 
                border-2 border-dashed rounded-lg transition-all duration-200
                ${h?"border-opacity-100 bg-gray-800/50 text-white":"border-gray-800/50 hover:border-gray-700/70"}
              `,style:{minHeight:"200px",borderColor:h?t.color:void 0},children:e.jsx("div",{className:"p-8",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg font-medium mb-2",children:"Drop here"}),e.jsxs("div",{className:"text-sm opacity-70",children:["Release to add to ",t.name]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-base mb-2",children:"No suggestions yet"}),e.jsx("div",{className:"text-sm opacity-70",children:"Drag suggestions here or click below to add"})]})})}):i.map((r,p)=>e.jsx(Ie,{suggestion:r,index:p,onClick:o},r.id))}),e.jsxs("button",{onClick:()=>m(t.id),className:`w-full h-12 flex items-center justify-center gap-2
            bg-transparent border border-dashed border-gray-700 rounded-lg
            text-gray-400 hover:text-gray-300 hover:bg-gray-800/30
            transition-colors mt-3`,children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Add suggestion"})]})]}),i.length>0&&e.jsx("div",{className:"p-3 border-t border-gray-800/50 bg-gray-900/70",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[e.jsxs("div",{className:"flex gap-3",children:[u.high>0&&e.jsxs("span",{children:["High: ",u.high]}),u.medium>0&&e.jsxs("span",{children:["Medium: ",u.medium]})]}),e.jsxs("span",{children:["Total: ",i.length]})]})})]})}function Et({suggestion:t,onSave:i,onCancel:o,onDelete:m,initialStatusId:g}){const{userData:h}=oe(),l=h?.is_admin||!1,x=t&&t.id&&t.id.trim()!==""?t:null,[u,r]=d.useState({title:"",description:"",type:"feature",priority:"medium",status:"submitted",estimated_effort:void 0,target_version:"",admin_notes:"",assigned_to:""}),[p,j]=d.useState(!1);d.useEffect(()=>{x?r({title:x.title||"",description:x.description||"",type:x.type||"feature",priority:x.priority||"medium",status:x.status||"submitted",estimated_effort:x.estimated_effort,target_version:x.target_version||"",admin_notes:x.admin_notes||"",assigned_to:x.assigned_to||""}):g&&r(a=>({...a,status:g}))},[x,g]);const C=async a=>{if(a.preventDefault(),!(!u.title.trim()||!u.description.trim()))try{j(!0);const s={title:u.title,description:u.description,type:u.type,priority:u.priority};l?(Object.assign(s,u),(!s.assigned_to||s.assigned_to.trim()==="")&&delete s.assigned_to):!x&&g&&(s.status=g),await i(s)}catch{}finally{j(!1)}},v=async()=>{if(!(!x||!m)&&window.confirm("Are you sure you want to delete this suggestion?"))try{j(!0),await m(x.id)}catch{}finally{j(!1)}},S=a=>{switch(a){case"feature":return e.jsx(Z,{className:"w-4 h-4"});case"bug":return e.jsx(ae,{className:"w-4 h-4"});case"improvement":return e.jsx(me,{className:"w-4 h-4"});case"other":return e.jsx(ce,{className:"w-4 h-4"});default:return e.jsx(Z,{className:"w-4 h-4"})}},M=a=>{switch(a){case"critical":return"text-red-500 bg-red-500/10 border-red-500/20";case"high":return"text-orange-500 bg-orange-500/10 border-orange-500/20";case"medium":return"text-yellow-500 bg-yellow-500/10 border-yellow-500/20";case"low":return"text-green-500 bg-green-500/10 border-green-500/20";default:return"text-gray-500 bg-gray-500/10 border-gray-500/20"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:x?"Edit Suggestion":"Submit a Feature Request or Bug Report"}),x?.ticket_id&&e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("span",{className:"font-mono",children:["Ticket #",x.ticket_id]})]}),e.jsx($e,{suggestion:x,size:"medium"})]})]}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Title ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("input",{type:"text",required:!0,value:u.title,onChange:a=>r(s=>({...s,title:a.target.value})),placeholder:"Brief, descriptive title for your suggestion",className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Type ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["feature","bug","improvement","other"].map(a=>e.jsxs("button",{type:"button",onClick:()=>r(s=>({...s,type:a})),className:`p-3 rounded-lg border transition-all flex items-center gap-2 ${u.type===a?"border-emerald-500 bg-emerald-500/10 text-emerald-400":"border-gray-700/50 bg-gray-800/50 text-gray-400 hover:border-gray-600 hover:text-gray-300"}`,children:[S(a),e.jsx("span",{className:"text-sm font-medium capitalize",children:a})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Priority"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["low","medium","high","critical"].map(a=>e.jsx("button",{type:"button",onClick:()=>r(s=>({...s,priority:a})),className:`p-2 rounded-lg border transition-all text-sm font-medium capitalize ${u.priority===a?M(a):"border-gray-700/50 bg-gray-800/50 text-gray-400 hover:border-gray-600 hover:text-gray-300"}`,children:a},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Description ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx("textarea",{required:!0,value:u.description,onChange:a=>r(s=>({...s,description:a.target.value})),placeholder:"Provide detailed information about your suggestion. For bugs, include steps to reproduce. For features, explain the use case and expected behavior.",rows:6,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-400 mb-2",children:"Guidelines for Good Suggestions"}),e.jsxs("ul",{className:"text-xs text-blue-300 space-y-1",children:[e.jsx("li",{children:"â€¢ Be specific and detailed in your description"}),e.jsx("li",{children:"â€¢ For bugs: Include steps to reproduce and expected vs actual behavior"}),e.jsx("li",{children:"â€¢ For features: Explain the business value and use cases"}),e.jsx("li",{children:"â€¢ Search existing suggestions to avoid duplicates"}),e.jsx("li",{children:"â€¢ Use descriptive titles that summarize the request"})]})]}),l&&x&&e.jsxs("div",{className:"space-y-4 border-t border-gray-800 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-300",children:"Admin Controls"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Status"}),e.jsxs("select",{value:u.status,onChange:a=>r(s=>({...s,status:a.target.value})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"under_review",children:"Planned"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Estimated Effort"}),e.jsxs("select",{value:u.estimated_effort||"",onChange:a=>r(s=>({...s,estimated_effort:a.target.value||void 0})),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Not set"}),e.jsx("option",{value:"small",children:"Small"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"large",children:"Large"}),e.jsx("option",{value:"extra_large",children:"Extra Large"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Target Version"}),e.jsx("input",{type:"text",value:u.target_version,onChange:a=>r(s=>({...s,target_version:a.target.value})),placeholder:"e.g., 2.0.0",className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Admin Notes"}),e.jsx("textarea",{value:u.admin_notes,onChange:a=>r(s=>({...s,admin_notes:a.target.value})),placeholder:"Internal notes about this suggestion...",rows:3,className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-emerald-500 focus:border-transparent resize-none"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsx("div",{children:x&&m&&l&&e.jsxs("button",{type:"button",onClick:v,disabled:p,className:"flex items-center gap-2 px-4 py-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors",children:[e.jsx(ft,{className:"w-4 h-4"}),"Delete"]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{type:"button",onClick:o,disabled:p,className:"px-4 py-2 text-gray-400 hover:text-white transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p||!u.title.trim()||!u.description.trim(),className:"px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?"Saving...":x?"Update Suggestion":"Submit Suggestion"})]})]})]})]})}function Rt({onSuggestionClick:t,onDeleteSuggestion:i}){const{suggestions:o,voteForSuggestion:m,removeVote:g}=ke(),h=r=>{switch(r){case"bug":return e.jsx(ae,{className:"w-4 h-4 text-red-400"});case"feature":return e.jsx(Z,{className:"w-4 h-4 text-blue-400"});case"improvement":return e.jsx(me,{className:"w-4 h-4 text-emerald-400"});default:return e.jsx(ce,{className:"w-4 h-4 text-gray-400"})}},l=r=>{switch(r){case"critical":return"text-red-400";case"high":return"text-orange-400";case"medium":return"text-yellow-400";default:return"text-gray-400"}},x=r=>{switch(r){case"submitted":return"bg-gray-500/20 text-gray-400";case"under_review":return"bg-blue-500/20 text-blue-400";case"in_progress":return"bg-amber-500/20 text-amber-400";case"testing":return"bg-purple-500/20 text-purple-400";case"completed":return"bg-emerald-500/20 text-emerald-400";case"rejected":return"bg-red-500/20 text-red-400";default:return"bg-gray-500/20 text-gray-400"}},u=async(r,p)=>{r.stopPropagation();try{p.hasUserVoted?await g(p.id):await m(p.id)}catch{}};return e.jsx("div",{className:"bg-gray-900/50 rounded-xl border border-gray-800/50 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-800/50 bg-gray-900/70",children:[e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Type"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Title"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Status"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Priority"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Votes"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Submitted By"}),e.jsx("th",{className:"text-left p-4 text-sm font-medium text-gray-400",children:"Date"})]})}),e.jsx("tbody",{children:o.map(r=>e.jsxs("tr",{onClick:()=>{r.id&&r.id.trim()!==""&&t(r)},className:"border-b border-gray-800/50 hover:bg-gray-800/30 cursor-pointer transition-colors",children:[e.jsx("td",{className:"p-4",children:h(r.type)}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:r.title}),e.jsx("div",{className:"text-sm text-gray-400 line-clamp-1",children:r.description})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${x(r.status)}`,children:r.status.replace("_"," ")})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:`font-medium ${l(r.priority)}`,children:r.priority})}),e.jsx("td",{className:"p-4",children:e.jsxs("button",{onClick:p=>u(p,r),className:`flex items-center gap-1 px-2 py-1 rounded-lg transition-colors ${r.hasUserVoted?"bg-emerald-500/20 text-emerald-400":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"font-semibold text-sm",children:r.votes_count||0})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(ye,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:r.submitted_by_profile?.full_name||"Unknown"})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx(we,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:Se(new Date(r.submitted_at),"MMM d, yyyy")})]})})]},r.id||`suggestion-${o.indexOf(r)}`))})]})})})}function Dt(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-800 rounded-lg w-48"}),e.jsx("div",{className:"h-4 bg-gray-800 rounded-lg w-80"}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"h-10 bg-gray-800 rounded-lg w-32"}),e.jsx("div",{className:"h-10 bg-gray-800 rounded-lg w-24"})]}),e.jsx("div",{className:"h-10 bg-gray-800 rounded-lg w-64"})]})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-6",children:[1,2,3,4,5,6].map(t=>e.jsxs("div",{className:"min-w-[320px] bg-gray-900/50 rounded-xl border border-gray-800/50 flex flex-col h-[600px]",children:[e.jsxs("div",{className:"p-4 border-b border-gray-800/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-md bg-gray-800"}),e.jsx("div",{className:"h-5 bg-gray-800 rounded-lg w-20"})]}),e.jsx("div",{className:"bg-gray-800/50 rounded-full w-8 h-5"})]}),e.jsx("div",{className:"p-4 space-y-3 flex-1",children:[1,2,3].map(i=>e.jsx("div",{className:"bg-gray-800/50 rounded-xl p-4 h-32"},i))})]},t))})]})}const Ut=t=>{const i=Ze(t);if(i.length>0)return i;const o=et(t);return o.length>0?o:tt(t)},Te=ne.forwardRef((t,i)=>{const{suggestions:o,statuses:m,isLoading:g,error:h,suggestionsByStatus:l,createSuggestion:x,updateSuggestion:u,deleteSuggestion:r,moveSuggestionToStatus:p,voteForSuggestion:j,removeVote:C,refreshSuggestions:v}=ke(),[S,M]=d.useState("kanban"),[a,s]=d.useState({}),[c,f]=d.useState(!1),[n,$]=d.useState(null),[R,E]=d.useState(null),[P,V]=d.useState(null),[O,N]=d.useState("none"),[z,L]=d.useState(null),[Q,ee]=d.useState(null),[De,K]=d.useState(null),[xe,Y]=d.useState(null),J=d.useRef(null),[Ue,X]=d.useState(!1);ne.useImperativeHandle(i,()=>({openSuggestionForm:()=>ie(null),openSuggestionModal:y=>{$(y),X(!0)}}),[]),d.useEffect(()=>{s(structuredClone(l))},[l]),d.useEffect(()=>{if(O==="none"){s(l);return}const y={...a};Object.keys(y).forEach(D=>{y[D]=[...y[D]].sort((_,w)=>{switch(O){case"votes":return w.votes_count-_.votes_count;case"date":return new Date(w.submitted_at||0).getTime()-new Date(_.submitted_at||0).getTime();case"priority":const b={critical:0,high:1,medium:2,low:3};return b[_.priority]-b[w.priority];default:return 0}})}),s(y)},[O,l]),d.useEffect(()=>()=>{L(null),ee(null),K(null),Y(null),J.current=null,V(null)},[]);const Fe=Ge(Ke(st,{activationConstraint:{distance:8}})),ie=(y=null)=>{$(null),E(y),f(!0)},ue=y=>{if(!y||!y.id){U.error("Unable to open suggestion - invalid data");return}const D=o.find(_=>_.id===y.id);if(!D){B.error("Suggestion not found in list:",y.id),U.error("Unable to find suggestion");return}$(D),X(!0),E(null)},Me=async y=>{let D=!1,_=null;try{B.log("handleSaveSuggestion called with:",{selectedSuggestionId:n?.id,selectedSuggestionTitle:n?.title,formData:y,hasId:!!n?.id,idType:typeof n?.id,idLength:n?.id?.length,idValue:JSON.stringify(n?.id)});const w=n&&n.id&&typeof n.id=="string"&&n.id.trim()!==""&&n.id.length>=10;if(n&&w){const b=n.id.trim();B.log("Updating suggestion with ID:",b),await u(b,y),D=!0}else(!n||!w)&&(B.log("Creating new suggestion"),_=await x(y),D=!!_);D&&(f(!1),X(!1),U.success(n?"Suggestion updated":"Suggestion created"))}catch(w){const b=w instanceof Error?w.message:"Failed to save suggestion";U.error(b)}},te=y=>m.some(_=>_.id===y)||y in a?y:Object.keys(a).find(_=>a[_].some(w=>w.id===y)),Pe=y=>{const{active:D}=y,_=String(D.id);L(_);const w=te(_);ee(w||null),K(w||null),Y(w&&a[w]?a[w].findIndex(F=>F.id===_):null);let b=null;for(const F in a)if(b=a[F].find(k=>k.id===_),b)break;V(b),O!=="none"&&N("none")},Ae=y=>{const{active:D,over:_}=y;if(!_)return;const w=String(D.id),b=String(_.id),F=te(w);let k=te(b);if(!k&&m.some(T=>T.id===b)&&(k=b),!F||!k){B.log("Drag over - status detection:",{activeId:w,overId:b,fromStatus:F,toStatus:k,isOverIdAStatus:m.some(T=>T.id===b),availableStatuses:m.map(T=>T.id)});return}if(F===k&&b===w)return;let I=a[k].findIndex(T=>T.id===b);(I===-1||b===k||b.endsWith("-placeholder"))&&(I=a[k].length),!(z===w&&Q===F&&De===k&&xe===I)&&(J.current=k,s(T=>{const H=[...T[F]],se=H.findIndex(q=>q.id===w);if(se===-1)return T;const[W]=H.splice(se,1),G=[...T[k]];return G.some(q=>q.id===w)||G.splice(I,0,{...W,status:k}),{...T,[F]:H,[k]:G}}),K(k),Y(I))},Ve=async y=>{const{active:D,over:_}=y,w=String(D.id);let b=null;if(_){const I=String(_.id);I.endsWith("-placeholder")?b=I.replace("-placeholder",""):m.find(T=>T.id===I)?b=I:b=te(I)}b||(b=J.current);const F=Q;if(!F||!b||F===b){L(null),ee(null),K(null),Y(null),V(null),J.current=null;return}let k=xe;if(_){const I=String(_.id);I.endsWith("-placeholder")||I===b?k=0:(k=a[b].findIndex(T=>T.id===I),k===-1&&(k=a[b].length))}else k==null&&(k=a[b].length);s(I=>{const T=[...I[F]],H=T.findIndex(q=>q.id===w);if(H===-1)return I;const[se]=T.splice(H,1),W=[...I[b]],G=W.findIndex(q=>q.id===w);return G!==-1&&W.splice(G,1),W.splice(k,0,{...se,status:b}),{...I,[F]:T,[b]:W}});try{await p(w,b),b==="completed"&&Le.celebrate()}catch{U.error("Failed to move suggestion. Please try again."),s(l)}L(null),ee(null),K(null),Y(null),V(null),J.current=null},ge=async y=>{try{await r(y),n&&n.id===y&&(X(!1),$(null),E(null)),U.success("Suggestion deleted")}catch{U.error("Failed to delete suggestion")}};return g?e.jsx(Dt,{}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx("div",{className:"text-red-500 mb-4",children:"Error loading roadmap data"}),e.jsx("div",{className:"text-gray-400",children:h})]}):e.jsxs(e.Fragment,{children:[e.jsx(kt,{onAddSuggestionClick:()=>ie(),view:S,onViewChange:M,sortBy:O,onSortChange:N}),S==="kanban"?e.jsx(e.Fragment,{children:e.jsxs(Ye,{sensors:Fe,collisionDetection:Ut,onDragStart:Pe,onDragOver:Ae,onDragEnd:Ve,measuring:{droppable:{strategy:Je.Always}},autoScroll:{threshold:{x:.2,y:.2},interval:10},children:[e.jsx("div",{className:"grid gap-3 pb-6 overflow-x-auto",style:{gridTemplateColumns:m.length<=4?`repeat(${m.length}, minmax(280px, 1fr))`:`repeat(${m.length}, minmax(280px, 350px))`,maxWidth:"100%"},children:m.map(y=>e.jsx(Tt,{status:y,suggestions:a[y.id]||[],onAddSuggestionClick:()=>ie(y.id),onSuggestionClick:ue},y.id))}),e.jsx(Xe,{children:P&&e.jsx(Ie,{suggestion:P,onClick:()=>{},isDragOverlay:!0},`overlay-${P.id}`)})]})}):e.jsx(Rt,{onSuggestionClick:ue,onDeleteSuggestion:ge}),(c||Ue)&&Oe.createPortal(e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",style:{margin:0},children:e.jsx("div",{className:"bg-gray-900 rounded-xl p-6 shadow-xl w-full max-w-xl border border-gray-800 max-h-[90vh] overflow-y-auto",children:e.jsx(Et,{suggestion:n,onSave:Me,onCancel:()=>{f(!1),X(!1),$(null),E(null)},onDelete:n?ge:void 0,initialStatusId:R},n?.id||R||"new-suggestion")})}),document.body)]})});Te.displayName="RoadmapContent";const Ee=ne.forwardRef((t,i)=>e.jsx(Ct,{children:e.jsx(Te,{ref:i})}));Ee.displayName="RoadmapKanban";const Re=(t="",i={})=>{const{debounceDelay:o=300,minSearchLength:m=0}=i,[g,h]=d.useState(t),[l,x]=d.useState(t),[u,r]=d.useState(!1);d.useEffect(()=>{const j=setTimeout(()=>{x(g),r(!1)},o);return g!==l&&g.length>=m&&r(!0),()=>clearTimeout(j)},[g,l,o,m]);const p=d.useCallback(()=>{h(""),x(""),r(!1)},[]);return{query:g,debouncedQuery:l,isSearching:u,setQuery:h,clearSearch:p}},Ft=({onSearch:t,placeholder:i="Search...",className:o="",debounceDelay:m=300,minSearchLength:g=0,initialValue:h=""})=>{const{query:l,debouncedQuery:x,isSearching:u,setQuery:r,clearSearch:p}=Re(h,{debounceDelay:m,minSearchLength:g});return d.useEffect(()=>{t(x)},[x,t]),e.jsxs("div",{className:`relative ${o}`,children:[e.jsx(bt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:l,onChange:j=>r(j.target.value),placeholder:i,className:"w-full pl-10 pr-10 py-2 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all duration-200"}),l&&e.jsx("button",{onClick:p,className:"absolute right-8 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-300 transition-colors",children:e.jsx(Ne,{className:"w-4 h-4"})}),u&&e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"})})]})},fe={gray:{bg:"bg-gray-500/10",border:"border-gray-500/20",text:"text-gray-500"},yellow:{bg:"bg-yellow-500/10",border:"border-yellow-500/20",text:"text-yellow-500"},blue:{bg:"bg-blue-500/10",border:"border-blue-500/20",text:"text-blue-500"},purple:{bg:"bg-purple-500/10",border:"border-purple-500/20",text:"text-purple-500"},green:{bg:"bg-green-500/10",border:"border-green-500/20",text:"text-green-500"},red:{bg:"bg-red-500/10",border:"border-red-500/20",text:"text-red-500"}};function re({title:t,value:i,icon:o,color:m,subtitle:g}){const h=fe[m]||fe.gray;return e.jsx(_t.div,{whileHover:{y:-2},className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${h.bg} border ${h.border}`,children:e.jsx(o,{className:`w-6 h-6 ${h.text}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:t}),e.jsx("p",{className:"text-2xl font-bold text-white",children:i}),g&&e.jsx("p",{className:"text-xs text-gray-500",children:g})]})]})})}function Wt(){const{ticketId:t}=Nt(),i=St(),{suggestions:o,loading:m,error:g}=_e(),{userData:h}=oe(),{debouncedQuery:l,setQuery:x}=Re("",{debounceDelay:300,minSearchLength:0}),[u,r]=d.useState("all"),[p,j]=d.useState("all"),C=d.useRef(null),v=h?.is_admin||!1;d.useEffect(()=>{if(t&&o.length>0&&C.current){const s=parseInt(t,10),c=o.find(f=>f.ticket_id===s);c?(C.current.openSuggestionModal?.(c),i("/roadmap",{replace:!0})):i("/roadmap",{replace:!0})}},[t,o,i]);const S=d.useMemo(()=>o.filter(s=>{const c=!l||s.title.toLowerCase().includes(l.toLowerCase())||s.description.toLowerCase().includes(l.toLowerCase()),f=u==="all"||s.type===u,n=p==="all"||s.status===p;return c&&f&&n}),[o,l,u,p]),M={total:o.length,completed:o.filter(s=>s.status==="completed").length,inProgress:o.filter(s=>s.status==="in_progress").length,pending:o.filter(s=>s.status==="submitted").length},a={features:o.filter(s=>s.type==="feature").length,bugs:o.filter(s=>s.type==="bug").length,improvements:o.filter(s=>s.type==="improvement").length,other:o.filter(s=>s.type==="other").length};return m?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-800 rounded-lg w-64"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:4}).map((s,c)=>e.jsx("div",{className:"h-24 bg-gray-800 rounded-xl"},c))}),e.jsx("div",{className:"h-96 bg-gray-800 rounded-xl"})]})})}):g?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white p-6",children:e.jsx("div",{className:"max-w-7xl mx-auto flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(he,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Error Loading Roadmap"}),e.jsx("p",{className:"text-gray-400",children:g})]})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:e.jsx(yt,{className:"w-6 h-6 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Product Roadmap"}),e.jsx("p",{className:"text-gray-400",children:"Share your ideas, report bugs, and track development progress"})]})]})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(ze,{onClick:()=>{C.current?.openSuggestionForm()},className:"flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(be,{className:"w-4 h-4"}),"Submit Feature Request"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(re,{title:"Total Suggestions",value:M.total,icon:jt,color:"blue",subtitle:"All time submissions"}),e.jsx(re,{title:"Completed",value:M.completed,icon:vt,color:"green",subtitle:"Successfully implemented"}),e.jsx(re,{title:"In Progress",value:M.inProgress,icon:le,color:"yellow",subtitle:"Currently being developed"}),e.jsx(re,{title:"Pending Review",value:M.pending,icon:ve,color:"purple",subtitle:"Awaiting evaluation"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Features"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:a.features})]})]})}),e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"w-5 h-5 text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Bugs"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:a.bugs})]})]})}),e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(wt,{className:"w-5 h-5 text-emerald-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Improvements"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:a.improvements})]})]})}),e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"w-5 h-5 text-yellow-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Other"}),e.jsx("p",{className:"text-lg font-semibold text-white",children:a.other})]})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(Ft,{onSearch:x,placeholder:"Search suggestions...",className:"w-full"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:u,onChange:s=>r(s.target.value),className:"bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Types"}),e.jsx("option",{value:"feature",children:"Features"}),e.jsx("option",{value:"bug",children:"Bugs"}),e.jsx("option",{value:"improvement",children:"Improvements"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("select",{value:p,onChange:s=>j(s.target.value),className:"bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-emerald-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"under_review",children:"Under Review"}),e.jsx("option",{value:"in_progress",children:"In Progress"}),e.jsx("option",{value:"testing",children:"Testing"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-gray-400",children:["Showing ",S.length," of ",o.length," suggestions"]}),v&&e.jsx("div",{className:"text-sm text-emerald-400 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20",children:"Admin Mode: You can drag & drop to manage suggestions"})]}),e.jsx(Ee,{ref:C})]})})}export{Wt as default};
