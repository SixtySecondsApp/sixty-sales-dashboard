import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as n}from"./vendor-react-DoYyFkVR.js";import{m as O,r as R,U as b,g as $,a as u}from"./index.html-Cwo_Unfk.js";import{A as P,h as H,a as J,b as I,c as Q,d as Y,e as z,f as B,g as G}from"./alert-dialog-Z8L2pxQa.js";import{a as W}from"./vendor-router-CQXjpROx.js";import{b as q,U as K,aC as w,aE as X,S as Z,a0 as ee,$ as te,T as se,ar as ae,W as re,Y as _,am as le}from"./vendor-icons-HRBKouGg.js";import{motion as j,AnimatePresence as de}from"./ui-animation-Dzb4KUJ1.js";import{p as ie}from"./vendor-utils-Cb9OXVhE.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-charts-D4YcUEy1.js";import"./ui-radix-extended-CHWFg20j.js";function fe(){const[m,C]=n.useState(""),[f,S]=n.useState(!1),[h,T]=n.useState("all"),[r,o]=n.useState(null),[N,i]=n.useState([]),{users:x,updateUser:A,deleteUser:U}=O(),{startViewMode:D}=R(),k=W(),v=n.useMemo(()=>x.filter(t=>{const s=t.email.toLowerCase().includes(m.toLowerCase())||t.first_name?.toLowerCase().includes(m.toLowerCase())||t.last_name?.toLowerCase().includes(m.toLowerCase()),a=h==="all"||t.stage===h;return s&&a}),[x,m,h]);n.useEffect(()=>{r?.editingTargets&&Array.isArray(r.targets)?i(JSON.parse(JSON.stringify(r.targets))):r?.editingTargets&&i([])},[r]);const c=(t,s,a)=>{i(g=>{const l=[...g];l[t]||(l[t]={id:void 0});const y=a===""?null:s.includes("target")?s==="revenue_target"?parseFloat(a):parseInt(a):a;return l[t]={...l[t],[s]:y},l})},E=()=>{const t=ie(new Date,"yyyy-MM-dd");i(s=>[...s,{id:`new_${Date.now()}`,revenue_target:null,outbound_target:null,meetings_target:null,proposal_target:null,start_date:t,end_date:null}])},L=t=>{i(s=>s.filter((a,g)=>g!==t))},p=async(t,s)=>{if(!t){u.error("Cannot update user: User ID missing.");return}try{await A({userId:t,updates:s}),o(null),i([])}catch{}},M=t=>{D({id:t.id,email:t.email,first_name:t.first_name,last_name:t.last_name,full_name:t.full_name}),u.success(`Now viewing as ${t.email}`),k("/")},F=()=>{const t=v.map(d=>({"First Name":d.first_name,"Last Name":d.last_name,Email:d.email,Stage:d.stage,Admin:d.is_admin?"Yes":"No",Created:new Date(d.created_at).toLocaleDateString()})),s=Object.keys(t[0]||{}),a=[s.join(","),...t.map(d=>s.map(V=>JSON.stringify(d[V]||"")).join(","))].join(`
`),g=new Blob([a],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),y=URL.createObjectURL(g);l.setAttribute("href",y),l.setAttribute("download",`users_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(l),l.click(),document.body.removeChild(l),u.success("Export completed successfully")};return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 mt-12 lg:mt-0 min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage users, roles, and permissions"})]}),e.jsxs("button",{onClick:()=>o({isNew:!0}),className:"w-full sm:w-auto flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-[#37bd7e]/10 text-[#37bd7e] hover:bg-[#37bd7e]/20 transition-all duration-300 text-sm border border-[#37bd7e]/30 hover:border-[#37bd7e]/50",children:[e.jsx(q,{className:"w-4 h-4"}),"Add User"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(K,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Users"}),e.jsx("div",{className:"text-xl font-bold text-white",children:x.length})]})]})}),e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-violet-500/10",children:e.jsx(w,{className:"w-5 h-5 text-violet-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Admins"}),e.jsx("div",{className:"text-xl font-bold text-white",children:x.filter(t=>t.is_admin).length})]})]})}),e.jsx("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-4 border border-gray-800/50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-emerald-500/10",children:e.jsx(X,{className:"w-5 h-5 text-emerald-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Active"}),e.jsx("div",{className:"text-xl font-bold text-white",children:x.filter(t=>t.last_sign_in_at).length})]})]})})]}),e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-lg border border-gray-800/50 overflow-hidden",children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b border-gray-800/50 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsx("div",{className:"w-full sm:flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",value:m,onChange:t=>C(t.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg pl-10 pr-4 py-2 text-white placeholder-gray-500 focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>S(!f),className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-gray-800/50 text-gray-300 hover:bg-[#37bd7e]/20 hover:text-white transition-all duration-300 text-sm border border-transparent hover:border-[#37bd7e]/30",children:[e.jsx(ee,{className:"w-4 h-4"}),"Filters"]}),e.jsxs(j.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:F,className:"flex-1 sm:flex-none flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-[#37bd7e]/10 text-[#37bd7e] hover:bg-[#37bd7e]/20 transition-all duration-300 text-sm border border-[#37bd7e]/30 hover:border-[#37bd7e]/50",children:[e.jsx(te,{className:"w-4 h-4"}),"Export"]})]})]}),e.jsx(de,{children:f&&e.jsx(j.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",children:e.jsxs("select",{className:"bg-gray-800/50 border border-gray-700/50 rounded-xl px-4 py-2.5 text-white text-sm",value:h,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"all",children:"All Stages"}),b.map(t=>e.jsx("option",{value:t,children:t},t))]})})})})]}),e.jsx("div",{className:"overflow-x-auto min-w-[800px] lg:min-w-0",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-800/50",children:[e.jsx("th",{className:"text-left text-xs font-medium text-gray-400 px-4 sm:px-6 py-3 whitespace-nowrap",children:"User"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-400 px-4 sm:px-6 py-3 whitespace-nowrap",children:"Stage"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-400 px-4 sm:px-6 py-3 whitespace-nowrap",children:"Targets"}),e.jsx("th",{className:"text-left text-xs font-medium text-gray-400 px-4 sm:px-6 py-3 whitespace-nowrap",children:"Admin"}),e.jsx("th",{className:"text-right text-xs font-medium text-gray-400 px-4 sm:px-6 py-3 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{children:v.map(t=>e.jsxs("tr",{className:"border-b border-gray-800/50 hover:bg-gray-800/20",children:[e.jsx("td",{className:"px-4 sm:px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-[#37bd7e]/10 border border-[#37bd7e]/20 flex items-center justify-center",children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.first_name,className:"w-full h-full object-cover rounded-lg"}):e.jsxs("span",{className:"text-sm font-medium text-[#37bd7e]",children:[t.first_name?.[0],t.last_name?.[0]]})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-white",children:[t.first_name," ",t.last_name]}),e.jsx("div",{className:"text-sm text-gray-400",children:t.email})]})]})}),e.jsx("td",{className:"px-4 sm:px-6 py-4",children:e.jsx("select",{value:t.stage,onChange:s=>p(t.id,{stage:s.target.value}),className:"bg-gray-800/30 border border-gray-700/30 rounded-lg px-3 py-1 text-sm text-white",children:b.map(s=>e.jsx("option",{value:s,children:s},s))})}),e.jsx("td",{className:"px-4 sm:px-6 py-4",children:e.jsxs("button",{onClick:()=>o({...t,editingTargets:!0}),className:"flex items-center gap-2 px-3 py-1 rounded-lg bg-violet-500/10 text-violet-500 hover:bg-violet-500/20 transition-all duration-300 text-sm border border-violet-500/30",children:[e.jsx(se,{className:"w-4 h-4"}),"Edit Targets"]})}),e.jsx("td",{className:"px-4 sm:px-6 py-4",children:e.jsxs("button",{onClick:()=>p(t.id,{is_admin:!t.is_admin}),className:$("flex items-center gap-2 px-3 py-1 rounded-lg transition-all duration-300 text-sm border",t.is_admin?"bg-emerald-500/10 text-emerald-500 border-emerald-500/30 hover:bg-emerald-500/20":"bg-gray-500/10 text-gray-400 border-gray-500/30 hover:bg-gray-500/20"),children:[e.jsx(w,{className:"w-4 h-4"}),t.is_admin?"Admin":"User"]})}),e.jsx("td",{className:"px-4 sm:px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>M(t),className:"p-2 hover:bg-violet-500/20 rounded-lg transition-colors",title:"View as this user",children:e.jsx(ae,{className:"w-4 h-4 text-violet-500"})}),e.jsx("button",{onClick:()=>o(t),className:"p-2 hover:bg-[#37bd7e]/20 rounded-lg transition-colors",children:e.jsx(re,{className:"w-4 h-4 text-[#37bd7e]"})}),e.jsxs(P,{children:[e.jsx(H,{asChild:!0,children:e.jsx("button",{className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:e.jsx(_,{className:"w-4 h-4 text-red-500"})})}),e.jsxs(J,{className:"bg-gray-900/95 backdrop-blur-xl border border-gray-800/50",children:[e.jsxs(I,{children:[e.jsx(Q,{children:"Delete User"}),e.jsxs(Y,{children:["Are you sure you want to delete ",t.first_name," ",t.last_name,"? This action cannot be undone. All their activities and targets will also be deleted."]})]}),e.jsxs(z,{children:[e.jsx(B,{className:"bg-gray-800/50 text-gray-300 hover:bg-gray-800",children:"Cancel"}),e.jsx(G,{onClick:()=>U(t.id),className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})]})]})})]},t.id))})]})})]})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-xl rounded-xl border border-gray-800/50 p-6 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-white",children:r.isNew?"Add User":r.editingTargets?`Edit Targets for ${r.first_name}`:"Edit User"}),r.editingTargets?e.jsxs("form",{onSubmit:t=>{t.preventDefault(),p(r.id,{targets:N})},className:"space-y-6",children:[N.map((t,s)=>e.jsxs("div",{className:"p-4 rounded-lg border border-gray-700/50 bg-gray-800/20 space-y-4 relative",children:[e.jsx("button",{type:"button",onClick:()=>L(s),className:"absolute top-2 right-2 p-1 text-red-500 hover:bg-red-500/20 rounded","aria-label":"Remove target set",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400",children:"Revenue Target"}),e.jsx("input",{type:"number",placeholder:"e.g., 20000",value:t.revenue_target??"",onChange:a=>c(s,"revenue_target",a.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-1.5 text-sm text-white"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400",children:"Outbound Target"}),e.jsx("input",{type:"number",placeholder:"e.g., 100",value:t.outbound_target??"",onChange:a=>c(s,"outbound_target",a.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-1.5 text-sm text-white"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400",children:"Meetings Target"}),e.jsx("input",{type:"number",placeholder:"e.g., 20",value:t.meetings_target??"",onChange:a=>c(s,"meetings_target",a.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-1.5 text-sm text-white"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400",children:"Proposal Target"}),e.jsx("input",{type:"number",placeholder:"e.g., 15",value:t.proposal_target??"",onChange:a=>c(s,"proposal_target",a.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-1.5 text-sm text-white"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400",children:"Start Date"}),e.jsx("input",{type:"date",value:t.start_date??"",onChange:a=>c(s,"start_date",a.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-1.5 text-sm text-white"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-400",children:"End Date"}),e.jsx("input",{type:"date",value:t.end_date??"",onChange:a=>c(s,"end_date",a.target.value),className:"w-full bg-gray-800/50 border border-gray-700/50 rounded-lg px-3 py-1.5 text-sm text-white"})]})]})]},t.id||s)),e.jsxs("button",{type:"button",onClick:E,className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-lg border-2 border-dashed border-gray-700/50 text-gray-400 hover:border-[#37bd7e]/50 hover:text-[#37bd7e] transition-colors duration-200",children:[e.jsx(le,{className:"w-4 h-4"}),"Add New Target Set"]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{o(null),i([])},className:"px-4 py-2 rounded-xl bg-gray-800/50 text-gray-300 hover:bg-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-xl bg-[#37bd7e] text-white hover:bg-[#2da76c] transition-colors",children:"Save Target Changes"})]})]}):e.jsxs("form",{onSubmit:t=>{t.preventDefault();const s=new FormData(t.target);r.isNew?u.info("New user creation not implemented."):p(r.id,{first_name:s.get("first_name"),last_name:s.get("last_name"),email:s.get("email"),stage:s.get("stage")})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"First Name"}),e.jsx("input",{type:"text",name:"first_name",defaultValue:r?.first_name||"",className:"w-full bg-gray-800/30 border border-gray-700/30 rounded-xl px-4 py-2 text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Last Name"}),e.jsx("input",{type:"text",name:"last_name",defaultValue:r?.last_name||"",className:"w-full bg-gray-800/30 border border-gray-700/30 rounded-xl px-4 py-2 text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Email"}),e.jsx("input",{type:"email",name:"email",defaultValue:r?.email||"",className:"w-full bg-gray-800/30 border border-gray-700/30 rounded-xl px-4 py-2 text-white",readOnly:!r.isNew})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Stage"}),e.jsx("select",{name:"stage",defaultValue:r?.stage||b[0],className:"w-full bg-gray-800/30 border border-gray-700/30 rounded-xl px-4 py-2 text-white",children:b.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>o(null),className:"px-4 py-2 rounded-xl bg-gray-800/50 text-gray-300 hover:bg-gray-800 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-xl bg-[#37bd7e] text-white hover:bg-[#2da76c] transition-colors",children:r.isNew?"Create User":"Save Changes"})]})]})]})})]})}export{fe as default};
