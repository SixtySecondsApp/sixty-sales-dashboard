import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as c}from"./vendor-react-DoYyFkVR.js";import{A as R,b as B}from"./alert-DhiZyWgi.js";import{B as o}from"./badge-C6MYiXDB.js";import{Dialog as Y,DialogContent as J,DialogHeader as Q,DialogTitle as X,DialogDescription as Z,DialogFooter as ee}from"./dialog-BBMx1wit.js";import{I as k}from"./input-CeE6qNqI.js";import{L as _}from"./label-B9drN7Ag.js";import{u as se,F as te}from"./ui-forms-D2VzSQqQ.js";import{p as ae,q as re,l as A,a as N,z as D,f as H}from"./index.html-Cwo_Unfk.js";import{a4 as V,X as le,a3 as ie,a5 as ne,a8 as E,aV as T,P as I,U as ce,M as z,B as de,a7 as oe,z as K,j as L,c as $,k as U,Y as W,ao as G,aP as me,R as xe,aW as M,at as he,L as ge,A as O}from"./vendor-icons-HRBKouGg.js";import{a as P,c as ue}from"./vendor-router-CQXjpROx.js";import{T as q}from"./TaskForm-Bqf2L1Og.js";import"./vendor-utils-Cb9OXVhE.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";import"./textarea-C78yVaZk.js";import"./select-BFsZCfaH.js";import"./popover-BxJ1Vfi_.js";import"./ui-radix-extended-CHWFg20j.js";const pe=({open:s,setOpen:m,contact:r,onClose:p})=>{const{updateContact:g}=ae(),{companies:b}=re(),[n,x]=c.useState(!1),[u,j]=c.useState(!1),i=se({defaultValues:{first_name:r?.first_name||"",last_name:r?.last_name||"",email:r?.email||"",phone:r?.phone||"",title:r?.title||"",linkedin_url:r?.linkedin_url||"",company_id:r?.company_id||"",is_primary:r?.is_primary||!1}}),h=c.useRef(null),f=c.useRef(null),w=c.useRef(null),t=c.useRef(null),d=y=>{y.key==="Escape"&&a()},a=()=>{m(!1),p&&p()},C=async()=>{try{if(x(!0),!await i.trigger()){const l=i.formState.errors;A.error("Form validation errors:",l),N.error("Please fix the highlighted fields."),x(!1);return}const v=i.getValues(),S={first_name:v.first_name||void 0,last_name:v.last_name||void 0,email:v.email,phone:v.phone||void 0,title:v.title||void 0,linkedin_url:v.linkedin_url||void 0,company_id:v.company_id||void 0,is_primary:v.is_primary};A.log("Saving contact with data:",S),await g(r.id,S),N.success("Contact has been successfully updated."),a()}catch{N.error("There was a problem saving your changes.")}finally{x(!1)}};return c.useEffect(()=>{s&&r&&(i.reset({first_name:r.first_name||"",last_name:r.last_name||"",email:r.email||"",phone:r.phone||"",title:r.title||"",linkedin_url:r.linkedin_url||"",company_id:r.company_id||"",is_primary:r.is_primary||!1}),setTimeout(()=>{f.current&&f.current.focus()},100))},[s,r,i]),r?e.jsx(te,{...i,children:e.jsx(Y,{open:s,onOpenChange:m,children:e.jsxs(J,{ref:h,className:"max-w-[600px] p-0 overflow-hidden bg-gray-950 border border-gray-800 rounded-xl",onKeyDown:d,children:[e.jsxs(Q,{className:"p-4 border-b border-gray-800 relative flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center justify-center w-7 h-7 rounded-md bg-blue-500/10 text-blue-400 border border-blue-500/20",children:e.jsx(V,{className:"w-4 h-4"})}),e.jsx(X,{className:"text-xl font-semibold text-white",children:"Edit Contact"})]}),e.jsx("button",{ref:w,onClick:a,className:"text-gray-400 hover:text-gray-300 focus:outline-none focus:ring-2 focus:ring-violet-600 focus:ring-opacity-50 rounded-md","aria-label":"Close modal",children:e.jsx(le,{className:"w-5 h-5"})})]}),e.jsx(Z,{className:"sr-only",children:"Edit the contact details including name, email, phone, and company information."}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(_,{htmlFor:"first_name",className:"text-sm font-medium text-gray-300 mb-1",children:"First Name"}),e.jsx(k,{...i.register("first_name"),ref:f,id:"first_name",type:"text",className:"w-full",placeholder:"John"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"last_name",className:"text-sm font-medium text-gray-300 mb-1",children:"Last Name"}),e.jsx(k,{...i.register("last_name"),id:"last_name",type:"text",className:"w-full",placeholder:"Doe"})]})]}),e.jsxs("div",{children:[e.jsxs(_,{htmlFor:"email",className:"text-sm font-medium text-gray-300 mb-1",children:["Email ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(k,{...i.register("email",{required:"Email is required",pattern:{value:/^\S+@\S+$/i,message:"Invalid email address"}}),id:"email",type:"email",className:"w-full",placeholder:"john.doe@example.com"}),i.formState.errors.email&&e.jsx("p",{className:"mt-1 text-sm text-red-400",children:i.formState.errors.email.message})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"phone",className:"text-sm font-medium text-gray-300 mb-1",children:"Phone"}),e.jsx(k,{...i.register("phone"),id:"phone",type:"tel",className:"w-full",placeholder:"+1 (555) 123-4567"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"title",className:"text-sm font-medium text-gray-300 mb-1",children:"Job Title"}),e.jsx(k,{...i.register("title"),id:"title",type:"text",className:"w-full",placeholder:"Sales Manager"})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"company_id",className:"text-sm font-medium text-gray-300 mb-1",children:"Company"}),e.jsxs("select",{...i.register("company_id"),id:"company_id",className:"w-full p-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:border-blue-500 focus:outline-none",children:[e.jsx("option",{value:"",children:"No Company"}),b?.map(y=>e.jsx("option",{value:y.id,children:y.name},y.id))]})]}),e.jsxs("div",{children:[e.jsx(_,{htmlFor:"linkedin_url",className:"text-sm font-medium text-gray-300 mb-1",children:"LinkedIn URL"}),e.jsx(k,{...i.register("linkedin_url"),id:"linkedin_url",type:"url",className:"w-full",placeholder:"https://linkedin.com/in/johndoe"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{...i.register("is_primary"),id:"is_primary",type:"checkbox",className:"w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-0 focus:ring-offset-gray-900"}),e.jsx(_,{htmlFor:"is_primary",className:"text-sm font-medium text-gray-300 cursor-pointer",children:"Primary Contact"})]})]}),e.jsx(ee,{className:"p-4 border-t border-gray-800 bg-gray-950 flex items-center justify-end",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:`py-2 px-4 rounded-lg text-gray-300 bg-gray-800 hover:bg-gray-700
                  transition-colors text-sm font-medium focus:outline-none focus:ring-2 focus:ring-gray-600 focus:ring-opacity-50`,"aria-label":"Cancel",children:"Cancel"}),e.jsx("button",{ref:t,onClick:C,disabled:n,className:`flex items-center gap-2 bg-blue-600 hover:bg-blue-700 
                  text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors
                  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50
                  disabled:bg-blue-600/70 disabled:cursor-not-allowed`,"aria-label":"Save contact",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-1",children:e.jsxs("svg",{className:"w-4 h-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"w-4 h-4 mr-1"}),"Save"]})})]})})]})})}):null};function be({contact:s}){const m=P(),[r,p]=c.useState(!1),g=n=>{const x=n.first_name||"",u=n.last_name||"";return`${x[0]||""}${u[0]||""}`.toUpperCase()||n.email?.[0]?.toUpperCase()||"?"},b=n=>n.first_name&&n.last_name?`${n.first_name} ${n.last_name}`:n.full_name?n.full_name:n.email||"Unknown Contact";return e.jsxs("div",{className:"mb-8",children:[e.jsxs("nav",{className:"breadcrumb-nav",children:[e.jsxs("button",{onClick:()=>m("/crm/contacts"),className:"breadcrumb-item flex items-center gap-1",children:[e.jsx(ne,{className:"w-4 h-4"}),"Contacts"]}),e.jsx("span",{className:"breadcrumb-separator",children:"/"}),e.jsx("span",{className:"breadcrumb-current",children:b(s)})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"w-20 h-20 rounded-full border-3 border-blue-400 bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-2xl shadow-lg",children:g(s)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:b(s)}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-400 mb-2",children:[s.title&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg",children:s.title}),e.jsx("span",{className:"text-gray-600",children:"•"})]}),s.company&&e.jsx("span",{className:"text-lg",children:s.company.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Active"}),s.is_primary&&e.jsx(o,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:"Primary Contact"})]})]})]}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn-primary",onClick:()=>p(!0),children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit Contact"})]}),e.jsxs("button",{className:"btn-secondary",children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"Message"})]}),e.jsxs("button",{className:"btn-secondary",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:"Call"})]})]})]}),e.jsx(pe,{open:r,setOpen:p,contact:s})]})}const je=[{id:"overview",label:"Overview"},{id:"activity",label:"Activity Log"},{id:"deals",label:"Deals"},{id:"tasks",label:"Tasks"},{id:"emails",label:"Emails"},{id:"documents",label:"Documents"}];function fe({activeTab:s,onTabChange:m}){return e.jsx("div",{className:"mb-8 border-b border-gray-800/30 overflow-x-auto",children:e.jsx("nav",{className:"flex -mb-px space-x-1",children:je.map(r=>e.jsx("button",{onClick:()=>m(r.id),className:`
              group inline-flex items-center py-4 px-6 border-b-2 text-sm whitespace-nowrap rounded-t-lg transition-all
              ${s===r.id?"border-blue-500 text-blue-400 bg-blue-500/10 font-medium":"border-transparent text-gray-400 hover:text-white hover:bg-gray-800/30"}
            `,children:r.label},r.id))})})}function Ne({contact:s}){const[m,r]=c.useState(null),[p,g]=c.useState(null),[b,n]=c.useState(!0);c.useEffect(()=>{(async()=>{if(s.id)try{n(!0);const[d,a]=await Promise.all([D.getContactOwner(s.id),D.getContactStats(s.id)]);r(d),g(a)}catch{}finally{n(!1)}})()},[s.id]);const x={name:"Unassigned",title:"No Sales Rep",email:"Not assigned",assigned_date:s.created_at},u={meetings:0,emails:0,calls:0,totalDeals:0,engagementScore:0},j=m||x,i=p||u,h=t=>{if(!t)return"NA";const d=t.split(" ");return d.length>=2?`${d[0][0]}${d[1][0]}`.toUpperCase():t.substring(0,2).toUpperCase()},f=t=>{try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Unknown"}},w=t=>t>=80?"from-green-500/20 to-blue-500/20 border-green-500/30 text-green-400":t>=50?"from-yellow-500/20 to-orange-500/20 border-yellow-500/30 text-yellow-400":"from-red-500/20 to-pink-500/20 border-red-500/30 text-red-400";return b?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"section-card animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-32 mb-4"}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-700 rounded-full"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-700 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-700 rounded w-20"})]})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"section-card bg-gradient-to-br from-blue-900/20 to-blue-800/10 border-blue-500/20",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-white",children:[e.jsx(V,{className:"w-5 h-5 text-blue-400"}),"Lead Owner"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold",children:h(j.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:j.name}),e.jsx("p",{className:"text-gray-400 text-sm",children:j.title}),e.jsx("p",{className:"text-gray-400 text-xs",children:j.email})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-blue-500/20",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs",children:"Assigned"}),e.jsx("p",{className:"text-white",children:f(j.assigned_date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs",children:"Last Contact"}),e.jsx("p",{className:"text-white",children:i.recentActivities?.length>0?f(i.recentActivities[0].created_at):"No activity"})]})]})})]}),e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-400"}),"Contact Information"]}),e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-800/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Email"}),e.jsx("p",{className:"text-white",children:s.email})]}),e.jsx("button",{className:"btn-icon",children:e.jsx(z,{className:"w-4 h-4"})})]}),s.phone&&e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-gray-800/50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Phone"}),e.jsx("p",{className:"text-white",children:s.phone})]}),e.jsx("button",{className:"btn-icon",children:e.jsx(I,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[s.company&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Company"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-white",children:s.company.name}),s.company.website&&e.jsx("a",{href:s.company.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300",children:e.jsx(oe,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-1",children:"Added on"}),e.jsx("p",{className:"text-white",children:f(s.created_at)})]})]})]})]}),e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(K,{className:"w-5 h-5 text-blue-400"}),"Activity Summary"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"activity-metric text-center p-3 rounded-lg bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-blue-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:i.meetings}),e.jsx("div",{className:"text-xs text-gray-400",children:"Meetings"})]}),e.jsxs("div",{className:"activity-metric text-center p-3 rounded-lg bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-blue-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:i.emails}),e.jsx("div",{className:"text-xs text-gray-400",children:"Emails"})]}),e.jsxs("div",{className:"activity-metric text-center p-3 rounded-lg bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-blue-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:i.calls}),e.jsx("div",{className:"text-xs text-gray-400",children:"Calls"})]}),e.jsxs("div",{className:"activity-metric text-center p-3 rounded-lg bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-blue-500/20",children:[e.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:i.totalDeals}),e.jsx("div",{className:"text-xs text-gray-400",children:"Deals"})]})]}),e.jsxs("div",{className:`p-3 rounded-lg bg-gradient-to-r ${w(i.engagementScore)}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"w-2 h-2 bg-current rounded-full"}),e.jsx("span",{className:"text-current text-sm font-medium",children:"Engagement Score"})]}),e.jsxs("div",{className:"text-2xl font-bold text-white",children:[i.engagementScore,"%"]}),e.jsx("div",{className:"text-xs text-gray-400",children:i.engagementScore>=80?"Highly engaged":i.engagementScore>=50?"Moderately engaged":"Low engagement"})]})]})]})}function ye({contact:s,activeTab:m}){const{tasks:r,isLoading:p,completeTask:g,uncompleteTask:b,deleteTask:n,fetchTasks:x}=H({contact_id:s.id,completed:!1}),[u,j]=c.useState(!1),[i,h]=c.useState(void 0),f=l=>{switch(l?.toLowerCase()){case"high":return"border-l-red-500 bg-red-500/5";case"medium":return"border-l-yellow-500 bg-yellow-500/5";case"low":return"border-l-green-500 bg-green-500/5";default:return"border-l-gray-500 bg-gray-500/5"}},w=l=>{switch(l?.toLowerCase()){case"high":return e.jsx(o,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"High"});case"medium":return e.jsx(o,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Medium"});case"low":return e.jsx(o,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Low"});default:return e.jsx(o,{variant:"outline",children:"Normal"})}},t=l=>{try{return new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Unknown"}},d=async l=>{try{l.completed?(await b(l.id),N.success("Task marked as incomplete")):(await g(l.id),N.success("Task completed!"))}catch{N.error("Failed to update task")}},a=async l=>{if(window.confirm("Are you sure you want to delete this task?"))try{await n(l.id),N.success("Task deleted")}catch{N.error("Failed to delete task")}},C=()=>{h(void 0),j(!0)},y=l=>{h(l),j(!0)},v=async l=>{await x()},S=async()=>{j(!1),h(void 0),setTimeout(async()=>{await x()},200)};return m==="overview"?e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"section-card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-blue-400"}),"Active Tasks",r.length>0&&e.jsx(o,{variant:"outline",className:"ml-2 bg-gray-700 text-gray-200 border-gray-600 font-mono text-xs",children:r.length})]}),e.jsxs("button",{className:"btn-primary",onClick:C,children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Task"})]})]}),p?e.jsx("div",{className:"space-y-3",children:[...Array(3)].map((l,F)=>e.jsx("div",{className:"p-4 rounded-lg bg-gray-800/50 border border-gray-700/50 animate-pulse",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-5 w-5 rounded bg-gray-700/80 shrink-0 mt-1"}),e.jsxs("div",{className:"flex-grow space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-700/80 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-700/60 rounded w-full"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"h-3 bg-gray-700/60 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-gray-700/60 rounded w-1/4"})]})]})]})},F))}):r&&r.length>0?e.jsx("div",{className:"space-y-3",children:r.map(l=>e.jsxs("div",{className:`p-4 rounded-lg border-l-4 bg-gray-800/50 ${f(l.priority)} transition-all hover:bg-gray-800/70`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:l.completed||!1,className:"mt-1 w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 cursor-pointer",onChange:()=>d(l)}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-white font-medium ${l.completed?"line-through opacity-60":""}`,children:l.title}),l.description&&e.jsx("p",{className:`text-gray-400 text-sm ${l.completed?"opacity-60":""}`,children:l.description}),l.task_type&&e.jsx("div",{className:"mt-1",children:e.jsx(o,{variant:"outline",className:"text-xs",children:l.task_type.replace("_"," ").toUpperCase()})})]})]}),w(l.priority)]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:["Due: ",l.due_date?t(l.due_date):"No due date"]}),l.assignee&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-600",children:"•"}),e.jsxs("span",{children:["Assigned to: ",l.assignee.first_name," ",l.assignee.last_name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-icon hover:bg-blue-500/20 hover:text-blue-400 transition-colors",onClick:()=>y(l),title:"Edit task",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-icon hover:bg-red-500/20 hover:text-red-400 transition-colors",onClick:()=>a(l),title:"Delete task",children:e.jsx(W,{className:"w-4 h-4"})})]})]})]},l.id))}):e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No active tasks"}),e.jsx("p",{className:"text-sm",children:"Create a new task to get started with managing your contact activities."})]})]}),e.jsxs("div",{className:"section-card bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-purple-400"}),"AI Email Follow-up"]}),e.jsx(o,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:"Based on contact data"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/30",children:[e.jsx("h3",{className:"text-white font-medium mb-2",children:"Suggested Email"}),e.jsxs("div",{className:"text-sm text-gray-300 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Subject:"})," Following up on our recent conversation"]}),e.jsx("p",{children:e.jsxs("strong",{children:["Hi ",s.first_name||"there",","]})}),e.jsxs("p",{children:["Hope you're doing well! I wanted to follow up on our recent discussions about ",r.length>0?"the opportunities we discussed":"potential collaboration","."]}),s.company&&e.jsxs("p",{children:["I believe our solutions could be a great fit for ",s.company.name,"'s needs."]}),e.jsx("p",{children:"Would you have time for a brief call this week to discuss next steps?"}),e.jsx("p",{children:e.jsxs("strong",{children:["Best regards,",e.jsx("br",{}),"Your Sales Team"]})})]})]}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn-primary flex-1",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"Send Email"})]}),e.jsxs("button",{className:"btn-outline",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:"Edit"})]}),e.jsxs("button",{className:"btn-outline",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsx("span",{children:"Regenerate"})]})]})]})]}),e.jsx(q,{task:i,isOpen:u,onClose:S,contactId:s.id,contactName:`${s.first_name||""} ${s.last_name||""}`.trim()||s.email,contactEmail:s.email,company:s.company?.name||"",onTaskCreated:v})]}):e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[m==="tasks"?e.jsx(ve,{contact:s,onCreateTask:C,onEditTask:y}):e.jsx("div",{className:"section-card",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-400 mb-2",children:[m.charAt(0).toUpperCase()+m.slice(1)," Content"]}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["This section will display ",m,"-related information for ",s.first_name||s.email,"."]})]})}),e.jsx(q,{task:i,isOpen:u,onClose:S,contactId:s.id,contactName:`${s.first_name||""} ${s.last_name||""}`.trim()||s.email,contactEmail:s.email,company:s.company?.name||"",onTaskCreated:v})]})}function ve({contact:s,onCreateTask:m,onEditTask:r}){const{tasks:p,isLoading:g,completeTask:b,uncompleteTask:n,deleteTask:x}=H({contact_id:s.id}),[u,j]=c.useState(!1),i=u?p:p.filter(a=>!a.completed),h=a=>{switch(a?.toLowerCase()){case"high":return"border-l-red-500 bg-red-500/5";case"medium":return"border-l-yellow-500 bg-yellow-500/5";case"low":return"border-l-green-500 bg-green-500/5";default:return"border-l-gray-500 bg-gray-500/5"}},f=a=>{switch(a?.toLowerCase()){case"high":return e.jsx(o,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"High"});case"medium":return e.jsx(o,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Medium"});case"low":return e.jsx(o,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Low"});default:return e.jsx(o,{variant:"outline",children:"Normal"})}},w=a=>{try{return new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Unknown"}},t=async a=>{try{a.completed?(await n(a.id),N.success("Task marked as incomplete")):(await b(a.id),N.success("Task completed!"))}catch{N.error("Failed to update task")}},d=async a=>{if(window.confirm("Are you sure you want to delete this task?"))try{await x(a.id),N.success("Task deleted")}catch{N.error("Failed to delete task")}};return e.jsxs("div",{className:"section-card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(L,{className:"w-6 h-6 text-blue-400"}),"Tasks for ",s.first_name||s.email]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:a=>j(a.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),"Show completed"]}),e.jsxs("button",{className:"btn-primary",onClick:m,children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"New Task"})]})]})]}),g?e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"h-24 bg-gray-700 rounded animate-pulse"},a))}):e.jsx("div",{className:"space-y-3",children:i.length>0?i.map(a=>e.jsxs("div",{className:`p-4 rounded-lg border-l-4 bg-gray-800/50 ${h(a.priority)} transition-all hover:bg-gray-800/70`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a.completed||!1,className:"mt-1 w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 cursor-pointer",onChange:()=>t(a)}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-white font-medium ${a.completed?"line-through opacity-60":""}`,children:a.title}),a.description&&e.jsx("p",{className:`text-gray-400 text-sm mt-1 ${a.completed?"opacity-60":""}`,children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.task_type&&e.jsx(o,{variant:"outline",className:"text-xs",children:a.task_type.replace("_"," ").toUpperCase()}),a.status&&e.jsx(o,{variant:"outline",className:`text-xs ${a.status==="completed"?"bg-green-500/20 text-green-400 border-green-500/30":a.status==="in_progress"?"bg-blue-500/20 text-blue-400 border-blue-500/30":a.status==="overdue"?"bg-red-500/20 text-red-400 border-red-500/30":"bg-gray-500/20 text-gray-400 border-gray-500/30"}`,children:a.status.replace("_"," ").toUpperCase()})]})]})]}),f(a.priority)]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 text-gray-400 flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsxs("span",{children:["Due: ",a.due_date?w(a.due_date):"No due date"]})]}),a.assignee&&e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("span",{children:["Assigned to: ",a.assignee.first_name," ",a.assignee.last_name]})}),a.created_at&&e.jsx("div",{className:"flex items-center gap-1 text-xs",children:e.jsxs("span",{children:["Created: ",w(a.created_at)]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-icon hover:bg-blue-500/20 hover:text-blue-400 transition-colors",onClick:()=>r(a),title:"Edit task",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsx("button",{className:"btn-icon hover:bg-red-500/20 hover:text-red-400 transition-colors",onClick:()=>d(a),title:"Delete task",children:e.jsx(W,{className:"w-4 h-4"})})]})]})]},a.id)):e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(L,{className:"w-16 h-16 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:u?"No tasks found":"No active tasks"}),e.jsx("p",{className:"text-sm",children:u?"This contact has no tasks yet.":'All tasks for this contact are completed. Toggle "Show completed" to see them.'})]})})]})}function we({contact:s}){const m=P(),[r,p]=c.useState([]),[g,b]=c.useState([]),[n,x]=c.useState(!0);c.useEffect(()=>{(async()=>{if(s.id)try{x(!0);const[d,a]=await Promise.all([D.getContactDeals(s.id),D.getContactActivities(s.id,5)]);p(d||[]),b(a||[])}catch{}finally{x(!1)}})()},[s.id]);const u=t=>{m(`/crm/deals/${t}?returnTo=/crm/contacts/${s.id}`)},j=t=>{switch(t?.toLowerCase()){case"won":case"signed":case"closed won":return"border-l-green-500";case"lost":case"closed lost":return"border-l-red-500";case"negotiation":case"negotiate":return"border-l-purple-500";case"proposal":case"quote":return"border-l-blue-500";case"qualified":case"discovery":return"border-l-yellow-500";default:return"border-l-gray-500"}},i=t=>{switch(t?.toLowerCase()){case"won":case"closed won":return e.jsx(o,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:"Won"});case"lost":case"closed lost":return e.jsx(o,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:"Lost"});case"negotiation":case"negotiate":return e.jsx(o,{className:"bg-purple-500/20 text-purple-400 border-purple-500/30",children:"Negotiation"});case"proposal":case"quote":return e.jsx(o,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30",children:"Proposal"});case"qualified":case"discovery":return e.jsx(o,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",children:"Qualified"});default:return e.jsx(o,{variant:"outline",children:t||"Unknown"})}},h=(t,d="£")=>`${d}${t?.toLocaleString()||0}`,f=t=>{try{return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return"Unknown"}},w=t=>{switch(t?.toLowerCase()){case"email":return{icon:z,color:"text-blue-400",bgColor:"bg-blue-500/20",borderColor:"border-blue-500/30"};case"meeting":return{icon:U,color:"text-green-400",bgColor:"bg-green-500/20",borderColor:"border-green-500/30"};case"call":return{icon:I,color:"text-orange-400",bgColor:"bg-orange-500/20",borderColor:"border-orange-500/30"};case"task":return{icon:T,color:"text-purple-400",bgColor:"bg-purple-500/20",borderColor:"border-purple-500/30"};default:return{icon:T,color:"text-gray-400",bgColor:"bg-gray-500/20",borderColor:"border-gray-500/30"}}};return n?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"section-card animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-700 rounded w-32 mb-4"}),e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-20 bg-gray-700 rounded"},t))})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"section-card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-400"}),"Active Deals"]}),e.jsxs("button",{className:"btn-sm btn-secondary",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"New Deal"})]})]}),e.jsx("div",{className:"space-y-3",children:r.length>0?r.map(t=>e.jsxs("div",{className:`deal-card-clickable p-4 rounded-lg bg-gray-800/50 border-l-4 ${j(t.stage_name)} group`,onClick:()=>u(t.id),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-white font-medium text-sm group-hover:text-blue-400 transition-colors",children:t.title||t.name||`Deal ${t.id}`}),e.jsx(he,{className:"w-4 h-4 text-gray-400 group-hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-all"})]}),i(t.stage_name)]}),e.jsx("p",{className:"text-gray-400 text-xs mb-2",children:t.description||"No description available"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-white font-semibold",children:h(t.value||t.amount)}),e.jsxs("span",{className:"text-gray-400 text-xs",children:[t.default_probability||t.probability||0,"% probability"]})]})]},t.id)):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(M,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No deals found for this contact"}),e.jsx("p",{className:"text-xs mt-1",children:"Create a new deal to get started"})]})})]}),e.jsxs("div",{className:"section-card",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5 text-blue-400"}),"Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:g.length>0?g.map(t=>{const{icon:d,color:a,bgColor:C,borderColor:y}=w(t.type);return e.jsxs("div",{className:"p-3 rounded-lg bg-gray-800/50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{className:`${C} ${a} ${y} text-xs`,children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),t.type?.charAt(0).toUpperCase()+t.type?.slice(1)]}),e.jsx("span",{className:"text-white text-sm font-medium",children:t.title||t.description||`${t.type} activity`})]}),e.jsx("span",{className:"text-gray-400 text-xs",children:f(t.created_at)})]}),t.notes&&e.jsx("p",{className:"text-gray-300 text-sm mb-2",children:t.notes}),t.deal_title&&e.jsxs("p",{className:"text-gray-400 text-xs",children:["Related to: ",t.deal_title]})]},t.id)}):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(T,{className:"w-12 h-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"No recent activity found"}),e.jsx("p",{className:"text-xs mt-1",children:"Activities will appear here as they happen"})]})})]}),e.jsxs("div",{className:"section-card bg-gradient-to-br from-purple-900/20 to-blue-900/20 border-purple-500/20",children:[e.jsxs("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-purple-400"}),"AI Insights"]}),e.jsxs("div",{className:"space-y-3",children:[r.length>0&&e.jsx("div",{className:"p-3 rounded-lg bg-green-500/15 border border-green-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-green-400 text-xs font-medium mb-1",children:"OPPORTUNITY"}),e.jsxs("p",{className:"text-white text-sm",children:[r.length," active deal",r.length>1?"s":""," worth ",h(r.reduce((t,d)=>t+(d.value||0),0)),". Great potential for expansion."]})]})]})}),g.length===0&&e.jsx("div",{className:"p-3 rounded-lg bg-yellow-500/15 border border-yellow-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-yellow-400 text-xs font-medium mb-1",children:"ATTENTION"}),e.jsx("p",{className:"text-white text-sm",children:"No recent activity. Consider reaching out to maintain engagement."})]})]})}),e.jsx("div",{className:"p-3 rounded-lg bg-blue-500/15 border border-blue-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full mt-2 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-400 text-xs font-medium mb-1",children:"INSIGHT"}),e.jsxs("p",{className:"text-white text-sm",children:["Contact shows ",g.length>5?"high":g.length>2?"moderate":"low"," engagement with ",g.length," recent activities."]})]})]})}),e.jsxs("button",{className:"btn-outline w-full mt-4",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate More Insights"})]})]})]})]})}const ze=()=>{const{id:s}=ue(),m=P(),[r,p]=c.useState(null),[g,b]=c.useState(!0),[n,x]=c.useState(null),[u,j]=c.useState("overview");return c.useEffect(()=>{(async()=>{if(!s){x("Contact ID is required"),b(!1);return}try{b(!0),x(null),A.log("Fetching contact with ID:",s);const h=await D.getContactById(s,!0);if(!h){x("Contact not found");return}A.log("Contact data received:",h),p(h)}catch(h){x(h instanceof Error?h.message:"Failed to load contact")}finally{b(!1)}})()},[s]),g?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(ge,{className:"h-8 w-8 animate-spin text-blue-400"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Loading contact..."})]})}):n?e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(R,{variant:"destructive",className:"bg-red-900/20 border-red-700 text-red-300",children:[e.jsx(O,{className:"h-4 w-4 text-red-400"}),e.jsx(B,{className:"text-red-300",children:n})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>m("/crm/contacts"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"← Back to Contacts"})})]})}):r?e.jsx("div",{className:"min-h-screen text-gray-100",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(be,{contact:r}),e.jsx(fe,{activeTab:u,onTabChange:j}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(Ne,{contact:r})}),e.jsx("div",{className:"lg:col-span-6",children:e.jsx(ye,{contact:r,activeTab:u})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(we,{contact:r})})]})]})}):e.jsx("div",{className:"min-h-screen py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(R,{className:"bg-gray-800/60 border-gray-600 text-gray-300",children:[e.jsx(O,{className:"h-4 w-4 text-gray-400"}),e.jsx(B,{className:"text-gray-300",children:"Contact not found. It may have been deleted or moved."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>m("/crm/contacts"),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"← Back to Contacts"})})]})})};export{ze as default};
