import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as d,a as X}from"./vendor-react-DoYyFkVR.js";import{B as b,g as U,a as f,e as we,s as H}from"./index.html-Cwo_Unfk.js";import{B as z}from"./badge-C6MYiXDB.js";import{Dialog as re,DialogContent as ie,DialogHeader as ne,DialogTitle as le,DialogDescription as oe}from"./dialog-BBMx1wit.js";import{AnimatePresence as ue,motion as T}from"./ui-animation-Dzb4KUJ1.js";import{P as Se}from"./progress-ZbeJO0kq.js";import{Z as Y,L as xe,az as ke,aA as Ae,$ as _e,Y as Ce,i as Pe,Q as De,d as Te,I as Re,aG as Z,c as ge,aH as Oe,at as Ee,af as te,aI as ce,aJ as Me,k as $e,aC as Ue,u as he,aK as ze,aL as Ge,A as ye,aM as Le,aN as Ke,a6 as Je,aO as Be,aP as Fe,aQ as Ve,aD as be,aR as fe,H as de,aS as ve,aF as je}from"./vendor-icons-HRBKouGg.js";import{p as me}from"./vendor-utils-Cb9OXVhE.js";import"./vendor-router-CQXjpROx.js";import"./vendor-supabase-BuXd-BBn.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-charts-D4YcUEy1.js";const se=X.createContext({isOpen:!1,setIsOpen:()=>{},triggerRef:{current:null}});function He({children:a}){const[u,c]=d.useState(!1),m=d.useRef(null);return d.useEffect(()=>{const h=p=>{m.current&&!m.current.contains(p.target)&&c(!1)};return u&&document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}},[u]),e.jsx(se.Provider,{value:{isOpen:u,setIsOpen:c,triggerRef:m},children:e.jsx("div",{className:"relative",children:a})})}function Ze({children:a,asChild:u}){const{setIsOpen:c,triggerRef:m}=X.useContext(se),h=()=>{c(p=>!p)};return u?X.cloneElement(a,{ref:m,onClick:h}):e.jsx("button",{ref:m,onClick:h,children:a})}function qe({children:a,align:u="start",className:c=""}){const{isOpen:m}=X.useContext(se),h={start:"left-0",center:"left-1/2 -translate-x-1/2",end:"right-0"}[u];return e.jsx(ue,{children:m&&e.jsx(T.div,{initial:{opacity:0,y:-10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-10,scale:.95},transition:{duration:.1},className:`
            absolute top-full mt-1 z-50 min-w-[8rem] rounded-md border shadow-md
            bg-gray-900 border-gray-700 text-white
            ${h} ${c}
          `,children:e.jsx("div",{className:"p-1",children:a})})})}function Qe({children:a,className:u="",onClick:c}){const{setIsOpen:m}=X.useContext(se),h=()=>{c?.(),m(!1)};return e.jsx("button",{onClick:h,className:`
        relative flex w-full cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm
        outline-none transition-colors hover:bg-gray-800 hover:text-white focus:bg-gray-800 focus:text-white
        ${u}
      `,children:a})}const W="sixty_mock_api_keys",M={getAllKeys:()=>{try{const a=localStorage.getItem(W);return a?JSON.parse(a):[]}catch{return[]}},createKey:(a,u,c,m)=>{const h=M.getAllKeys(),p=crypto.randomUUID(),O=`sk_test_${crypto.randomUUID().replace(/-/g,"")}`,y=`${O.slice(0,8)}...${O.slice(-4)}`,I={id:p,name:a,key_preview:y,full_key:O,permissions:u,rate_limit:c,usage_count:0,created_at:new Date,expires_at:m?new Date(Date.now()+m*24*60*60*1e3):null,is_active:!0,last_used:null};return h.push(I),localStorage.setItem(W,JSON.stringify(h)),I},deleteKey:a=>{try{const c=M.getAllKeys().filter(m=>m.id!==a);return localStorage.setItem(W,JSON.stringify(c)),!0}catch{return!1}},updateUsage:a=>{const u=M.getAllKeys(),c=u.find(m=>m.id===a);c&&(c.usage_count++,c.last_used=new Date,localStorage.setItem(W,JSON.stringify(u)))},validateKey:a=>M.getAllKeys().some(c=>c.full_key===a&&c.is_active),getKeyByApiKey:a=>M.getAllKeys().find(c=>c.full_key===a)||null},Ye=()=>{M.getAllKeys().length===0&&(M.createKey("Development Key",["contacts:read","contacts:write","contacts:delete","companies:read","companies:write","companies:delete","deals:read","deals:write","deals:delete","tasks:read","tasks:write","tasks:delete","meetings:read","meetings:write","meetings:delete","activities:read","activities:write","activities:delete","analytics:read"],1e3,90),M.createKey("Read-Only Key",["contacts:read","companies:read","deals:read","tasks:read","meetings:read","activities:read","analytics:read"],500,30))},Ie=({apiKey:a,onClose:u})=>{const[c,m]=d.useState(!1),[h,p]=d.useState([]),[O,y]=d.useState(0),[I,A]=d.useState({}),v=d.useRef({}),D="https://ewtuefzeogytgmsnkpmb.supabase.co";d.useEffect(()=>()=>{const o=v.current;Object.keys(o).length>0&&Object.entries(o).forEach(async([i,t])=>{if(t&&a)try{await fetch(`${D}/functions/v1/api-v1-${i}/${t}`,{method:"DELETE",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8","X-API-Key":a}})}catch{}})},[a,D]);const J=o=>{const i=Date.now();return{contacts:{first_name:"Test",last_name:`Contact_${i}`,email:`test_${i}@example.com`,phone:"+1234567890",title:"Test Contact"},companies:{name:`Test Company ${i}`,domain:`test${i}.com`,industry:"Technology",size:"medium",website:`https://test${i}.com`},deals:{name:`Test Deal ${i}`,company:`Test Company ${i}`,contact_name:"Test Contact",contact_email:`test_${i}@example.com`,value:Math.floor(Math.random()*1e5)+1e4,expected_close_date:new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0]},tasks:{title:`Test Task ${i}`,description:"This is a test task created by API test suite",due_date:new Date(Date.now()+3*24*60*60*1e3).toISOString(),priority:"high",status:"pending",task_type:"follow_up",contact_email:`test_${i}@example.com`},meetings:{title:`Test Meeting ${i}`,start_time:new Date(Date.now()+24*60*60*1e3).toISOString(),duration_minutes:30,summary:"Test meeting created by API test suite",owner_email:"test@example.com",fathom_recording_id:`test_${i}`},activities:{subject:`Test Activity ${i}`,type:"outbound",client_name:`Test Client ${i}`,sales_rep:"test@example.com",details:"Test activity created by API test suite",date:new Date().toISOString(),status:"completed"}}[o]},E=o=>({contacts:{phone:"+9876543210",title:"Updated Title"},companies:{size:"large",industry:"Finance"},deals:{value:75e3},tasks:{status:"completed",completed:!0},meetings:{duration_minutes:45,summary:"Updated meeting summary"},activities:{status:"completed",details:"Updated activity details"}})[o],R=["contacts","companies","deals","tasks","meetings","activities"],S=async(o,i,t,n)=>{const r=Date.now(),l=`${D}/functions/v1/api-v1-${o}${n?`/${n}`:""}`;let N="GET";i==="create"&&(N="POST"),i==="update"&&(N="PUT"),i==="delete"&&(N="DELETE");try{const g=await fetch(l,{method:N,headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8","X-API-Key":a||""},body:N==="POST"||N==="PUT"?JSON.stringify(t):void 0}),L=await g.json(),q=Date.now()-r;if(!g.ok)throw new Error(L.error||`HTTP ${g.status}`);return{entity:o,operation:i,status:"success",message:`${i} successful`,duration:q,data:L}}catch(g){return{entity:o,operation:i,status:"failed",message:g.message,duration:Date.now()-r}}},x=async o=>{const i=[];for(const[t,n]of Object.entries(o))if(n)try{const r=`${D}/functions/v1/api-v1-${t}/${n}`;(await fetch(r,{method:"DELETE",headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8","X-API-Key":a||""}})).ok?i.push(`âœ… Cleaned up ${t}: ${n.substring(0,8)}...`):i.push(`âš ï¸ Failed to cleanup ${t}: ${n.substring(0,8)}...`)}catch(r){i.push(`âŒ Error cleaning ${t}: ${r}`)}return i},j=async()=>{if(!a){f.error("Please generate an API key first");return}m(!0),p([]),y(0),A({});const o=R.length*5;let i=0;const t=[],n={};for(const g of R){p(P=>[...P,{entity:g,operation:"list",status:"running"}]);const L=await S(g,"list");t.push(L),p([...t]),i++,y(i/o*100),p(P=>[...P,{entity:g,operation:"create",status:"running"}]);const q=J(g),V=await S(g,"create",q);if(t.push(V),p([...t]),V.status==="success"&&V.data?.data?.id){const P=V.data.data.id;A(w=>({...w,[g]:P})),n[g]=P,v.current[g]=P,i++,y(i/o*100),p(w=>[...w,{entity:g,operation:"get",status:"running"}]);const s=await S(g,"get",null,P);t.push(s),p([...t]),i++,y(i/o*100),p(w=>[...w,{entity:g,operation:"update",status:"running"}]);const _=E(g),C=await S(g,"update",_,P);t.push(C),p([...t]),i++,y(i/o*100),p(w=>[...w,{entity:g,operation:"delete",status:"running"}]);const K=await S(g,"delete",null,P);t.push(K),p([...t]),i++,y(i/o*100),K.status==="success"&&(delete n[g],delete v.current[g])}else i+=3,y(i/o*100),t.push({entity:g,operation:"get",status:"failed",message:"Skipped due to create failure"},{entity:g,operation:"update",status:"failed",message:"Skipped due to create failure"},{entity:g,operation:"delete",status:"failed",message:"Skipped due to create failure"}),p([...t]);await new Promise(P=>setTimeout(P,100))}const r=Object.keys(n);if(r.length>0){t.push({entity:"cleanup",operation:"cleanup",status:"running",message:`Cleaning up ${r.length} remaining test records...`}),p([...t]);const g=await x(n);t[t.length-1]={entity:"cleanup",operation:"cleanup",status:"success",message:`Cleanup completed: ${g.join(", ")}`,data:{cleanupResults:g}},p([...t]),g.length>0&&f.info(`ðŸ§¹ Cleaned up ${g.filter(L=>L.includes("âœ…")).length} test records`),v.current={}}m(!1);const l=t.filter(g=>g.status==="success").length,N=t.filter(g=>g.status==="failed").length;N===0?f.success(`All ${o} tests passed successfully! ${r.length>0?"(Test data cleaned up)":""}`):f.warning(`${l} tests passed, ${N} tests failed ${r.length>0?"(Test data cleaned up)":""}`)},$=()=>{const o={timestamp:new Date().toISOString(),apiKey:a?`${a.substring(0,10)}...`:"No API Key",summary:{total:h.length,success:h.filter(r=>r.status==="success").length,failed:h.filter(r=>r.status==="failed").length,avgDuration:h.reduce((r,l)=>r+(l.duration||0),0)/h.length},results:h},i=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),t=URL.createObjectURL(i),n=document.createElement("a");n.href=t,n.download=`api-test-results-${Date.now()}.json`,n.click(),URL.revokeObjectURL(t)},k=()=>{p([]),y(0),A({}),v.current={}},B=async()=>{const o={...v.current};if(Object.keys(o).length===0){f.info("No test data to clean up");return}try{const i=await x(o);v.current={};const t=i.filter(n=>n.includes("âœ…")).length;t>0?f.success(`ðŸ§¹ Manually cleaned up ${t} test records`):f.warning("âš ï¸ Some cleanup operations may have failed")}catch{f.error("Failed to perform manual cleanup")}},G=o=>{switch(o){case"success":return e.jsx(Te,{className:"h-4 w-4 text-green-400"});case"failed":return e.jsx(De,{className:"h-4 w-4 text-red-400"});case"running":return e.jsx(xe,{className:"h-4 w-4 text-blue-400 animate-spin"});default:return e.jsx(Pe,{className:"h-4 w-4 text-gray-400"})}},F=o=>{switch(o){case"list":case"get":return"bg-blue-500/20 text-blue-400";case"create":return"bg-green-500/20 text-green-400";case"update":return"bg-amber-500/20 text-amber-400";case"delete":return"bg-red-500/20 text-red-400";case"cleanup":return"bg-purple-500/20 text-purple-400";default:return"bg-gray-500/20 text-gray-400"}};return e.jsxs("div",{className:"bg-gradient-to-br from-gray-900/80 to-gray-900/40 backdrop-blur-xl rounded-2xl p-6 border border-gray-800/50 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-purple-500/20 to-purple-600/10 backdrop-blur-sm rounded-xl border border-purple-500/20",children:e.jsx(Y,{className:"h-6 w-6 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-100",children:"API Test Suite"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Comprehensive testing for all endpoints"})]})]}),u&&e.jsx(b,{variant:"ghost",size:"sm",onClick:u,className:"hover:bg-gray-800/50",children:"âœ•"})]}),!a&&e.jsx("div",{className:"mb-4 p-4 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:e.jsx("p",{className:"text-sm text-amber-400",children:"âš ï¸ Please generate an API key first to run tests"})}),e.jsxs("div",{className:"flex gap-3 mb-6",children:[e.jsx(b,{onClick:j,disabled:c||!a,className:"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white",children:c?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4 mr-2 animate-spin"}),"Running Tests..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Run Complete Test Suite"]})}),e.jsxs(b,{variant:"outline",onClick:k,disabled:c,className:"bg-gray-800/50 hover:bg-gray-700/50 border-gray-700/50",children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Reset"]}),h.length>0&&e.jsxs(b,{variant:"outline",onClick:$,className:"bg-gray-800/50 hover:bg-gray-700/50 border-gray-700/50",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Download Report"]}),Object.keys(v.current).length>0&&e.jsxs(b,{variant:"outline",onClick:B,disabled:c,className:"bg-red-800/50 hover:bg-red-700/50 border-red-700/50 text-red-300 hover:text-red-200",title:`Clean up ${Object.keys(v.current).length} test records`,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Cleanup (",Object.keys(v.current).length,")"]})]}),c&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-400 mb-2",children:[e.jsx("span",{children:"Testing Progress"}),e.jsxs("span",{children:[Math.round(O),"%"]})]}),e.jsx(Se,{value:O,className:"h-2 bg-gray-700/50"})]}),h.length>0&&e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.jsx(ue,{mode:"popLayout",children:h.map((o,i)=>e.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.2},className:"flex items-center justify-between p-3 bg-gray-800/30 backdrop-blur-sm rounded-lg border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[G(o.status),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-200 capitalize",children:o.entity}),e.jsx(z,{className:U("text-xs",F(o.operation)),children:o.operation.toUpperCase()})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[o.duration&&e.jsxs("span",{className:"text-xs text-gray-400",children:[o.duration,"ms"]}),o.message&&o.status==="failed"&&e.jsx("span",{className:"text-xs text-red-400 max-w-xs truncate",children:o.message})]})]},`${o.entity}-${o.operation}-${i}`))})}),h.length>0&&!c&&e.jsx("div",{className:"mt-6 p-4 bg-gray-800/30 backdrop-blur-sm rounded-lg border border-gray-700/50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:h.filter(o=>o.status==="success").length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Passed"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:h.filter(o=>o.status==="failed").length}),e.jsx("div",{className:"text-xs text-gray-400",children:"Failed"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-300",children:[Math.round(h.reduce((o,i)=>o+(i.duration||0),0)/h.length),"ms"]}),e.jsx("div",{className:"text-xs text-gray-400",children:"Avg Time"})]})]})})]})},Q=[{id:"contacts:read",label:"Read Contacts",description:"View contact information"},{id:"contacts:write",label:"Write Contacts",description:"Create and update contacts"},{id:"contacts:delete",label:"Delete Contacts",description:"Remove contacts"},{id:"companies:read",label:"Read Companies",description:"View company information"},{id:"companies:write",label:"Write Companies",description:"Create and update companies"},{id:"companies:delete",label:"Delete Companies",description:"Remove companies"},{id:"deals:read",label:"Read Deals",description:"View deals and pipeline data"},{id:"deals:write",label:"Write Deals",description:"Create and update deals"},{id:"deals:delete",label:"Delete Deals",description:"Remove deals"},{id:"tasks:read",label:"Read Tasks",description:"View tasks and to-dos"},{id:"tasks:write",label:"Write Tasks",description:"Create and update tasks"},{id:"tasks:delete",label:"Delete Tasks",description:"Remove tasks"},{id:"meetings:read",label:"Read Meetings",description:"View meeting information"},{id:"meetings:write",label:"Write Meetings",description:"Create and update meetings"},{id:"meetings:delete",label:"Delete Meetings",description:"Remove meetings"},{id:"activities:read",label:"Read Activities",description:"View activity logs and data"},{id:"activities:write",label:"Write Activities",description:"Create and update activities"},{id:"activities:delete",label:"Delete Activities",description:"Remove activities"},{id:"analytics:read",label:"Read Analytics",description:"Access analytics and reports"}],Xe=[{value:100,label:"100/hour - Light usage"},{value:500,label:"500/hour - Moderate usage"},{value:1e3,label:"1000/hour - Heavy usage"},{value:5e3,label:"5000/hour - Enterprise"}],We=({onKeySelected:a})=>{const{user:u}=we(),[c,m]=d.useState([]),[h,p]=d.useState(!0),[O,y]=d.useState(!1),[I,A]=d.useState(null),[v,D]=d.useState(new Set),[J,E]=d.useState(!1),[R,S]=d.useState(null),[x,j]=d.useState({name:"",permissions:["deals:read"],rate_limit:500,expires_in_days:90});d.useEffect(()=>{Ye(),$()},[]);const $=async()=>{if(u){p(!0);try{const{data:t,error:n}=await H.from("api_keys").select("*").eq("user_id",u.id).order("created_at",{ascending:!1});if(n)throw n;const r=(t||[]).map(l=>({id:l.id,name:l.name,key_preview:l.key_preview,permissions:l.permissions||[],rate_limit:l.rate_limit||500,usage_count:l.usage_count||0,last_used:l.last_used?new Date(l.last_used):null,created_at:new Date(l.created_at),expires_at:l.expires_at?new Date(l.expires_at):null,is_active:l.is_active??!0}));if(m(r),a&&r.length>0){const l=r.find(N=>N.is_active&&(!N.expires_at||N.expires_at>new Date)&&N.full_key);l&&l.full_key&&a(l.full_key)}}catch(t){if(t?.message?.includes("api_keys")||t?.code==="42P01"){E(!0);const r=M.getAllKeys().map(l=>({id:l.id,name:l.name,key_preview:l.key_preview,full_key:l.full_key,permissions:l.permissions,rate_limit:l.rate_limit,usage_count:l.usage_count,last_used:l.last_used,created_at:l.created_at,expires_at:l.expires_at,is_active:l.is_active}));if(m(r),a&&r.length>0){const l=r.find(N=>N.is_active&&N.full_key);l&&a(l.full_key)}f.info("Using local mock API keys for testing")}else f.error("Failed to load API keys")}finally{p(!1)}}},k=async()=>{if(!u){f.error("You must be logged in to create API keys");return}try{const{data:{session:t}}=await H.auth.getSession();if(!t){f.error("Authentication session expired. Please log in again.");return}const{data:n,error:r}=await H.functions.invoke("create-api-key",{body:{name:x.name,permissions:x.permissions,rate_limit:x.rate_limit,expires_in_days:x.expires_in_days}});if(r)throw r;if(!n||!n.api_key)throw new Error("Invalid response from API key creation");A({key:n.api_key,name:x.name}),a&&a(n.api_key),await $(),j({name:"",permissions:["deals:read"],rate_limit:500,expires_in_days:90}),f.success("API key created successfully")}catch(t){if(t.message?.includes("500")||t.message?.includes("502")||t.message?.includes("api_keys")){E(!0);try{const n=M.createKey(x.name,x.permissions,x.rate_limit,x.expires_in_days);A({key:n.full_key,name:n.name}),a&&a(n.full_key);const r=M.getAllKeys();m(r.map(l=>({id:l.id,name:l.name,key_preview:l.key_preview,full_key:l.full_key,permissions:l.permissions,rate_limit:l.rate_limit,usage_count:l.usage_count,last_used:l.last_used,created_at:l.created_at,expires_at:l.expires_at,is_active:l.is_active}))),j({name:"",permissions:["deals:read"],rate_limit:500,expires_in_days:90}),f.success("Mock API key created for testing");return}catch{f.error("Failed to create mock API key")}}t.message?.includes("401")||t.message?.includes("Unauthorized")?(f.error("Authentication error. Please log in again."),window.location.href="/auth/login"):t.message?.includes("500")||t.message?.includes("502")?f.error("Server error. The API service may be unavailable. Please try again later."):f.error("Failed to create API key: "+(t.message||"Unknown error"))}},B=async t=>{try{const{error:n}=await H.from("api_keys").update({is_active:!1}).eq("id",t).eq("user_id",u?.id);if(n)throw n;await $(),f.success("API key revoked")}catch{f.error("Failed to revoke API key")}},G=t=>{navigator.clipboard.writeText(t),f.success("API key copied to clipboard")},F=t=>{D(n=>{const r=new Set(n);return r.has(t)?r.delete(t):r.add(t),r})},o=(t,n)=>{const r=t/n*100;return r>=90?"text-red-400":r>=70?"text-yellow-400":"text-emerald-400"},i=t=>t.is_active?t.expires_at&&t.expires_at<new Date?e.jsx(z,{variant:"destructive",children:"Expired"}):e.jsx(z,{variant:"default",className:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",children:"Active"}):e.jsx(z,{variant:"destructive",children:"Revoked"});return h?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"})}):e.jsxs("div",{className:"space-y-6",children:[J&&e.jsxs("div",{className:"mb-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg",children:[e.jsx(Re,{className:"h-4 w-4 inline mr-2 text-amber-400"}),e.jsx("span",{className:"text-sm text-amber-400",children:"Using mock API keys for testing. Database table setup required for production use."})]}),a&&e.jsx("div",{className:"mb-4 p-4 bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-purple-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-purple-300 mb-1",children:"API Testing Mode"}),e.jsx("p",{className:"text-sm text-purple-200/90 mb-2",children:"For security reasons, existing API keys don't store the full key value. To use an existing key for testing:"}),e.jsxs("ul",{className:"text-sm text-purple-200/90 space-y-1",children:[e.jsx("li",{children:"â€¢ Create a new API key (full key will be available for testing)"}),e.jsx("li",{children:`â€¢ Or click "Use for Testing" on any key that shows it's available`})]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-100 flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"API Keys Management"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Manage your API keys for secure access to the CRM"})]}),e.jsxs(b,{onClick:()=>y(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-lg",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Create Key"]})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-900/80 to-gray-800/60 backdrop-blur-xl rounded-2xl border border-gray-700/60 shadow-xl overflow-hidden",children:c.length>0?e.jsx("div",{className:"divide-y divide-gray-700/40",children:c.map((t,n)=>e.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:n*.1},className:"p-6 hover:bg-gray-800/40 transition-all duration-200 border-l-4 border-l-transparent hover:border-l-blue-500/50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-100",children:t.name}),i(t)]}),e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("code",{className:"text-sm font-mono bg-gray-900/70 px-3 py-2 rounded-lg border border-gray-600/50 text-gray-100 shadow-sm",children:v.has(t.id)&&t.full_key?t.full_key:t.key_preview}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>F(t.id),className:"hover:bg-gray-700/70 text-gray-300 hover:text-gray-100",title:v.has(t.id)?"Hide API Key":"Show API Key",children:v.has(t.id)?e.jsx(Oe,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>G(v.has(t.id)&&t.full_key?t.full_key:t.key_preview),className:"hover:bg-gray-700/70 text-gray-300 hover:text-gray-100",title:"Copy API Key",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.full_key?e.jsxs(b,{size:"sm",onClick:()=>S(t.id),className:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-sm",title:"Run API Test Suite for this key",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Test Key"]}):e.jsxs(b,{size:"sm",disabled:!0,variant:"ghost",className:"text-gray-500 cursor-not-allowed",title:"Testing not available - create a new key to enable testing",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Test Unavailable"]}),a&&(t.full_key?e.jsxs(b,{size:"sm",onClick:()=>a(t.full_key),className:"bg-purple-600 hover:bg-purple-700 text-white shadow-sm",title:"Use this API Key for Testing Page",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Use for Testing"]}):e.jsxs(b,{size:"sm",disabled:!0,variant:"ghost",className:"text-gray-500 cursor-not-allowed",title:"Full API key not available - create a new key for testing",children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Not Available"]}))]})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:t.permissions.map(r=>e.jsx(z,{variant:"outline",className:"text-xs border-gray-600 text-gray-200 bg-gray-800/30",children:r},r))}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx(Me,{className:"h-4 w-4 text-blue-400"}),e.jsxs("span",{className:o(t.usage_count,t.rate_limit),children:[t.usage_count,"/",t.rate_limit]}),e.jsx("span",{className:"text-gray-400",children:"requests/hour"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-300",children:[e.jsx($e,{className:"h-4 w-4 text-green-400"}),e.jsx("span",{className:"text-gray-400",children:t.last_used?`Last used ${me(t.last_used,"MMM d, yyyy")}`:"Never used"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsxs("span",{children:["Created ",me(t.created_at,"MMM d, yyyy")]})]}),t.expires_at&&e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsxs("span",{children:["Expires ",me(t.expires_at,"MMM d, yyyy")]})]})]})]}),e.jsxs(He,{children:[e.jsx(Ze,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",className:"hover:bg-gray-700/50",children:e.jsx(ze,{className:"h-4 w-4"})})}),e.jsx(qe,{className:"bg-gray-900/90 backdrop-blur-xl border-gray-700/50",children:e.jsxs(Qe,{onClick:()=>B(t.id),className:"text-red-400 hover:bg-red-500/10",disabled:!t.is_active,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Revoke Key"]})})]})]})},t.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Z,{className:"h-12 w-12 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-300 mb-2",children:"No API Keys"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create your first API key to start using the CRM API"}),e.jsxs(b,{onClick:()=>y(!0),className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Create API Key"]})]})}),e.jsx(re,{open:O,onOpenChange:y,children:e.jsxs(ie,{className:"bg-gray-900/95 backdrop-blur-xl border-gray-700/50 text-gray-100 max-w-lg",children:[e.jsxs(ne,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Create New API Key"]}),e.jsx(oe,{className:"text-gray-400",children:"Generate a new API key with specific permissions and rate limits."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Key Name"}),e.jsx("input",{type:"text",value:x.name,onChange:t=>j({...x,name:t.target.value}),placeholder:"e.g., Mobile App Key",className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-700/50 rounded-lg text-gray-100 placeholder-gray-500 focus:ring-2 focus:ring-blue-500/50 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-300",children:["Permissions",e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:["(",x.permissions.length,"/",Q.length," selected)"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{className:"text-xs bg-gray-800/50 border border-gray-700/50 rounded px-2 py-1 text-gray-300",onChange:t=>{const n=t.target.value;n==="all"?j({...x,permissions:Q.map(r=>r.id)}):n==="read-only"?j({...x,permissions:Q.filter(r=>r.id.includes(":read")).map(r=>r.id)}):n==="full-access"?j({...x,permissions:Q.filter(r=>!r.id.includes(":delete")).map(r=>r.id)}):n==="clear"&&j({...x,permissions:[]}),t.target.value="presets"},children:[e.jsx("option",{value:"presets",children:"Quick Presets"}),e.jsx("option",{value:"all",children:"All Permissions"}),e.jsx("option",{value:"read-only",children:"Read Only"}),e.jsx("option",{value:"full-access",children:"Read & Write"}),e.jsx("option",{value:"clear",children:"Clear All"})]})})]}),e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto bg-gray-800/30 p-3 rounded-lg border border-gray-700/50",children:["contacts","companies","deals","tasks","meetings","activities","analytics"].map(t=>{const n=Q.filter(r=>r.id.startsWith(t));return n.length===0?null:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-semibold text-gray-400 uppercase tracking-wide",children:t==="analytics"?"Analytics & Reports":t}),e.jsx("div",{className:"space-y-1 pl-2",children:n.map(r=>e.jsxs("label",{className:"flex items-start gap-3 text-sm cursor-pointer hover:bg-gray-700/20 p-1 rounded",children:[e.jsx("input",{type:"checkbox",checked:x.permissions.includes(r.id),onChange:l=>{l.target.checked?j({...x,permissions:[...x.permissions,r.id]}):j({...x,permissions:x.permissions.filter(N=>N!==r.id)})},className:"mt-0.5 rounded border-gray-600 bg-gray-800/50 text-blue-600 focus:ring-blue-500/50"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-gray-200",children:r.label.replace(`${t.charAt(0).toUpperCase()+t.slice(1)} `,"")}),e.jsx("div",{className:"text-gray-500 text-xs",children:r.description})]})]},r.id))})]},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Rate Limit"}),e.jsx("select",{value:x.rate_limit,onChange:t=>j({...x,rate_limit:parseInt(t.target.value)}),className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-700/50 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",children:Xe.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Expires In"}),e.jsxs("select",{value:x.expires_in_days||"",onChange:t=>j({...x,expires_in_days:t.target.value?parseInt(t.target.value):null}),className:"w-full px-3 py-2 bg-gray-800/50 border border-gray-700/50 rounded-lg text-gray-100 focus:ring-2 focus:ring-blue-500/50 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Never expires"}),e.jsx("option",{value:30,children:"30 days"}),e.jsx("option",{value:90,children:"90 days"}),e.jsx("option",{value:365,children:"1 year"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(b,{onClick:()=>y(!1),variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800/50",children:"Cancel"}),e.jsx(b,{onClick:k,disabled:!x.name||x.permissions.length===0,className:"flex-1 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white",children:"Create Key"})]})]})]})}),e.jsx(re,{open:!!R,onOpenChange:()=>S(null),children:e.jsxs(ie,{className:"bg-gray-900/95 backdrop-blur-xl border-gray-700/50 text-gray-100 max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs(ne,{children:[e.jsxs(le,{className:"flex items-center gap-2 text-purple-400",children:[e.jsx(ce,{className:"h-5 w-5"}),"API Key Testing Suite"]}),e.jsx(oe,{className:"text-gray-400",children:R&&e.jsxs(e.Fragment,{children:["Testing API key: ",e.jsx("span",{className:"font-mono text-sm",children:c.find(t=>t.id===R)?.name})]})})]}),e.jsx("div",{className:"overflow-auto max-h-[calc(90vh-120px)]",children:R&&e.jsx(Ie,{apiKey:c.find(t=>t.id===R)?.full_key||null,onClose:()=>S(null)})})]})}),e.jsx(re,{open:!!I,onOpenChange:()=>A(null),children:e.jsxs(ie,{className:"bg-gray-900/95 backdrop-blur-xl border-gray-700/50 text-gray-100 max-w-lg",children:[e.jsxs(ne,{children:[e.jsxs(le,{className:"flex items-center gap-2 text-emerald-400",children:[e.jsx(Te,{className:"h-5 w-5"}),"API Key Created Successfully"]}),e.jsx(oe,{className:"text-gray-400",children:"Your new API key has been generated. Make sure to copy it now as you won't be able to see it again."})]}),I&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"API Key"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 p-3 bg-gray-800/50 border border-gray-700/50 rounded-lg text-gray-100 font-mono text-sm break-all",children:I.key}),e.jsx(b,{onClick:()=>G(I.key),size:"sm",className:"bg-emerald-600 hover:bg-emerald-700 text-white",children:e.jsx(te,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/20 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-amber-400 font-medium mb-1",children:[e.jsx(he,{className:"h-4 w-4"}),"Important"]}),e.jsx("p",{className:"text-sm text-amber-200",children:"This is the only time you'll be able to see this key. Make sure to copy and store it securely."})]}),e.jsx(b,{onClick:()=>A(null),className:"w-full bg-gray-700 hover:bg-gray-600 text-white",children:"I've Copied the Key"})]})]})})]})},pe=({value:a,onChange:u,language:c="json",readOnly:m=!1,height:h="200px",placeholder:p,className:O})=>{const[y,I]=d.useState(null),[A,v]=d.useState(!1),[D,J]=d.useState([]),[E,R]=d.useState(!1);d.useEffect(()=>{const k=a.split(`
`).length;J(Array.from({length:k},(B,G)=>G+1))},[a]),d.useEffect(()=>{if(c==="json"&&a.trim())try{JSON.parse(a),I(null)}catch(k){I(k.message)}else I(null)},[a,c]);const S=k=>{m||u(k.target.value)},x=async()=>{try{await navigator.clipboard.writeText(a),v(!0),setTimeout(()=>v(!1),2e3)}catch{}},j=()=>{if(c==="json"&&!y&&a.trim())try{const k=JSON.stringify(JSON.parse(a),null,2);u(k)}catch{}},$=E?"500px":h;return e.jsxs(T.div,{className:U("relative bg-gray-900/50 border border-gray-700/50 rounded-lg overflow-hidden",O),layout:!0,children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-gray-800/50 border-b border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-400 uppercase font-medium",children:c}),y&&e.jsxs("div",{className:"flex items-center gap-1 text-red-400",children:[e.jsx(ye,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:["Invalid ",c]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[c==="json"&&!m&&e.jsx(b,{size:"sm",variant:"ghost",onClick:j,className:"h-6 px-2 text-xs hover:bg-gray-700/50",disabled:!!y||!a.trim(),children:"Format"}),e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>R(!E),className:"h-6 w-6 p-0 hover:bg-gray-700/50",children:E?e.jsx(Le,{className:"h-3 w-3"}):e.jsx(Ke,{className:"h-3 w-3"})}),e.jsx(b,{size:"sm",variant:"ghost",onClick:x,className:"h-6 w-6 p-0 hover:bg-gray-700/50",children:A?e.jsx(Je,{className:"h-3 w-3 text-emerald-400"}):e.jsx(te,{className:"h-3 w-3"})})]})]}),e.jsxs("div",{className:"relative flex",style:{height:$},children:[e.jsx("div",{className:"flex-shrink-0 bg-gray-800/30 border-r border-gray-700/50 px-2 py-3 select-none",children:D.map(k=>e.jsx("div",{className:"text-xs text-gray-500 font-mono leading-5 text-right",style:{minWidth:"20px"},children:k},k))}),e.jsx("textarea",{value:a,onChange:S,readOnly:m,placeholder:p,className:U("flex-1 bg-transparent text-gray-100 font-mono text-sm p-3 resize-none outline-none","placeholder-gray-500 leading-5",m&&"cursor-not-allowed",y&&"text-red-300"),style:{tabSize:2,whiteSpace:"pre",lineHeight:"1.25rem"}})]}),y&&e.jsx(T.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-red-500/10 border-t border-red-500/20 px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-medium",children:"Syntax Error:"}),e.jsx("span",{className:"text-xs",children:y})]})}),A&&e.jsx(T.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-2 right-12 bg-emerald-600 text-white text-xs px-2 py-1 rounded shadow-lg pointer-events-none z-10",children:"Copied!"})]})},ee=({title:a,value:u,icon:c,color:m="green"})=>e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02,y:-2},className:"relative overflow-hidden bg-gradient-to-br from-gray-900/80 to-gray-900/40 backdrop-blur-xl rounded-2xl p-4 border border-gray-800/50 shadow-lg hover:shadow-xl hover:border-gray-700/60 transition-all duration-300 group",children:[e.jsx("div",{className:U("absolute inset-0 bg-gradient-to-br opacity-0 group-hover:opacity-100 transition-opacity duration-500",m==="green"&&"from-emerald-500/5 to-transparent",m==="blue"&&"from-blue-500/5 to-transparent",m==="purple"&&"from-purple-500/5 to-transparent",m==="orange"&&"from-orange-500/5 to-transparent")}),e.jsxs("div",{className:"relative flex items-start justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:"text-gray-400 text-xs font-medium uppercase tracking-wider",children:a}),e.jsx("div",{className:"text-2xl font-bold text-gray-100",children:u})]}),e.jsx("div",{className:"text-gray-600 group-hover:text-gray-400 transition-colors",children:c})]})]}),et=[{value:"contacts",label:"Contacts",icon:"ðŸ‘¥"},{value:"companies",label:"Companies",icon:"ðŸ¢"},{value:"deals",label:"Deals",icon:"ðŸ’°"},{value:"tasks",label:"Tasks",icon:"âœ…"},{value:"meetings",label:"Meetings",icon:"ðŸ“…"},{value:"activities",label:"Activities",icon:"ðŸ“Š"}],Ne=[{method:"GET",label:"List All",path:"",description:"Get all records with pagination"},{method:"GET",label:"Get Single",path:"/{id}",description:"Get a single record by ID"},{method:"POST",label:"Create",path:"",description:"Create a new record"},{method:"PUT",label:"Update",path:"/{id}",description:"Update an existing record"},{method:"DELETE",label:"Delete",path:"/{id}",description:"Delete a record"}],xt=()=>{const{user:a}=we(),[u,c]=d.useState("request"),[m,h]=d.useState("contacts"),[p,O]=d.useState(Ne[0]),[y,I]=d.useState("GET"),[A,v]=d.useState("/api/v1/contacts"),[D,J]=d.useState(""),[E,R]=d.useState(`{
  "Content-Type": "application/json"
}`),[S,x]=d.useState(`{
  
}`),[j,$]=d.useState(""),[k,B]=d.useState(!1),[G,F]=d.useState([]),[o,i]=d.useState(null),[t]=d.useState([{id:"1",name:"List All Contacts",description:"Get all contacts with pagination",method:"GET",endpoint:"/api/v1/contacts",headers:{"Content-Type":"application/json"},category:"Contacts"},{id:"2",name:"Create Contact",description:"Add a new contact",method:"POST",endpoint:"/api/v1/contacts",headers:{"Content-Type":"application/json"},body:`{
  "first_name": "John",
  "last_name": "Doe",
  "email": "john@example.com"
}`,category:"Contacts"},{id:"3",name:"Update Contact",description:"Update existing contact",method:"PUT",endpoint:"/api/v1/contacts/{id}",headers:{"Content-Type":"application/json"},body:`{
  "phone": "+1234567890"
}`,category:"Contacts"},{id:"4",name:"List All Companies",description:"Get all companies",method:"GET",endpoint:"/api/v1/companies",headers:{"Content-Type":"application/json"},category:"Companies"},{id:"5",name:"Create Company",description:"Add a new company",method:"POST",endpoint:"/api/v1/companies",headers:{"Content-Type":"application/json"},body:`{
  "name": "Acme Corp",
  "domain": "acme.com",
  "industry": "Technology"
}`,category:"Companies"},{id:"6",name:"Delete Company",description:"Remove a company",method:"DELETE",endpoint:"/api/v1/companies/{id}",headers:{"Content-Type":"application/json"},category:"Companies"},{id:"7",name:"List All Deals",description:"Get all deals in pipeline",method:"GET",endpoint:"/api/v1/deals",headers:{"Content-Type":"application/json"},category:"Deals"},{id:"8",name:"Create Deal",description:"Create new sales opportunity",method:"POST",endpoint:"/api/v1/deals",headers:{"Content-Type":"application/json"},body:`{
  "name": "Enterprise Deal",
  "value": 50000,
  "company": "Acme Corp",
  "stage_id": "qualification"
}`,category:"Deals"},{id:"9",name:"Update Deal Stage",description:"Move deal to next stage",method:"PUT",endpoint:"/api/v1/deals/{id}",headers:{"Content-Type":"application/json"},body:`{
  "stage_id": "negotiation"
}`,category:"Deals"},{id:"10",name:"List All Tasks",description:"Get all tasks",method:"GET",endpoint:"/api/v1/tasks",headers:{"Content-Type":"application/json"},category:"Tasks"},{id:"11",name:"Create Task",description:"Add a new task",method:"POST",endpoint:"/api/v1/tasks",headers:{"Content-Type":"application/json"},body:`{
  "title": "Follow up call",
  "due_date": "2024-01-20",
  "priority": "high"
}`,category:"Tasks"},{id:"12",name:"Complete Task",description:"Mark task as done",method:"PUT",endpoint:"/api/v1/tasks/{id}",headers:{"Content-Type":"application/json"},body:`{
  "status": "completed",
  "completed": true
}`,category:"Tasks"},{id:"13",name:"List All Meetings",description:"Get all meetings",method:"GET",endpoint:"/api/v1/meetings",headers:{"Content-Type":"application/json"},category:"Meetings"},{id:"14",name:"Create Meeting",description:"Schedule a new meeting",method:"POST",endpoint:"/api/v1/meetings",headers:{"Content-Type":"application/json"},body:`{
  "title": "Sales Demo",
  "meeting_start": "2024-01-15T14:00:00Z",
  "duration_minutes": 30
}`,category:"Meetings"},{id:"15",name:"Get Meeting Details",description:"Get single meeting info",method:"GET",endpoint:"/api/v1/meetings/{id}",headers:{"Content-Type":"application/json"},category:"Meetings"},{id:"16",name:"List Activities",description:"Get all sales activities",method:"GET",endpoint:"/api/v1/activities",headers:{"Content-Type":"application/json"},category:"Activities"},{id:"17",name:"Log Activity",description:"Record a sales activity",method:"POST",endpoint:"/api/v1/activities",headers:{"Content-Type":"application/json"},body:`{
  "type": "outbound",
  "client_name": "Acme Corp",
  "details": "Initial outreach"
}`,category:"Activities"},{id:"18",name:"Delete Activity",description:"Remove an activity",method:"DELETE",endpoint:"/api/v1/activities/{id}",headers:{"Content-Type":"application/json"},category:"Activities"}]),[n,r]=d.useState({totalRequests:0,successRate:0,avgResponseTime:0,activeKeys:0});d.useEffect(()=>{l();const s=localStorage.getItem("selectedApiKey")||sessionStorage.getItem("currentApiKey");s&&!o&&i(s)},[]),d.useEffect(()=>{const s=_=>{_.detail?.apiKey&&i(_.detail.apiKey)};return window.addEventListener("apiKeySelected",s),()=>window.removeEventListener("apiKeySelected",s)},[]);const l=async()=>{try{const{data:s,error:_}=await H.from("api_requests").select("*").eq("user_id",a?.id).order("created_at",{ascending:!1}).limit(50);if(_)throw _;const C=(s||[]).map(w=>({id:w.id,method:w.method,endpoint:w.endpoint,headers:w.headers||{},body:w.body,timestamp:new Date(w.created_at),status:w.status_code,response:w.response_body}));F(C);const K=C.filter(w=>w.status&&w.status<400).length;r({totalRequests:C.length,successRate:C.length>0?Math.round(K/C.length*100):0,avgResponseTime:245,activeKeys:2})}catch(s){s?.message?.includes("api_requests")}};d.useEffect(()=>{const s=`/api/v1/${m}`,_=p.path.includes("{id}")&&D?`${s}/${D}`:s;v(_),I(p.method),p.method==="POST"||p.method==="PUT"?x(N(m,p.method)):x("")},[m,p,D]);const N=(s,_)=>{const C={contacts:{POST:{first_name:"John",last_name:"Doe",email:"john.doe@example.com",phone:"+1234567890",company_id:null,title:"Sales Manager"},PUT:{first_name:"John",last_name:"Doe Updated"}},companies:{POST:{name:"Acme Corp",domain:"acme.com",industry:"Technology",size:"medium",website:"https://acme.com"},PUT:{name:"Acme Corp Updated",size:"large"}},deals:{POST:{name:"Enterprise Deal",company:"Acme Corp",contact_name:"John Doe",contact_email:"john@acme.com",value:5e4,stage_id:"qualification",expected_close_date:new Date(Date.now()+2592e6).toISOString().split("T")[0]},PUT:{value:75e3,stage_id:"negotiation"}},tasks:{POST:{title:"Follow up with client",description:"Send proposal and schedule demo",due_date:new Date(Date.now()+2592e5).toISOString(),priority:"high",status:"pending",task_type:"follow_up"},PUT:{status:"completed",completed:!0}},meetings:{POST:{title:"Sales Demo",meeting_start:new Date(Date.now()+864e5).toISOString(),duration_minutes:30,summary:"Product demonstration for potential client",owner_email:a?.email||"sales@example.com"},PUT:{summary:"Updated meeting summary",duration_minutes:45}},activities:{POST:{type:"outbound",client_name:"Acme Corp",sales_rep:a?.email||"sales@example.com",details:"Initial outreach email sent",date:new Date().toISOString()},PUT:{details:"Follow-up completed",status:"completed"}}};return JSON.stringify(C[s]?.[_]||{},null,2)},g=async()=>{B(!0);try{let s={};try{s=JSON.parse(E)}catch{throw new Error("Invalid JSON in headers")}const _=await fetch("https://ewtuefzeogytgmsnkpmb.supabase.co/functions/v1/api-proxy",{method:y,headers:{...s,Authorization:`Bearer ${(await H.auth.getSession()).data.session?.access_token}`},body:y!=="GET"?S:void 0}),C=await _.text();let K=C;try{const ae=JSON.parse(C);K=JSON.stringify(ae,null,2)}catch{}$(K);const w={id:Date.now().toString(),method:y,endpoint:A,headers:s,body:y!=="GET"?S:void 0,timestamp:new Date,status:_.status,response:K};F(ae=>[w,...ae]),f.success("Request completed successfully")}catch(s){const _={error:s.message,status:"failed",timestamp:new Date().toISOString()};$(JSON.stringify(_,null,2)),f.error("Request failed: "+s.message)}finally{B(!1)}},L=s=>{I(s.method),v(s.endpoint),R(JSON.stringify(s.headers,null,2)),s.body&&x(s.body),c("request"),f.success(`Loaded template: ${s.name}`)},q=()=>{navigator.clipboard.writeText(j),f.success("Response copied to clipboard")},V=()=>{const s=new Blob([j],{type:"application/json"}),_=URL.createObjectURL(s),C=document.createElement("a");C.href=_,C.download=`api-response-${Date.now()}.json`,C.click(),URL.revokeObjectURL(_),f.success("Response downloaded")},P=[{id:"request",label:"Request Builder",icon:be},{id:"keys",label:"API Keys",icon:Z},{id:"test-suite",label:"Test Suite",icon:fe},{id:"history",label:"History",icon:de},{id:"templates",label:"Templates",icon:ve}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(T.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500/20 to-blue-600/10 backdrop-blur-sm rounded-xl border border-blue-500/20",children:e.jsx(Be,{className:"h-6 w-6 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-100 to-gray-300 bg-clip-text text-transparent",children:"API Testing"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Test and explore your CRM API endpoints"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx(ee,{title:"Total Requests",value:n.totalRequests.toString(),icon:e.jsx(Fe,{className:"h-5 w-5"}),color:"blue"}),e.jsx(ee,{title:"Success Rate",value:`${n.successRate}%`,icon:e.jsx(Y,{className:"h-5 w-5"}),color:"green"}),e.jsx(ee,{title:"Avg Response",value:`${n.avgResponseTime}ms`,icon:e.jsx(Ve,{className:"h-5 w-5"}),color:"purple"}),e.jsx(ee,{title:"API Keys",value:n.activeKeys.toString(),icon:e.jsx(Z,{className:"h-5 w-5"}),color:"orange"})]}),e.jsx(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gray-900/50 backdrop-blur-xl rounded-2xl p-1 border border-gray-800/50 shadow-lg",children:e.jsx("div",{className:"flex",children:P.map(s=>e.jsxs(b,{variant:"ghost",onClick:()=>c(s.id),className:U("flex-1 relative transition-all duration-200 rounded-xl",u===s.id?"bg-gray-800/70 backdrop-blur-sm border border-gray-700/50 text-gray-100 shadow-md":"hover:bg-gray-800/30 text-gray-400"),children:[e.jsx(s.icon,{className:"h-4 w-4 mr-2"}),s.label]},s.id))})}),e.jsxs(ue,{mode:"wait",children:[u==="request"&&e.jsx(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-gray-900/60 to-gray-900/30 backdrop-blur-xl rounded-2xl p-6 border border-gray-800/50 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-100 mb-4 flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Request Builder"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Module"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:et.map(s=>e.jsxs("button",{onClick:()=>h(s.value),className:U("px-3 py-2 rounded-lg border transition-all duration-200 flex items-center gap-2",m===s.value?"bg-blue-500/20 border-blue-500/50 text-blue-400":"bg-gray-800/30 border-gray-700/50 text-gray-400 hover:bg-gray-800/50 hover:text-gray-300"),children:[e.jsx("span",{children:s.icon}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Select Operation"}),e.jsx("div",{className:"space-y-2",children:Ne.map(s=>e.jsxs("button",{onClick:()=>O(s),className:U("w-full px-4 py-3 rounded-lg border transition-all duration-200 flex items-center justify-between group",p.method===s.method&&p.label===s.label?"bg-green-500/20 border-green-500/50":"bg-gray-800/30 border-gray-700/50 hover:bg-gray-800/50"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:U("font-mono text-xs",s.method==="GET"&&"bg-blue-500/20 text-blue-400",s.method==="POST"&&"bg-green-500/20 text-green-400",s.method==="PUT"&&"bg-amber-500/20 text-amber-400",s.method==="DELETE"&&"bg-red-500/20 text-red-400"),children:s.method}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200",children:s.label}),e.jsx("div",{className:"text-xs text-gray-500",children:s.description})]})]}),p.method===s.method&&p.label===s.label&&e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]},`${s.method}-${s.label}`))})]}),p.path.includes("{id}")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Record ID"}),e.jsx("input",{type:"text",value:D,onChange:s=>J(s.target.value),placeholder:"Enter record ID (e.g., uuid-1234-5678)",className:"w-full px-4 py-2 bg-gray-800/50 border border-gray-700/50 rounded-lg text-gray-100 placeholder-gray-500 focus:ring-2 focus:ring-blue-500/50 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Endpoint URL"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:U("px-3 py-2 rounded-lg font-mono text-sm flex items-center justify-center min-w-[80px]",y==="GET"&&"bg-blue-500/20 text-blue-400 border border-blue-500/50",y==="POST"&&"bg-green-500/20 text-green-400 border border-green-500/50",y==="PUT"&&"bg-amber-500/20 text-amber-400 border border-amber-500/50",y==="DELETE"&&"bg-red-500/20 text-red-400 border border-red-500/50"),children:y}),e.jsx("input",{type:"text",value:A,readOnly:!0,className:"flex-1 px-3 py-2 bg-gray-800/70 border border-gray-700/50 rounded-lg text-gray-300 font-mono text-sm cursor-not-allowed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Headers"}),e.jsx(pe,{value:E,onChange:R,language:"json",height:"120px"})]}),y!=="GET"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Body"}),e.jsx(pe,{value:S,onChange:x,language:"json",height:"200px"})]}),e.jsxs(b,{onClick:g,disabled:k,className:"w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-lg",children:[k?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(ke,{className:"h-4 w-4 mr-2"}),k?"Sending...":"Send Request"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-900/60 to-gray-900/30 backdrop-blur-xl rounded-2xl p-6 border border-gray-800/50 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-100 flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Response"]}),j&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{size:"sm",variant:"ghost",onClick:q,className:"hover:bg-gray-800/50",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(b,{size:"sm",variant:"ghost",onClick:V,className:"hover:bg-gray-800/50",children:e.jsx(_e,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"min-h-[300px]",children:j?e.jsx(pe,{value:j,onChange:()=>{},language:"json",readOnly:!0,height:"300px"}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(je,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Response will appear here"})]})})})]})]})},"request"),u==="keys"&&e.jsx(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(We,{onKeySelected:i})},"keys"),u==="history"&&e.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"bg-gradient-to-br from-gray-900/60 to-gray-900/30 backdrop-blur-xl rounded-2xl p-6 border border-gray-800/50 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-100 mb-4 flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Request History"]}),e.jsx("div",{className:"space-y-3",children:G.length>0?G.map(s=>e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-gray-800/30 rounded-lg p-4 border border-gray-700/30 hover:border-gray-600/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{variant:s.method==="GET"?"default":s.method==="POST"?"secondary":"outline",className:"font-mono",children:s.method}),e.jsx("span",{className:"text-gray-300 font-mono text-sm",children:s.endpoint}),s.status&&e.jsx(z,{variant:s.status<400?"default":"destructive",className:U(s.status<400?"bg-emerald-500/20 text-emerald-400 border-emerald-500/30":""),children:s.status})]}),e.jsx("span",{className:"text-xs text-gray-500",children:s.timestamp.toLocaleString()})]}),s.response&&e.jsx("div",{className:"text-xs text-gray-400 font-mono line-clamp-2 bg-gray-900/50 p-2 rounded",children:s.response})]},s.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(de,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No requests yet. Send your first API request to see history here."})]})})]},"history"),u==="templates"&&e.jsxs(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"bg-gradient-to-br from-gray-900/60 to-gray-900/30 backdrop-blur-xl rounded-2xl p-6 border border-gray-800/50 shadow-xl",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-100 mb-4 flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Request Templates"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(s=>e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},whileHover:{scale:1.02},className:"bg-gray-800/30 rounded-lg p-4 border border-gray-700/30 hover:border-gray-600/50 transition-all cursor-pointer",onClick:()=>L(s),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-100 mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-400 line-clamp-2",children:s.description})]}),e.jsx(z,{variant:"outline",className:"text-xs",children:s.category})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{variant:s.method==="GET"?"default":s.method==="POST"?"secondary":"outline",className:"font-mono text-xs",children:s.method}),e.jsx("span",{className:"text-xs text-gray-500 font-mono",children:s.endpoint})]})]},s.id))})]},"templates"),u==="test-suite"&&e.jsx(T.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:o?e.jsx(Ie,{apiKey:o}):e.jsx("div",{className:"bg-gradient-to-br from-gray-900/60 to-gray-900/30 backdrop-blur-xl rounded-2xl p-8 border border-gray-800/50 shadow-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-4 text-purple-400 opacity-50"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-100 mb-2",children:"API Key Required"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Please generate an API key first to run the test suite"}),e.jsxs(b,{onClick:()=>c("keys"),className:"bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Go to API Keys"]})]})})},"test-suite")]})]})};export{xt as default};
