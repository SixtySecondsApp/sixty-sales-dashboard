import{c as b}from"./vendor-supabase-BuXd-BBn.js";import"./vendor-react-DoYyFkVR.js";var C=Object.defineProperty,S=(i,e,t)=>e in i?C(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,n=(i,e,t)=>S(i,typeof e!="symbol"?e+"":e,t);const g="https://ewtuefzeogytgmsnkpmb.supabase.co",T="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNzg5NDkyNywiZXhwIjoyMDUzNDcwOTI3fQ.jKjwRZn7fi9rJUcmWPe5zBRpq7leefmx0H8U59bfVEs",f={db:{poolSize:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4,maxUses:7500,allowExitOnIdle:!0,statement_timeout:3e4,idle_in_transaction_session_timeout:1e4,retryAttempts:3,retryDelayMs:1e3},global:{fetch:(i,e)=>{const t={...e,headers:{...e?.headers,Connection:"keep-alive","Keep-Alive":"timeout=30, max=100","Cache-Control":"no-cache","Accept-Encoding":"gzip, deflate, br"},cache:"no-cache",signal:AbortSignal.timeout(25e3)};return fetch(i,t)}}},y=class m{constructor(){n(this,"metrics",{connectionCount:0,totalQueries:0,avgResponseTime:0,errorRate:0,cacheHitRate:0,lastMetricsReset:Date.now()}),n(this,"queryTimes",[]),n(this,"errorCount",0),n(this,"cacheHits",0),n(this,"cacheMisses",0)}static getInstance(){return m.instance||(m.instance=new m),m.instance}recordQuery(e,t=!1,c=!1){this.metrics.totalQueries++,this.queryTimes.push(e),t&&this.errorCount++,c?this.cacheHits++:this.cacheMisses++,this.queryTimes.length>100&&this.queryTimes.shift(),this.metrics.avgResponseTime=this.queryTimes.reduce((o,r)=>o+r,0)/this.queryTimes.length,this.metrics.errorRate=this.errorCount/this.metrics.totalQueries*100,this.metrics.cacheHitRate=this.cacheHits/(this.cacheHits+this.cacheMisses)*100}getMetrics(){return{...this.metrics}}resetMetrics(){this.metrics={connectionCount:0,totalQueries:0,avgResponseTime:0,errorRate:0,cacheHitRate:0,lastMetricsReset:Date.now()},this.queryTimes=[],this.errorCount=0,this.cacheHits=0,this.cacheMisses=0}};n(y,"instance");let z=y,l=null,p=null;const v=(()=>{if(!l){l=b(g,T,{auth:{persistSession:!0,storageKey:"sb.auth.v3.optimized",autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce",debug:!1,storage:{getItem:e=>{try{return localStorage.getItem(e)}catch{return null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch{}},removeItem:e=>{try{localStorage.removeItem(e)}catch{}}}},db:f.db,global:{headers:{"X-Client-Info":"sales-dashboard-v3-optimized","X-Client-Version":"3.0.0","Accept-Encoding":"gzip, deflate, br",Connection:"keep-alive"},fetch:async(e,t)=>{for(let r=0;r<3;r++)try{const a={...t,headers:{...t?.headers,Connection:"keep-alive","Keep-Alive":"timeout=30, max=100"},signal:AbortSignal.timeout(25e3)},s=await fetch(e,a);if(s.ok||s.status>=400&&s.status<500)return s;throw new Error(`HTTP ${s.status}: ${s.statusText}`)}catch(a){if(r===2)throw a;await new Promise(s=>setTimeout(s,1e3*Math.pow(2,r)))}throw new Error("Max retry attempts exceeded")}},realtime:{params:{eventsPerSecond:10},heartbeatIntervalMs:3e4,reconnectAfterMs:e=>Math.min(e*1e3,3e4)}});const i=l.from.bind(l);l.from=e=>{const t=i(e),c=z.getInstance(),o=t.select.bind(t);return t.select=(...r)=>{const a=o(...r),s=a.then?.bind(a);return s&&(a.then=(M,w)=>{const I=performance.now();return s(h=>{const u=performance.now()-I;return c.recordQuery(u,!!h.error),M?.(h)||h},h=>{const u=performance.now()-I;return c.recordQuery(u,!0),w?.(h)||Promise.reject(h)})}),a},t}}return l})(),R=(!p&&d&&(p=b(g,d,{auth:{persistSession:!1,autoRefreshToken:!1,storageKey:"sb.auth.admin.v3"},db:f.db,global:{headers:{"X-Client-Info":"sales-dashboard-admin-v3-optimized",Authorization:`Bearer ${d}`},fetch:f.global.fetch}})),p||v);class A{constructor(){n(this,"cache",new Map),n(this,"maxSize",100)}get(e){const t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}set(e,t,c=3e5){if(this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;this.cache.delete(o)}this.cache.set(e,{data:t,timestamp:Date.now(),ttl:c,queryKey:e})}invalidate(e){for(const[t]of this.cache)t.includes(e)&&this.cache.delete(t)}clear(){this.cache.clear()}getStats(){return{size:this.cache.size,maxSize:this.maxSize,hitRate:z.getInstance().getMetrics().cacheHitRate}}}new A;const J=R;export{J as supabaseAdmin,R as supabaseAdminOptimized,v as supabaseOptimized};
