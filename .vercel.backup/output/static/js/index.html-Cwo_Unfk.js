const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/table-C4c75fDG.js","js/vendor-state-CpjwTZNq.js","js/vendor-react-DoYyFkVR.js","js/vendor-router-CQXjpROx.js","js/vendor-supabase-BuXd-BBn.js","js/vendor-utils-Cb9OXVhE.js","js/ui-radix-core-CdvL28QE.js","js/vendor-icons-HRBKouGg.js","js/ui-animation-Dzb4KUJ1.js","js/vendor-charts-D4YcUEy1.js","js/index-IRLd9rcZ.js","js/Pipeline-D2jE0jRS.js","js/sortable.esm-Dal5CmSK.js","js/EditDealModal-LmzFMvbO.js","js/dialog-BBMx1wit.js","js/input-CeE6qNqI.js","js/label-B9drN7Ag.js","js/ui-forms-D2VzSQqQ.js","js/textarea-C78yVaZk.js","js/avatar-pcXzE_pF.js","js/badge-C6MYiXDB.js","js/card-B2-KTHtJ.js","js/select-BFsZCfaH.js","js/popover-BxJ1Vfi_.js","js/ui-radix-extended-CHWFg20j.js","js/slider-BMvrEO5E.js","js/date-filter-BIFPvFKu.js","js/OwnerFilter-bkhDp6eP.js","js/ChartLoader-C5qHLK1n.js","js/index-CMN_0IMp.js","js/AuditLogViewer-3eVDmxd9.js","js/useAuditLogs-CoIXGfwI.js","js/BulkActivityImport-CzjAGYa9.js","js/alert-DhiZyWgi.js","js/ActivityLog-86luPf7c.js","js/tabs-C3YOVIlH.js","js/vendor-parsing-Di7camYH.js","js/ActivityProcessingPage-CB6W46ue.js","js/Heatmap-C6k8t_u6.js","js/SalesFunnel-BcKu3Dt3.js","js/Profile-BBpRzkv9.js","js/Users-CGYoGBLp.js","js/alert-dialog-Z8L2pxQa.js","js/PipelineSettings-C27Yogpw.js","js/AuditLogs-BwZMEndr.js","js/SmartTasksAdmin-jrwIPl-M.js","js/signup-pPB50Fbe.js","js/forgot-password-7yQEiJ9S.js","js/reset-password-q5OOf1Qj.js","js/PipelinePage-RsqAjjt9.js","js/TasksPage-C15_yeM6.js","js/TaskForm-Bqf2L1Og.js","js/Roadmap-zWcEjyfa.js","js/Releases-6jF2f1gQ.js","js/Clients-B5cZmK1s.js","js/TestFallback-DL2391KY.js","js/MeetingsPage-DldHtPln.js","js/progress-ZbeJO0kq.js","js/DebugMeetings-BK-fRRKx.js","js/ApiTesting-CIY3JNkz.js","js/CRM-BnrcBHtU.js","js/CompaniesTable-BFCo6620.js","js/CRMNavigation-9kApijvP.js","js/ContactsTable-BcgOUcB-.js","js/Admin-BsDGSaah.js","js/Insights-BaZsGlJ8.js","js/CompanyProfile-D7-dvoYh.js","js/ContactRecord-EYkXdPE-.js","js/DealRecord-DvkzLLra.js"])))=>i.map(i=>d[i]);
var Kn=Object.defineProperty;var Zn=(e,t,a)=>t in e?Kn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a;var Ce=(e,t,a)=>Zn(e,typeof t!="symbol"?t+"":t,a);import{j as r,u as jr,a as Xn,b as ca,c as eo,Q as to,d as ao}from"./vendor-state-CpjwTZNq.js";import{d as ro,b as Cr,r as g,a as U,e as $s}from"./vendor-react-DoYyFkVR.js";import{u as Fs,L as lt,a as Ma,R as so,b as ie,N as Te,B as no}from"./vendor-router-CQXjpROx.js";import{_ as te,c as Na}from"./vendor-supabase-BuXd-BBn.js";import{s as we,e as Be,a as rs,b as oo,d as Fe,f as Gt,i as Nr,g as Sr,h as De,j as Ne,k as Fa,l as Xe,m as io,n as Yt,o as lo,p as be,q as Sa,r as co,t as uo,u as mo,v as fo,w as za,x as ss,y as ho,z as zs,A as ka,B as kr,C as Xt,D as po,E as go,F as Us,c as yo,G as vo,H as bo,I as Ua,J as Ba,K as xo,L as wo,M as zt,N as ns}from"./vendor-utils-Cb9OXVhE.js";import{S as _o}from"./ui-radix-core-CdvL28QE.js";import{C as Bs,a as Vs,U as Ve,X as xt,S as jo,M as qs,B as Jt,P as Er,b as os,c as Ws,d as va,e as Qt,A as At,I as Co,T as is,f as ba,F as Ea,g as sr,Z as No,h as So,i as ko,L as nr,j as da,k as Dr,l as Eo,m as Do,K as Mo,n as To,o as Io,H as Po,p as Ao,q as xa,r as ls,s as cs,t as ds,u as Oo,R as Va,v as Ro,w as Lo,x as $o,y as Fo,z as Mr,D as Hs,E as zo,G as Uo,J as Bo,N as Vo}from"./vendor-icons-HRBKouGg.js";import{AnimatePresence as Le,motion as ne,useCycle as qo}from"./ui-animation-Dzb4KUJ1.js";import{ResponsiveContainer as Wo,ComposedChart as Ho,CartesianGrid as Go,XAxis as Yo,YAxis as Jo,Label as Qo,Tooltip as Ko,Legend as Zo,Bar as ua}from"./vendor-charts-D4YcUEy1.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();var or={},us=ro;or.createRoot=us.createRoot,or.hydrateRoot=us.hydrateRoot;var Xo=typeof Element<"u",ei=typeof Map=="function",ti=typeof Set=="function",ai=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function wa(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var a,s,n;if(Array.isArray(e)){if(a=e.length,a!=t.length)return!1;for(s=a;s--!==0;)if(!wa(e[s],t[s]))return!1;return!0}var o;if(ei&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;for(o=e.entries();!(s=o.next()).done;)if(!t.has(s.value[0]))return!1;for(o=e.entries();!(s=o.next()).done;)if(!wa(s.value[1],t.get(s.value[0])))return!1;return!0}if(ti&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;for(o=e.entries();!(s=o.next()).done;)if(!t.has(s.value[0]))return!1;return!0}if(ai&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(a=e.length,a!=t.length)return!1;for(s=a;s--!==0;)if(e[s]!==t[s])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof t.valueOf=="function")return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof t.toString=="function")return e.toString()===t.toString();if(n=Object.keys(e),a=n.length,a!==Object.keys(t).length)return!1;for(s=a;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,n[s]))return!1;if(Xo&&e instanceof Element)return!1;for(s=a;s--!==0;)if(!((n[s]==="_owner"||n[s]==="__v"||n[s]==="__o")&&e.$$typeof)&&!wa(e[n[s]],t[n[s]]))return!1;return!0}return e!==e&&t!==t}var ri=function(t,a){try{return wa(t,a)}catch(s){if((s.message||"").match(/stack|recursion/i))return!1;throw s}};const si=Cr(ri);var ni=function(e,t,a,s,n,o,i,l){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[a,s,n,o,i,l],h=0;c=new Error(t.replace(/%s/g,function(){return d[h++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}},oi=ni;const ms=Cr(oi);var ii=function(t,a,s,n){var o=s?s.call(n,t,a):void 0;if(o!==void 0)return!!o;if(t===a)return!0;if(typeof t!="object"||!t||typeof a!="object"||!a)return!1;var i=Object.keys(t),l=Object.keys(a);if(i.length!==l.length)return!1;for(var c=Object.prototype.hasOwnProperty.bind(a),d=0;d<i.length;d++){var h=i[d];if(!c(h))return!1;var b=t[h],f=a[h];if(o=s?s.call(n,b,f,h):void 0,o===!1||o===void 0&&b!==f)return!1}return!0};const li=Cr(ii);var Gs=(e=>(e.BASE="base",e.BODY="body",e.HEAD="head",e.HTML="html",e.LINK="link",e.META="meta",e.NOSCRIPT="noscript",e.SCRIPT="script",e.STYLE="style",e.TITLE="title",e.FRAGMENT="Symbol(react.fragment)",e))(Gs||{}),qa={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},fs=Object.values(Gs),Tr={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},ci=Object.entries(Tr).reduce((e,[t,a])=>(e[a]=t,e),{}),$e="data-rh",kt={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},Et=(e,t)=>{for(let a=e.length-1;a>=0;a-=1){const s=e[a];if(Object.prototype.hasOwnProperty.call(s,t))return s[t]}return null},di=e=>{let t=Et(e,"title");const a=Et(e,kt.TITLE_TEMPLATE);if(Array.isArray(t)&&(t=t.join("")),a&&t)return a.replace(/%s/g,()=>t);const s=Et(e,kt.DEFAULT_TITLE);return t||s||void 0},ui=e=>Et(e,kt.ON_CHANGE_CLIENT_STATE)||(()=>{}),Wa=(e,t)=>t.filter(a=>typeof a[e]<"u").map(a=>a[e]).reduce((a,s)=>({...a,...s}),{}),mi=(e,t)=>t.filter(a=>typeof a.base<"u").map(a=>a.base).reverse().reduce((a,s)=>{if(!a.length){const n=Object.keys(s);for(let o=0;o<n.length;o+=1){const l=n[o].toLowerCase();if(e.indexOf(l)!==-1&&s[l])return a.concat(s)}}return a},[]),fi=e=>console&&typeof console.warn=="function"&&void 0,Ot=(e,t,a)=>{const s={};return a.filter(n=>Array.isArray(n[e])?!0:(typeof n[e]<"u"&&fi(`Helmet: ${e} should be of type "Array". Instead found type "${typeof n[e]}"`),!1)).map(n=>n[e]).reverse().reduce((n,o)=>{const i={};o.filter(c=>{let d;const h=Object.keys(c);for(let f=0;f<h.length;f+=1){const m=h[f],M=m.toLowerCase();t.indexOf(M)!==-1&&!(d==="rel"&&c[d].toLowerCase()==="canonical")&&!(M==="rel"&&c[M].toLowerCase()==="stylesheet")&&(d=M),t.indexOf(m)!==-1&&(m==="innerHTML"||m==="cssText"||m==="itemprop")&&(d=m)}if(!d||!c[d])return!1;const b=c[d].toLowerCase();return s[d]||(s[d]={}),i[d]||(i[d]={}),s[d][b]?!1:(i[d][b]=!0,!0)}).reverse().forEach(c=>n.push(c));const l=Object.keys(i);for(let c=0;c<l.length;c+=1){const d=l[c],h={...s[d],...i[d]};s[d]=h}return n},[]).reverse()},hi=(e,t)=>{if(Array.isArray(e)&&e.length){for(let a=0;a<e.length;a+=1)if(e[a][t])return!0}return!1},pi=e=>({baseTag:mi(["href"],e),bodyAttributes:Wa("bodyAttributes",e),defer:Et(e,kt.DEFER),encode:Et(e,kt.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:Wa("htmlAttributes",e),linkTags:Ot("link",["rel","href"],e),metaTags:Ot("meta",["name","charset","http-equiv","property","itemprop"],e),noscriptTags:Ot("noscript",["innerHTML"],e),onChangeClientState:ui(e),scriptTags:Ot("script",["src","innerHTML"],e),styleTags:Ot("style",["cssText"],e),title:di(e),titleAttributes:Wa("titleAttributes",e),prioritizeSeoTags:hi(e,kt.PRIORITIZE_SEO_TAGS)}),Ys=e=>Array.isArray(e)?e.join(""):e,gi=(e,t)=>{const a=Object.keys(e);for(let s=0;s<a.length;s+=1)if(t[a[s]]&&t[a[s]].includes(e[a[s]]))return!0;return!1},Ha=(e,t)=>Array.isArray(e)?e.reduce((a,s)=>(gi(s,t)?a.priority.push(s):a.default.push(s),a),{priority:[],default:[]}):{default:e,priority:[]},hs=(e,t)=>({...e,[t]:void 0}),yi=["noscript","script","style"],ir=(e,t=!0)=>t===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),Js=e=>Object.keys(e).reduce((t,a)=>{const s=typeof e[a]<"u"?`${a}="${e[a]}"`:`${a}`;return t?`${t} ${s}`:s},""),vi=(e,t,a,s)=>{const n=Js(a),o=Ys(t);return n?`<${e} ${$e}="true" ${n}>${ir(o,s)}</${e}>`:`<${e} ${$e}="true">${ir(o,s)}</${e}>`},bi=(e,t,a=!0)=>t.reduce((s,n)=>{const o=n,i=Object.keys(o).filter(d=>!(d==="innerHTML"||d==="cssText")).reduce((d,h)=>{const b=typeof o[h]>"u"?h:`${h}="${ir(o[h],a)}"`;return d?`${d} ${b}`:b},""),l=o.innerHTML||o.cssText||"",c=yi.indexOf(e)===-1;return`${s}<${e} ${$e}="true" ${i}${c?"/>":`>${l}</${e}>`}`},""),Qs=(e,t={})=>Object.keys(e).reduce((a,s)=>{const n=Tr[s];return a[n||s]=e[s],a},t),xi=(e,t,a)=>{const s={key:t,[$e]:!0},n=Qs(a,s);return[U.createElement("title",n,t)]},_a=(e,t)=>t.map((a,s)=>{const n={key:s,[$e]:!0};return Object.keys(a).forEach(o=>{const l=Tr[o]||o;if(l==="innerHTML"||l==="cssText"){const c=a.innerHTML||a.cssText;n.dangerouslySetInnerHTML={__html:c}}else n[l]=a[o]}),U.createElement(e,n)}),Ie=(e,t,a=!0)=>{switch(e){case"title":return{toComponent:()=>xi(e,t.title,t.titleAttributes),toString:()=>vi(e,t.title,t.titleAttributes,a)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>Qs(t),toString:()=>Js(t)};default:return{toComponent:()=>_a(e,t),toString:()=>bi(e,t,a)}}},wi=({metaTags:e,linkTags:t,scriptTags:a,encode:s})=>{const n=Ha(e,qa.meta),o=Ha(t,qa.link),i=Ha(a,qa.script);return{priorityMethods:{toComponent:()=>[..._a("meta",n.priority),..._a("link",o.priority),..._a("script",i.priority)],toString:()=>`${Ie("meta",n.priority,s)} ${Ie("link",o.priority,s)} ${Ie("script",i.priority,s)}`},metaTags:n.default,linkTags:o.default,scriptTags:i.default}},_i=e=>{const{baseTag:t,bodyAttributes:a,encode:s=!0,htmlAttributes:n,noscriptTags:o,styleTags:i,title:l="",titleAttributes:c,prioritizeSeoTags:d}=e;let{linkTags:h,metaTags:b,scriptTags:f}=e,m={toComponent:()=>{},toString:()=>""};return d&&({priorityMethods:m,linkTags:h,metaTags:b,scriptTags:f}=wi(e)),{priority:m,base:Ie("base",t,s),bodyAttributes:Ie("bodyAttributes",a,s),htmlAttributes:Ie("htmlAttributes",n,s),link:Ie("link",h,s),meta:Ie("meta",b,s),noscript:Ie("noscript",o,s),script:Ie("script",f,s),style:Ie("style",i,s),title:Ie("title",{title:l,titleAttributes:c},s)}},lr=_i,ma=[],Ks=!!(typeof window<"u"&&window.document&&window.document.createElement),cr=class{constructor(e,t){Ce(this,"instances",[]);Ce(this,"canUseDOM",Ks);Ce(this,"context");Ce(this,"value",{setHelmet:e=>{this.context.helmet=e},helmetInstances:{get:()=>this.canUseDOM?ma:this.instances,add:e=>{(this.canUseDOM?ma:this.instances).push(e)},remove:e=>{const t=(this.canUseDOM?ma:this.instances).indexOf(e);(this.canUseDOM?ma:this.instances).splice(t,1)}}});this.context=e,this.canUseDOM=t||!1,t||(e.helmet=lr({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},ji={},Zs=U.createContext(ji),vt,Xs=(vt=class extends g.Component{constructor(a){super(a);Ce(this,"helmetData");this.helmetData=new cr(this.props.context||{},vt.canUseDOM)}render(){return U.createElement(Zs.Provider,{value:this.helmetData.value},this.props.children)}},Ce(vt,"canUseDOM",Ks),vt),jt=(e,t)=>{const a=document.head||document.querySelector("head"),s=a.querySelectorAll(`${e}[${$e}]`),n=[].slice.call(s),o=[];let i;return t&&t.length&&t.forEach(l=>{const c=document.createElement(e);for(const d in l)if(Object.prototype.hasOwnProperty.call(l,d))if(d==="innerHTML")c.innerHTML=l.innerHTML;else if(d==="cssText")c.styleSheet?c.styleSheet.cssText=l.cssText:c.appendChild(document.createTextNode(l.cssText));else{const h=d,b=typeof l[h]>"u"?"":l[h];c.setAttribute(d,b)}c.setAttribute($e,"true"),n.some((d,h)=>(i=h,c.isEqualNode(d)))?n.splice(i,1):o.push(c)}),n.forEach(l=>l.parentNode?.removeChild(l)),o.forEach(l=>a.appendChild(l)),{oldTags:n,newTags:o}},dr=(e,t)=>{const a=document.getElementsByTagName(e)[0];if(!a)return;const s=a.getAttribute($e),n=s?s.split(","):[],o=[...n],i=Object.keys(t);for(const l of i){const c=t[l]||"";a.getAttribute(l)!==c&&a.setAttribute(l,c),n.indexOf(l)===-1&&n.push(l);const d=o.indexOf(l);d!==-1&&o.splice(d,1)}for(let l=o.length-1;l>=0;l-=1)a.removeAttribute(o[l]);n.length===o.length?a.removeAttribute($e):a.getAttribute($e)!==i.join(",")&&a.setAttribute($e,i.join(","))},Ci=(e,t)=>{typeof e<"u"&&document.title!==e&&(document.title=Ys(e)),dr("title",t)},ps=(e,t)=>{const{baseTag:a,bodyAttributes:s,htmlAttributes:n,linkTags:o,metaTags:i,noscriptTags:l,onChangeClientState:c,scriptTags:d,styleTags:h,title:b,titleAttributes:f}=e;dr("body",s),dr("html",n),Ci(b,f);const m={baseTag:jt("base",a),linkTags:jt("link",o),metaTags:jt("meta",i),noscriptTags:jt("noscript",l),scriptTags:jt("script",d),styleTags:jt("style",h)},M={},x={};Object.keys(m).forEach(u=>{const{newTags:p,oldTags:k}=m[u];p.length&&(M[u]=p),k.length&&(x[u]=m[u].oldTags)}),t&&t(),c(e,M,x)},Rt=null,Ni=e=>{Rt&&cancelAnimationFrame(Rt),e.defer?Rt=requestAnimationFrame(()=>{ps(e,()=>{Rt=null})}):(ps(e),Rt=null)},Si=Ni,gs=class extends g.Component{constructor(){super(...arguments);Ce(this,"rendered",!1)}shouldComponentUpdate(t){return!li(t,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:t}=this.props.context;t.remove(this),this.emitChange()}emitChange(){const{helmetInstances:t,setHelmet:a}=this.props.context;let s=null;const n=pi(t.get().map(o=>{const i={...o.props};return delete i.context,i}));Xs.canUseDOM?Si(n):lr&&(s=lr(n)),a(s)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:t}=this.props.context;t.add(this),this.emitChange()}render(){return this.init(),null}},rr,_m=(rr=class extends g.Component{shouldComponentUpdate(e){return!si(hs(this.props,"helmetData"),hs(e,"helmetData"))}mapNestedChildrenToProps(e,t){if(!t)return null;switch(e.type){case"script":case"noscript":return{innerHTML:t};case"style":return{cssText:t};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,t,a,s){return{...t,[e.type]:[...t[e.type]||[],{...a,...this.mapNestedChildrenToProps(e,s)}]}}mapObjectTypeChildren(e,t,a,s){switch(e.type){case"title":return{...t,[e.type]:s,titleAttributes:{...a}};case"body":return{...t,bodyAttributes:{...a}};case"html":return{...t,htmlAttributes:{...a}};default:return{...t,[e.type]:{...a}}}}mapArrayTypeChildrenToProps(e,t){let a={...t};return Object.keys(e).forEach(s=>{a={...a,[s]:e[s]}}),a}warnOnInvalidChildren(e,t){return ms(fs.some(a=>e.type===a),typeof e.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${fs.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),ms(!t||typeof t=="string"||Array.isArray(t)&&!t.some(a=>typeof a!="string"),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,t){let a={};return U.Children.forEach(e,s=>{if(!s||!s.props)return;const{children:n,...o}=s.props,i=Object.keys(o).reduce((c,d)=>(c[ci[d]||d]=o[d],c),{});let{type:l}=s;switch(typeof l=="symbol"?l=l.toString():this.warnOnInvalidChildren(s,n),l){case"Symbol(react.fragment)":t=this.mapChildrenToProps(n,t);break;case"link":case"meta":case"noscript":case"script":case"style":a=this.flattenArrayTypeChildren(s,a,i,n);break;default:t=this.mapObjectTypeChildren(s,t,i,n);break}}),this.mapArrayTypeChildrenToProps(a,t)}render(){const{children:e,...t}=this.props;let a={...t},{helmetData:s}=t;if(e&&(a=this.mapChildrenToProps(e,a)),s&&!(s instanceof cr)){const n=s;s=new cr(n.context,!0),delete a.helmetData}return s?U.createElement(gs,{...a,context:s.value}):U.createElement(Zs.Consumer,null,n=>U.createElement(gs,{...a,context:n}))}},Ce(rr,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),rr),ki=e=>{switch(e){case"success":return Mi;case"info":return Ii;case"warning":return Ti;case"error":return Pi;default:return null}},Ei=Array(12).fill(0),Di=({visible:e,className:t})=>U.createElement("div",{className:["sonner-loading-wrapper",t].filter(Boolean).join(" "),"data-visible":e},U.createElement("div",{className:"sonner-spinner"},Ei.map((a,s)=>U.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${s}`})))),Mi=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),Ti=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),Ii=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),Pi=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},U.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ai=U.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},U.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),U.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Oi=()=>{let[e,t]=U.useState(document.hidden);return U.useEffect(()=>{let a=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",a),()=>window.removeEventListener("visibilitychange",a)},[]),e},ur=1,Ri=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:a,...s}=e,n=typeof e?.id=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:ur++,o=this.toasts.find(l=>l.id===n),i=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(n)&&this.dismissedToasts.delete(n),o?this.toasts=this.toasts.map(l=>l.id===n?(this.publish({...l,...e,id:n,title:a}),{...l,...e,id:n,dismissible:i,title:a}):l):this.addToast({title:a,...s,dismissible:i,id:n}),n},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(t=>{this.subscribers.forEach(a=>a({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let a;t.loading!==void 0&&(a=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let s=e instanceof Promise?e:e(),n=a!==void 0,o,i=s.then(async c=>{if(o=["resolve",c],U.isValidElement(c))n=!1,this.create({id:a,type:"default",message:c});else if($i(c)&&!c.ok){n=!1;let d=typeof t.error=="function"?await t.error(`HTTP error! status: ${c.status}`):t.error,h=typeof t.description=="function"?await t.description(`HTTP error! status: ${c.status}`):t.description;this.create({id:a,type:"error",message:d,description:h})}else if(t.success!==void 0){n=!1;let d=typeof t.success=="function"?await t.success(c):t.success,h=typeof t.description=="function"?await t.description(c):t.description;this.create({id:a,type:"success",message:d,description:h})}}).catch(async c=>{if(o=["reject",c],t.error!==void 0){n=!1;let d=typeof t.error=="function"?await t.error(c):t.error,h=typeof t.description=="function"?await t.description(c):t.description;this.create({id:a,type:"error",message:d,description:h})}}).finally(()=>{var c;n&&(this.dismiss(a),a=void 0),(c=t.finally)==null||c.call(t)}),l=()=>new Promise((c,d)=>i.then(()=>o[0]==="reject"?d(o[1]):c(o[1])).catch(d));return typeof a!="string"&&typeof a!="number"?{unwrap:l}:Object.assign(a,{unwrap:l})},this.custom=(e,t)=>{let a=t?.id||ur++;return this.create({jsx:e(a),id:a,...t}),a},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ee=new Ri,Li=(e,t)=>{let a=t?.id||ur++;return Ee.addToast({title:e,...t,id:a}),a},$i=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",Fi=Li,zi=()=>Ee.toasts,Ui=()=>Ee.getActiveToasts(),L=Object.assign(Fi,{success:Ee.success,info:Ee.info,warning:Ee.warning,error:Ee.error,custom:Ee.custom,message:Ee.message,promise:Ee.promise,dismiss:Ee.dismiss,loading:Ee.loading},{getHistory:zi,getToasts:Ui});function Bi(e,{insertAt:t}={}){if(typeof document>"u")return;let a=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",t==="top"&&a.firstChild?a.insertBefore(s,a.firstChild):a.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}Bi(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function fa(e){return e.label!==void 0}var Vi=3,qi="32px",Wi="16px",ys=4e3,Hi=356,Gi=14,Yi=20,Ji=200;function Re(...e){return e.filter(Boolean).join(" ")}function Qi(e){let[t,a]=e.split("-"),s=[];return t&&s.push(t),a&&s.push(a),s}var Ki=e=>{var t,a,s,n,o,i,l,c,d,h,b;let{invert:f,toast:m,unstyled:M,interacting:x,setHeights:u,visibleToasts:p,heights:k,index:I,toasts:T,expanded:_,removeToast:S,defaultRichColors:N,closeButton:A,style:D,cancelButtonStyle:j,actionButtonStyle:y,className:O="",descriptionClassName:G="",duration:Q,position:ae,gap:de,loadingIcon:W,expandByDefault:P,classNames:z,icons:E,closeButtonAriaLabel:w="Close toast",pauseWhenPageIsHidden:F}=e,[V,q]=U.useState(null),[C,$]=U.useState(null),[B,H]=U.useState(!1),[Y,J]=U.useState(!1),[K,oe]=U.useState(!1),[re,X]=U.useState(!1),[ue,fe]=U.useState(!1),[_e,xe]=U.useState(0),[Je,Me]=U.useState(0),mt=U.useRef(m.duration||Q||ys),na=U.useRef(null),Qe=U.useRef(null),oa=I===0,Ra=I+1<=p,ke=m.type,et=m.dismissible!==!1,La=m.className||"",ia=m.descriptionClassName||"",ft=U.useMemo(()=>k.findIndex(ee=>ee.toastId===m.id)||0,[k,m.id]),It=U.useMemo(()=>{var ee;return(ee=m.closeButton)!=null?ee:A},[m.closeButton,A]),la=U.useMemo(()=>m.duration||Q||ys,[m.duration,Q]),Pt=U.useRef(0),wt=U.useRef(0),es=U.useRef(0),_t=U.useRef(null),[Gn,Yn]=ae.split("-"),ts=U.useMemo(()=>k.reduce((ee,me,ve)=>ve>=ft?ee:ee+me.height,0),[k,ft]),as=Oi(),Jn=m.invert||f,$a=ke==="loading";wt.current=U.useMemo(()=>ft*de+ts,[ft,ts]),U.useEffect(()=>{mt.current=la},[la]),U.useEffect(()=>{H(!0)},[]),U.useEffect(()=>{let ee=Qe.current;if(ee){let me=ee.getBoundingClientRect().height;return Me(me),u(ve=>[{toastId:m.id,height:me,position:m.position},...ve]),()=>u(ve=>ve.filter(Pe=>Pe.toastId!==m.id))}},[u,m.id]),U.useLayoutEffect(()=>{if(!B)return;let ee=Qe.current,me=ee.style.height;ee.style.height="auto";let ve=ee.getBoundingClientRect().height;ee.style.height=me,Me(ve),u(Pe=>Pe.find(Ae=>Ae.toastId===m.id)?Pe.map(Ae=>Ae.toastId===m.id?{...Ae,height:ve}:Ae):[{toastId:m.id,height:ve,position:m.position},...Pe])},[B,m.title,m.description,u,m.id]);let tt=U.useCallback(()=>{J(!0),xe(wt.current),u(ee=>ee.filter(me=>me.toastId!==m.id)),setTimeout(()=>{S(m)},Ji)},[m,S,u,wt]);U.useEffect(()=>{if(m.promise&&ke==="loading"||m.duration===1/0||m.type==="loading")return;let ee;return _||x||F&&as?(()=>{if(es.current<Pt.current){let me=new Date().getTime()-Pt.current;mt.current=mt.current-me}es.current=new Date().getTime()})():mt.current!==1/0&&(Pt.current=new Date().getTime(),ee=setTimeout(()=>{var me;(me=m.onAutoClose)==null||me.call(m,m),tt()},mt.current)),()=>clearTimeout(ee)},[_,x,m,ke,F,as,tt]),U.useEffect(()=>{m.delete&&tt()},[tt,m.delete]);function Qn(){var ee,me,ve;return E!=null&&E.loading?U.createElement("div",{className:Re(z?.loader,(ee=m?.classNames)==null?void 0:ee.loader,"sonner-loader"),"data-visible":ke==="loading"},E.loading):W?U.createElement("div",{className:Re(z?.loader,(me=m?.classNames)==null?void 0:me.loader,"sonner-loader"),"data-visible":ke==="loading"},W):U.createElement(Di,{className:Re(z?.loader,(ve=m?.classNames)==null?void 0:ve.loader),visible:ke==="loading"})}return U.createElement("li",{tabIndex:0,ref:Qe,className:Re(O,La,z?.toast,(t=m?.classNames)==null?void 0:t.toast,z?.default,z?.[ke],(a=m?.classNames)==null?void 0:a[ke]),"data-sonner-toast":"","data-rich-colors":(s=m.richColors)!=null?s:N,"data-styled":!(m.jsx||m.unstyled||M),"data-mounted":B,"data-promise":!!m.promise,"data-swiped":ue,"data-removed":Y,"data-visible":Ra,"data-y-position":Gn,"data-x-position":Yn,"data-index":I,"data-front":oa,"data-swiping":K,"data-dismissible":et,"data-type":ke,"data-invert":Jn,"data-swipe-out":re,"data-swipe-direction":C,"data-expanded":!!(_||P&&B),style:{"--index":I,"--toasts-before":I,"--z-index":T.length-I,"--offset":`${Y?_e:wt.current}px`,"--initial-height":P?"auto":`${Je}px`,...D,...m.style},onDragEnd:()=>{oe(!1),q(null),_t.current=null},onPointerDown:ee=>{$a||!et||(na.current=new Date,xe(wt.current),ee.target.setPointerCapture(ee.pointerId),ee.target.tagName!=="BUTTON"&&(oe(!0),_t.current={x:ee.clientX,y:ee.clientY}))},onPointerUp:()=>{var ee,me,ve,Pe;if(re||!et)return;_t.current=null;let Ae=Number(((ee=Qe.current)==null?void 0:ee.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),at=Number(((me=Qe.current)==null?void 0:me.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ht=new Date().getTime()-((ve=na.current)==null?void 0:ve.getTime()),Oe=V==="x"?Ae:at,rt=Math.abs(Oe)/ht;if(Math.abs(Oe)>=Yi||rt>.11){xe(wt.current),(Pe=m.onDismiss)==null||Pe.call(m,m),$(V==="x"?Ae>0?"right":"left":at>0?"down":"up"),tt(),X(!0),fe(!1);return}oe(!1),q(null)},onPointerMove:ee=>{var me,ve,Pe,Ae;if(!_t.current||!et||((me=window.getSelection())==null?void 0:me.toString().length)>0)return;let at=ee.clientY-_t.current.y,ht=ee.clientX-_t.current.x,Oe=(ve=e.swipeDirections)!=null?ve:Qi(ae);!V&&(Math.abs(ht)>1||Math.abs(at)>1)&&q(Math.abs(ht)>Math.abs(at)?"x":"y");let rt={x:0,y:0};V==="y"?(Oe.includes("top")||Oe.includes("bottom"))&&(Oe.includes("top")&&at<0||Oe.includes("bottom")&&at>0)&&(rt.y=at):V==="x"&&(Oe.includes("left")||Oe.includes("right"))&&(Oe.includes("left")&&ht<0||Oe.includes("right")&&ht>0)&&(rt.x=ht),(Math.abs(rt.x)>0||Math.abs(rt.y)>0)&&fe(!0),(Pe=Qe.current)==null||Pe.style.setProperty("--swipe-amount-x",`${rt.x}px`),(Ae=Qe.current)==null||Ae.style.setProperty("--swipe-amount-y",`${rt.y}px`)}},It&&!m.jsx?U.createElement("button",{"aria-label":w,"data-disabled":$a,"data-close-button":!0,onClick:$a||!et?()=>{}:()=>{var ee;tt(),(ee=m.onDismiss)==null||ee.call(m,m)},className:Re(z?.closeButton,(n=m?.classNames)==null?void 0:n.closeButton)},(o=E?.close)!=null?o:Ai):null,m.jsx||g.isValidElement(m.title)?m.jsx?m.jsx:typeof m.title=="function"?m.title():m.title:U.createElement(U.Fragment,null,ke||m.icon||m.promise?U.createElement("div",{"data-icon":"",className:Re(z?.icon,(i=m?.classNames)==null?void 0:i.icon)},m.promise||m.type==="loading"&&!m.icon?m.icon||Qn():null,m.type!=="loading"?m.icon||E?.[ke]||ki(ke):null):null,U.createElement("div",{"data-content":"",className:Re(z?.content,(l=m?.classNames)==null?void 0:l.content)},U.createElement("div",{"data-title":"",className:Re(z?.title,(c=m?.classNames)==null?void 0:c.title)},typeof m.title=="function"?m.title():m.title),m.description?U.createElement("div",{"data-description":"",className:Re(G,ia,z?.description,(d=m?.classNames)==null?void 0:d.description)},typeof m.description=="function"?m.description():m.description):null),g.isValidElement(m.cancel)?m.cancel:m.cancel&&fa(m.cancel)?U.createElement("button",{"data-button":!0,"data-cancel":!0,style:m.cancelButtonStyle||j,onClick:ee=>{var me,ve;fa(m.cancel)&&et&&((ve=(me=m.cancel).onClick)==null||ve.call(me,ee),tt())},className:Re(z?.cancelButton,(h=m?.classNames)==null?void 0:h.cancelButton)},m.cancel.label):null,g.isValidElement(m.action)?m.action:m.action&&fa(m.action)?U.createElement("button",{"data-button":!0,"data-action":!0,style:m.actionButtonStyle||y,onClick:ee=>{var me,ve;fa(m.action)&&((ve=(me=m.action).onClick)==null||ve.call(me,ee),!ee.defaultPrevented&&tt())},className:Re(z?.actionButton,(b=m?.classNames)==null?void 0:b.actionButton)},m.action.label):null))};function vs(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Zi(e,t){let a={};return[e,t].forEach((s,n)=>{let o=n===1,i=o?"--mobile-offset":"--offset",l=o?Wi:qi;function c(d){["top","right","bottom","left"].forEach(h=>{a[`${i}-${h}`]=typeof d=="number"?`${d}px`:d})}typeof s=="number"||typeof s=="string"?c(s):typeof s=="object"?["top","right","bottom","left"].forEach(d=>{s[d]===void 0?a[`${i}-${d}`]=l:a[`${i}-${d}`]=typeof s[d]=="number"?`${s[d]}px`:s[d]}):c(l)}),a}var Xi=g.forwardRef(function(e,t){let{invert:a,position:s="bottom-right",hotkey:n=["altKey","KeyT"],expand:o,closeButton:i,className:l,offset:c,mobileOffset:d,theme:h="light",richColors:b,duration:f,style:m,visibleToasts:M=Vi,toastOptions:x,dir:u=vs(),gap:p=Gi,loadingIcon:k,icons:I,containerAriaLabel:T="Notifications",pauseWhenPageIsHidden:_}=e,[S,N]=U.useState([]),A=U.useMemo(()=>Array.from(new Set([s].concat(S.filter(F=>F.position).map(F=>F.position)))),[S,s]),[D,j]=U.useState([]),[y,O]=U.useState(!1),[G,Q]=U.useState(!1),[ae,de]=U.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),W=U.useRef(null),P=n.join("+").replace(/Key/g,"").replace(/Digit/g,""),z=U.useRef(null),E=U.useRef(!1),w=U.useCallback(F=>{N(V=>{var q;return(q=V.find(C=>C.id===F.id))!=null&&q.delete||Ee.dismiss(F.id),V.filter(({id:C})=>C!==F.id)})},[]);return U.useEffect(()=>Ee.subscribe(F=>{if(F.dismiss){N(V=>V.map(q=>q.id===F.id?{...q,delete:!0}:q));return}setTimeout(()=>{$s.flushSync(()=>{N(V=>{let q=V.findIndex(C=>C.id===F.id);return q!==-1?[...V.slice(0,q),{...V[q],...F},...V.slice(q+1)]:[F,...V]})})})}),[]),U.useEffect(()=>{if(h!=="system"){de(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?de("dark"):de("light")),typeof window>"u")return;let F=window.matchMedia("(prefers-color-scheme: dark)");try{F.addEventListener("change",({matches:V})=>{de(V?"dark":"light")})}catch{F.addListener(({matches:q})=>{try{de(q?"dark":"light")}catch{}})}},[h]),U.useEffect(()=>{S.length<=1&&O(!1)},[S]),U.useEffect(()=>{let F=V=>{var q,C;n.every($=>V[$]||V.code===$)&&(O(!0),(q=W.current)==null||q.focus()),V.code==="Escape"&&(document.activeElement===W.current||(C=W.current)!=null&&C.contains(document.activeElement))&&O(!1)};return document.addEventListener("keydown",F),()=>document.removeEventListener("keydown",F)},[n]),U.useEffect(()=>{if(W.current)return()=>{z.current&&(z.current.focus({preventScroll:!0}),z.current=null,E.current=!1)}},[W.current]),U.createElement("section",{ref:t,"aria-label":`${T} ${P}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},A.map((F,V)=>{var q;let[C,$]=F.split("-");return S.length?U.createElement("ol",{key:F,dir:u==="auto"?vs():u,tabIndex:-1,ref:W,className:l,"data-sonner-toaster":!0,"data-theme":ae,"data-y-position":C,"data-lifted":y&&S.length>1&&!o,"data-x-position":$,style:{"--front-toast-height":`${((q=D[0])==null?void 0:q.height)||0}px`,"--width":`${Hi}px`,"--gap":`${p}px`,...m,...Zi(c,d)},onBlur:B=>{E.current&&!B.currentTarget.contains(B.relatedTarget)&&(E.current=!1,z.current&&(z.current.focus({preventScroll:!0}),z.current=null))},onFocus:B=>{B.target instanceof HTMLElement&&B.target.dataset.dismissible==="false"||E.current||(E.current=!0,z.current=B.relatedTarget)},onMouseEnter:()=>O(!0),onMouseMove:()=>O(!0),onMouseLeave:()=>{G||O(!1)},onDragEnd:()=>O(!1),onPointerDown:B=>{B.target instanceof HTMLElement&&B.target.dataset.dismissible==="false"||Q(!0)},onPointerUp:()=>Q(!1)},S.filter(B=>!B.position&&V===0||B.position===F).map((B,H)=>{var Y,J;return U.createElement(Ki,{key:B.id,icons:I,index:H,toast:B,defaultRichColors:b,duration:(Y=x?.duration)!=null?Y:f,className:x?.className,descriptionClassName:x?.descriptionClassName,invert:a,visibleToasts:M,closeButton:(J=x?.closeButton)!=null?J:i,interacting:G,position:F,style:x?.style,unstyled:x?.unstyled,classNames:x?.classNames,cancelButtonStyle:x?.cancelButtonStyle,actionButtonStyle:x?.actionButtonStyle,removeToast:w,toasts:S.filter(K=>K.position==B.position),heights:D.filter(K=>K.position==B.position),setHeights:j,expandByDefault:o,gap:p,loadingIcon:k,expanded:y,pauseWhenPageIsHidden:_,swipeDirections:e.swipeDirections})})):null}))});function el({...e}){return r.jsx(Xi,{position:"top-right",className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})}const v={log:(...e)=>{},warn:(...e)=>{},error:(...e)=>{},info:(...e)=>{},debug:(...e)=>{},table:e=>{},time:e=>{},timeEnd:e=>{}},tl={maxRetries:3,retryDelay:1e3,backoff:!0,showToast:!0};async function ct(){const e="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8",t={"Content-Type":"application/json",apikey:e};try{const{supabase:a}=await te(async()=>{const{supabase:o}=await Promise.resolve().then(()=>nn);return{supabase:o}},void 0),{data:{session:s},error:n}=await a.auth.getSession();n?v.warn("Error getting auth session:",n):s?.access_token?(t.Authorization=`Bearer ${s.access_token}`,v.log(" Using authenticated session for API calls")):(v.warn("No active session found. Some features may require authentication."),t.Authorization=`Bearer ${e}`)}catch{t.Authorization=`Bearer ${e}`}return t}async function en(e,t={},a={}){const s={...tl,...a};let n;for(let o=0;o<=s.maxRetries;o++)try{const i=await fetch(e,t);if(i.status===401){const l=new Error("Authentication required. Please log in.");throw l.name="AuthenticationError",l}if(!i.ok)throw new Error(`Server error: ${i.status}`);if(i.ok)return o>0&&s.showToast&&L.success("Connection restored!"),i;throw i.status>=400&&i.status<500?new Error(`Client error: ${i.status} ${i.statusText}`):new Error(`Server error: ${i.status} ${i.statusText}`)}catch(i){if(n=i,i instanceof Error&&i.name==="AuthenticationError")throw v.error("Authentication error:",i.message),L.error("Please log in to access this feature"),i;if(i instanceof TypeError&&i.message.includes("Failed to fetch")&&(v.warn(`API request failed (attempt ${o+1}/${s.maxRetries+1}), retrying in ${s.retryDelay*Math.pow(2,o)}ms:`,i.message),o<s.maxRetries)){await new Promise(c=>setTimeout(c,s.retryDelay*Math.pow(2,o)));continue}o===0&&s.showToast&&L.warning(" Connection issue detected. Retrying...");const l=s.backoff?s.retryDelay*Math.pow(2,o):s.retryDelay;v.warn(`API request failed (attempt ${o+1}/${s.maxRetries+1}), retrying in ${l}ms:`,i.message),await new Promise(c=>setTimeout(c,l))}throw n}async function Ue(e,t={},a={}){const s=await ct(),o=await(await en(e,{headers:{...s,...t.headers},...t},a)).json();if(o.error)throw new Error(o.error);return o.data||o}async function al(e){if(e==="/api")return!0;try{const t=await en(`${e}/health`,{headers:await ct()},{maxRetries:1,showToast:!1});return t.ok?(await t.json()).status==="healthy":!1}catch{return!1}}function rl(e,t=3e4){let a=!0,s;const n=async()=>{const l=await al(e);l!==a&&(a=l,l?L.success(" API connection restored"):L.error(" API connection lost - Please check Supabase status"))};return{start:()=>{s=setInterval(n,t),n()},stop:()=>{s&&clearInterval(s)},checkHealth:n}}const tn=typeof window<"u",sl=tn?window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1":!1;tn&&window.location.hostname.includes("vercel.app");const Kt=!1,pe=`${"https://ewtuefzeogytgmsnkpmb.supabase.co".replace("/rest/v1","")}/functions/v1`;var nl=Object.defineProperty,ol=(e,t,a)=>t in e?nl(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,it=(e,t,a)=>ol(e,typeof t!="symbol"?t+"":t,a);const an=class Ut{constructor(){it(this,"metrics",[]),it(this,"componentMetrics",[]),it(this,"apiMetrics",[]),it(this,"observers",[]),it(this,"isEnabled",!0),it(this,"memoryInterval",null),it(this,"PERFORMANCE_BUDGETS",{LCP:2500,FID:100,CLS:.1,FCP:1800,TTFB:800,RENDER:16,API:1e3}),typeof window<"u"&&(this.initializeWebVitals(),this.initializeNavigationObserver(),this.initializeMemoryMonitoring(),this.startBundleSizeTracking())}static getInstance(){return Ut.instance||(Ut.instance=new Ut),Ut.instance}initializeWebVitals(){this.trackWebVital("LCP",this.PERFORMANCE_BUDGETS.LCP),this.trackWebVital("FID",this.PERFORMANCE_BUDGETS.FID),this.trackWebVital("CLS",this.PERFORMANCE_BUDGETS.CLS),this.trackWebVital("FCP",this.PERFORMANCE_BUDGETS.FCP),this.trackWebVital("TTFB",this.PERFORMANCE_BUDGETS.TTFB)}trackWebVital(t,a){"web-vitals"in window?this.loadWebVitalsLibrary().then(()=>{const n=window.webVitals[`get${t}`];n&&n(o=>{this.recordWebVital(o,a)})}):this.trackWebVitalNative(t,a)}async loadWebVitalsLibrary(){if(!("webVitals"in window))try{const t=await te(()=>Promise.resolve().then(()=>wu),void 0);window.webVitals=t}catch{}}trackWebVitalNative(t,a){if("PerformanceObserver"in window)try{const s=new PerformanceObserver(n=>{n.getEntries().forEach(i=>{if(i.entryType==="largest-contentful-paint"&&t==="LCP")this.recordMetric("lcp",i.startTime,a);else if(i.entryType==="first-input"&&t==="FID"){const l=i;this.recordMetric("fid",l.processingStart-l.startTime,a)}else if(i.entryType==="layout-shift"&&t==="CLS"){const l=i;l.hadRecentInput||this.recordMetric("cls",l.value,a)}})});switch(t){case"LCP":s.observe({entryTypes:["largest-contentful-paint"]});break;case"FID":s.observe({entryTypes:["first-input"]});break;case"CLS":s.observe({entryTypes:["layout-shift"]});break}this.observers.push(s)}catch{}}recordWebVital(t,a){const s=t.value<=a;v.log(` ${t.name}: ${t.value}ms (Budget: ${a}ms) - ${s?" GOOD":" NEEDS IMPROVEMENT"}`);const n=this.getCurrentMetrics();n[t.name.toLowerCase()]=t.value,this.sendToAnalytics("web-vital",{metric:t.name,value:t.value,rating:t.rating,budget:a,withinBudget:s})}recordMetric(t,a,s){const n=a<=s;v.log(` ${t.toUpperCase()}: ${a}ms (Budget: ${s}ms) - ${n?" GOOD":" NEEDS IMPROVEMENT"}`);const o=this.getCurrentMetrics();o[t]=a}initializeNavigationObserver(){if("PerformanceObserver"in window)try{const t=new PerformanceObserver(a=>{a.getEntries().forEach(n=>{if(n.entryType==="navigation"){const o=n;this.recordNavigationMetrics(o)}})});t.observe({entryTypes:["navigation"]}),this.observers.push(t)}catch{}}recordNavigationMetrics(t){const a=t.responseStart-t.requestStart,s=t.domContentLoadedEventEnd-t.domContentLoadedEventStart,n=t.loadEventEnd-t.loadEventStart;v.log(" Navigation Metrics:",{TTFB:`${a.toFixed(2)}ms`,"DOM Content Loaded":`${s.toFixed(2)}ms`,"Load Complete":`${n.toFixed(2)}ms`});const o=this.getCurrentMetrics();o.ttfb=a}initializeMemoryMonitoring(){"memory"in performance&&(this.memoryInterval&&clearInterval(this.memoryInterval),this.memoryInterval=setInterval(()=>{if(!this.isEnabled)return;const t=performance.memory;if(t){const a=t.usedJSHeapSize,s=t.totalJSHeapSize,n=a/s*100;n>80&&v.warn(` High memory usage: ${n.toFixed(1)}%`);const o=this.getCurrentMetrics();o.memoryUsage=a/1024/1024}},3e4))}startBundleSizeTracking(){if("PerformanceObserver"in window)try{const t=new PerformanceObserver(a=>{const s=a.getEntries();let n=0;if(s.forEach(o=>{(o.name.includes(".js")||o.name.includes(".css"))&&(n+=o.transferSize||0)}),n>0){const o=this.getCurrentMetrics();o.bundleSize=n/1024,n>512e3&&v.warn(` Large bundle size: ${(n/1024/1024).toFixed(2)}MB`)}});t.observe({entryTypes:["resource"]}),this.observers.push(t)}catch{}}trackComponentRender(t,a,s=0){if(!this.isEnabled)return;const n={componentName:t,renderTime:a,propsCount:s,reRenderCount:this.getComponentReRenderCount(t),timestamp:Date.now()};this.componentMetrics.push(n),a>this.PERFORMANCE_BUDGETS.RENDER&&v.warn(` Slow render: ${t} took ${a.toFixed(2)}ms`),this.componentMetrics.length>100&&(this.componentMetrics=this.componentMetrics.slice(-50))}trackAPICall(t,a,s,n,o){if(!this.isEnabled)return;const i={endpoint:t,method:a,responseTime:s,status:n,size:o,timestamp:Date.now()};this.apiMetrics.push(i),s>this.PERFORMANCE_BUDGETS.API,this.apiMetrics.length>100&&(this.apiMetrics=this.apiMetrics.slice(-50))}getComponentReRenderCount(t){return this.componentMetrics.filter(a=>a.componentName===t).length}getCurrentMetrics(){const t=this.metrics[this.metrics.length-1];if(t&&Date.now()-t.timestamp<5e3)return t;const a={timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent};return this.metrics.push(a),this.metrics.length>20&&(this.metrics=this.metrics.slice(-10)),a}sendToAnalytics(t,a){"gtag"in window&&window.gtag("event",t,{event_category:"Performance",...a})}getPerformanceSummary(){const t=this.metrics[this.metrics.length-1]||{};return{webVitals:{lcp:t.lcp,fid:t.fid,cls:t.cls,fcp:t.fcp,ttfb:t.ttfb},slowComponents:this.componentMetrics.filter(a=>a.renderTime>this.PERFORMANCE_BUDGETS.RENDER).slice(-10),slowAPIs:this.apiMetrics.filter(a=>a.responseTime>this.PERFORMANCE_BUDGETS.API).slice(-10),memoryUsage:t.memoryUsage||0,bundleSize:t.bundleSize||0}}setEnabled(t){this.isEnabled=t}cleanup(){this.observers.forEach(t=>t.disconnect()),this.observers=[],this.memoryInterval&&(clearInterval(this.memoryInterval),this.memoryInterval=null),this.metrics=[],this.componentMetrics=[],this.apiMetrics=[]}};it(an,"instance");let il=an;const rn="https://ewtuefzeogytgmsnkpmb.supabase.co",ll="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8",bs="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNzg5NDkyNywiZXhwIjoyMDUzNDcwOTI3fQ.jKjwRZn7fi9rJUcmWPe5zBRpq7leefmx0H8U59bfVEs";let Ga=null,Ya=null;function sn(){return Ga||(Ga=Na(rn,ll,{auth:{persistSession:!0,storageKey:"sb.auth.v2",autoRefreshToken:!0,detectSessionInUrl:!0,flowType:"pkce",debug:!1,storage:{getItem:e=>{try{return localStorage.getItem(e)}catch{return null}},setItem:(e,t)=>{try{localStorage.setItem(e,t)}catch{}},removeItem:e=>{try{localStorage.removeItem(e)}catch{}}}},global:{headers:{"X-Client-Info":"sales-dashboard-v2"}}})),Ga}const R=new Proxy({},{get(e,t){try{const a=sn();if(!a)throw new Error("Supabase client not initialized");const s=a[t];return typeof s=="function"?s.bind(a):s}catch(a){throw a}}});function cl(){return!Ya&&bs&&(Ya=Na(rn,bs,{auth:{persistSession:!1,autoRefreshToken:!1,storageKey:"sb.auth.admin.v2"},global:{headers:{"X-Client-Info":"sales-dashboard-admin-v2"}}})),Ya||sn()}const qe=new Proxy({},{get(e,t){try{const a=cl();if(!a)throw new Error("Supabase admin client not initialized");const s=a[t];return typeof s=="function"?s.bind(a):s}catch(a){throw a}}}),he={isAuthenticated:e=>!!e?.user&&!!e?.access_token,getUserId:e=>e?.user?.id||null,formatAuthError:e=>{if(!e)return"An unknown error occurred";const t=e.message||e.error_description||"Authentication failed",a=e.status||e.statusCode||0;return a===403?"Access denied. You may not have permission to access this resource. Please check your account status or contact support.":a===401?"Authentication required. Please sign in to continue.":a===429?"Too many requests. Please wait a moment and try again.":{"Invalid login credentials":"Invalid email or password. Please check your credentials and try again.","Email not confirmed":"Please check your email and click the confirmation link before signing in.","Password should be at least 6 characters":"Password must be at least 6 characters long.","User already registered":"An account with this email already exists. Try signing in instead.","Invalid email address":"Please enter a valid email address.","signups not allowed":"New registrations are currently disabled. Please contact support.","JWT expired":"Your session has expired. Please sign in again.","JWT malformed":"Authentication error. Please sign in again.","permission denied":"You do not have permission to perform this action.",insufficient_privilege:"Insufficient privileges for this operation.","row-level security violation":"Access denied. You can only access your own data."}[t]||t},isAuthError:e=>{if(!e)return!1;const t=e.status||e.statusCode||0,a=(e.message||"").toLowerCase();return t===401||t===403||a.includes("jwt")||a.includes("unauthorized")||a.includes("forbidden")||a.includes("permission")||a.includes("row-level security")},handleAuthError:(e,t)=>{const a=he.isAuthError(e);he.formatAuthError(e),a&&v.warn("Authentication/Authorization error detected:",{error:e.message,status:e.status,context:t})},refreshAndRetry:async e=>{try{const{data:{session:t},error:a}=await R.auth.refreshSession();if(a)throw v.error("Session refresh failed:",a),a;if(!t)throw new Error("No valid session after refresh");return v.log("Session refreshed successfully, retrying operation"),await e()}catch(t){throw t}},clearAuthStorage:()=>{try{["sb.auth.v2","sb.auth.admin.v2","supabase.auth.token","sb-refresh-token","sb-access-token"].forEach(t=>{localStorage.removeItem(t)})}catch{}},diagnoseSession:async()=>{const e=[];try{const{data:{session:t},error:a}=await R.auth.getSession();if(a)return e.push(`Session error: ${a.message}`),{isValid:!1,session:null,user:null,issues:e};if(!t)return e.push("No active session found"),{isValid:!1,session:null,user:null,issues:e};t.access_token||e.push("Session missing access token"),t.user||e.push("Session missing user data");const s=Date.now()/1e3;return t.expires_at&&t.expires_at<s&&e.push("Session has expired"),{isValid:e.length===0,session:t,user:t.user||null,issues:e}}catch(t){return e.push(`Unexpected error: ${t instanceof Error?t.message:"Unknown error"}`),{isValid:!1,session:null,user:null,issues:e}}}},nn=Object.freeze(Object.defineProperty({__proto__:null,authUtils:he,supabase:R,supabaseAdmin:qe},Symbol.toStringTag,{value:"Module"}));var Ir={};(function e(t,a,s,n){var o=!!(t.Worker&&t.Blob&&t.Promise&&t.OffscreenCanvas&&t.OffscreenCanvasRenderingContext2D&&t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype.transferControlToOffscreen&&t.URL&&t.URL.createObjectURL),i=typeof Path2D=="function"&&typeof DOMMatrix=="function",l=function(){if(!t.OffscreenCanvas)return!1;var E=new OffscreenCanvas(1,1),w=E.getContext("2d");w.fillRect(0,0,1,1);var F=E.transferToImageBitmap();try{w.createPattern(F,"no-repeat")}catch{return!1}return!0}();function c(){}function d(E){var w=a.exports.Promise,F=w!==void 0?w:t.Promise;return typeof F=="function"?new F(E):(E(c,c),null)}var h=function(E,w){return{transform:function(F){if(E)return F;if(w.has(F))return w.get(F);var V=new OffscreenCanvas(F.width,F.height),q=V.getContext("2d");return q.drawImage(F,0,0),w.set(F,V),V},clear:function(){w.clear()}}}(l,new Map),b=function(){var E=Math.floor(16.666666666666668),w,F,V={},q=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(w=function(C){var $=Math.random();return V[$]=requestAnimationFrame(function B(H){q===H||q+E-1<H?(q=H,delete V[$],C()):V[$]=requestAnimationFrame(B)}),$},F=function(C){V[C]&&cancelAnimationFrame(V[C])}):(w=function(C){return setTimeout(C,E)},F=function(C){return clearTimeout(C)}),{frame:w,cancel:F}}(),f=function(){var E,w,F={};function V(q){function C($,B){q.postMessage({options:$||{},callback:B})}q.init=function(B){var H=B.transferControlToOffscreen();q.postMessage({canvas:H},[H])},q.fire=function(B,H,Y){if(w)return C(B,null),w;var J=Math.random().toString(36).slice(2);return w=d(function(K){function oe(re){re.data.callback===J&&(delete F[J],q.removeEventListener("message",oe),w=null,h.clear(),Y(),K())}q.addEventListener("message",oe),C(B,J),F[J]=oe.bind(null,{data:{callback:J}})}),w},q.reset=function(){q.postMessage({reset:!0});for(var B in F)F[B](),delete F[B]}}return function(){if(E)return E;if(!s&&o){var q=["var CONFETTI, SIZE = {}, module = {};","("+e.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{E=new Worker(URL.createObjectURL(new Blob([q])))}catch{return null}V(E)}return E}}(),m={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function M(E,w){return w?w(E):E}function x(E){return E!=null}function u(E,w,F){return M(E&&x(E[w])?E[w]:m[w],F)}function p(E){return E<0?0:Math.floor(E)}function k(E,w){return Math.floor(Math.random()*(w-E))+E}function I(E){return parseInt(E,16)}function T(E){return E.map(_)}function _(E){var w=String(E).replace(/[^0-9a-f]/gi,"");return w.length<6&&(w=w[0]+w[0]+w[1]+w[1]+w[2]+w[2]),{r:I(w.substring(0,2)),g:I(w.substring(2,4)),b:I(w.substring(4,6))}}function S(E){var w=u(E,"origin",Object);return w.x=u(w,"x",Number),w.y=u(w,"y",Number),w}function N(E){E.width=document.documentElement.clientWidth,E.height=document.documentElement.clientHeight}function A(E){var w=E.getBoundingClientRect();E.width=w.width,E.height=w.height}function D(E){var w=document.createElement("canvas");return w.style.position="fixed",w.style.top="0px",w.style.left="0px",w.style.pointerEvents="none",w.style.zIndex=E,w}function j(E,w,F,V,q,C,$,B,H){E.save(),E.translate(w,F),E.rotate(C),E.scale(V,q),E.arc(0,0,1,$,B,H),E.restore()}function y(E){var w=E.angle*(Math.PI/180),F=E.spread*(Math.PI/180);return{x:E.x,y:E.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:E.startVelocity*.5+Math.random()*E.startVelocity,angle2D:-w+(.5*F-Math.random()*F),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:E.color,shape:E.shape,tick:0,totalTicks:E.ticks,decay:E.decay,drift:E.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:E.gravity*3,ovalScalar:.6,scalar:E.scalar,flat:E.flat}}function O(E,w){w.x+=Math.cos(w.angle2D)*w.velocity+w.drift,w.y+=Math.sin(w.angle2D)*w.velocity+w.gravity,w.velocity*=w.decay,w.flat?(w.wobble=0,w.wobbleX=w.x+10*w.scalar,w.wobbleY=w.y+10*w.scalar,w.tiltSin=0,w.tiltCos=0,w.random=1):(w.wobble+=w.wobbleSpeed,w.wobbleX=w.x+10*w.scalar*Math.cos(w.wobble),w.wobbleY=w.y+10*w.scalar*Math.sin(w.wobble),w.tiltAngle+=.1,w.tiltSin=Math.sin(w.tiltAngle),w.tiltCos=Math.cos(w.tiltAngle),w.random=Math.random()+2);var F=w.tick++/w.totalTicks,V=w.x+w.random*w.tiltCos,q=w.y+w.random*w.tiltSin,C=w.wobbleX+w.random*w.tiltCos,$=w.wobbleY+w.random*w.tiltSin;if(E.fillStyle="rgba("+w.color.r+", "+w.color.g+", "+w.color.b+", "+(1-F)+")",E.beginPath(),i&&w.shape.type==="path"&&typeof w.shape.path=="string"&&Array.isArray(w.shape.matrix))E.fill(W(w.shape.path,w.shape.matrix,w.x,w.y,Math.abs(C-V)*.1,Math.abs($-q)*.1,Math.PI/10*w.wobble));else if(w.shape.type==="bitmap"){var B=Math.PI/10*w.wobble,H=Math.abs(C-V)*.1,Y=Math.abs($-q)*.1,J=w.shape.bitmap.width*w.scalar,K=w.shape.bitmap.height*w.scalar,oe=new DOMMatrix([Math.cos(B)*H,Math.sin(B)*H,-Math.sin(B)*Y,Math.cos(B)*Y,w.x,w.y]);oe.multiplySelf(new DOMMatrix(w.shape.matrix));var re=E.createPattern(h.transform(w.shape.bitmap),"no-repeat");re.setTransform(oe),E.globalAlpha=1-F,E.fillStyle=re,E.fillRect(w.x-J/2,w.y-K/2,J,K),E.globalAlpha=1}else if(w.shape==="circle")E.ellipse?E.ellipse(w.x,w.y,Math.abs(C-V)*w.ovalScalar,Math.abs($-q)*w.ovalScalar,Math.PI/10*w.wobble,0,2*Math.PI):j(E,w.x,w.y,Math.abs(C-V)*w.ovalScalar,Math.abs($-q)*w.ovalScalar,Math.PI/10*w.wobble,0,2*Math.PI);else if(w.shape==="star")for(var X=Math.PI/2*3,ue=4*w.scalar,fe=8*w.scalar,_e=w.x,xe=w.y,Je=5,Me=Math.PI/Je;Je--;)_e=w.x+Math.cos(X)*fe,xe=w.y+Math.sin(X)*fe,E.lineTo(_e,xe),X+=Me,_e=w.x+Math.cos(X)*ue,xe=w.y+Math.sin(X)*ue,E.lineTo(_e,xe),X+=Me;else E.moveTo(Math.floor(w.x),Math.floor(w.y)),E.lineTo(Math.floor(w.wobbleX),Math.floor(q)),E.lineTo(Math.floor(C),Math.floor($)),E.lineTo(Math.floor(V),Math.floor(w.wobbleY));return E.closePath(),E.fill(),w.tick<w.totalTicks}function G(E,w,F,V,q){var C=w.slice(),$=E.getContext("2d"),B,H,Y=d(function(J){function K(){B=H=null,$.clearRect(0,0,V.width,V.height),h.clear(),q(),J()}function oe(){s&&!(V.width===n.width&&V.height===n.height)&&(V.width=E.width=n.width,V.height=E.height=n.height),!V.width&&!V.height&&(F(E),V.width=E.width,V.height=E.height),$.clearRect(0,0,V.width,V.height),C=C.filter(function(re){return O($,re)}),C.length?B=b.frame(oe):K()}B=b.frame(oe),H=K});return{addFettis:function(J){return C=C.concat(J),Y},canvas:E,promise:Y,reset:function(){B&&b.cancel(B),H&&H()}}}function Q(E,w){var F=!E,V=!!u(w||{},"resize"),q=!1,C=u(w,"disableForReducedMotion",Boolean),$=o&&!!u(w||{},"useWorker"),B=$?f():null,H=F?N:A,Y=E&&B?!!E.__confetti_initialized:!1,J=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,K;function oe(X,ue,fe){for(var _e=u(X,"particleCount",p),xe=u(X,"angle",Number),Je=u(X,"spread",Number),Me=u(X,"startVelocity",Number),mt=u(X,"decay",Number),na=u(X,"gravity",Number),Qe=u(X,"drift",Number),oa=u(X,"colors",T),Ra=u(X,"ticks",Number),ke=u(X,"shapes"),et=u(X,"scalar"),La=!!u(X,"flat"),ia=S(X),ft=_e,It=[],la=E.width*ia.x,Pt=E.height*ia.y;ft--;)It.push(y({x:la,y:Pt,angle:xe,spread:Je,startVelocity:Me,color:oa[ft%oa.length],shape:ke[k(0,ke.length)],ticks:Ra,decay:mt,gravity:na,drift:Qe,scalar:et,flat:La}));return K?K.addFettis(It):(K=G(E,It,H,ue,fe),K.promise)}function re(X){var ue=C||u(X,"disableForReducedMotion",Boolean),fe=u(X,"zIndex",Number);if(ue&&J)return d(function(Me){Me()});F&&K?E=K.canvas:F&&!E&&(E=D(fe),document.body.appendChild(E)),V&&!Y&&H(E);var _e={width:E.width,height:E.height};B&&!Y&&B.init(E),Y=!0,B&&(E.__confetti_initialized=!0);function xe(){if(B){var Me={getBoundingClientRect:function(){if(!F)return E.getBoundingClientRect()}};H(Me),B.postMessage({resize:{width:Me.width,height:Me.height}});return}_e.width=_e.height=null}function Je(){K=null,V&&(q=!1,t.removeEventListener("resize",xe)),F&&E&&(document.body.contains(E)&&document.body.removeChild(E),E=null,Y=!1)}return V&&!q&&(q=!0,t.addEventListener("resize",xe,!1)),B?B.fire(X,_e,Je):oe(X,_e,Je)}return re.reset=function(){B&&B.reset(),K&&K.reset()},re}var ae;function de(){return ae||(ae=Q(null,{useWorker:!0,resize:!0})),ae}function W(E,w,F,V,q,C,$){var B=new Path2D(E),H=new Path2D;H.addPath(B,new DOMMatrix(w));var Y=new Path2D;return Y.addPath(H,new DOMMatrix([Math.cos($)*q,Math.sin($)*q,-Math.sin($)*C,Math.cos($)*C,F,V])),Y}function P(E){if(!i)throw new Error("path confetti are not supported in this browser");var w,F;typeof E=="string"?w=E:(w=E.path,F=E.matrix);var V=new Path2D(w),q=document.createElement("canvas"),C=q.getContext("2d");if(!F){for(var $=1e3,B=$,H=$,Y=0,J=0,K,oe,re=0;re<$;re+=2)for(var X=0;X<$;X+=2)C.isPointInPath(V,re,X,"nonzero")&&(B=Math.min(B,re),H=Math.min(H,X),Y=Math.max(Y,re),J=Math.max(J,X));K=Y-B,oe=J-H;var ue=10,fe=Math.min(ue/K,ue/oe);F=[fe,0,0,fe,-Math.round(K/2+B)*fe,-Math.round(oe/2+H)*fe]}return{type:"path",path:w,matrix:F}}function z(E){var w,F=1,V="#000000",q='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof E=="string"?w=E:(w=E.text,F="scalar"in E?E.scalar:F,q="fontFamily"in E?E.fontFamily:q,V="color"in E?E.color:V);var C=10*F,$=""+C+"px "+q,B=new OffscreenCanvas(C,C),H=B.getContext("2d");H.font=$;var Y=H.measureText(w),J=Math.ceil(Y.actualBoundingBoxRight+Y.actualBoundingBoxLeft),K=Math.ceil(Y.actualBoundingBoxAscent+Y.actualBoundingBoxDescent),oe=2,re=Y.actualBoundingBoxLeft+oe,X=Y.actualBoundingBoxAscent+oe;J+=oe+oe,K+=oe+oe,B=new OffscreenCanvas(J,K),H=B.getContext("2d"),H.font=$,H.fillStyle=V,H.fillText(w,re,X);var ue=1/F;return{type:"bitmap",bitmap:B.transferToImageBitmap(),matrix:[ue,0,0,ue,-J*ue/2,-K*ue/2]}}a.exports=function(){return de().apply(this,arguments)},a.exports.reset=function(){de().reset()},a.exports.create=Q,a.exports.shapeFromPath=P,a.exports.shapeFromText=z})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),Ir,!1);const dl=Ir.exports;Ir.exports.create;var ul=Object.defineProperty,ml=(e,t,a)=>t in e?ul(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,fl=(e,t,a)=>ml(e,t+"",a);class on{static fire(t,a){dl({...this.defaults,...a,particleCount:Math.floor(200*t)})}static celebrate(){this.fire(.25,{spread:26,startVelocity:55,origin:{x:.2,y:.9}}),this.fire(.25,{spread:26,startVelocity:55,origin:{x:.8,y:.9}}),this.fire(.35,{spread:100,decay:.91,origin:{x:.5,y:.8}}),setTimeout(()=>{this.fire(.1,{spread:120,startVelocity:25,decay:.92,origin:{x:.3,y:.8}})},200),setTimeout(()=>{this.fire(.1,{spread:120,startVelocity:25,decay:.92,origin:{x:.7,y:.8}})},200),setTimeout(()=>{this.fire(.2,{spread:150,startVelocity:45,decay:.91,origin:{x:.5,y:.9}})},400)}}fl(on,"defaults",{origin:{y:.7},spread:90,ticks:400,gravity:1.2,decay:.94,startVelocity:45,colors:["#37bd7e","#34D399","#6EE7B7","#059669","#047857"]});const Pr=g.createContext(void 0);function hl({children:e}){const[t,a]=g.useState(null),s=jr(),n=i=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["deals"]}),a(i),sessionStorage.setItem("viewMode",JSON.stringify(i))},o=()=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["deals"]}),a(null),sessionStorage.removeItem("viewMode")};return U.useEffect(()=>{const i=sessionStorage.getItem("viewMode");if(i)try{const l=JSON.parse(i);a(l)}catch{sessionStorage.removeItem("viewMode")}},[]),r.jsx(Pr.Provider,{value:{isViewMode:!!t,viewedUser:t,startViewMode:n,exitViewMode:o},children:e})}function Ar(){const e=g.useContext(Pr);if(e===void 0)throw new Error("useViewMode must be used within a ViewModeProvider");return e}async function pl(e,t){const{data:{user:a}}=await R.auth.getUser();if(!a)throw new Error("Not authenticated");const s=t||a.id;v.log("[fetchActivities] Debug:",{viewedUserId:t,targetUserId:s,currentUserId:a.id,isViewMode:!!t});let n=R.from("activities").select(`
      *,
      deals (
        id,
        name,
        value,
        one_off_revenue,
        monthly_mrr,
        annual_value,
        stage_id
      )
    `);if(t){const{data:l}=await R.from("profiles").select("first_name, last_name, full_name").eq("id",t).single();if(l){const c=l.full_name||`${l.first_name||""} ${l.last_name||""}`.trim();n=n.or(`user_id.eq.${s},sales_rep.eq.${c}`)}else n=n.eq("user_id",s)}else n=n.eq("user_id",s);n=n.order("date",{ascending:!1});const{data:o,error:i}=await n;if(i)throw i;return v.log("[fetchActivities] Raw data count:",o?.length||0),t?o||[]:o?.filter(l=>l.user_id===a.id)||[]}async function ln(e,t){if(t)try{const{error:a}=await R.functions.invoke("process-single-activity",{body:{activityId:e}});a&&L.error("Failed to auto-process activity: "+(a.message||"Unknown error"))}catch(a){L.error("Failed to auto-process activity: "+(a.message||"Unknown error"))}}async function gl(e){const{data:{user:t}}=await R.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:a}=await R.from("profiles").select("first_name, last_name").eq("id",t.id).single();if(!a)throw new Error("User profile not found");const{data:s,error:n}=await R.from("activities").insert({user_id:t.id,type:e.type,client_name:e.client_name,details:e.details||null,amount:e.amount,priority:e.priority||"medium",sales_rep:`${a.first_name} ${a.last_name}`,date:e.date||new Date().toISOString(),status:e.status||"completed",quantity:e.quantity||1,contact_identifier:e.contactIdentifier,contact_identifier_type:e.contactIdentifierType,deal_id:e.deal_id}).select().single();if(n)throw n;return s&&await ln(s.id,s.contact_identifier),s}async function yl(e){const{data:{user:t}}=await R.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:a}=await R.from("profiles").select("first_name, last_name").eq("id",t.id).single();if(!a)throw new Error("User profile not found");let s=e.deal_id,n=!1;if(s)n=!0;else try{const{data:c}=await R.from("deal_stages").select("id, name").eq("name","Signed").limit(1);let d=c?.[0]?.id;if(!d){const{data:h}=await R.from("deal_stages").select("id, name").or("name.ilike.%closed won%,name.ilike.%won%").limit(1);d=h?.[0]?.id}if(!d){const{data:h}=await R.from("deal_stages").select("id").order("order_position",{ascending:!1}).limit(1);d=h?.[0]?.id}if(d){const{data:h,error:b}=await R.from("deals").insert({name:`${e.client_name} - ${e.saleType} Sale`,company:e.client_name,value:e.amount,stage_id:d,owner_id:t.id,probability:100,status:"active",expected_close_date:e.date||new Date().toISOString(),one_off_revenue:e.oneOffRevenue??(e.saleType==="one-off"?e.amount:null),monthly_mrr:e.monthlyMrr??(e.saleType==="subscription"?e.amount:null),annual_value:e.saleType==="lifetime"?e.amount:null}).select("id").single();!b&&h&&(s=h.id,v.log(`Auto-created deal ${h.id} for sale to ${e.client_name}`))}}catch{}if(n&&s)try{const{data:c}=await R.from("deal_stages").select("id").eq("name","Signed").single();if(c){const{data:d}=await R.from("deals").select("one_off_revenue, monthly_mrr, annual_value").eq("id",s).single();let h=d?.one_off_revenue||0,b=d?.monthly_mrr||0,f=d?.annual_value||0;e.oneOffRevenue!==void 0||e.monthlyMrr!==void 0?(h=e.oneOffRevenue||0,b=e.monthlyMrr||0):e.saleType==="one-off"?h=(d?.one_off_revenue||0)+e.amount:e.saleType==="subscription"?b=(d?.monthly_mrr||0)+e.amount:e.saleType==="lifetime"&&(f=e.amount);const{error:m}=await R.from("deals").update({stage_id:c.id,probability:100,expected_close_date:e.date||new Date().toISOString(),one_off_revenue:h>0?h:null,monthly_mrr:b>0?b:null,annual_value:f>0?f:null,value:e.amount}).eq("id",s);m?v.warn("Failed to update deal stage to Signed:",m):v.log(`Updated deal ${s} to Signed stage`)}}catch{}const o={user_id:t.id,type:"sale",client_name:e.client_name,details:e.details||`${e.saleType} Sale`,amount:e.amount,priority:"high",sales_rep:`${a.first_name} ${a.last_name}`,date:e.date||new Date().toISOString(),status:"completed",contact_identifier:e.contactIdentifier,contact_identifier_type:e.contactIdentifierType,deal_id:s},{data:i,error:l}=await R.from("activities").insert(o).select().single();if(l)throw l;if(!i)throw new Error("Failed to create sale");return i&&await ln(i.id,i.contact_identifier),i}async function vl(e,t){const{data:a,error:s}=await R.from("activities").update(t).eq("id",e).select().single();if(s)throw s;return a}async function bl(e){const{error:t}=await R.from("activities").delete().eq("id",e);if(t)throw t}function Ta(e){const{isViewMode:t,viewedUser:a}=Ar(),s=jr();g.useEffect(()=>{if(t)return;async function b(){const{data:{user:f}}=await R.auth.getUser();if(!f)return;const m=R.channel("activities_changes").on("postgres_changes",{event:"*",schema:"public",table:"activities",filter:`user_id=eq.${f.id}`},M=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["salesData"]}),s.invalidateQueries({queryKey:["targets"]})}).subscribe();return()=>{m.unsubscribe()}}b()},[s,e,t]);const n=["activities"],{data:o=[],isLoading:i}=Xn({queryKey:t&&a?[...n,"view",a.id]:n,queryFn:()=>pl(e,t?a?.id:void 0),staleTime:t?0:5*60*1e3}),l=ca({mutationFn:gl,onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["salesData"]}),s.invalidateQueries({queryKey:["targets"]}),L.success("Activity added successfully")},onError:b=>{L.error("Failed to add activity")}}),c=ca({mutationFn:yl,onSuccess:b=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["salesData"]}),s.invalidateQueries({queryKey:["targets"]}),L.success("Sale added successfully! "),on.celebrate()},onError:b=>{L.error(`Failed to add sale: ${b.message}`)}}),d=ca({mutationFn:({id:b,updates:f})=>vl(b,f),onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["salesData"]}),s.invalidateQueries({queryKey:["targets"]}),L.success("Activity updated successfully")},onError:b=>{L.error("Failed to update activity")}}),h=ca({mutationFn:bl,onSuccess:()=>{s.invalidateQueries({queryKey:["activities"]}),s.invalidateQueries({queryKey:["salesData"]}),s.invalidateQueries({queryKey:["targets"]}),L.success("Activity deleted successfully")},onError:b=>{L.error("Failed to delete activity")}});return{activities:o,isLoading:i,addActivity:l.mutate,addActivityAsync:l.mutateAsync,addSale:c.mutate,updateActivity:d.mutate,removeActivity:h.mutate}}async function xl(){try{const{originalUserId:e,isImpersonating:t}=Rr();if(t&&e){const{data:{user:a}}=await R.auth.getUser();if(a)try{await R.rpc("set_audit_context",{p_original_user_id:e,p_impersonated_user_id:a.id,p_is_impersonating:!0})}catch(s){v.debug("Audit context RPC not available:",s)}}else await bt()}catch{}}async function bt(){try{v.log(" Audit context cleared locally")}catch{}}function Or(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?window.location.origin:"https://sales.sixtyseconds.video"}function wl(e){const t=Or(),a=e.startsWith("/")?e:`/${e}`;return`${t}${a}`}const jm=["Trainee","Junior","Senior","Manager","Director"],Ja=(e,t)=>{sessionStorage.setItem("originalUserId",e),sessionStorage.setItem("originalUserEmail",t),sessionStorage.setItem("isImpersonating","true")},yt=()=>{sessionStorage.removeItem("originalUserId"),sessionStorage.removeItem("originalUserEmail"),sessionStorage.removeItem("isImpersonating")},Rr=()=>({originalUserId:sessionStorage.getItem("originalUserId"),originalUserEmail:sessionStorage.getItem("originalUserEmail"),isImpersonating:sessionStorage.getItem("isImpersonating")==="true"}),_l=async()=>{try{const{originalUserId:e,originalUserEmail:t}=Rr();if(!e||!t)throw new Error("No impersonation session found");const{data:a,error:s}=await R.functions.invoke("restore-user",{body:{userId:e,email:t,redirectTo:Or()}});if(s)throw s;if(a?.email&&a?.password){v.warn("Edge Function is returning old format. Using fallback password-based restoration."),yt();const{error:n}=await R.auth.signInWithPassword({email:a.email,password:a.password});if(n)throw n;L.success("Session restored (legacy mode)"),window.location.reload();return}if(a?.session){yt(),bt();const{error:n}=await R.auth.setSession(a.session);if(n)throw n;L.success("Admin session restored successfully!"),window.location.reload()}else if(a?.magicLink)yt(),bt(),a.requiresPasswordReset?L.warning("Restoring session. You may need to reset your password."):L.success("Restoring your admin session..."),window.location.href=a.magicLink;else throw new Error("Failed to restore session. Response: "+JSON.stringify(a))}catch(e){throw yt(),bt(),L.error("Failed to stop impersonation: "+(e.message||"Unknown error")),e}};function Ge(){const[e,t]=g.useState(null),[a,s]=g.useState(!0),[n,o]=g.useState(null),[i,l]=g.useState(!1),[c,d]=g.useState(null);let h=null;try{h=g.useContext(Pr)}catch{}g.useEffect(()=>{const{isImpersonating:x,originalUserId:u}=Rr();l(x&&!!u),x&&u?xl():bt();let p=!1;async function k(){if(!p){p=!0;try{s(!0),o(null);const T=R.auth.getSession(),_=new Promise((A,D)=>setTimeout(()=>D(new Error("Session fetch timeout")),1e4)),{data:{session:S},error:N}=await Promise.race([T,_]).catch(A=>({data:{session:null},error:A}));if(N)throw v.warn("Session error (will use fallback):",N.message),N;if(S?.user){const A=S.user,{data:D,error:j}=await R.from("profiles").select("*").eq("id",A.id).single();if(j&&j.code!=="PGRST116")throw j;if(D)t(D);else{const{data:y,error:O}=await R.from("profiles").insert({id:A.id,email:A.email,first_name:A.user_metadata?.first_name||"User",last_name:A.user_metadata?.last_name||"",avatar_url:A.user_metadata?.avatar_url,role:"Junior",department:"Sales"}).select().single();O?(v.warn("Could not create profile, using basic user data:",O),t({id:A.id,email:A.email||null,first_name:A.user_metadata?.first_name||"User",last_name:A.user_metadata?.last_name||"",full_name:null,avatar_url:A.user_metadata?.avatar_url||null,role:"Junior",department:"Sales",stage:null,is_admin:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),username:null,website:null})):t(y)}if(u&&u!==A.id)try{const{data:y}=await R.from("profiles").select("*").eq("id",u).single();d(y)}catch(y){v.warn("Could not fetch original user data:",y)}}else v.log("No authenticated user, creating mock user for development"),t({id:"ac4efca2-1fe1-49b3-9d5e-6ac3d8bf3459",email:"andrew.bryce@sixtyseconds.video",first_name:"Andrew",last_name:"Bryce",full_name:"Andrew Bryce",avatar_url:null,role:"Senior",department:"Sales",stage:"Senior",is_admin:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),username:null,website:null})}catch(T){o(T),t(null)}finally{s(!1),p=!1}}}k();const{data:{subscription:I}}=R.auth.onAuthStateChange(async(T,_)=>{T!=="INITIAL_SESSION"&&(T==="SIGNED_IN"&&_&&!e?k():T==="SIGNED_OUT"&&(t(null),d(null),l(!1),yt()))});return()=>I.unsubscribe()},[]);const b=async()=>{try{await R.auth.signOut(),t(null),d(null),l(!1),yt(),bt()}catch{t(null),d(null),l(!1),yt(),bt()}},f=async()=>{try{await _l()}catch{}},[m,M]=g.useState(null);return g.useEffect(()=>{h?.isViewMode&&h?.viewedUser?(async()=>{const{data:u,error:p}=await R.from("profiles").select("*").eq("id",h.viewedUser.id).single();u&&!p&&M(u)})():M(null)},[h?.isViewMode,h?.viewedUser?.id]),{userData:h?.isViewMode&&m?m:e,originalUserData:c,isLoading:a,error:n,signOut:b,isAuthenticated:!!e,isImpersonating:i,stopImpersonating:f,isViewMode:h?.isViewMode||!1,actualUser:e}}function jl(e){const[t,a]=g.useState([]),[s,n]=g.useState(!0),[o,i]=g.useState(null),{userData:l}=Ge(),c=JSON.stringify(e),d=g.useCallback(async()=>{if(!l?.id){n(!1);return}try{n(!0),i(null);const _=c?JSON.parse(c):{},S=l.id||"mock-user-id";let N=R.from("tasks").select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).order("due_date",{ascending:!0,nullsFirst:!1});_?.assigned_to?N=N.eq("assigned_to",_.assigned_to):_?.contact_id||(N=N.eq("assigned_to",S)),_?.created_by&&(N=N.eq("created_by",_.created_by)),_?.status&&_.status.length>0&&(N=N.in("status",_.status)),_?.priority&&_.priority.length>0&&(N=N.in("priority",_.priority)),_?.task_type&&_.task_type.length>0&&(N=N.in("task_type",_.task_type)),_?.deal_id&&(N=N.eq("deal_id",_.deal_id)),_?.company_id&&(N=N.eq("company_id",_.company_id)),_?.contact_id&&(N=N.eq("contact_id",_.contact_id)),_?.completed!==void 0&&(N=N.eq("completed",_.completed)),_?.due_date_range?.start&&(N=N.gte("due_date",new Date(_.due_date_range.start).toISOString())),_?.due_date_range?.end&&(N=N.lte("due_date",new Date(_.due_date_range.end).toISOString())),_?.overdue_only&&(N=N.lt("due_date",new Date().toISOString()).not("status","in","(completed,cancelled)").eq("completed",!1)),_?.search&&(N=N.or(`
          title.ilike.%${_.search}%,
          description.ilike.%${_.search}%,
          contact_name.ilike.%${_.search}%,
          company.ilike.%${_.search}%,
          notes.ilike.%${_.search}%
        `));const{data:A,error:D}=await N;if(D){if(D.message?.includes('relation "tasks" does not exist')){v.warn("Tasks table does not exist. Please run the migration."),a([]);return}throw D}a(A||[])}catch(_){i(_),_.message?.includes('relation "tasks" does not exist')&&a([])}finally{n(!1)}},[l?.id,c]);g.useEffect(()=>{d()},[d]);const h=g.useCallback(async _=>{let S=l?.id;if(!S){if(!l)throw new Error(" User authentication data is still loading. Please try again in a moment.");S="mock-user-id"}if(!S||S==="")throw new Error(" Invalid user ID. Please refresh the page and try again.");try{const{data:N,error:A}=await R.from("tasks").insert({..._,created_by:S}).select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).single();if(A)throw A;return a(D=>[N,...D]),N}catch(N){throw N}},[l]),b=g.useCallback(async(_,S)=>{try{S.completed===!0&&!S.completed_at?(S.completed_at=new Date().toISOString(),S.status="completed"):S.completed===!1&&(S.completed_at=void 0,S.status==="completed"&&(S.status="pending"));const{data:N,error:A}=await R.from("tasks").update(S).eq("id",_).select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).single();if(A)throw A;return a(D=>D.map(j=>j.id===_?N:j)),N}catch(N){throw N}},[]),f=g.useCallback(async _=>{try{const{error:S}=await R.from("tasks").delete().eq("id",_);if(S)throw S;a(N=>N.filter(A=>A.id!==_))}catch(S){throw S}},[]),m=g.useCallback(async _=>b(_,{completed:!0,status:"completed",completed_at:new Date().toISOString()}),[b]),M=g.useCallback(async _=>b(_,{completed:!1,status:"pending",completed_at:void 0}),[b]),x=g.useCallback(async(_,S)=>{try{const{data:N,error:A}=await R.from("tasks").update(S).in("id",_).select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `);if(A)throw A;return a(D=>D.map(j=>N.find(O=>O.id===j.id)||j)),N}catch(N){throw N}},[]);g.useCallback(async(_,S,N)=>h({...N,company_id:_,company:S}),[h]);const u=g.useCallback(async _=>{try{const{data:S,error:N}=await R.from("tasks").select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).eq("company_id",_).order("due_date",{ascending:!0,nullsFirst:!1});if(N)throw N;return S||[]}catch(S){throw S}},[]);g.useCallback(async _=>{try{const{data:S,error:N}=await R.from("tasks").select("id, status, priority, due_date, completed").eq("company_id",_);if(N)throw N;const A=S||[],D=new Date;return{total:A.length,pending:A.filter(j=>j.status==="pending").length,in_progress:A.filter(j=>j.status==="in_progress").length,completed:A.filter(j=>j.completed).length,overdue:A.filter(j=>j.due_date&&new Date(j.due_date)<D&&!j.completed&&j.status!=="cancelled").length,due_today:A.filter(j=>!j.due_date||j.completed?!1:new Date(j.due_date).toDateString()===D.toDateString()).length,high_priority:A.filter(j=>j.priority==="high"||j.priority==="urgent").length}}catch(S){throw S}},[]);const p=g.useCallback(async _=>{try{const{data:S,error:N}=await R.from("tasks").select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).eq("deal_id",_).order("due_date",{ascending:!0,nullsFirst:!1});if(N)throw N;return S||[]}catch(S){throw S}},[]),k=g.useCallback(async _=>{try{const{data:S,error:N}=await R.from("tasks").select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).eq("contact_id",_).order("due_date",{ascending:!0,nullsFirst:!1});if(N)throw N;return S||[]}catch(S){throw S}},[]),I=g.useCallback(async(_,S)=>h({...S,contact_id:_}),[h]),T=g.useCallback(async _=>{try{let S=R.from("tasks").select(`
          *,
          assignee:profiles!assigned_to(id, first_name, last_name, email, avatar_url),
          creator:profiles!created_by(id, first_name, last_name, email, avatar_url)
        `).not("contact_id","is",null).order("due_date",{ascending:!0,nullsFirst:!1});_&&_.length>0&&(S=S.in("contact_id",_));const{data:N,error:A}=await S;if(A)throw A;return(N||[]).reduce((j,y)=>{const O=y.contact_id;return O&&(j[O]||(j[O]=[]),j[O].push(y)),j},{})}catch(S){throw S}},[]);return{tasks:t,isLoading:s,error:o,fetchTasks:d,createTask:h,updateTask:b,deleteTask:f,completeTask:m,uncompleteTask:M,bulkUpdateTasks:x,getTasksByDeal:p,getTasksByContact:k,getTasksByCompany:u,createContactTask:I,getTasksGroupedByContact:T}}class st{static async autoCreateCompanyFromWebsite(t,a,s){if(!t||!s)return null;try{const n=t.replace(/^(https?:\/\/)?(www\.)?/,"").split("/")[0].toLowerCase(),o=n.split("."),i=o[0].charAt(0).toUpperCase()+o[0].slice(1),{data:l,error:c}=await R.from("companies").select("*").or(`domain.ilike.%${n}%,website.ilike.%${n}%`).limit(1);if(!c&&l&&l.length>0)return v.log("Found existing company for domain:",n),l[0];const d={name:i,domain:n,website:t,owner_id:s},{data:h,error:b}=await R.from("companies").insert(d).select().single();return b?(v.error("Error creating company:",b),null):(v.log("Auto-created company:",h),h)}catch{return null}}static async getContacts(t){try{v.log(" Fetching contacts directly from Supabase");let a=R.from("contacts").select("*",{count:"exact"});if(t?.search){const c=t.search.trim();a=a.or(`first_name.ilike.%${c}%,last_name.ilike.%${c}%,email.ilike.%${c}%`)}t?.companyId&&(a=a.eq("company_id",t.companyId)),t?.ownerId&&(a=a.eq("owner_id",t.ownerId)),t?.limit?a=a.limit(t.limit):a=a.limit(50),a=a.order("created_at",{ascending:!1});const{data:s,error:n,count:o}=await a;if(n){if(v.error("Error fetching contacts from Supabase:",n),he.isAuthError(n)){const c=he.formatAuthError(n);if(v.warn("Authentication error in contacts fetch:",c),L.error(c),n.message?.includes("JWT")||n.code==="PGRST301"){const d=await he.diagnoseSession();d.isValid||(v.warn("Session diagnosis:",d),L.error("Session expired. Please refresh the page and sign in again."))}}throw n}let i=(s||[]).map(c=>({...c,full_name:c.first_name&&c.last_name?`${c.first_name} ${c.last_name}`:c.first_name||c.last_name||""})),l=i;if(t?.includeCompany&&i.length>0){const c=[...new Set(i.filter(d=>d.company_id).map(d=>d.company_id))];if(c.length>0){const{data:d,error:h}=await R.from("companies").select("*").in("id",c);if(!h&&d){const b=new Map(d.map(f=>[f.id,f]));l=i.map(f=>({...f,company:f.company_id?b.get(f.company_id):void 0}))}}}return v.log(` Fetched ${l.length} contacts`),l}catch(a){throw a}}static async getContactById(t,a=!0){try{if(Kt||pe==="/api")return v.log(" Using direct Supabase for contact fetch"),await this.getContactByIdDirect(t,a);const s=new URLSearchParams;s.append("id",t),s.append("includeCompany",a.toString());const n=await ct(),o=await fetch(`${pe}/contacts?${s}`,{headers:n});if(!o.ok){if(o.status===404)return null;throw new Error(`HTTP error! status: ${o.status}`)}const i=await o.json();if(i.error)throw new Error(i.error);return i.data}catch{try{return await this.getContactByIdDirect(t,a)}catch(n){throw n}}}static async getContactByIdDirect(t,a=!0){try{v.log(" Fetching contact directly from Supabase:",t);const{data:s,error:n}=await R.from("contacts").select("*").eq("id",t).single();if(n){if(n.code==="PGRST116")return null;throw n}if(!s)return null;const o={id:s.id,email:s.email,first_name:s.first_name,last_name:s.last_name,full_name:s.first_name&&s.last_name?`${s.first_name} ${s.last_name}`:s.first_name||s.last_name||"",phone:s.phone,title:s.title,company_id:s.company_id,linkedin_url:s.linkedin_url,notes:s.notes,owner_id:s.owner_id,created_at:s.created_at,updated_at:s.updated_at};return v.log(" Contact fetched successfully from Supabase:",o.email),o}catch(s){throw s}}static async findContactByEmail(t){try{const a=new URLSearchParams;return a.append("search",t),a.append("limit","1"),(await this.getContacts({search:t,limit:1})).find(o=>o.email?.toLowerCase()===t.toLowerCase())||null}catch{return null}}static async createContact(t){try{v.log(" Creating contact directly via Supabase");let a={...t};if(t.company_website&&!t.company_id&&t.owner_id){v.log(" Auto-creating company from website:",t.company_website);const l=await this.autoCreateCompanyFromWebsite(t.company_website,t.email,t.owner_id);l&&(a.company_id=l.id,v.log(" Linked contact to company:",l.name),L.success(`Contact linked to company "${l.name}"`))}const{company_website:s,...n}=a,{data:o,error:i}=await R.from("contacts").insert(n).select().single();if(i){if(v.error("Error creating contact in Supabase:",i),he.isAuthError(i)){const l=he.formatAuthError(i);v.warn("Authentication error in contact creation:",l),L.error(`Failed to create contact: ${l}`),(i.message?.includes("permission")||i.message?.includes("row-level security"))&&L.error("You may not have permission to create contacts. Please check with your administrator.",{duration:6e3})}throw i}return v.log(" Contact created successfully:",o),o}catch(a){throw a}}static async updateContact(t,a){try{v.log(" Updating contact directly via Supabase");const{data:s,error:n}=await R.from("contacts").update(a).eq("id",t).select().single();if(n)throw v.error("Error updating contact in Supabase:",n),n;return v.log(" Contact updated successfully:",s),s}catch(s){throw s}}static async deleteContact(t){try{v.log(" Deleting contact directly via Supabase");const{error:a}=await R.from("contacts").delete().eq("id",t);if(a)throw v.error("Error deleting contact in Supabase:",a),a;return v.log(" Contact deleted successfully"),!0}catch(a){throw a}}static async getContactsByCompany(t){try{return await this.getContacts({companyId:t,includeCompany:!1})}catch(a){throw a}}static async searchContacts(t,a=!0){try{return await this.getContacts({search:t,includeCompany:a,limit:20})}catch(s){throw s}}static async getContactStats(t){try{const a=await ct(),s=await fetch(`${pe}/contacts?id=${t}&stats=true`,{headers:a});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();if(n.error)throw new Error(n.error);return n.data||{meetings:0,emails:0,calls:0,totalDeals:0,activeDeals:0,totalDealsValue:0,engagementScore:0,recentActivities:[]}}catch{return{meetings:0,emails:0,calls:0,totalDeals:0,activeDeals:0,totalDealsValue:0,engagementScore:0,recentActivities:[]}}}static async autoCreateContactFromEmail(t,a,s,n,o){try{const i=await this.findContactByEmail(t);return i||await this.createContact({email:t,first_name:s,last_name:n,owner_id:a,is_primary:!1})}catch{return null}}static async setPrimaryContact(t){try{return await this.updateContact(t,{is_primary:!0})}catch(a){throw a}}static async getContactDeals(t){try{const a=await ct(),s=await fetch(`${pe}/contacts?id=${t}&deals=true`,{headers:a});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();if(n.error)throw new Error(n.error);return n.data||[]}catch{return[]}}static async getContactActivities(t,a=10){try{const s=await ct(),n=await fetch(`${pe}/contacts?id=${t}&activities=true&limit=${a}`,{headers:s});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();if(o.error)throw new Error(o.error);return o.data||[]}catch{return[]}}static async getContactOwner(t){try{const a=await ct(),s=await fetch(`${pe}/contacts?id=${t}&owner=true`,{headers:a});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();if(n.error)throw new Error(n.error);return n.data||null}catch{return null}}static async getContactTasks(t){try{const a=await ct(),s=await fetch(`${pe}/contacts?id=${t}&tasks=true`,{headers:a});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();if(n.error)throw new Error(n.error);return n.data||[]}catch{return[]}}}function Lr(e={}){const[t,a]=g.useState([]),[s,n]=g.useState(!0),[o,i]=g.useState(null),[l,c]=g.useState(0),{autoFetch:d=!0}=e,h=g.useCallback(async()=>{n(!0),i(null);try{const T=await st.getContacts(e);a(T),c(T.length)}catch(T){i(T)}finally{n(!1)}},[e.search,e.companyId,e.isPrimary,e.includeCompany]),b=g.useCallback(async T=>{try{const _=await st.createContact(T);return a(S=>[_,...S]),c(S=>S+1),L.success("Contact created successfully"),_}catch(_){return i(_),L.error("Failed to create contact"),null}},[]),f=g.useCallback(async(T,_)=>{try{const S=await st.updateContact(T,_);return a(N=>N.map(A=>A.id===T?S:A)),L.success("Contact updated successfully"),S}catch(S){return i(S),L.error("Failed to update contact"),null}},[]),m=g.useCallback(async T=>{try{return await st.deleteContact(T),a(_=>_.filter(S=>S.id!==T)),c(_=>_-1),L.success("Contact deleted successfully"),!0}catch(_){return i(_),L.error("Failed to delete contact"),!1}},[]),M=g.useCallback(async(T,_)=>{try{const S=_!==void 0?_:e.includeCompany;return await st.searchContacts(T,S)}catch(S){return i(S),[]}},[e.includeCompany]),x=g.useCallback(async T=>{try{return await st.findContactByEmail(T)}catch(_){return i(_),null}},[]),u=g.useCallback(async(T,_,S,N,A)=>{try{const D=await st.autoCreateContactFromEmail(T,_,S,N,A);return D&&(a(j=>j.some(O=>O.id===D.id)?j:[D,...j]),c(j=>j+1)),D}catch(D){return i(D),null}},[]),p=g.useCallback(async T=>{try{const _=await st.setPrimaryContact(T);return a(S=>S.map(N=>({...N,is_primary:N.id===T?!0:N.company_id===_.company_id?!1:N.is_primary}))),L.success("Primary contact updated successfully"),_}catch(_){return i(_),L.error("Failed to set primary contact"),null}},[]),k=g.useCallback(()=>{h()},[h]),I=g.useCallback(()=>{i(null)},[]);return g.useEffect(()=>{d&&h()},[h,d]),{contacts:t,isLoading:s,error:o,totalCount:l,fetchContacts:h,createContact:b,updateContact:f,deleteContact:m,searchContacts:M,findContactByEmail:x,autoCreateFromEmail:u,setPrimaryContact:p,refreshContacts:k,clearError:I}}var Z=function(){return Z=Object.assign||function(t){for(var a,s=1,n=arguments.length;s<n;s++){a=arguments[s];for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(t[o]=a[o])}return t},Z.apply(this,arguments)};function Cl(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(a[s[n]]=e[s[n]]);return a}function cn(e,t,a){for(var s=0,n=t.length,o;s<n;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}function ea(e){return e.mode==="multiple"}function ta(e){return e.mode==="range"}function Ia(e){return e.mode==="single"}var Nl={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function Sl(e,t){return be(e,"LLLL y",t)}function kl(e,t){return be(e,"d",t)}function El(e,t){return be(e,"LLLL",t)}function Dl(e){return"".concat(e)}function Ml(e,t){return be(e,"cccccc",t)}function Tl(e,t){return be(e,"yyyy",t)}var Il=Object.freeze({__proto__:null,formatCaption:Sl,formatDay:kl,formatMonthCaption:El,formatWeekNumber:Dl,formatWeekdayName:Ml,formatYearCaption:Tl}),Pl=function(e,t,a){return be(e,"do MMMM (EEEE)",a)},Al=function(){return"Month: "},Ol=function(){return"Go to next month"},Rl=function(){return"Go to previous month"},Ll=function(e,t){return be(e,"cccc",t)},$l=function(e){return"Week n. ".concat(e)},Fl=function(){return"Year: "},zl=Object.freeze({__proto__:null,labelDay:Pl,labelMonthDropdown:Al,labelNext:Ol,labelPrevious:Rl,labelWeekNumber:$l,labelWeekday:Ll,labelYearDropdown:Fl});function Ul(){var e="buttons",t=Nl,a=oo,s={},n={},o=1,i={},l=new Date;return{captionLayout:e,classNames:t,formatters:Il,labels:zl,locale:a,modifiersClassNames:s,modifiers:n,numberOfMonths:o,styles:i,today:l,mode:"default"}}function Bl(e){var t=e.fromYear,a=e.toYear,s=e.fromMonth,n=e.toMonth,o=e.fromDate,i=e.toDate;return s?o=we(s):t&&(o=new Date(t,0,1)),n?i=Be(n):a&&(i=new Date(a,11,31)),{fromDate:o?rs(o):void 0,toDate:i?rs(i):void 0}}var dn=g.createContext(void 0);function Vl(e){var t,a=e.initialProps,s=Ul(),n=Bl(a),o=n.fromDate,i=n.toDate,l=(t=a.captionLayout)!==null&&t!==void 0?t:s.captionLayout;l!=="buttons"&&(!o||!i)&&(l="buttons");var c;(Ia(a)||ea(a)||ta(a))&&(c=a.onSelect);var d=Z(Z(Z({},s),a),{captionLayout:l,classNames:Z(Z({},s.classNames),a.classNames),components:Z({},a.components),formatters:Z(Z({},s.formatters),a.formatters),fromDate:o,labels:Z(Z({},s.labels),a.labels),mode:a.mode||s.mode,modifiers:Z(Z({},s.modifiers),a.modifiers),modifiersClassNames:Z(Z({},s.modifiersClassNames),a.modifiersClassNames),onSelect:c,styles:Z(Z({},s.styles),a.styles),toDate:i});return r.jsx(dn.Provider,{value:d,children:e.children})}function ge(){var e=g.useContext(dn);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function un(e){var t=ge(),a=t.locale,s=t.classNames,n=t.styles,o=t.formatters.formatCaption;return r.jsx("div",{className:s.caption_label,style:n.caption_label,"aria-live":"polite",role:"presentation",id:e.id,children:o(e.displayMonth,{locale:a})})}function ql(e){return r.jsx("svg",Z({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},e,{children:r.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function mn(e){var t,a,s=e.onChange,n=e.value,o=e.children,i=e.caption,l=e.className,c=e.style,d=ge(),h=(a=(t=d.components)===null||t===void 0?void 0:t.IconDropdown)!==null&&a!==void 0?a:ql;return r.jsxs("div",{className:l,style:c,children:[r.jsx("span",{className:d.classNames.vhidden,children:e["aria-label"]}),r.jsx("select",{name:e.name,"aria-label":e["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:n,onChange:s,children:o}),r.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[i,r.jsx(h,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function Wl(e){var t,a=ge(),s=a.fromDate,n=a.toDate,o=a.styles,i=a.locale,l=a.formatters.formatMonthCaption,c=a.classNames,d=a.components,h=a.labels.labelMonthDropdown;if(!s)return r.jsx(r.Fragment,{});if(!n)return r.jsx(r.Fragment,{});var b=[];if(fo(s,n))for(var f=we(s),m=s.getMonth();m<=n.getMonth();m++)b.push(za(f,m));else for(var f=we(new Date),m=0;m<=11;m++)b.push(za(f,m));var M=function(u){var p=Number(u.target.value),k=za(we(e.displayMonth),p);e.onChange(k)},x=(t=d?.Dropdown)!==null&&t!==void 0?t:mn;return r.jsx(x,{name:"months","aria-label":h(),className:c.dropdown_month,style:o.dropdown_month,onChange:M,value:e.displayMonth.getMonth(),caption:l(e.displayMonth,{locale:i}),children:b.map(function(u){return r.jsx("option",{value:u.getMonth(),children:l(u,{locale:i})},u.getMonth())})})}function Hl(e){var t,a=e.displayMonth,s=ge(),n=s.fromDate,o=s.toDate,i=s.locale,l=s.styles,c=s.classNames,d=s.components,h=s.formatters.formatYearCaption,b=s.labels.labelYearDropdown,f=[];if(!n)return r.jsx(r.Fragment,{});if(!o)return r.jsx(r.Fragment,{});for(var m=n.getFullYear(),M=o.getFullYear(),x=m;x<=M;x++)f.push(ss(ho(new Date),x));var u=function(k){var I=ss(we(a),Number(k.target.value));e.onChange(I)},p=(t=d?.Dropdown)!==null&&t!==void 0?t:mn;return r.jsx(p,{name:"years","aria-label":b(),className:c.dropdown_year,style:l.dropdown_year,onChange:u,value:a.getFullYear(),caption:h(a,{locale:i}),children:f.map(function(k){return r.jsx("option",{value:k.getFullYear(),children:h(k,{locale:i})},k.getFullYear())})})}function Gl(e,t){var a=g.useState(e),s=a[0],n=a[1],o=t===void 0?s:t;return[o,n]}function Yl(e){var t=e.month,a=e.defaultMonth,s=e.today,n=t||a||s||new Date,o=e.toDate,i=e.fromDate,l=e.numberOfMonths,c=l===void 0?1:l;if(o&&Gt(o,n)<0){var d=-1*(c-1);n=Fe(o,d)}return i&&Gt(n,i)<0&&(n=i),we(n)}function Jl(){var e=ge(),t=Yl(e),a=Gl(t,e.month),s=a[0],n=a[1],o=function(i){var l;if(!e.disableNavigation){var c=we(i);n(c),(l=e.onMonthChange)===null||l===void 0||l.call(e,c)}};return[s,o]}function Ql(e,t){for(var a=t.reverseMonths,s=t.numberOfMonths,n=we(e),o=we(Fe(n,s)),i=Gt(o,n),l=[],c=0;c<i;c++){var d=Fe(n,c);l.push(d)}return a&&(l=l.reverse()),l}function Kl(e,t){if(!t.disableNavigation){var a=t.toDate,s=t.pagedNavigation,n=t.numberOfMonths,o=n===void 0?1:n,i=s?o:1,l=we(e);if(!a)return Fe(l,i);var c=Gt(a,e);if(!(c<o))return Fe(l,i)}}function Zl(e,t){if(!t.disableNavigation){var a=t.fromDate,s=t.pagedNavigation,n=t.numberOfMonths,o=n===void 0?1:n,i=s?o:1,l=we(e);if(!a)return Fe(l,-i);var c=Gt(l,a);if(!(c<=0))return Fe(l,-i)}}var fn=g.createContext(void 0);function Xl(e){var t=ge(),a=Jl(),s=a[0],n=a[1],o=Ql(s,t),i=Kl(s,t),l=Zl(s,t),c=function(b){return o.some(function(f){return Nr(b,f)})},d=function(b,f){c(b)||(f&&Sr(b,f)?n(Fe(b,1+t.numberOfMonths*-1)):n(b))},h={currentMonth:s,displayMonths:o,goToMonth:n,goToDate:d,previousMonth:l,nextMonth:i,isDateDisplayed:c};return r.jsx(fn.Provider,{value:h,children:e.children})}function aa(){var e=g.useContext(fn);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function xs(e){var t,a=ge(),s=a.classNames,n=a.styles,o=a.components,i=aa().goToMonth,l=function(h){i(Fe(h,e.displayIndex?-e.displayIndex:0))},c=(t=o?.CaptionLabel)!==null&&t!==void 0?t:un,d=r.jsx(c,{id:e.id,displayMonth:e.displayMonth});return r.jsxs("div",{className:s.caption_dropdowns,style:n.caption_dropdowns,children:[r.jsx("div",{className:s.vhidden,children:d}),r.jsx(Wl,{onChange:l,displayMonth:e.displayMonth}),r.jsx(Hl,{onChange:l,displayMonth:e.displayMonth})]})}function ec(e){return r.jsx("svg",Z({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:r.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function tc(e){return r.jsx("svg",Z({width:"16px",height:"16px",viewBox:"0 0 120 120"},e,{children:r.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var Da=g.forwardRef(function(e,t){var a=ge(),s=a.classNames,n=a.styles,o=[s.button_reset,s.button];e.className&&o.push(e.className);var i=o.join(" "),l=Z(Z({},n.button_reset),n.button);return e.style&&Object.assign(l,e.style),r.jsx("button",Z({},e,{ref:t,type:"button",className:i,style:l}))});function ac(e){var t,a,s=ge(),n=s.dir,o=s.locale,i=s.classNames,l=s.styles,c=s.labels,d=c.labelPrevious,h=c.labelNext,b=s.components;if(!e.nextMonth&&!e.previousMonth)return r.jsx(r.Fragment,{});var f=d(e.previousMonth,{locale:o}),m=[i.nav_button,i.nav_button_previous].join(" "),M=h(e.nextMonth,{locale:o}),x=[i.nav_button,i.nav_button_next].join(" "),u=(t=b?.IconRight)!==null&&t!==void 0?t:tc,p=(a=b?.IconLeft)!==null&&a!==void 0?a:ec;return r.jsxs("div",{className:i.nav,style:l.nav,children:[!e.hidePrevious&&r.jsx(Da,{name:"previous-month","aria-label":f,className:m,style:l.nav_button_previous,disabled:!e.previousMonth,onClick:e.onPreviousClick,children:n==="rtl"?r.jsx(u,{className:i.nav_icon,style:l.nav_icon}):r.jsx(p,{className:i.nav_icon,style:l.nav_icon})}),!e.hideNext&&r.jsx(Da,{name:"next-month","aria-label":M,className:x,style:l.nav_button_next,disabled:!e.nextMonth,onClick:e.onNextClick,children:n==="rtl"?r.jsx(p,{className:i.nav_icon,style:l.nav_icon}):r.jsx(u,{className:i.nav_icon,style:l.nav_icon})})]})}function ws(e){var t=ge().numberOfMonths,a=aa(),s=a.previousMonth,n=a.nextMonth,o=a.goToMonth,i=a.displayMonths,l=i.findIndex(function(M){return Nr(e.displayMonth,M)}),c=l===0,d=l===i.length-1,h=t>1&&(c||!d),b=t>1&&(d||!c),f=function(){s&&o(s)},m=function(){n&&o(n)};return r.jsx(ac,{displayMonth:e.displayMonth,hideNext:h,hidePrevious:b,nextMonth:n,previousMonth:s,onPreviousClick:f,onNextClick:m})}function rc(e){var t,a=ge(),s=a.classNames,n=a.disableNavigation,o=a.styles,i=a.captionLayout,l=a.components,c=(t=l?.CaptionLabel)!==null&&t!==void 0?t:un,d;return n?d=r.jsx(c,{id:e.id,displayMonth:e.displayMonth}):i==="dropdown"?d=r.jsx(xs,{displayMonth:e.displayMonth,id:e.id}):i==="dropdown-buttons"?d=r.jsxs(r.Fragment,{children:[r.jsx(xs,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id}),r.jsx(ws,{displayMonth:e.displayMonth,displayIndex:e.displayIndex,id:e.id})]}):d=r.jsxs(r.Fragment,{children:[r.jsx(c,{id:e.id,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),r.jsx(ws,{displayMonth:e.displayMonth,id:e.id})]}),r.jsx("div",{className:s.caption,style:o.caption,children:d})}function sc(e){var t=ge(),a=t.footer,s=t.styles,n=t.classNames.tfoot;return a?r.jsx("tfoot",{className:n,style:s.tfoot,children:r.jsx("tr",{children:r.jsx("td",{colSpan:8,children:a})})}):r.jsx(r.Fragment,{})}function nc(e,t,a){for(var s=a?kr(new Date):Xt(new Date,{locale:e,weekStartsOn:t}),n=[],o=0;o<7;o++){var i=Ne(s,o);n.push(i)}return n}function oc(){var e=ge(),t=e.classNames,a=e.styles,s=e.showWeekNumber,n=e.locale,o=e.weekStartsOn,i=e.ISOWeek,l=e.formatters.formatWeekdayName,c=e.labels.labelWeekday,d=nc(n,o,i);return r.jsxs("tr",{style:a.head_row,className:t.head_row,children:[s&&r.jsx("td",{style:a.head_cell,className:t.head_cell}),d.map(function(h,b){return r.jsx("th",{scope:"col",className:t.head_cell,style:a.head_cell,"aria-label":c(h,{locale:n}),children:l(h,{locale:n})},b)})]})}function ic(){var e,t=ge(),a=t.classNames,s=t.styles,n=t.components,o=(e=n?.HeadRow)!==null&&e!==void 0?e:oc;return r.jsx("thead",{style:s.head,className:a.head,children:r.jsx(o,{})})}function lc(e){var t=ge(),a=t.locale,s=t.formatters.formatDay;return r.jsx(r.Fragment,{children:s(e.date,{locale:a})})}var $r=g.createContext(void 0);function cc(e){if(!ea(e.initialProps)){var t={selected:void 0,modifiers:{disabled:[]}};return r.jsx($r.Provider,{value:t,children:e.children})}return r.jsx(dc,{initialProps:e.initialProps,children:e.children})}function dc(e){var t=e.initialProps,a=e.children,s=t.selected,n=t.min,o=t.max,i=function(d,h,b){var f,m;(f=t.onDayClick)===null||f===void 0||f.call(t,d,h,b);var M=!!(h.selected&&n&&s?.length===n);if(!M){var x=!!(!h.selected&&o&&s?.length===o);if(!x){var u=s?cn([],s):[];if(h.selected){var p=u.findIndex(function(k){return De(d,k)});u.splice(p,1)}else u.push(d);(m=t.onSelect)===null||m===void 0||m.call(t,u,d,h,b)}}},l={disabled:[]};s&&l.disabled.push(function(d){var h=o&&s.length>o-1,b=s.some(function(f){return De(f,d)});return!!(h&&!b)});var c={selected:s,onDayClick:i,modifiers:l};return r.jsx($r.Provider,{value:c,children:a})}function Fr(){var e=g.useContext($r);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}function uc(e,t){var a=t||{},s=a.from,n=a.to;return s&&n?De(n,e)&&De(s,e)?void 0:De(n,e)?{from:n,to:void 0}:De(s,e)?void 0:Sa(s,e)?{from:e,to:n}:{from:s,to:e}:n?Sa(e,n)?{from:n,to:e}:{from:e,to:n}:s?Sr(e,s)?{from:e,to:s}:{from:s,to:e}:{from:e,to:void 0}}var zr=g.createContext(void 0);function mc(e){if(!ta(e.initialProps)){var t={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return r.jsx(zr.Provider,{value:t,children:e.children})}return r.jsx(fc,{initialProps:e.initialProps,children:e.children})}function fc(e){var t=e.initialProps,a=e.children,s=t.selected,n=s||{},o=n.from,i=n.to,l=t.min,c=t.max,d=function(m,M,x){var u,p;(u=t.onDayClick)===null||u===void 0||u.call(t,m,M,x);var k=uc(m,s);(p=t.onSelect)===null||p===void 0||p.call(t,k,m,M,x)},h={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(h.range_start=[o],i?(h.range_end=[i],De(o,i)||(h.range_middle=[{after:o,before:i}])):h.range_end=[o]):i&&(h.range_start=[i],h.range_end=[i]),l&&(o&&!i&&h.disabled.push({after:Fa(o,l-1),before:Ne(o,l-1)}),o&&i&&h.disabled.push({after:o,before:Ne(o,l-1)}),!o&&i&&h.disabled.push({after:Fa(i,l-1),before:Ne(i,l-1)})),c){if(o&&!i&&(h.disabled.push({before:Ne(o,-c+1)}),h.disabled.push({after:Ne(o,c-1)})),o&&i){var b=Xe(i,o)+1,f=c-b;h.disabled.push({before:Fa(o,f)}),h.disabled.push({after:Ne(i,f)})}!o&&i&&(h.disabled.push({before:Ne(i,-c+1)}),h.disabled.push({after:Ne(i,c-1)}))}return r.jsx(zr.Provider,{value:{selected:s,onDayClick:d,modifiers:h},children:a})}function Ur(){var e=g.useContext(zr);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function ja(e){return Array.isArray(e)?cn([],e):e!==void 0?[e]:[]}function hc(e){var t={};return Object.entries(e).forEach(function(a){var s=a[0],n=a[1];t[s]=ja(n)}),t}var ze;(function(e){e.Outside="outside",e.Disabled="disabled",e.Selected="selected",e.Hidden="hidden",e.Today="today",e.RangeStart="range_start",e.RangeEnd="range_end",e.RangeMiddle="range_middle"})(ze||(ze={}));var pc=ze.Selected,Ke=ze.Disabled,gc=ze.Hidden,yc=ze.Today,Qa=ze.RangeEnd,Ka=ze.RangeMiddle,Za=ze.RangeStart,vc=ze.Outside;function bc(e,t,a){var s,n=(s={},s[pc]=ja(e.selected),s[Ke]=ja(e.disabled),s[gc]=ja(e.hidden),s[yc]=[e.today],s[Qa]=[],s[Ka]=[],s[Za]=[],s[vc]=[],s);return e.fromDate&&n[Ke].push({before:e.fromDate}),e.toDate&&n[Ke].push({after:e.toDate}),ea(e)?n[Ke]=n[Ke].concat(t.modifiers[Ke]):ta(e)&&(n[Ke]=n[Ke].concat(a.modifiers[Ke]),n[Za]=a.modifiers[Za],n[Ka]=a.modifiers[Ka],n[Qa]=a.modifiers[Qa]),n}var hn=g.createContext(void 0);function xc(e){var t=ge(),a=Fr(),s=Ur(),n=bc(t,a,s),o=hc(t.modifiers),i=Z(Z({},n),o);return r.jsx(hn.Provider,{value:i,children:e.children})}function pn(){var e=g.useContext(hn);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function wc(e){return!!(e&&typeof e=="object"&&"before"in e&&"after"in e)}function _c(e){return!!(e&&typeof e=="object"&&"from"in e)}function jc(e){return!!(e&&typeof e=="object"&&"after"in e)}function Cc(e){return!!(e&&typeof e=="object"&&"before"in e)}function Nc(e){return!!(e&&typeof e=="object"&&"dayOfWeek"in e)}function Sc(e,t){var a,s=t.from,n=t.to;if(s&&n){var o=Xe(n,s)<0;o&&(a=[n,s],s=a[0],n=a[1]);var i=Xe(e,s)>=0&&Xe(n,e)>=0;return i}return n?De(n,e):s?De(s,e):!1}function kc(e){return Us(e)}function Ec(e){return Array.isArray(e)&&e.every(Us)}function Dc(e,t){return t.some(function(a){if(typeof a=="boolean")return a;if(kc(a))return De(e,a);if(Ec(a))return a.includes(e);if(_c(a))return Sc(e,a);if(Nc(a))return a.dayOfWeek.includes(e.getDay());if(wc(a)){var s=Xe(a.before,e),n=Xe(a.after,e),o=s>0,i=n<0,l=Sa(a.before,a.after);return l?i&&o:o||i}return jc(a)?Xe(e,a.after)>0:Cc(a)?Xe(a.before,e)>0:typeof a=="function"?a(e):!1})}function Br(e,t,a){var s=Object.keys(t).reduce(function(o,i){var l=t[i];return Dc(e,l)&&o.push(i),o},[]),n={};return s.forEach(function(o){return n[o]=!0}),a&&!Nr(e,a)&&(n.outside=!0),n}function Mc(e,t){for(var a=we(e[0]),s=Be(e[e.length-1]),n,o,i=a;i<=s;){var l=Br(i,t),c=!l.disabled&&!l.hidden;if(!c){i=Ne(i,1);continue}if(l.selected)return i;l.today&&!o&&(o=i),n||(n=i),i=Ne(i,1)}return o||n}var Tc=365;function gn(e,t){var a=t.moveBy,s=t.direction,n=t.context,o=t.modifiers,i=t.retry,l=i===void 0?{count:0,lastFocused:e}:i,c=n.weekStartsOn,d=n.fromDate,h=n.toDate,b=n.locale,f={day:Ne,week:Yt,month:Fe,year:co,startOfWeek:function(u){return n.ISOWeek?kr(u):Xt(u,{locale:b,weekStartsOn:c})},endOfWeek:function(u){return n.ISOWeek?zs(u):ka(u,{locale:b,weekStartsOn:c})}},m=f[a](e,s==="after"?1:-1);s==="before"&&d?m=uo([d,m]):s==="after"&&h&&(m=mo([h,m]));var M=!0;if(o){var x=Br(m,o);M=!x.disabled&&!x.hidden}return M?m:l.count>Tc?l.lastFocused:gn(m,{moveBy:a,direction:s,context:n,modifiers:o,retry:Z(Z({},l),{count:l.count+1})})}var yn=g.createContext(void 0);function Ic(e){var t=aa(),a=pn(),s=g.useState(),n=s[0],o=s[1],i=g.useState(),l=i[0],c=i[1],d=Mc(t.displayMonths,a),h=n??(l&&t.isDateDisplayed(l))?l:d,b=function(){c(n),o(void 0)},f=function(u){o(u)},m=ge(),M=function(u,p){if(n){var k=gn(n,{moveBy:u,direction:p,context:m,modifiers:a});De(n,k)||(t.goToDate(k,n),f(k))}},x={focusedDay:n,focusTarget:h,blur:b,focus:f,focusDayAfter:function(){return M("day","after")},focusDayBefore:function(){return M("day","before")},focusWeekAfter:function(){return M("week","after")},focusWeekBefore:function(){return M("week","before")},focusMonthBefore:function(){return M("month","before")},focusMonthAfter:function(){return M("month","after")},focusYearBefore:function(){return M("year","before")},focusYearAfter:function(){return M("year","after")},focusStartOfWeek:function(){return M("startOfWeek","before")},focusEndOfWeek:function(){return M("endOfWeek","after")}};return r.jsx(yn.Provider,{value:x,children:e.children})}function Vr(){var e=g.useContext(yn);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}function Pc(e,t){var a=pn(),s=Br(e,a,t);return s}var qr=g.createContext(void 0);function Ac(e){if(!Ia(e.initialProps)){var t={selected:void 0};return r.jsx(qr.Provider,{value:t,children:e.children})}return r.jsx(Oc,{initialProps:e.initialProps,children:e.children})}function Oc(e){var t=e.initialProps,a=e.children,s=function(o,i,l){var c,d,h;if((c=t.onDayClick)===null||c===void 0||c.call(t,o,i,l),i.selected&&!t.required){(d=t.onSelect)===null||d===void 0||d.call(t,void 0,o,i,l);return}(h=t.onSelect)===null||h===void 0||h.call(t,o,o,i,l)},n={selected:t.selected,onDayClick:s};return r.jsx(qr.Provider,{value:n,children:a})}function vn(){var e=g.useContext(qr);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function Rc(e,t){var a=ge(),s=vn(),n=Fr(),o=Ur(),i=Vr(),l=i.focusDayAfter,c=i.focusDayBefore,d=i.focusWeekAfter,h=i.focusWeekBefore,b=i.blur,f=i.focus,m=i.focusMonthBefore,M=i.focusMonthAfter,x=i.focusYearBefore,u=i.focusYearAfter,p=i.focusStartOfWeek,k=i.focusEndOfWeek,I=function(W){var P,z,E,w;Ia(a)?(P=s.onDayClick)===null||P===void 0||P.call(s,e,t,W):ea(a)?(z=n.onDayClick)===null||z===void 0||z.call(n,e,t,W):ta(a)?(E=o.onDayClick)===null||E===void 0||E.call(o,e,t,W):(w=a.onDayClick)===null||w===void 0||w.call(a,e,t,W)},T=function(W){var P;f(e),(P=a.onDayFocus)===null||P===void 0||P.call(a,e,t,W)},_=function(W){var P;b(),(P=a.onDayBlur)===null||P===void 0||P.call(a,e,t,W)},S=function(W){var P;(P=a.onDayMouseEnter)===null||P===void 0||P.call(a,e,t,W)},N=function(W){var P;(P=a.onDayMouseLeave)===null||P===void 0||P.call(a,e,t,W)},A=function(W){var P;(P=a.onDayPointerEnter)===null||P===void 0||P.call(a,e,t,W)},D=function(W){var P;(P=a.onDayPointerLeave)===null||P===void 0||P.call(a,e,t,W)},j=function(W){var P;(P=a.onDayTouchCancel)===null||P===void 0||P.call(a,e,t,W)},y=function(W){var P;(P=a.onDayTouchEnd)===null||P===void 0||P.call(a,e,t,W)},O=function(W){var P;(P=a.onDayTouchMove)===null||P===void 0||P.call(a,e,t,W)},G=function(W){var P;(P=a.onDayTouchStart)===null||P===void 0||P.call(a,e,t,W)},Q=function(W){var P;(P=a.onDayKeyUp)===null||P===void 0||P.call(a,e,t,W)},ae=function(W){var P;switch(W.key){case"ArrowLeft":W.preventDefault(),W.stopPropagation(),a.dir==="rtl"?l():c();break;case"ArrowRight":W.preventDefault(),W.stopPropagation(),a.dir==="rtl"?c():l();break;case"ArrowDown":W.preventDefault(),W.stopPropagation(),d();break;case"ArrowUp":W.preventDefault(),W.stopPropagation(),h();break;case"PageUp":W.preventDefault(),W.stopPropagation(),W.shiftKey?x():m();break;case"PageDown":W.preventDefault(),W.stopPropagation(),W.shiftKey?u():M();break;case"Home":W.preventDefault(),W.stopPropagation(),p();break;case"End":W.preventDefault(),W.stopPropagation(),k();break}(P=a.onDayKeyDown)===null||P===void 0||P.call(a,e,t,W)},de={onClick:I,onFocus:T,onBlur:_,onKeyDown:ae,onKeyUp:Q,onMouseEnter:S,onMouseLeave:N,onPointerEnter:A,onPointerLeave:D,onTouchCancel:j,onTouchEnd:y,onTouchMove:O,onTouchStart:G};return de}function Lc(){var e=ge(),t=vn(),a=Fr(),s=Ur(),n=Ia(e)?t.selected:ea(e)?a.selected:ta(e)?s.selected:void 0;return n}function $c(e){return Object.values(ze).includes(e)}function Fc(e,t){var a=[e.classNames.day];return Object.keys(t).forEach(function(s){var n=e.modifiersClassNames[s];if(n)a.push(n);else if($c(s)){var o=e.classNames["day_".concat(s)];o&&a.push(o)}}),a}function zc(e,t){var a=Z({},e.styles.day);return Object.keys(t).forEach(function(s){var n;a=Z(Z({},a),(n=e.modifiersStyles)===null||n===void 0?void 0:n[s])}),a}function Uc(e,t,a){var s,n,o,i=ge(),l=Vr(),c=Pc(e,t),d=Rc(e,c),h=Lc(),b=!!(i.onDayClick||i.mode!=="default");g.useEffect(function(){var S;c.outside||l.focusedDay&&b&&De(l.focusedDay,e)&&((S=a.current)===null||S===void 0||S.focus())},[l.focusedDay,e,a,b,c.outside]);var f=Fc(i,c).join(" "),m=zc(i,c),M=!!(c.outside&&!i.showOutsideDays||c.hidden),x=(o=(n=i.components)===null||n===void 0?void 0:n.DayContent)!==null&&o!==void 0?o:lc,u=r.jsx(x,{date:e,displayMonth:t,activeModifiers:c}),p={style:m,className:f,children:u,role:"gridcell"},k=l.focusTarget&&De(l.focusTarget,e)&&!c.outside,I=l.focusedDay&&De(l.focusedDay,e),T=Z(Z(Z({},p),(s={disabled:c.disabled,role:"gridcell"},s["aria-selected"]=c.selected,s.tabIndex=I||k?0:-1,s)),d),_={isButton:b,isHidden:M,activeModifiers:c,selectedDays:h,buttonProps:T,divProps:p};return _}function Bc(e){var t=g.useRef(null),a=Uc(e.date,e.displayMonth,t);return a.isHidden?r.jsx("div",{role:"gridcell"}):a.isButton?r.jsx(Da,Z({name:"day",ref:t},a.buttonProps)):r.jsx("div",Z({},a.divProps))}function Vc(e){var t=e.number,a=e.dates,s=ge(),n=s.onWeekNumberClick,o=s.styles,i=s.classNames,l=s.locale,c=s.labels.labelWeekNumber,d=s.formatters.formatWeekNumber,h=d(Number(t),{locale:l});if(!n)return r.jsx("span",{className:i.weeknumber,style:o.weeknumber,children:h});var b=c(Number(t),{locale:l}),f=function(m){n(t,a,m)};return r.jsx(Da,{name:"week-number","aria-label":b,className:i.weeknumber,style:o.weeknumber,onClick:f,children:h})}function qc(e){var t,a,s=ge(),n=s.styles,o=s.classNames,i=s.showWeekNumber,l=s.components,c=(t=l?.Day)!==null&&t!==void 0?t:Bc,d=(a=l?.WeekNumber)!==null&&a!==void 0?a:Vc,h;return i&&(h=r.jsx("td",{className:o.cell,style:n.cell,children:r.jsx(d,{number:e.weekNumber,dates:e.dates})})),r.jsxs("tr",{className:o.row,style:n.row,children:[h,e.dates.map(function(b){return r.jsx("td",{className:o.cell,style:n.cell,role:"presentation",children:r.jsx(c,{displayMonth:e.displayMonth,date:b})},lo(b))})]})}function _s(e,t,a){for(var s=a?.ISOWeek?zs(t):ka(t,a),n=a?.ISOWeek?kr(e):Xt(e,a),o=Xe(s,n),i=[],l=0;l<=o;l++)i.push(Ne(n,l));var c=i.reduce(function(d,h){var b=a?.ISOWeek?po(h):go(h,a),f=d.find(function(m){return m.weekNumber===b});return f?(f.dates.push(h),d):(d.push({weekNumber:b,dates:[h]}),d)},[]);return c}function Wc(e,t){var a=_s(we(e),Be(e),t);if(t?.useFixedWeeks){var s=io(e,t);if(s<6){var n=a[a.length-1],o=n.dates[n.dates.length-1],i=Yt(o,6-s),l=_s(Yt(o,1),i,t);a.push.apply(a,l)}}return a}function Hc(e){var t,a,s,n=ge(),o=n.locale,i=n.classNames,l=n.styles,c=n.hideHead,d=n.fixedWeeks,h=n.components,b=n.weekStartsOn,f=n.firstWeekContainsDate,m=n.ISOWeek,M=Wc(e.displayMonth,{useFixedWeeks:!!d,ISOWeek:m,locale:o,weekStartsOn:b,firstWeekContainsDate:f}),x=(t=h?.Head)!==null&&t!==void 0?t:ic,u=(a=h?.Row)!==null&&a!==void 0?a:qc,p=(s=h?.Footer)!==null&&s!==void 0?s:sc;return r.jsxs("table",{id:e.id,className:i.table,style:l.table,role:"grid","aria-labelledby":e["aria-labelledby"],children:[!c&&r.jsx(x,{}),r.jsx("tbody",{className:i.tbody,style:l.tbody,children:M.map(function(k){return r.jsx(u,{displayMonth:e.displayMonth,dates:k.dates,weekNumber:k.weekNumber},k.weekNumber)})}),r.jsx(p,{displayMonth:e.displayMonth})]})}function Gc(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var Yc=Gc()?g.useLayoutEffect:g.useEffect,Xa=!1,Jc=0;function js(){return"react-day-picker-".concat(++Jc)}function Qc(e){var t,a=e??(Xa?js():null),s=g.useState(a),n=s[0],o=s[1];return Yc(function(){n===null&&o(js())},[]),g.useEffect(function(){Xa===!1&&(Xa=!0)},[]),(t=e??n)!==null&&t!==void 0?t:void 0}function Kc(e){var t,a,s=ge(),n=s.dir,o=s.classNames,i=s.styles,l=s.components,c=aa().displayMonths,d=Qc(s.id?"".concat(s.id,"-").concat(e.displayIndex):void 0),h=s.id?"".concat(s.id,"-grid-").concat(e.displayIndex):void 0,b=[o.month],f=i.month,m=e.displayIndex===0,M=e.displayIndex===c.length-1,x=!m&&!M;n==="rtl"&&(t=[m,M],M=t[0],m=t[1]),m&&(b.push(o.caption_start),f=Z(Z({},f),i.caption_start)),M&&(b.push(o.caption_end),f=Z(Z({},f),i.caption_end)),x&&(b.push(o.caption_between),f=Z(Z({},f),i.caption_between));var u=(a=l?.Caption)!==null&&a!==void 0?a:rc;return r.jsxs("div",{className:b.join(" "),style:f,children:[r.jsx(u,{id:d,displayMonth:e.displayMonth,displayIndex:e.displayIndex}),r.jsx(Hc,{id:h,"aria-labelledby":d,displayMonth:e.displayMonth})]},e.displayIndex)}function Zc(e){var t=ge(),a=t.classNames,s=t.styles;return r.jsx("div",{className:a.months,style:s.months,children:e.children})}function Xc(e){var t,a,s=e.initialProps,n=ge(),o=Vr(),i=aa(),l=g.useState(!1),c=l[0],d=l[1];g.useEffect(function(){n.initialFocus&&o.focusTarget&&(c||(o.focus(o.focusTarget),d(!0)))},[n.initialFocus,c,o.focus,o.focusTarget,o]);var h=[n.classNames.root,n.className];n.numberOfMonths>1&&h.push(n.classNames.multiple_months),n.showWeekNumber&&h.push(n.classNames.with_weeknumber);var b=Z(Z({},n.styles.root),n.style),f=Object.keys(s).filter(function(M){return M.startsWith("data-")}).reduce(function(M,x){var u;return Z(Z({},M),(u={},u[x]=s[x],u))},{}),m=(a=(t=s.components)===null||t===void 0?void 0:t.Months)!==null&&a!==void 0?a:Zc;return r.jsx("div",Z({className:h.join(" "),style:b,dir:n.dir,id:n.id,nonce:s.nonce,title:s.title,lang:s.lang},f,{children:r.jsx(m,{children:i.displayMonths.map(function(M,x){return r.jsx(Kc,{displayIndex:x,displayMonth:M},x)})})}))}function ed(e){var t=e.children,a=Cl(e,["children"]);return r.jsx(Vl,{initialProps:a,children:r.jsx(Xl,{children:r.jsx(Ac,{initialProps:a,children:r.jsx(cc,{initialProps:a,children:r.jsx(mc,{initialProps:a,children:r.jsx(xc,{children:r.jsx(Ic,{children:t})})})})})})})}function td(e){return r.jsx(ed,Z({},e,{children:r.jsx(Xc,{initialProps:e})}))}const Wr="-",ad=e=>{const t=sd(e),{conflictingClassGroups:a,conflictingClassGroupModifiers:s}=e;return{getClassGroupId:i=>{const l=i.split(Wr);return l[0]===""&&l.length!==1&&l.shift(),bn(l,t)||rd(i)},getConflictingClassGroupIds:(i,l)=>{const c=a[i]||[];return l&&s[i]?[...c,...s[i]]:c}}},bn=(e,t)=>{if(e.length===0)return t.classGroupId;const a=e[0],s=t.nextPart.get(a),n=s?bn(e.slice(1),s):void 0;if(n)return n;if(t.validators.length===0)return;const o=e.join(Wr);return t.validators.find(({validator:i})=>i(o))?.classGroupId},Cs=/^\[(.+)\]$/,rd=e=>{if(Cs.test(e)){const t=Cs.exec(e)[1],a=t?.substring(0,t.indexOf(":"));if(a)return"arbitrary.."+a}},sd=e=>{const{theme:t,prefix:a}=e,s={nextPart:new Map,validators:[]};return od(Object.entries(e.classGroups),a).forEach(([o,i])=>{mr(i,s,o,t)}),s},mr=(e,t,a,s)=>{e.forEach(n=>{if(typeof n=="string"){const o=n===""?t:Ns(t,n);o.classGroupId=a;return}if(typeof n=="function"){if(nd(n)){mr(n(s),t,a,s);return}t.validators.push({validator:n,classGroupId:a});return}Object.entries(n).forEach(([o,i])=>{mr(i,Ns(t,o),a,s)})})},Ns=(e,t)=>{let a=e;return t.split(Wr).forEach(s=>{a.nextPart.has(s)||a.nextPart.set(s,{nextPart:new Map,validators:[]}),a=a.nextPart.get(s)}),a},nd=e=>e.isThemeGetter,od=(e,t)=>t?e.map(([a,s])=>{const n=s.map(o=>typeof o=="string"?t+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([i,l])=>[t+i,l])):o);return[a,n]}):e,id=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,a=new Map,s=new Map;const n=(o,i)=>{a.set(o,i),t++,t>e&&(t=0,s=a,a=new Map)};return{get(o){let i=a.get(o);if(i!==void 0)return i;if((i=s.get(o))!==void 0)return n(o,i),i},set(o,i){a.has(o)?a.set(o,i):n(o,i)}}},xn="!",ld=e=>{const{separator:t,experimentalParseClassName:a}=e,s=t.length===1,n=t[0],o=t.length,i=l=>{const c=[];let d=0,h=0,b;for(let u=0;u<l.length;u++){let p=l[u];if(d===0){if(p===n&&(s||l.slice(u,u+o)===t)){c.push(l.slice(h,u)),h=u+o;continue}if(p==="/"){b=u;continue}}p==="["?d++:p==="]"&&d--}const f=c.length===0?l:l.substring(h),m=f.startsWith(xn),M=m?f.substring(1):f,x=b&&b>h?b-h:void 0;return{modifiers:c,hasImportantModifier:m,baseClassName:M,maybePostfixModifierPosition:x}};return a?l=>a({className:l,parseClassName:i}):i},cd=e=>{if(e.length<=1)return e;const t=[];let a=[];return e.forEach(s=>{s[0]==="["?(t.push(...a.sort(),s),a=[]):a.push(s)}),t.push(...a.sort()),t},dd=e=>({cache:id(e.cacheSize),parseClassName:ld(e),...ad(e)}),ud=/\s+/,md=(e,t)=>{const{parseClassName:a,getClassGroupId:s,getConflictingClassGroupIds:n}=t,o=[],i=e.trim().split(ud);let l="";for(let c=i.length-1;c>=0;c-=1){const d=i[c],{modifiers:h,hasImportantModifier:b,baseClassName:f,maybePostfixModifierPosition:m}=a(d);let M=!!m,x=s(M?f.substring(0,m):f);if(!x){if(!M){l=d+(l.length>0?" "+l:l);continue}if(x=s(f),!x){l=d+(l.length>0?" "+l:l);continue}M=!1}const u=cd(h).join(":"),p=b?u+xn:u,k=p+x;if(o.includes(k))continue;o.push(k);const I=n(x,M);for(let T=0;T<I.length;++T){const _=I[T];o.push(p+_)}l=d+(l.length>0?" "+l:l)}return l};function fd(){let e=0,t,a,s="";for(;e<arguments.length;)(t=arguments[e++])&&(a=wn(t))&&(s&&(s+=" "),s+=a);return s}const wn=e=>{if(typeof e=="string")return e;let t,a="";for(let s=0;s<e.length;s++)e[s]&&(t=wn(e[s]))&&(a&&(a+=" "),a+=t);return a};function hd(e,...t){let a,s,n,o=i;function i(c){const d=t.reduce((h,b)=>b(h),e());return a=dd(d),s=a.cache.get,n=a.cache.set,o=l,l(c)}function l(c){const d=s(c);if(d)return d;const h=md(c,a);return n(c,h),h}return function(){return o(fd.apply(null,arguments))}}const ye=e=>{const t=a=>a[e]||[];return t.isThemeGetter=!0,t},_n=/^\[(?:([a-z-]+):)?(.+)\]$/i,pd=/^\d+\/\d+$/,gd=new Set(["px","full","screen"]),yd=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,vd=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,bd=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,xd=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,wd=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ze=e=>Dt(e)||gd.has(e)||pd.test(e),nt=e=>Mt(e,"length",Dd),Dt=e=>!!e&&!Number.isNaN(Number(e)),er=e=>Mt(e,"number",Dt),Lt=e=>!!e&&Number.isInteger(Number(e)),_d=e=>e.endsWith("%")&&Dt(e.slice(0,-1)),se=e=>_n.test(e),ot=e=>yd.test(e),jd=new Set(["length","size","percentage"]),Cd=e=>Mt(e,jd,jn),Nd=e=>Mt(e,"position",jn),Sd=new Set(["image","url"]),kd=e=>Mt(e,Sd,Td),Ed=e=>Mt(e,"",Md),$t=()=>!0,Mt=(e,t,a)=>{const s=_n.exec(e);return s?s[1]?typeof t=="string"?s[1]===t:t.has(s[1]):a(s[2]):!1},Dd=e=>vd.test(e)&&!bd.test(e),jn=()=>!1,Md=e=>xd.test(e),Td=e=>wd.test(e),Id=()=>{const e=ye("colors"),t=ye("spacing"),a=ye("blur"),s=ye("brightness"),n=ye("borderColor"),o=ye("borderRadius"),i=ye("borderSpacing"),l=ye("borderWidth"),c=ye("contrast"),d=ye("grayscale"),h=ye("hueRotate"),b=ye("invert"),f=ye("gap"),m=ye("gradientColorStops"),M=ye("gradientColorStopPositions"),x=ye("inset"),u=ye("margin"),p=ye("opacity"),k=ye("padding"),I=ye("saturate"),T=ye("scale"),_=ye("sepia"),S=ye("skew"),N=ye("space"),A=ye("translate"),D=()=>["auto","contain","none"],j=()=>["auto","hidden","clip","visible","scroll"],y=()=>["auto",se,t],O=()=>[se,t],G=()=>["",Ze,nt],Q=()=>["auto",Dt,se],ae=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],de=()=>["solid","dashed","dotted","double","none"],W=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],P=()=>["start","end","center","between","around","evenly","stretch"],z=()=>["","0",se],E=()=>["auto","avoid","all","avoid-page","page","left","right","column"],w=()=>[Dt,se];return{cacheSize:500,separator:":",theme:{colors:[$t],spacing:[Ze,nt],blur:["none","",ot,se],brightness:w(),borderColor:[e],borderRadius:["none","","full",ot,se],borderSpacing:O(),borderWidth:G(),contrast:w(),grayscale:z(),hueRotate:w(),invert:z(),gap:O(),gradientColorStops:[e],gradientColorStopPositions:[_d,nt],inset:y(),margin:y(),opacity:w(),padding:O(),saturate:w(),scale:w(),sepia:z(),skew:w(),space:O(),translate:O()},classGroups:{aspect:[{aspect:["auto","square","video",se]}],container:["container"],columns:[{columns:[ot]}],"break-after":[{"break-after":E()}],"break-before":[{"break-before":E()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...ae(),se]}],overflow:[{overflow:j()}],"overflow-x":[{"overflow-x":j()}],"overflow-y":[{"overflow-y":j()}],overscroll:[{overscroll:D()}],"overscroll-x":[{"overscroll-x":D()}],"overscroll-y":[{"overscroll-y":D()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Lt,se]}],basis:[{basis:y()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",se]}],grow:[{grow:z()}],shrink:[{shrink:z()}],order:[{order:["first","last","none",Lt,se]}],"grid-cols":[{"grid-cols":[$t]}],"col-start-end":[{col:["auto",{span:["full",Lt,se]},se]}],"col-start":[{"col-start":Q()}],"col-end":[{"col-end":Q()}],"grid-rows":[{"grid-rows":[$t]}],"row-start-end":[{row:["auto",{span:[Lt,se]},se]}],"row-start":[{"row-start":Q()}],"row-end":[{"row-end":Q()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",se]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",se]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...P()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...P(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...P(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[k]}],px:[{px:[k]}],py:[{py:[k]}],ps:[{ps:[k]}],pe:[{pe:[k]}],pt:[{pt:[k]}],pr:[{pr:[k]}],pb:[{pb:[k]}],pl:[{pl:[k]}],m:[{m:[u]}],mx:[{mx:[u]}],my:[{my:[u]}],ms:[{ms:[u]}],me:[{me:[u]}],mt:[{mt:[u]}],mr:[{mr:[u]}],mb:[{mb:[u]}],ml:[{ml:[u]}],"space-x":[{"space-x":[N]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[N]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",se,t]}],"min-w":[{"min-w":[se,t,"min","max","fit"]}],"max-w":[{"max-w":[se,t,"none","full","min","max","fit","prose",{screen:[ot]},ot]}],h:[{h:[se,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[se,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[se,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[se,t,"auto","min","max","fit"]}],"font-size":[{text:["base",ot,nt]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",er]}],"font-family":[{font:[$t]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",se]}],"line-clamp":[{"line-clamp":["none",Dt,er]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ze,se]}],"list-image":[{"list-image":["none",se]}],"list-style-type":[{list:["none","disc","decimal",se]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[p]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[p]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...de(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ze,nt]}],"underline-offset":[{"underline-offset":["auto",Ze,se]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:O()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",se]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",se]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[p]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...ae(),Nd]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Cd]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},kd]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[M]}],"gradient-via-pos":[{via:[M]}],"gradient-to-pos":[{to:[M]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[p]}],"border-style":[{border:[...de(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[p]}],"divide-style":[{divide:de()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...de()]}],"outline-offset":[{"outline-offset":[Ze,se]}],"outline-w":[{outline:[Ze,nt]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:G()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[p]}],"ring-offset-w":[{"ring-offset":[Ze,nt]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",ot,Ed]}],"shadow-color":[{shadow:[$t]}],opacity:[{opacity:[p]}],"mix-blend":[{"mix-blend":[...W(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":W()}],filter:[{filter:["","none"]}],blur:[{blur:[a]}],brightness:[{brightness:[s]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",ot,se]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[b]}],saturate:[{saturate:[I]}],sepia:[{sepia:[_]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[a]}],"backdrop-brightness":[{"backdrop-brightness":[s]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[b]}],"backdrop-opacity":[{"backdrop-opacity":[p]}],"backdrop-saturate":[{"backdrop-saturate":[I]}],"backdrop-sepia":[{"backdrop-sepia":[_]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[i]}],"border-spacing-x":[{"border-spacing-x":[i]}],"border-spacing-y":[{"border-spacing-y":[i]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",se]}],duration:[{duration:w()}],ease:[{ease:["linear","in","out","in-out",se]}],delay:[{delay:w()}],animate:[{animate:["none","spin","ping","pulse","bounce",se]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[T]}],"scale-x":[{"scale-x":[T]}],"scale-y":[{"scale-y":[T]}],rotate:[{rotate:[Lt,se]}],"translate-x":[{"translate-x":[A]}],"translate-y":[{"translate-y":[A]}],"skew-x":[{"skew-x":[S]}],"skew-y":[{"skew-y":[S]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",se]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",se]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":O()}],"scroll-mx":[{"scroll-mx":O()}],"scroll-my":[{"scroll-my":O()}],"scroll-ms":[{"scroll-ms":O()}],"scroll-me":[{"scroll-me":O()}],"scroll-mt":[{"scroll-mt":O()}],"scroll-mr":[{"scroll-mr":O()}],"scroll-mb":[{"scroll-mb":O()}],"scroll-ml":[{"scroll-ml":O()}],"scroll-p":[{"scroll-p":O()}],"scroll-px":[{"scroll-px":O()}],"scroll-py":[{"scroll-py":O()}],"scroll-ps":[{"scroll-ps":O()}],"scroll-pe":[{"scroll-pe":O()}],"scroll-pt":[{"scroll-pt":O()}],"scroll-pr":[{"scroll-pr":O()}],"scroll-pb":[{"scroll-pb":O()}],"scroll-pl":[{"scroll-pl":O()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",se]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Ze,nt,er]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Pd=hd(Id);function le(...e){return Pd(yo(e))}const fr=vo("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),Cn=g.forwardRef(({className:e,variant:t,size:a,asChild:s=!1,...n},o)=>{const i=s?_o:"button";return r.jsx(i,{className:le(fr({variant:t,size:a,className:e})),ref:o,...n})});Cn.displayName="Button";function Nn({className:e,classNames:t,showOutsideDays:a=!0,...s}){return r.jsx(td,{showOutsideDays:a,className:le("p-3",e),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:le(fr({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:le(fr({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...n})=>r.jsx(Vs,{className:"h-4 w-4"}),IconRight:({...n})=>r.jsx(Bs,{className:"h-4 w-4"})},...s})}Nn.displayName="Calendar";function Ad(e,t){const a=t.name.toLowerCase();return a.includes("verbal")||a.includes("lost")?null:a.includes("sql")||a.includes("mql")?"meeting":a.includes("opportunity")?null:a.includes("signed")&&!a.includes("paid")?"sale":null}async function Od(e,t,a){try{v.log(` Creating ${a} activity for deal ${e.id} (${e.name||e.company})`);const{data:{user:s}}=await R.auth.getUser();if(!s)return v.warn(" No authenticated user for activity creation"),!1;if(v.log(` Current user: ${s.id}, Deal owner: ${e.owner_id}`),e.owner_id!==s.id)return v.warn(` Skipping activity creation - user ${s.id} is not deal owner ${e.owner_id}`),!1;const{data:n}=await R.from("profiles").select("first_name, last_name").eq("id",s.id).single();if(!n)return v.warn("User profile not found for activity creation"),!1;const o=`${n.first_name||""} ${n.last_name||""}`.trim();let i="",l="medium",c=0;switch(a){case"meeting":i=`Initial meeting for ${e.name||e.company||"deal"}`,l="medium";break;case"proposal":i=`Proposal sent for ${e.name||e.company||"deal"}`,l="high",c=e.value;break;case"sale":i=`${e.name||e.company||"Sale"} - Closed Won`,l="high",c=e.value;break}const{data:d}=await R.from("activities").select("id").eq("deal_id",e.id).eq("type",a).eq("user_id",s.id).maybeSingle();if(d)return v.info(`Activity of type ${a} already exists for deal ${e.id}`),!1;const h={user_id:s.id,type:a,client_name:e.company||e.name||"Unknown Client",details:i,amount:c,priority:l,sales_rep:o,date:new Date().toISOString(),status:"completed",quantity:1,deal_id:e.id,contact_identifier:e.contact_email||null,contact_identifier_type:e.contact_email?"email":null},{error:b}=await R.from("activities").insert(h);return b?(v.error(`Failed to create ${a} activity for deal ${e.id}:`,b),!1):(v.log(` Created ${a} activity for deal ${e.id} (${e.name})`),!0)}catch{return!1}}async function Ss(e,t,a){v.log(` Pipeline Activity Check: ${e.name||e.company} moving from ${t?.name||"unknown"} to ${a.name}`);const s=Ad(t,a);return s?(v.log(` Activity type determined: ${s} for stage ${a.name}`),await Od(e,a,s)):(v.log(` No activity needed for transition to ${a.name}`),!1)}function Ft(e){const t=e?.message||"Unknown error";return v.error("Deal operation error (sanitized for user):",{message:t,timestamp:new Date().toISOString()}),t.includes("duplicate key")?"A deal with this information already exists":t.includes("foreign key")?"Referenced record not found":t.includes("PGRST")?"Database connection error":t.includes("JWT")?"Authentication required":"Operation failed. Please try again."}function Sn(e){const{isViewMode:t,viewedUser:a}=Ar(),[s,n]=g.useState([]),[o,i]=g.useState([]),[l,c]=g.useState(!0),[d,h]=g.useState(null),b=t&&a?a.id:e,f=g.useCallback(async()=>{try{c(!0),h(null),v.log(" Starting deals fetch for owner:",b||"ALL",t?"(View Mode)":"");const{data:{session:_}}=await R.auth.getSession();if(!_){v.log(" No session found, using service key fallback");let D,j;try{v.log(" Trying basic deals query with service key...");let O=qe.from("deals").select("*");b&&(O=O.eq("owner_id",b));const G=await O.order("created_at",{ascending:!1});if(D=G.data,j=G.error,j)throw v.error(" Service key basic query failed:",j),j;v.log(` Service key query successful: ${D?.length||0} deals found`)}catch(O){throw v.error(" Service client query failed:",O),O}const y=D?.map(O=>({...O,company:O.company||"",contact_name:O.contact_name||"",daysInStage:O.stage_changed_at?Math.floor((new Date().getTime()-new Date(O.stage_changed_at).getTime())/(1e3*60*60*24)):0,timeStatus:"normal"}))||[];n(y),c(!1);return}v.log(" Session found, using direct Supabase query");let S,N;try{let D=R.from("deals").select("*");b&&(D=D.eq("owner_id",b));const j=await D.order("created_at",{ascending:!1});if(S=j.data,N=j.error,N){v.warn("Regular client failed, trying admin client:",N);let y=qe.from("deals").select("*");b&&(y=y.eq("owner_id",b));const O=await y.order("created_at",{ascending:!1});S=O.data,N=O.error}if(N)throw v.error(" All queries failed:",N),N;v.log(` Query successful: ${S?.length||0} deals found`)}catch(D){throw v.error(" Failed to fetch deals:",D),D}const A=S?.map(D=>({...D,company:D.company||"",contact_name:D.contact_name||"",daysInStage:D.stage_changed_at?Math.floor((new Date().getTime()-new Date(D.stage_changed_at).getTime())/(1e3*60*60*24)):0,timeStatus:"normal"}))||[];v.log(` Processing complete: ${A.length} deals ready`),n(A)}catch(_){const S=Ft(_);h(S),L.error(S)}finally{c(!1)}},[b]),m=g.useCallback(async()=>{try{try{const _=await Ue(`${pe}/stages`,{},{maxRetries:1,retryDelay:1e3,showToast:!1});i(_||[]);return}catch{const{data:S,error:N}=await R.from("deal_stages").select("*").order("order_position",{ascending:!0});if(N)throw N;i(S||[])}}catch(_){h(_.message)}},[]);g.useEffect(()=>{m(),f()},[b,f,m]);const M=s.reduce((_,S)=>{const N=S.stage_id;return _[N]||(_[N]=[]),_[N].push(S),_},{}),x=async _=>{try{v.log(" Starting deal creation with data:",_),v.log(" API_BASE_URL:",pe);try{const S=await Ue(`${pe}/deals`,{method:"POST",body:JSON.stringify(_)},{maxRetries:1,retryDelay:1e3,showToast:!1});v.log(" Deal API response:",S),L.success("Deal created successfully"),await f();const N=S.data?.data||S.data||S;return v.log(" Extracted deal from response:",N),N}catch(S){v.log(" API call failed, falling back to Supabase:",S);const{data:N,error:A}=await R.from("deals").insert({..._,stage_changed_at:new Date().toISOString()}).select().single();if(A)throw v.error(" Supabase fallback also failed:",A),A;return v.log(" Deal created via Supabase fallback:",N),L.success("Deal created successfully"),await f(),N}}catch(S){const N=Ft(S);return L.error(N),!1}},u=async(_,S)=>{try{v.log(" Updating deal with data:",S);try{const N=await Ue(`${pe}/deals/${_}`,{method:"PUT",body:JSON.stringify(S)},{maxRetries:1,retryDelay:1e3,showToast:!1});return v.log(" Edge Function update successful"),L.success("Deal updated successfully"),v.log(" Calling fetchDeals to refresh pipeline data after update..."),await f(),v.log(" Pipeline data refreshed after deal update"),!0}catch(N){v.warn(" Edge Function failed, trying direct Supabase client:",N);const A={...S};if(S.stage_id){const{data:D}=await R.from("deals").select("stage_id").eq("id",_).single();D&&D.stage_id!==S.stage_id&&(A.stage_changed_at=new Date().toISOString())}if("expected_close_date"in A){if(v.log(" Processing expected_close_date:",A.expected_close_date),A.expected_close_date===""||A.expected_close_date===void 0)A.expected_close_date=null;else if(A.expected_close_date)try{const D=new Date(A.expected_close_date);isNaN(D.getTime())?(v.warn(" Invalid date format, setting to null"),A.expected_close_date=null):A.expected_close_date=D.toISOString().split("T")[0]}catch(D){v.warn(" Date processing error, setting to null:",D),A.expected_close_date=null}}v.log(" Final update data being sent to Supabase:",A);try{const{data:D,error:j}=await R.from("deals").update(A).eq("id",_).select().single();if(j){if(j.message&&j.message.includes("expected_close_date")&&j.message.includes("schema cache")){v.warn(" Schema cache issue detected, trying update without expected_close_date");const{expected_close_date:y,...O}=A,{data:G,error:Q}=await R.from("deals").update(O).eq("id",_).select().single();if(Q)throw Q;return L.success("Deal updated successfully (note: close date may need manual update)"),v.log(" Calling fetchDeals to refresh pipeline data after fallback update..."),await f(),v.log(" Pipeline data refreshed after fallback deal update"),!0}throw j}return v.log(" Direct Supabase update successful"),L.success("Deal updated successfully"),v.log(" Calling fetchDeals to refresh pipeline data after update..."),await f(),v.log(" Pipeline data refreshed after deal update"),!0}catch(D){if(v.error(" Supabase update failed:",D),D.message&&D.message.includes("schema cache")){v.log(" Attempting basic update without problematic fields...");const j={name:A.name,company:A.company,value:A.value,stage_id:A.stage_id,probability:A.probability,notes:A.notes||A.description,updated_at:new Date().toISOString()};Object.keys(j).forEach(G=>{j[G]===void 0&&delete j[G]});const{data:y,error:O}=await R.from("deals").update(j).eq("id",_).select().single();if(O)throw O;return L.success("Deal updated successfully (some fields may need manual update)"),v.log(" Calling fetchDeals to refresh pipeline data after basic update..."),await f(),v.log(" Pipeline data refreshed after basic deal update"),!0}throw D}}}catch(N){let D=Ft(N);return N.message&&N.message.includes("expected_close_date")?D="Failed to update deal - there may be an issue with the close date field":N.message&&N.message.includes("schema cache")&&(D="Database schema issue - please try again or contact support"),L.error(D),!1}},p=async _=>{try{try{const S=await Ue(`${pe}/deals/${_}`,{method:"DELETE"},{maxRetries:1,retryDelay:1e3,showToast:!1});return L.success("Deal deleted successfully"),await f(),!0}catch{const{error:N}=await R.from("deals").delete().eq("id",_);if(N)throw N;return L.success("Deal deleted successfully"),await f(),!0}}catch(S){const N=Ft(S);return L.error(N),!1}},k=async(_,S)=>{try{const N=s.find(j=>j.id===_),A=N&&N.stage_id&&o.find(j=>j.id===N.stage_id)||null,D=o.find(j=>j.id===S);try{const j=await Ue(`${pe}/deals/${_}`,{method:"PUT",body:JSON.stringify({stage_id:S,stage_changed_at:new Date().toISOString()})},{maxRetries:1,retryDelay:1e3,showToast:!1});return N&&D&&await Ss({id:N.id,name:N.name,company:N.company,value:N.value,owner_id:N.owner_id,contact_email:N.contact_email},A,D),await f(),!0}catch{const{data:y,error:O}=await R.from("deals").update({stage_id:S,stage_changed_at:new Date().toISOString()}).eq("id",_).select().single();if(O)throw O;return N&&D&&await Ss({id:N.id,name:N.name,company:N.company,value:N.value,owner_id:N.owner_id,contact_email:N.contact_email},A,D),await f(),!0}}catch(N){const A=Ft(N);return L.error(A),!1}};return{deals:s,stages:o,dealsByStage:M,isLoading:l,error:d,createDeal:x,updateDeal:u,deleteDeal:p,moveDealToStage:k,forceUpdateDealStage:async(_,S)=>await k(_,S),refreshDeals:f}}function Rd(){const[e,t]=g.useState([]),[a,s]=g.useState(!0),[n,o]=g.useState(null),[i,l]=g.useState(0);return g.useEffect(()=>{(async()=>{try{s(!0),o(null),v.log(" Checking user authentication for stages...");const{data:{session:m}}=await R.auth.getSession();if(!m){v.log(" No session found - skipping Edge Functions, going straight to service key fallback for stages...");const u=Na("https://ewtuefzeogytgmsnkpmb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNzg5NDkyNywiZXhwIjoyMDUzNDcwOTI3fQ.jKjwRZn7fi9rJUcmWPe5zBRpq7leefmx0H8U59bfVEs");v.log(" Stages service key fallback (no auth)...");const{data:p,error:k}=await u.from("deal_stages").select("*").order("order_position");if(k)throw v.error(" Service key stages fallback failed:",k),k;v.log(` Service key stages fallback successful: Retrieved ${p?.length||0} stages`),v.log(" Stage data structure:",p?.[0]),p?.forEach(I=>v.log(`    Stage: id=${I.id}, name=${I.name}, order=${I.order_position}`)),t(p||[]),s(!1);return}v.log(" Using direct Supabase client for stages...");const{data:M,error:x}=await R.from("deal_stages").select("*").order("order_position");if(x){v.error(" Stages fetch failed:",x),v.log(" Trying stages with service role key...");try{const u=Na("https://ewtuefzeogytgmsnkpmb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNzg5NDkyNywiZXhwIjoyMDUzNDcwOTI3fQ.jKjwRZn7fi9rJUcmWPe5zBRpq7leefmx0H8U59bfVEs"),{data:p,error:k}=await u.from("deal_stages").select("*").order("order_position");if(k)throw v.error(" Service key stages fallback also failed:",k),k;v.log(` Service key stages fallback successful: Retrieved ${p?.length||0} stages`),p?.forEach(I=>v.log(`    Stage: ${I.name}`)),t(p||[]);return}catch(u){throw v.error(" All stages fallback methods failed:",u),u}}v.log(` Stages fetch successful: Retrieved ${M?.length||0} stages`),v.log(" First stage data structure:",M?.[0]),M?.forEach(u=>v.log(`    Stage: id=${u.id}, name="${u.name}", order=${u.order_position}`)),t(M||[])}catch(m){o(m)}finally{s(!1)}})()},[i]),{stages:e,isLoading:a,error:n,createStage:async f=>{try{o(null);const{data:m}=await R.from("deal_stages").select("order_position").order("order_position",{ascending:!1}).limit(1).single(),M=(m?.order_position||0)+1,{data:x,error:u}=await R.from("deal_stages").insert({...f,order_position:M}).select().single();if(u)throw u;return t(p=>[...p,x].sort((k,I)=>k.order_position-I.order_position)),x}catch(m){return o(m),null}},updateStage:async(f,m)=>{try{o(null);const{data:M,error:x}=await R.from("deal_stages").update(m).eq("id",f).select().single();if(x)throw x;return t(u=>u.map(p=>p.id===f?M:p).sort((p,k)=>p.order_position-k.order_position)),!0}catch(M){return o(M),!1}},deleteStage:async f=>{try{o(null);const{data:m}=await R.from("deals").select("id").eq("stage_id",f).limit(1);if(m&&m.length>0)throw new Error("Cannot delete stage with existing deals");const{error:M}=await R.from("deal_stages").delete().eq("id",f);if(M)throw M;return t(x=>x.filter(u=>u.id!==f)),!0}catch(m){return o(m),!1}},refetchStages:()=>{l(f=>f+1)}}}class Ct{static async getCompanies(t){try{const a=new URLSearchParams;t?.search&&a.append("search",t.search),t?.includeStats&&a.append("includeStats","true"),t?.domain&&a.append("domain",t.domain),t?.size&&a.append("size",t.size),t?.industry&&a.append("industry",t.industry);const s=await fetch(`${pe}/companies?${a}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return(await s.json()).data}catch(a){throw a}}static async getCompanyById(t,a=!0){try{const s=await fetch(`${pe}/companies/${t}?includeRelationships=${a}`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(s){throw s}}static async findCompanyByDomain(t){try{const a=await fetch(`${pe}/companies?domain=${encodeURIComponent(t.toLowerCase())}`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.json();return s.data.length>0?s.data[0]:null}catch{return null}}static extractDomainFromEmail(t){if(!t||!t.includes("@"))return null;const a=t.split("@")[1]?.toLowerCase();return["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","me.com","aol.com","live.com"].includes(a)?null:a}static suggestCompanyNameFromDomain(t){return t?t.replace(/\.(com|org|net|co\.uk|io|ai|tech)$/i,"").split(".").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):""}static async createCompany(t){try{t.domain&&(t.domain=t.domain.toLowerCase());try{const a=await fetch(`${pe}/companies`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(a){v.log(" Company API call failed, falling back to Supabase:",a);const{supabase:s}=await te(async()=>{const{supabase:i}=await Promise.resolve().then(()=>nn);return{supabase:i}},void 0),{data:n,error:o}=await s.from("companies").insert(t).select().single();if(o)throw v.error(" Supabase fallback also failed:",o),o;return v.log(" Company created via Supabase fallback:",n),n}}catch(a){throw a}}static async updateCompany(t,a){try{a.domain&&(a.domain=a.domain.toLowerCase());const s=await fetch(`${pe}/companies/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(s){throw s}}static async deleteCompany(t){try{const a=await fetch(`${pe}/companies/${t}`,{method:"DELETE"});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return!0}catch(a){throw a}}static async autoCreateCompanyFromEmail(t,a,s){try{const n=this.extractDomainFromEmail(t);if(!n)return null;const o=await this.findCompanyByDomain(n);if(o)return o;const i=s||this.suggestCompanyNameFromDomain(n);return await this.createCompany({name:i,domain:n,owner_id:a||"dev-user-123"})}catch{return null}}static async getCompanyStats(t){try{const a=await fetch(`${pe}/companies/${t}/stats`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.json()}catch(a){throw a}}}function Ld(e={}){const{userData:t}=Ge(),[a,s]=g.useState([]),[n,o]=g.useState(!0),[i,l]=g.useState(null),[c,d]=g.useState(0),h=g.useCallback(async()=>{try{o(!0),l(null);let I=`${pe}/companies?includeStats=true`;v.log(" Fetching companies from URL:",I);const T=new URLSearchParams;e.search&&T.append("search",e.search),T.toString()&&(I+=`&${T.toString()}`);const _={"Content-Type":"application/json"},{data:{session:S}}=await R.auth.getSession();S?.access_token&&(_.Authorization=`Bearer ${S.access_token}`);const N=await fetch(I,{headers:_});if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);const A=await N.json();s(A.data||[]),d(A.data?.length||0)}catch{const T=[{id:"mock-company-1",name:"Sample Company Ltd",domain:"sample.co.uk",size:"Medium",industry:"Technology",website:"https://sample.co.uk",contactCount:3,dealsCount:2,dealsValue:15e3,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),owner_id:t?.id||"mock-user"},{id:"mock-company-2",name:"Demo Corp",domain:"demo.com",size:"Large",industry:"Consulting",website:"https://demo.com",contactCount:5,dealsCount:3,dealsValue:25e3,created_at:new Date(Date.now()-864e5).toISOString(),updated_at:new Date(Date.now()-864e5).toISOString(),owner_id:t?.id||"mock-user"}].filter(_=>{if(!e.search)return!0;const S=e.search.toLowerCase();return _.name.toLowerCase().includes(S)||_.domain.toLowerCase().includes(S)});s(T),d(T.length),l(null)}finally{o(!1)}},[e.search,t?.id]),b=g.useCallback(async I=>{try{const T=await Ct.createCompany(I);return s(_=>[T,..._]),d(_=>_+1),L.success("Company created successfully"),T}catch(T){return l(T),L.error("Failed to create company"),null}},[]),f=g.useCallback(async(I,T)=>{try{const _=await Ct.updateCompany(I,T);return s(S=>S.map(N=>N.id===I?_:N)),L.success("Company updated successfully"),_}catch(_){return l(_),L.error("Failed to update company"),null}},[]),m=g.useCallback(async I=>{try{return await Ct.deleteCompany(I),s(T=>T.filter(_=>_.id!==I)),d(T=>T-1),L.success("Company deleted successfully"),!0}catch(T){return l(T),L.error("Failed to delete company"),!1}},[]),M=g.useCallback(async I=>{try{return await Ct.getCompanies({search:I,includeStats:!0})}catch(T){return l(T),[]}},[]),x=g.useCallback(async I=>{try{return await Ct.findCompanyByDomain(I)}catch(T){return l(T),null}},[]),u=g.useCallback(async(I,T,_)=>{try{const S=await Ct.autoCreateCompanyFromEmail(I,T,_);return S&&(s(N=>N.some(D=>D.id===S.id)?N:[S,...N]),d(N=>N+1)),S}catch(S){return l(S),null}},[]),p=g.useCallback(()=>{h()},[h]),k=g.useCallback(()=>{l(null)},[]);return g.useEffect(()=>{h()},[h]),{companies:a,isLoading:n,error:i,totalCount:c,fetchCompanies:h,createCompany:b,updateCompany:f,deleteCompany:m,searchCompanies:M,findCompanyByDomain:x,autoCreateFromEmail:u,refreshCompanies:p,clearError:k}}function kn({isOpen:e,onClose:t,onContactSelect:a,prefilledEmail:s="",prefilledName:n=""}){const{userData:o}=Ge(),{searchContacts:i,createContact:l,findContactByEmail:c}=Lr(),{createCompany:d,companies:h}=Ld(),[b,f]=g.useState(""),[m,M]=g.useState([]),[x,u]=g.useState(!1),[p,k]=g.useState(!1),[I,T]=g.useState(!1),[_,S]=g.useState([]),[N,A]=g.useState({first_name:"",last_name:"",email:s,phone:"",company_website:"",job_title:""}),D=["gmail.com","outlook.com","hotmail.com","yahoo.com","icloud.com","aol.com","live.com","msn.com","yahoo.co.uk","googlemail.com","me.com","mac.com","protonmail.com","tutanota.com"],j=P=>{if(!P||!P.includes("@"))return"";const z=P.split("@")[1]?.toLowerCase();return!z||D.includes(z)?"":`www.${z}`},y=P=>{if(!P||!P.includes("@"))return{firstName:"",lastName:""};const z=P.split("@")[0];if(!z)return{firstName:"",lastName:""};const E=V=>V.charAt(0).toUpperCase()+V.slice(1).toLowerCase(),w=z.replace(/^(mr|mrs|ms|dr|prof)\.?/i,"").replace(/\d+$/,"").replace(/[_-]+$/,"");if(w.includes(".")||w.includes("_")){const V=w.includes(".")?".":"_",q=w.split(V);if(q.length>=2&&q[0].length>0&&q[1].length>0)return{firstName:E(q[0]),lastName:E(q.slice(1).join(" "))}}const F=w.match(/^([a-z]+)([A-Z][a-z]+)$/);if(F)return{firstName:E(F[1]),lastName:E(F[2])};if(w.length>6&&/^[a-z]+$/.test(w)){const V=["andrew","john","jane","michael","sarah","david","mary","chris","alex","sam","james","emma","robert","lisa","william","jessica","thomas","ashley","daniel","emily","matthew","amanda","mark","melissa","paul","jennifer","kevin","nicole"];for(const q of V)if(w.startsWith(q)&&w.length>q.length){const C=w.slice(q.length);if(C.length>1)return{firstName:E(q),lastName:E(C)}}}return w.length>=2&&w.length<=15&&/^[a-zA-Z]+$/.test(w)?{firstName:E(w),lastName:""}:{firstName:"",lastName:""}};g.useEffect(()=>{if(n&&!N.first_name&&!N.last_name){const P=n.trim().split(" "),z=P[0]||"",E=P.slice(1).join(" ");A(w=>({...w,first_name:z,last_name:E}))}},[n,N.first_name,N.last_name]),g.useEffect(()=>{if(e){f(s||""),k(!1);const P=s?j(s):"",z=s?y(s):{firstName:"",lastName:""},E=n?n.split(" ")[0]||"":z.firstName,w=n?n.split(" ").slice(1).join(" "):z.lastName;A({first_name:E,last_name:w,email:s,phone:"",company_website:P,job_title:""}),O(),s&&G(s)}},[e,s,n]);const O=async()=>{if(e){u(!0);try{v.log("Calling searchContacts with empty string...");const P=await i("",!0);v.log("Fetched all contacts:",P),v.log("Results type:",typeof P),v.log("Results is array:",Array.isArray(P)),v.log("Results length:",P?.length),S(P||[]),b.trim()||M(P||[])}catch(P){v.error("Error stack:",P.stack),S([]),M([])}finally{u(!1)}}},G=async P=>{if(!P.trim()){M(_);return}u(!0);try{const z=await i(P.trim(),!0);v.log("Search results for",P,":",z),M(z||[])}catch{L.error("Failed to search contacts"),M([])}finally{u(!1)}};g.useEffect(()=>{const P=setTimeout(()=>{G(b)},300);return()=>clearTimeout(P)},[b]);const Q=P=>{a(P),t()},ae=async(P,z)=>{if(!P||!o?.id)return null;try{const E=P.replace(/^(https?:\/\/)?(www\.)?/,"").split("/")[0],w=E.split("."),F=w[0].charAt(0).toUpperCase()+w[0].slice(1),V=h?.find($=>$.domain?.toLowerCase()===E.toLowerCase()||$.website?.toLowerCase().includes(E.toLowerCase()));if(V)return V;const q={name:F,domain:E,website:P,owner_id:o.id},C=await d(q);return v.log("Auto-created company:",C),C}catch{return null}},de=async()=>{if(!N.email||!N.first_name){L.error("Email and first name are required");return}T(!0);try{const P=await c(N.email);if(P){L.error("A contact with this email already exists"),Q(P);return}let z=null;N.company_website&&(z=await ae(N.company_website,N.email));const E={first_name:N.first_name,last_name:N.last_name,email:N.email,phone:N.phone||null,title:N.job_title||null,company_id:z?.id||null,owner_id:o?.id||""},w=await l(E);if(w){const F=z?`Contact and company "${z.name}" created successfully!`:"Contact created successfully!";L.success(F);const V={...w,company_website:N.company_website,company_name:z?.name,company_id:z?.id,company:z?.name||"",_form_website:N.company_website};Q(V)}}catch{L.error("Failed to create contact")}finally{T(!1)}},W=g.useMemo(()=>b.trim()?m:_?.length>0?_:m,[b,m,_]);return r.jsx(Le,{children:e&&r.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",onClick:t,children:r.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden",onClick:P=>P.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-800/50",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-violet-500/10 rounded-lg",children:r.jsx(Ve,{className:"w-5 h-5 text-violet-400"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-semibold text-white",children:"Select Contact"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Search for existing contacts or create a new one"})]})]}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(xt,{className:"w-5 h-5 text-gray-400"})})]}),r.jsxs("div",{className:"flex h-[600px]",children:[r.jsxs("div",{className:"flex-1 flex flex-col border-r border-gray-800/30",children:[r.jsx("div",{className:"p-4 border-b border-gray-800/30",children:r.jsxs("div",{className:"relative",children:[r.jsx(jo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:b,onChange:P=>f(P.target.value),placeholder:"Search by name, email, or company...",className:"w-full pl-10 pr-10 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500"}),x&&b&&r.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:r.jsx("div",{className:"w-4 h-4 border-2 border-gray-600 border-t-violet-500 rounded-full animate-spin"})})]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:x?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[r.jsx("div",{className:"w-5 h-5 border-2 border-gray-600 border-t-violet-500 rounded-full animate-spin"}),"Searching contacts..."]})}):W.length>0?r.jsx("div",{className:"p-2 space-y-1",children:W.map(P=>r.jsx(ne.button,{whileHover:{backgroundColor:"rgba(75, 85, 99, 0.5)"},onClick:()=>Q(P),className:"w-full p-4 text-left rounded-xl transition-colors",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-violet-500/20 rounded-full flex items-center justify-center flex-shrink-0",children:r.jsx(Ve,{className:"w-4 h-4 text-violet-400"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("h4",{className:"font-medium text-white truncate",children:P.full_name||`${P.first_name||""} ${P.last_name||""}`.trim()||P.email||"Unknown Contact"}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx(qs,{className:"w-3 h-3 text-gray-400"}),r.jsx("span",{className:"text-sm text-gray-400 truncate",children:P.email})]}),(P.company||P.company_name||P.companies?.name)&&r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx(Jt,{className:"w-3 h-3 text-gray-400"}),r.jsx("span",{className:"text-sm text-gray-400 truncate",children:P.company||P.company_name||P.companies?.name})]}),P.phone&&r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx(Er,{className:"w-3 h-3 text-gray-400"}),r.jsx("span",{className:"text-sm text-gray-400",children:P.phone})]})]})]})},P.id))}):r.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-6 text-center",children:[r.jsx("div",{className:"w-16 h-16 bg-gray-800/50 rounded-full flex items-center justify-center mb-4",children:r.jsx(Ve,{className:"w-6 h-6 text-gray-400"})}),r.jsx("h4",{className:"font-medium text-white mb-2",children:b?"No contacts found":"No contacts yet"}),r.jsx("p",{className:"text-gray-400 text-sm mb-4",children:b?`No contacts match "${b}". Try a different search or create a new contact.`:"Create your first contact to get started"}),r.jsxs("button",{onClick:()=>k(!0),className:"px-4 py-2 bg-violet-600 hover:bg-violet-700 text-white rounded-lg transition-colors flex items-center gap-2",children:[r.jsx(os,{className:"w-4 h-4"}),"Create New Contact"]})]})}),W.length>0&&r.jsx("div",{className:"p-4 border-t border-gray-800/30",children:r.jsxs("button",{onClick:()=>k(!0),className:"w-full px-4 py-3 bg-violet-600/10 border border-violet-500/20 text-violet-400 rounded-xl hover:bg-violet-600/20 hover:border-violet-500/30 transition-colors flex items-center justify-center gap-2",children:[r.jsx(Ws,{className:"w-4 h-4"}),"Create New Contact"]})})]}),r.jsx(Le,{children:p&&r.jsxs(ne.div,{initial:{width:0,opacity:0},animate:{width:"50%",opacity:1},exit:{width:0,opacity:0},transition:{duration:.3},className:"flex flex-col border-l border-gray-800/30 overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-800/30",children:[r.jsxs("h4",{className:"font-semibold text-white flex items-center gap-2",children:[r.jsx(os,{className:"w-4 h-4 text-violet-400"}),"Create New Contact"]}),r.jsx("button",{onClick:()=>k(!1),className:"p-1 hover:bg-gray-800/50 rounded transition-colors",children:r.jsx(xt,{className:"w-4 h-4 text-gray-400"})})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx("input",{type:"text",placeholder:"First Name *",value:N.first_name,onChange:P=>A(z=>({...z,first_name:P.target.value})),className:"w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 text-sm",required:!0}),r.jsx("input",{type:"text",placeholder:"Last Name",value:N.last_name,onChange:P=>A(z=>({...z,last_name:P.target.value})),className:"w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 text-sm"})]}),r.jsx("input",{type:"email",placeholder:"Email Address *",value:N.email,onChange:P=>{const z=P.target.value,E=j(z),w=y(z);A(F=>({...F,email:z,company_website:!F.company_website||F.company_website.startsWith("www.")?E:F.company_website,first_name:!F.first_name&&w.firstName?w.firstName:F.first_name,last_name:!F.last_name&&w.lastName?w.lastName:F.last_name}))},className:"w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 text-sm",required:!0}),r.jsx("input",{type:"tel",placeholder:"Phone Number",value:N.phone,onChange:P=>A(z=>({...z,phone:P.target.value})),className:"w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 text-sm"}),r.jsx("input",{type:"text",placeholder:"Company Website (e.g., www.company.com)",value:N.company_website,onChange:P=>{let z=P.target.value.trim();z&&!z.startsWith("www.")&&!z.startsWith("http")&&z.includes(".")&&!z.includes(" ")&&(z=`www.${z}`),A(E=>({...E,company_website:z}))},className:"w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 text-sm"}),r.jsx("input",{type:"text",placeholder:"Job Title",value:N.job_title,onChange:P=>A(z=>({...z,job_title:P.target.value})),className:"w-full px-3 py-2.5 bg-gray-800/50 border border-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 text-sm"})]})}),r.jsx("div",{className:"p-4 border-t border-gray-800/30",children:r.jsx("button",{onClick:de,disabled:!N.email||!N.first_name||I,className:"w-full px-4 py-3 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl hover:from-violet-600 hover:to-purple-700 disabled:from-gray-700 disabled:to-gray-700 transition-all shadow-lg shadow-violet-500/25 flex items-center justify-center gap-2 text-sm font-medium",children:I?r.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):r.jsxs(r.Fragment,{children:[r.jsx(va,{className:"w-4 h-4"}),"Create & Select Contact"]})})})]})})]})]})})})}async function ks(){try{v.log(" Checking existing stages...");const{data:e,error:t}=await R.from("deal_stages").select("*").order("order_position");if(t)return v.error(" Error checking stages:",t),!1;v.log(` Found ${e?.length||0} stages`);const a=e?.filter(i=>i.name);if(a&&a.length>0)return v.log(" Valid stages already exist"),!0;if(e&&e.length>0){v.log(" Deleting invalid stages without names...");const i=e.filter(l=>!l.name).map(l=>l.id);if(i.length>0){const{error:l}=await R.from("deal_stages").delete().in("id",i);l&&v.error(" Error deleting invalid stages:",l)}}v.log(" Creating default stages...");const s=[{name:"Lead",description:"New potential opportunity",color:"#3B82F6",order_position:10,default_probability:10},{name:"SQL",description:"Sales Qualified Lead",color:"#6366F1",order_position:20,default_probability:20},{name:"Opportunity",description:"Active opportunity",color:"#8B5CF6",order_position:30,default_probability:25},{name:"Proposal",description:"Proposal sent",color:"#EAB308",order_position:40,default_probability:50},{name:"Verbal",description:"Verbal commitment",color:"#F97316",order_position:45,default_probability:75},{name:"Signed",description:"Deal signed",color:"#10B981",order_position:50,default_probability:100},{name:"Lost",description:"Deal lost",color:"#EF4444",order_position:60,default_probability:0}],{data:n,error:o}=await R.from("deal_stages").insert(s).select();return o?(v.error(" Error creating stages:",o),!1):(v.log(" Successfully created default stages:",n),!0)}catch{return!1}}const En=e=>{if(!e)return!1;if(e.is_admin===!0)return!0;if("role"in e&&e.role){const t=e.role.toLowerCase();if(t==="admin"||t==="super_admin")return!0}if("user_metadata"in e&&e.user_metadata?.role){const t=e.user_metadata.role.toLowerCase();if(t==="admin"||t==="super_admin")return!0}return!1},Wt=e=>En(e),$d=e=>{if(!e)return!1;const t=e.one_off_revenue&&e.one_off_revenue>0,a=e.monthly_mrr&&e.monthly_mrr>0;return t&&a},Cm=(e,t)=>En(t)?!0:$d(e)?!1:e.owner_id===t?.id;function Dn({isOpen:e,onClose:t,onDealCreated:a,actionType:s="deal",initialData:n}){const{userData:o}=Ge(),{createDeal:i}=Sn(o?.id),{stages:l,refetchStages:c}=Rd();g.useEffect(()=>{v.log(" DealWizard stages state:",{stages:l,stagesLength:l?.length,isNull:l===null,isUndefined:l===void 0,isEmpty:l?.length===0}),l&&l.length>0&&v.log(" First stage details:",{id:l[0]?.id,name:l[0]?.name,hasName:!!l[0]?.name,type:typeof l[0]?.name})},[l]),Lr();const{addActivityAsync:d,addSale:h}=Ta(),b=l?.find(D=>D?.name?.toLowerCase()?.includes("opportunity")||D?.name?.toLowerCase()?.includes("lead"))||l?.[0],[f,m]=g.useState({step:"new-deal",dealType:"new",selectedContact:null,selectedDeal:null,dealData:{name:n?.clientName?`${n.clientName} Opportunity`:"",company:n?.clientName||"",value:n?.dealValue||0,description:"",stage_id:"",expected_close_date:"",contact_name:"",contact_email:n?.contactEmail||"",contact_phone:"",oneOffRevenue:n?.oneOffRevenue||0,monthlyMrr:n?.monthlyMrr||0,saleType:n?.saleType||"one-off"}}),[M,x]=g.useState(!1),[u,p]=g.useState(!1),[k,I]=g.useState(!1),[T,_]=g.useState(!0);g.useEffect(()=>{e&&!f.selectedContact&&!k&&(p(!0),I(!0),_(!1)),e||(I(!1),p(!1),_(!0))},[e,f.selectedContact,k]),g.useEffect(()=>{if(e&&(!l||l.length===0)?ks().then(D=>{D&&c&&c()}).catch(D=>{}):e&&l&&l.length>0&&l.filter(j=>!j.name).length>0&&ks().then(j=>{j&&c&&c()}).catch(j=>{}),l&&l.length>0&&(!f.dealData.stage_id||f.dealData.stage_id==="")){let D;if(s==="sale")D=l.find(y=>y.name==="Signed")?.id;else if(s==="meeting"){const j=l.find(y=>y.name==="SQL"||y.name==="sql");D=j?.id,v.log(" Meeting action - SQL stage:",{sqlStage:j,selectedStageId:D,stages:l.map(y=>y.name)})}D||(D=b?.id||l[0]?.id,v.log(" Using fallback stage:",{defaultStage:b?.name,selectedStageId:D})),D&&m(j=>({...j,dealData:{...j.dealData,stage_id:D}}))}},[l,b,f.dealData.stage_id,e,c,s]),g.useEffect(()=>{if(e&&l&&l.length>0){let D;s==="meeting"?D=l.find(y=>y.name==="SQL"||y.name==="sql")?.id:s==="sale"&&(D=l.find(y=>y.name==="Signed")?.id),D&&f.dealData.stage_id!==D&&m(j=>({...j,dealData:{...j.dealData,stage_id:D}}))}},[e,s,l]);const S=()=>{m({step:"new-deal",dealType:"new",selectedContact:null,selectedDeal:null,dealData:{name:n?.clientName?`${n.clientName} Opportunity`:"",company:n?.clientName||"",value:n?.dealValue||0,description:"",stage_id:"",expected_close_date:"",contact_name:"",contact_email:n?.contactEmail||"",contact_phone:"",oneOffRevenue:n?.oneOffRevenue||0,monthlyMrr:n?.monthlyMrr||0,saleType:n?.saleType||"one-off"}}),p(!1),I(!1),x(!1),t()},N=D=>{m(j=>({...j,selectedContact:D,dealData:{...j.dealData,contact_name:D.full_name||`${D.first_name} ${D.last_name}`.trim(),contact_email:D.email,contact_phone:D.phone||"",company:D.company?.name||j.dealData.company,name:D.company?.name?`${D.company.name} Opportunity`:j.dealData.name}})),p(!1)},A=async()=>{if(!f.selectedContact){L.error("Please select a contact first");return}if(!f.dealData.name||!f.dealData.company){L.error("Please fill in all required fields");return}try{x(!0);let D;if(s==="sale"){const O=l?.find(G=>G.name==="Signed");O?D=O.id:D=f.dealData.stage_id||b?.id}else if(s==="meeting"){const O=l?.find(G=>G.name==="SQL"||G.name==="sql");O?D=O.id:D=f.dealData.stage_id||b?.id}else D=f.dealData.stage_id||b?.id;const j={name:f.dealData.name,company:f.dealData.company,contact_name:f.selectedContact.full_name,contact_email:f.selectedContact.email,contact_phone:f.selectedContact.phone||f.dealData.contact_phone,value:f.dealData.value,description:f.dealData.description,stage_id:D,owner_id:o?.id||"",expected_close_date:f.dealData.expected_close_date||null,probability:s==="sale"?100:b?.default_probability||10,status:"active",...s==="sale"&&{one_off_revenue:f.dealData.oneOffRevenue||0,monthly_mrr:f.dealData.monthlyMrr||0,annual_value:f.dealData.monthlyMrr?f.dealData.monthlyMrr*12:null}};v.log(" Creating deal with data:",j);const y=await i(j);if(v.log(" Deal creation result:",y),y&&y.id){if(v.log(" Deal created successfully with ID:",y.id),s==="deal"||s==="proposal"||s==="sale")try{v.log(" Waiting for deal transaction to commit..."),await new Promise(ae=>setTimeout(ae,1500));let O=!1,G=0;const Q=10;for(v.log(" Verifying deal exists in database before creating activity...");!O&&G<Q;){G++;try{const{data:ae,error:de}=await R.from("deals").select("id, name, created_at").eq("id",y.id).single();if(de){if(v.log(` Verification attempt ${G}/${Q} - Deal not found yet:`,de.message),G<Q){const W=Math.min(1e3*Math.pow(1.5,G),5e3);v.log(` Waiting ${W}ms before retry...`),await new Promise(P=>setTimeout(P,W))}}else if(ae&&ae.id){O=!0,v.log(` Deal verified in database after ${G} attempt(s):`,{id:ae.id,name:ae.name,created:ae.created_at});break}}catch(ae){if(v.log(` Verification attempt ${G} error:`,ae),G<Q){const de=Math.min(1e3*Math.pow(1.5,G),5e3);await new Promise(W=>setTimeout(W,de))}}}if(!O){v.error(" Could not verify deal in database after maximum attempts"),v.log(" Skipping activity creation to avoid foreign key error"),L.warning("Deal created successfully, but proposal activity could not be added. You can add it manually from the deal details.");return}if(s==="sale"){v.log(" Creating sale activity for verified deal...");try{const ae=f.dealData.monthlyMrr*3+f.dealData.oneOffRevenue;await h({client_name:f.dealData.company||f.dealData.name,amount:ae,details:`Sale closed: ${f.dealData.name}`,saleType:f.dealData.saleType,date:new Date().toISOString(),deal_id:y.id,contactIdentifier:f.selectedContact?.email,contactIdentifierType:f.selectedContact?.email?"email":"unknown",oneOffRevenue:f.dealData.oneOffRevenue,monthlyMrr:f.dealData.monthlyMrr}),v.log(" Sale activity created successfully for deal:",y.id)}catch(ae){v.error(" Failed to create sale activity:",ae)}}else{const ae=s==="proposal"?"proposal":"meeting",de=s==="proposal"?`Proposal sent: ${f.dealData.name}`:`New deal created: ${f.dealData.name}`;v.log(` Creating ${ae} activity for verified deal...`);try{const W=f.dealData.monthlyMrr*3+f.dealData.oneOffRevenue;await d({type:ae,client_name:f.dealData.company||f.dealData.name,details:de,amount:W||f.dealData.value,priority:"high",date:new Date().toISOString(),status:"completed",deal_id:y.id,contactIdentifier:f.selectedContact?.email,contactIdentifierType:f.selectedContact?.email?"email":"unknown",...ae==="proposal"&&{oneOffRevenue:f.dealData.oneOffRevenue,monthlyMrr:f.dealData.monthlyMrr}}),v.log(` ${ae} activity created successfully for deal:`,y.id)}catch(W){v.error(` Failed to create ${ae} activity:`,W)}}}catch(O){v.error("Unexpected error in proposal activity flow:",O),L.warning("Deal created successfully. Proposal activity may need to be added manually.")}m(O=>({...O,step:"success"})),s==="proposal"?L.success("Deal and proposal created successfully!"):s==="sale"?L.success("Sale recorded successfully! "):L.success("Deal created successfully!"),a&&a(y),setTimeout(()=>{S()},2500)}else v.error(" Deal creation failed - no deal returned. Response:",y),L.error("Failed to create deal - please check the console for details")}catch{L.error("Failed to create deal. Please try again.")}finally{x(!1)}};return r.jsx(Le,{children:e&&r.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:S,children:[r.jsxs(ne.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{duration:.2},className:"bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",onClick:D=>D.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-800/50",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-violet-500/10 rounded-lg",children:r.jsx(Jt,{className:"w-5 h-5 text-violet-400"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-white",children:s==="proposal"?"Create Deal & Proposal":s==="meeting"?"Create Meeting & Deal":"Create New Deal"}),r.jsxs("p",{className:"text-sm text-gray-400",children:[f.step==="new-deal"&&(f.selectedContact?"Fill in deal details":"Select a contact to continue"),f.step==="success"&&(s==="proposal"?"Deal and proposal created successfully!":s==="meeting"?"Meeting and deal created successfully!":"Deal created successfully!")]})]})]}),r.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(xt,{className:"w-5 h-5 text-gray-400"})})]}),r.jsx("div",{className:"px-6 py-4 border-b border-gray-800/30",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:le("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors","bg-violet-500 text-white"),children:"1"}),r.jsx("div",{className:le("flex-1 h-px transition-colors",f.step==="success"?"bg-violet-500":"bg-gray-700")}),r.jsx("div",{className:le("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors",f.step==="success"?"bg-emerald-500 text-white":"bg-gray-700 text-gray-300"),children:r.jsx(va,{className:"w-4 h-4"})})]})}),r.jsx("div",{className:"p-6",children:r.jsxs(Le,{mode:"wait",children:[f.step==="new-deal"&&!(!f.selectedContact&&T)&&r.jsxs(ne.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-white",children:"Select Contact"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Choose an existing contact or create a new one"})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[r.jsx(Ve,{className:"w-4 h-4 text-violet-400"}),"Contact Information"]}),f.selectedContact&&r.jsx("span",{className:"text-xs px-2 py-1 bg-emerald-500/20 text-emerald-400 rounded-full",children:"Contact Selected"})]}),f.selectedContact?r.jsx("div",{className:"p-4 bg-emerald-500/10 border border-emerald-500/20 rounded-xl",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h5",{className:"font-medium text-emerald-400",children:f.selectedContact.full_name}),r.jsx("p",{className:"text-sm text-emerald-300/70",children:f.selectedContact.email}),f.selectedContact.company&&r.jsx("p",{className:"text-sm text-gray-400",children:f.selectedContact.company.name})]}),r.jsx("button",{onClick:()=>m(D=>({...D,selectedContact:null})),className:"px-3 py-1 text-xs text-emerald-400 hover:text-emerald-300 hover:bg-emerald-500/10 rounded transition-colors",children:"Change"})]})}):r.jsx("div",{className:"p-4 bg-gray-800/30 border border-gray-700/50 rounded-xl",children:r.jsxs("button",{onClick:()=>p(!0),className:"w-full px-4 py-3 bg-violet-600 hover:bg-violet-700 text-white rounded-xl transition-colors flex items-center justify-center gap-2",children:[r.jsx(Ve,{className:"w-4 h-4"}),"Search Contacts"]})})]}),f.selectedContact&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h4",{className:"font-medium text-white flex items-center gap-2",children:[r.jsx(Jt,{className:"w-4 h-4 text-violet-400"}),"Deal Information"]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("input",{type:"text",placeholder:"Deal Name *",value:f.dealData.name,onChange:D=>m(j=>({...j,dealData:{...j.dealData,name:D.target.value}})),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500",required:!0}),r.jsx("input",{type:"text",placeholder:"Company Name *",value:f.dealData.company,onChange:D=>m(j=>({...j,dealData:{...j.dealData,company:D.target.value}})),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500",required:!0})]}),(s==="sale"||s==="proposal")&&Wt(o)&&r.jsxs("div",{className:"space-y-4 p-4 bg-gradient-to-r from-emerald-500/5 to-blue-500/5 border border-emerald-500/20 rounded-xl",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Qt,{className:"w-5 h-5 text-emerald-400"}),r.jsx("h3",{className:"text-base font-semibold text-white",children:"Revenue Breakdown"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-300",children:"One-off Revenue ()"}),r.jsx("input",{type:"number",placeholder:"0",value:f.dealData.oneOffRevenue||"",onChange:D=>{const j=parseFloat(D.target.value)||0;m(y=>({...y,dealData:{...y.dealData,oneOffRevenue:j,value:j+y.dealData.monthlyMrr*3}}))},className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Monthly MRR ()"}),r.jsx("input",{type:"number",placeholder:"0",value:f.dealData.monthlyMrr||"",onChange:D=>{const j=parseFloat(D.target.value)||0;m(y=>({...y,dealData:{...y.dealData,monthlyMrr:j,value:y.dealData.oneOffRevenue+j*3}}))},className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-300",children:"Sale Type"}),r.jsxs("select",{value:f.dealData.saleType,onChange:D=>m(j=>({...j,dealData:{...j.dealData,saleType:D.target.value}})),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500",children:[r.jsx("option",{value:"one-off",children:"One-off"}),r.jsx("option",{value:"subscription",children:"Subscription"}),r.jsx("option",{value:"lifetime",children:"Lifetime"})]})]}),(f.dealData.oneOffRevenue>0||f.dealData.monthlyMrr>0)&&r.jsxs("div",{className:"p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:[r.jsxs("div",{className:"text-sm text-emerald-400",children:[r.jsx("span",{className:"font-medium",children:"Total Deal Value: "}),"",((f.dealData.oneOffRevenue||0)+(f.dealData.monthlyMrr||0)*3).toLocaleString("en-GB")]}),f.dealData.monthlyMrr>0&&r.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Annual Value: ",((f.dealData.oneOffRevenue||0)+(f.dealData.monthlyMrr||0)*12).toLocaleString("en-GB")]})]})]}),(s==="sale"||s==="proposal")&&!Wt(o)&&r.jsx("div",{className:"p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg",children:r.jsxs("div",{className:"text-sm text-amber-400",children:[r.jsx("span",{className:"font-medium",children:" Revenue Split Unavailable"}),r.jsx("div",{className:"text-xs text-gray-400 mt-1",children:"Only administrators can create deals with revenue split. This deal will use the simple value field below."})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(!(s==="sale"||s==="proposal")||!Wt(o))&&r.jsx("input",{type:"number",placeholder:"Deal Value ()",value:f.dealData.value||"",onChange:D=>m(j=>({...j,dealData:{...j.dealData,value:parseFloat(D.target.value)||0}})),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500"}),r.jsx("select",{value:f.dealData.stage_id,onChange:D=>m(j=>({...j,dealData:{...j.dealData,stage_id:D.target.value}})),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500",children:!l||l.length===0?r.jsx("option",{value:"",children:"Loading stages..."}):r.jsxs(r.Fragment,{children:[!f.dealData.stage_id&&r.jsx("option",{value:"",children:"Select a stage"}),l.filter(D=>D.name!=="Signed & Paid").map(D=>(v.log(" Rendering stage:",{id:D.id,name:D.name,hasName:!!D.name}),r.jsx("option",{value:D.id,children:D.name||`Stage ${D.id}`},D.id)))]})})]}),r.jsx("textarea",{placeholder:"Description (optional)",value:f.dealData.description,onChange:D=>m(j=>({...j,dealData:{...j.dealData,description:D.target.value}})),className:"w-full px-4 py-3 bg-gray-800/50 border border-gray-700/50 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-violet-500/50 focus:border-violet-500 resize-none",rows:3}),r.jsx("div",{className:"pt-4",children:r.jsx("button",{onClick:A,disabled:!f.dealData.name||!f.dealData.company||M,className:"w-full px-6 py-3 bg-gradient-to-r from-violet-500 to-purple-600 text-white rounded-xl hover:from-violet-600 hover:to-purple-700 disabled:from-gray-700 disabled:to-gray-700 transition-all shadow-lg shadow-violet-500/25 flex items-center justify-center gap-2",children:M?r.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):r.jsxs(r.Fragment,{children:[r.jsx(va,{className:"w-5 h-5"}),s==="proposal"?"Create Deal & Proposal":s==="sale"?"Create Sale":s==="meeting"?"Add Meeting":"Create Deal"]})})})]})]},"new-deal"),f.step==="success"&&r.jsxs(ne.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"text-center py-8",children:[r.jsx("div",{className:"w-16 h-16 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(va,{className:"w-8 h-8 text-emerald-400"})}),r.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:s==="sale"?"Sale Recorded Successfully!":s==="proposal"?"Deal & Proposal Created!":s==="meeting"?"Meeting & Deal Created!":"Deal Created Successfully!"}),r.jsx("p",{className:"text-gray-400",children:s==="sale"?"Your sale has been recorded and the deal marked as signed.":s==="meeting"?"Your meeting has been logged and the deal moved to SQL stage.":"Your new deal has been added to the pipeline with the selected contact."})]},"success")]})})]}),r.jsx(kn,{isOpen:u,onClose:()=>{p(!1)},onContactSelect:N,prefilledEmail:f.dealData.contact_email,prefilledName:f.dealData.contact_name})]})})}const Fd=Object.freeze(Object.defineProperty({__proto__:null,DealWizard:Dn},Symbol.toStringTag,{value:"Module"}));function zd({isOpen:e,onClose:t}){const{userData:a}=Ge(),{deals:s,moveDealToStage:n}=Sn();Lr();const[o,i]=g.useState(null),[l,c]=g.useState(new Date),[d,h]=g.useState(!1),[b,f]=g.useState(!1),[m,M]=g.useState(null),[x,u]=g.useState(!1),[p,k]=g.useState(null),[I,T]=g.useState(!1),[_,S]=g.useState(!1),[N,A]=g.useState({}),[D,j]=g.useState("idle"),[y,O]=g.useState({type:"outbound",client_name:"",details:"",amount:"",oneOffRevenue:"",monthlyMrr:"",saleType:"one-off",outboundCount:"1",outboundType:"Call",contactIdentifier:"",contactIdentifierType:"unknown",status:"completed",title:"",description:"",task_type:"call",priority:"medium",due_date:"",contact_name:"",company_website:"",deal_id:null,selectedDeal:null}),G=g.useCallback(()=>{const C={};return o==="task"&&(y.title.trim()||(C.title="Task title is required")),(o==="meeting"||o==="proposal"||o==="sale")&&(p||(C.contact="Please select a contact"),!y.client_name?.trim()&&!y.company_website?.trim()&&(C.client_name="Either company name or website is required"),o==="meeting"&&!y.details&&(C.details="Meeting type is required")),o!=="outbound"&&o!=="meeting"&&o!=="proposal"&&o!=="sale"&&o!=="task"&&(y.contactIdentifier||(C.contactIdentifier="Contact identifier is required"),y.contactIdentifierType==="unknown"&&(C.contactIdentifier="Please enter a valid email, phone number, or LinkedIn URL")),A(C),Object.keys(C).length===0},[o,y,p]),Q=g.useCallback((C,$)=>{if(j("error"),S(!1),he.isAuthError(C)){const B=he.formatAuthError(C);L.error(B,{duration:6e3,icon:r.jsx(At,{className:"w-4 h-4"})}),(C.message?.includes("contacts")||C.message?.includes("permission"))&&L.error("Contact creation failed due to permissions. You may need to sign in again or contact support.",{duration:8e3,icon:r.jsx(Co,{className:"w-4 h-4"}),action:{label:"Refresh Page",onClick:()=>window.location.reload()}}),(C.message?.includes("JWT")||C.message?.includes("session"))&&he.diagnoseSession().then(H=>{H.isValid||L.error(`Session issue detected: ${H.issues.join(", ")}. Please sign in again.`,{duration:1e4,icon:r.jsx(At,{className:"w-4 h-4"}),action:{label:"Sign Out",onClick:()=>{he.clearAuthStorage(),window.location.href="/auth"}}})})}else{const B=C instanceof Error?C.message:"Unknown error occurred";L.error(`Failed to create ${$}: ${B}`,{duration:5e3,icon:r.jsx(At,{className:"w-4 h-4"})})}},[]),ae=()=>{i(null),k(null),T(!1),c(new Date),h(!1),f(!1),O({type:"outbound",client_name:"",details:"",amount:"",oneOffRevenue:"",monthlyMrr:"",saleType:"one-off",outboundCount:"1",outboundType:"Call",contactIdentifier:"",contactIdentifierType:"unknown",status:"completed",title:"",description:"",task_type:"call",priority:"medium",due_date:"",contact_name:"",company_website:"",deal_id:null,deal_name:"",selectedDeal:null}),t()},{addActivity:de,addSale:W}=Ta(),{createTask:P}=jl(),z=[{value:"call",label:"Phone Call",icon:"",color:"bg-blue-500/20 text-blue-400",iconColor:"text-blue-500"},{value:"email",label:"Email",icon:"",color:"bg-green-500/20 text-green-400",iconColor:"text-green-500"},{value:"meeting",label:"Meeting",icon:"",color:"bg-purple-500/20 text-purple-400",iconColor:"text-purple-500"},{value:"follow_up",label:"Follow Up",icon:"",color:"bg-orange-500/20 text-orange-400",iconColor:"text-orange-500"},{value:"demo",label:"Demo",icon:"",color:"bg-indigo-500/20 text-indigo-400",iconColor:"text-indigo-500"},{value:"proposal",label:"Proposal",icon:"",color:"bg-yellow-500/20 text-yellow-400",iconColor:"text-yellow-500"},{value:"general",label:"General",icon:"",color:"bg-gray-500/20 text-gray-400",iconColor:"text-gray-400"}],E=[{value:"low",label:"Low",icon:"",color:"bg-green-500/20 text-green-400 border-green-500/30",ringColor:"ring-green-500/30"},{value:"medium",label:"Medium",icon:"",color:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",ringColor:"ring-yellow-500/30"},{value:"high",label:"High",icon:"",color:"bg-orange-500/20 text-orange-400 border-orange-500/30",ringColor:"ring-orange-500/30"},{value:"urgent",label:"Urgent",icon:"",color:"bg-red-500/20 text-red-400 border-red-500/30",ringColor:"ring-red-500/30"}],w=()=>{const C=new Date;return[{label:"In 1 Hour",value:be(bo(C,1),"yyyy-MM-dd'T'HH:mm"),icon:"",description:"Quick follow up"},{label:"End of Day",value:be(Ua(Ba(C,0),17),"yyyy-MM-dd'T'HH:mm"),icon:"",description:"Before close"},{label:"Tomorrow 9AM",value:be(Ua(Ba(Ne(C,1),0),9),"yyyy-MM-dd'T'HH:mm"),icon:"",description:"Start fresh"},{label:"Next Monday",value:be(Ua(Ba(Ne(Xt(Yt(C,1)),1),0),9),"yyyy-MM-dd'T'HH:mm"),icon:"",description:"Next week"}]},F=async C=>{if(C.preventDefault(),A({}),j("idle"),!!G()){if(S(!0),j("idle"),o==="task")try{const $={title:y.title,description:y.description,task_type:y.task_type,priority:y.priority,due_date:y.due_date||void 0,assigned_to:a?.id||"",contact_name:y.contact_name||void 0,company_website:y.company_website||void 0};await P($),j("success"),S(!1),L.success("Task created successfully!",{icon:r.jsx(da,{className:"w-4 h-4"})}),setTimeout(()=>{ae()},1e3);return}catch($){Q($,"task");return}if((o==="meeting"||o==="proposal"||o==="sale")&&!p){L.error("Please select a contact first");return}if((o==="meeting"||o==="proposal"||o==="sale")&&(!y.client_name||y.client_name.trim()==="")&&(!y.company_website||y.company_website.trim()==="")){L.error("Please enter either a company name or website");return}if(o==="meeting"&&!y.details){L.error("Please select a meeting type");return}if((o==="meeting"||o==="proposal"||o==="sale")&&p&&(y.contactIdentifier||(y.contactIdentifier=p.email,y.contactIdentifierType="email"),y.contact_name||(y.contact_name=p.full_name||(p.first_name||p.last_name?`${p.first_name||""} ${p.last_name||""}`.trim():p.email)),!y.client_name&&p.company&&(y.client_name=typeof p.company=="string"?p.company:p.company?.name||""),v.log(" Contact data for submission:",{contact_name:y.contact_name,client_name:y.client_name,company_website:y.company_website,contactIdentifier:y.contactIdentifier,selectedContact:p})),o!=="outbound"&&o!=="meeting"&&o!=="proposal"&&o!=="sale"){if(!y.contactIdentifier){L.error("Please provide a contact identifier (email, phone number, or LinkedIn URL)");return}if(y.contactIdentifierType==="unknown"){L.error("Please enter a valid email, phone number, or LinkedIn URL");return}}try{if(o==="outbound")v.log(" Creating outbound activity..."),await de({type:"outbound",client_name:y.client_name||"Unknown",details:y.outboundType,quantity:parseInt(y.outboundCount)||1,date:l.toISOString(),deal_id:y.deal_id,...y.contactIdentifier?{contactIdentifier:y.contactIdentifier,contactIdentifierType:y.contactIdentifierType}:{}}),v.log(" Outbound activity created successfully");else if(o){v.log(` Creating ${o} activity...`);let $=y.deal_id;if(o==="proposal"&&!$&&y.client_name){const H="603b5020-aafc-4646-9195-9f041a9a3f14",Y=s.filter(J=>J.stage_id===H&&J.company?.toLowerCase().includes(y.client_name.toLowerCase()));if(Y.length>0){const J=Y[0];if(await new Promise(oe=>{const re=document.createElement("div");re.className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",re.innerHTML=`
                <div class="bg-gray-900 border border-gray-800 rounded-2xl p-6 max-w-md w-full">
                  <h3 class="text-lg font-semibold text-white mb-3">Existing Deal Found</h3>
                  <p class="text-gray-300 mb-4">
                    Found an existing deal "<strong>${J.name}</strong>" in SQL stage for ${y.client_name}.
                  </p>
                  <p class="text-gray-400 text-sm mb-6">
                    Would you like to progress this deal to Opportunity stage, or create a new deal?
                  </p>
                  <div class="flex gap-3">
                    <button id="progress-deal" class="flex-1 py-2 px-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors font-medium">
                      Progress Existing Deal
                    </button>
                    <button id="create-new" class="flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium">
                      Create New Deal
                    </button>
                  </div>
                </div>
              `,document.body.appendChild(re);const X=re.querySelector("#progress-deal"),ue=re.querySelector("#create-new");X?.addEventListener("click",()=>{document.body.removeChild(re),oe(!0)}),ue?.addEventListener("click",()=>{document.body.removeChild(re),oe(!1)})})){const oe="8be6a854-e7d0-41b5-9057-03b2213e7697";try{if(await n(J.id,oe),$=J.id,Wt(a)){const re=parseFloat(y.oneOffRevenue||"0")||0,X=parseFloat(y.monthlyMrr||"0")||0;if(re>0||X>0){const ue=X*3+re;await R.from("deals").update({value:ue}).eq("id",J.id)}}L.success(` Progressed "${J.name}" to Opportunity stage`),v.log(` Progressed existing deal ${J.id} to Opportunity stage`)}catch(re){v.error("Error progressing deal:",re)}}}}if(o==="sale"&&!$&&y.client_name){const H="8be6a854-e7d0-41b5-9057-03b2213e7697",Y="603b5020-aafc-4646-9195-9f041a9a3f14";let J=s.filter(K=>K.stage_id===H&&K.company?.toLowerCase().includes(y.client_name.toLowerCase()));if(J.length===0&&(J=s.filter(K=>K.stage_id===Y&&K.company?.toLowerCase().includes(y.client_name.toLowerCase()))),J.length>0){const K=J[0],oe=K.stage_id===Y,re=oe?"SQL":"Opportunity";if(await new Promise(ue=>{const fe=document.createElement("div");fe.className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[60] flex items-center justify-center p-4",fe.innerHTML=`
                <div class="bg-gray-900 border border-gray-800 rounded-2xl p-6 max-w-md w-full">
                  <h3 class="text-lg font-semibold text-white mb-3">Existing Deal Found</h3>
                  <p class="text-gray-300 mb-4">
                    Found an existing deal "<strong>${K.name}</strong>" in ${re} stage for ${y.client_name}.
                  </p>
                  <p class="text-gray-400 text-sm mb-6">
                    Would you like to ${oe?"fast-track this deal directly to Signed":"close this deal as won"} (move to Signed stage), or create a new deal?
                  </p>
                  <div class="flex gap-3">
                    <button id="progress-deal" class="flex-1 py-2 px-4 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors font-medium">
                      ${oe?"Fast-Track to Signed":"Close Existing Deal"}
                    </button>
                    <button id="create-new" class="flex-1 py-2 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium">
                      Create New Deal
                    </button>
                  </div>
                </div>
              `,document.body.appendChild(fe);const _e=fe.querySelector("#progress-deal"),xe=fe.querySelector("#create-new");_e?.addEventListener("click",()=>{document.body.removeChild(fe),ue(!0)}),xe?.addEventListener("click",()=>{document.body.removeChild(fe),ue(!1)})})){const ue="207a94db-abd8-43d8-ba21-411be66183d2";try{await n(K.id,ue),$=K.id;const fe=parseFloat(y.oneOffRevenue||"0")||0,_e=parseFloat(y.monthlyMrr||"0")||0;let xe=0;Wt(a)&&(fe>0||_e>0)?xe=_e*3+fe:xe=parseFloat(y.amount||"0")||0,xe>0&&await R.from("deals").update({value:xe}).eq("id",K.id),L.success(` Closed "${K.name}" as won!`),v.log(` Progressed existing deal ${K.id} to Signed stage`)}catch(fe){v.error("Error progressing deal to Signed:",fe)}}}}if((o==="meeting"||o==="proposal"||o==="sale")&&!$){v.log(` No deal selected for ${o} - creating new deal automatically...`);try{let H="SQL",Y=20,J=0;if(o==="proposal")H="Opportunity",Y=30,J=parseFloat(y.amount||"0")||0;else if(o==="sale"){H="Signed",Y=100;const re=parseFloat(y.oneOffRevenue||"0")||0;J=(parseFloat(y.monthlyMrr||"0")||0)*3+re}const{data:K}=await R.from("deal_stages").select("id").eq("name",H).single(),oe=K?.id;if(oe&&a?.id){const re=y.client_name||(y.company_website?y.company_website.replace(/^(https?:\/\/)?(www\.)?/,"").split(".")[0]:"Unknown Company"),{data:X,error:ue}=await R.from("deals").insert({name:`${re} - ${y.details||o}`,company:re,company_website:y.company_website||null,value:J,stage_id:oe,owner_id:a.id,probability:Y,status:"active",expected_close_date:Ne(new Date,30).toISOString(),contact_email:y.contactIdentifier,contact_name:y.contact_name||re}).select().single();!ue&&X?($=X.id,v.log(` Created deal ${X.id} for ${o}`),L.success(` Deal created and linked to ${o}`)):v.warn(`Failed to create deal for ${o}:`,ue)}}catch(H){v.error(`Error creating deal for ${o}:`,H)}}let B;if(o==="proposal"&&(B=parseFloat(y.amount||"0")||0),o==="sale"){v.log(` Creating sale with deal_id: ${$}`);const H=parseFloat(y.oneOffRevenue||"0")||0,Y=parseFloat(y.monthlyMrr||"0")||0,J=Y*3+H;await W({client_name:y.client_name||y.contact_name||"Unknown",amount:J,details:y.details||(Y>0&&H>0?"Subscription + One-off Sale":Y>0?"Subscription Sale":"One-off Sale"),saleType:Y>0?"subscription":"one-off",date:l.toISOString(),deal_id:$,contactIdentifier:y.contactIdentifier,contactIdentifierType:y.contactIdentifierType||"email",contact_name:y.contact_name,oneOffRevenue:H,monthlyMrr:Y}),v.log(` Sale created successfully with deal_id: ${$}`)}else v.log(` About to create ${o} activity with deal_id: ${$}`),await de({type:o,client_name:y.client_name||"Unknown",details:y.details,amount:o==="proposal"?B:void 0,date:l.toISOString(),deal_id:$,contactIdentifier:y.contactIdentifier,contactIdentifierType:y.contactIdentifierType||"email",contact_name:y.contact_name,status:o==="meeting"?y.status:"completed"}),v.log(` ${o} activity created successfully with deal_id: ${$}`)}j("success"),S(!1),L.success(`${o==="outbound"?"Outbound":o==="sale"?"Sale":o} added successfully!`,{icon:r.jsx(da,{className:"w-4 h-4"})}),setTimeout(()=>{ae()},1e3)}catch($){Q($,o||"item")}}},V=[{id:"deal",icon:is,label:"Create Deal",color:"purple"},{id:"task",icon:ba,label:"Add Task",color:"indigo"},{id:"sale",icon:Qt,label:"Add Sale",color:"emerald"},{id:"outbound",icon:Er,label:"Add Outbound",color:"blue"},{id:"meeting",icon:Ve,label:"Add Meeting",color:"violet"},{id:"proposal",icon:Ea,label:"Add Proposal",color:"orange"}],q=C=>{O($=>({...$,due_date:C}))};return z.find(C=>C.value===y.task_type),E.find(C=>C.value===y.priority),r.jsxs(Le,{children:[e&&r.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center",onClick:ae,children:[r.jsxs(ne.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300,mass:.8},className:"relative bg-gray-900/95 border border-gray-800/50 rounded-t-3xl sm:rounded-3xl p-6 sm:p-8 w-full sm:max-w-2xl backdrop-blur-xl sm:m-4 max-h-[90vh] overflow-y-auto",onClick:C=>C.stopPropagation(),children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900/90 via-gray-900/70 to-gray-900/30 rounded-3xl -z-10"}),r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(74,74,117,0.15),transparent)] rounded-3xl -z-10"}),r.jsx(ne.div,{className:"w-12 h-1 rounded-full bg-gray-800 absolute -top-8 left-1/2 -translate-x-1/2 sm:hidden",initial:{width:"2rem"},animate:{width:"3rem"},transition:{type:"spring",stiffness:400,damping:30,repeat:1/0,repeatType:"reverse"}}),r.jsxs("div",{className:"flex justify-between items-center mb-6 sm:mb-8",children:[r.jsx("h2",{className:"text-xl font-semibold text-white/90 tracking-wide",children:"Quick Add"}),r.jsx("button",{type:"button",onClick:ae,className:"p-2 hover:bg-gray-800/50 rounded-xl transition-colors",children:r.jsx(xt,{className:"w-5 h-5 text-gray-400"})})]}),I?null:o?b?null:o==="task"?r.jsxs(ne.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},onSubmit:F,className:"space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx("button",{type:"button",onClick:()=>i(null),className:"p-2 hover:bg-gray-800/50 rounded-xl transition-colors",children:r.jsx(sr,{className:"w-5 h-5 text-gray-400 rotate-180"})}),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-xl font-semibold text-white flex items-center gap-2",children:[r.jsx(ba,{className:"w-6 h-6 text-indigo-500"}),"Create New Task"]}),r.jsx("p",{className:"text-gray-400 text-sm",children:"Set up your task quickly and efficiently"})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx(is,{className:"w-5 h-5 text-indigo-400"}),"What needs to be done? *"]}),r.jsx("input",{type:"text",value:y.title,onChange:C=>O($=>({...$,title:C.target.value})),placeholder:"e.g., Call John about the proposal",className:le("w-full bg-gray-800/50 border text-white text-lg p-4 rounded-xl focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 placeholder:text-gray-400 transition-all",N.title?"border-red-500/50 focus:border-red-500/50 focus:ring-red-500/20":"border-gray-600/50"),required:!0}),N.title&&r.jsxs("p",{className:"text-red-400 text-sm mt-1 flex items-center gap-1",children:[r.jsx(At,{className:"w-3 h-3"}),N.title]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:"text-base font-medium text-white flex items-center gap-2",children:[r.jsx(No,{className:"w-4 h-4 text-yellow-400"}),"Task Type"]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:z.slice(0,4).map(C=>r.jsx("button",{type:"button",onClick:()=>O($=>({...$,task_type:C.value})),className:`p-3 rounded-xl border transition-all ${y.task_type===C.value?`${C.color} border-current`:"bg-gray-800/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-base",children:C.icon}),r.jsx("span",{className:"text-xs font-medium",children:C.label})]})},C.value))}),r.jsx("div",{className:"grid grid-cols-3 gap-2",children:z.slice(4).map(C=>r.jsx("button",{type:"button",onClick:()=>O($=>({...$,task_type:C.value})),className:`p-3 rounded-xl border transition-all ${y.task_type===C.value?`${C.color} border-current`:"bg-gray-800/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-base",children:C.icon}),r.jsx("span",{className:"text-xs font-medium",children:C.label})]})},C.value))})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("label",{className:"text-base font-medium text-white flex items-center gap-2",children:[r.jsx(So,{className:"w-4 h-4 text-red-400"}),"Priority Level"]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:E.map(C=>r.jsx("button",{type:"button",onClick:()=>O($=>({...$,priority:C.value})),className:`p-3 rounded-xl border transition-all ${y.priority===C.value?`${C.color} ${C.ringColor} ring-2`:"bg-gray-800/30 border-gray-600/30 text-gray-400 hover:bg-gray-700/50"}`,children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-base",children:C.icon}),r.jsx("span",{className:"text-xs font-medium",children:C.label})]})},C.value))})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("label",{className:"text-base font-medium text-white flex items-center gap-2",children:[r.jsx(ko,{className:"w-4 h-4 text-green-400"}),"When is this due?"]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:w().map(C=>r.jsx("button",{type:"button",onClick:()=>q(C.value),className:`p-3 rounded-xl border transition-all group ${y.due_date===C.value?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-gray-800/30 border-gray-600/30 text-gray-300 hover:bg-gray-700/50"}`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-lg",children:C.icon}),r.jsxs("div",{className:"text-left",children:[r.jsx("div",{className:"text-sm font-medium",children:C.label}),r.jsx("div",{className:"text-xs opacity-70",children:C.description})]})]})},C.label))}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm text-gray-400",children:"Or set a custom date & time"}),r.jsx("input",{type:"datetime-local",value:y.due_date,onChange:C=>O($=>({...$,due_date:C.target.value})),className:"w-full bg-gray-800/50 border border-gray-600/50 text-white p-3 rounded-xl focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 transition-all"})]})]}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("label",{className:"text-base font-medium text-white",children:"Additional Details (Optional)"}),r.jsx("textarea",{value:y.description,onChange:C=>O($=>({...$,description:C.target.value})),placeholder:"Any additional context or notes...",rows:3,className:"w-full bg-gray-800/50 border border-gray-600/50 text-white p-3 rounded-xl focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 placeholder:text-gray-400 transition-all resize-none"})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Contact Name"}),r.jsx("input",{type:"text",value:y.contact_name,onChange:C=>O($=>({...$,contact_name:C.target.value})),placeholder:"John Smith",className:"w-full bg-gray-800/30 border border-gray-600/30 text-white p-3 rounded-xl focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 placeholder:text-gray-400 transition-all"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Company Website"}),r.jsx("input",{type:"text",value:y.company_website,onChange:C=>{let $=C.target.value.trim();$&&!$.startsWith("www.")&&!$.startsWith("http")&&$.includes(".")&&!$.includes(" ")&&($=`www.${$}`),O(B=>({...B,company_website:$}))},placeholder:"www.company.com",className:"w-full bg-gray-800/30 border border-gray-600/30 text-white p-3 rounded-xl focus:border-indigo-500/50 focus:ring-2 focus:ring-indigo-500/20 placeholder:text-gray-400 transition-all"})]})]}),r.jsxs("div",{className:"flex gap-3 pt-4",children:[r.jsx("button",{type:"button",onClick:()=>i(null),className:"flex-1 py-3 px-4 bg-gray-800/50 border border-gray-600/50 text-gray-300 rounded-xl hover:bg-gray-700/50 transition-all font-medium",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:_,className:le("flex-1 py-3 px-4 text-white rounded-xl transition-all font-medium shadow-lg flex items-center justify-center gap-2",D==="success"?"bg-green-600 hover:bg-green-700 shadow-green-500/25":_?"bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 shadow-indigo-500/25"),children:_?r.jsxs(r.Fragment,{children:[r.jsx(nr,{className:"w-5 h-5 animate-spin"}),"Creating..."]}):D==="success"?r.jsxs(r.Fragment,{children:[r.jsx(da,{className:"w-5 h-5"}),"Created!"]}):r.jsxs(r.Fragment,{children:[r.jsx(ba,{className:"w-5 h-5"}),"Create Task"]})})]})]}):(o==="meeting"||o==="proposal"||o==="sale")&&p?r.jsx(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:r.jsxs("form",{onSubmit:F,className:"space-y-4",children:[r.jsx("div",{className:"flex items-start justify-between",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{type:"button",onClick:()=>i(null),className:"p-1.5 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(sr,{className:"w-4 h-4 text-gray-400 rotate-180"})}),r.jsxs("div",{children:[r.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[o==="meeting"&&r.jsxs(r.Fragment,{children:[r.jsx(Ve,{className:"w-5 h-5 text-violet-500"})," Add Meeting"]}),o==="proposal"&&r.jsxs(r.Fragment,{children:[r.jsx(Ea,{className:"w-5 h-5 text-orange-500"})," Add Proposal"]}),o==="sale"&&r.jsxs(r.Fragment,{children:[r.jsx(Qt,{className:"w-5 h-5 text-emerald-500"})," Add Sale"]})]}),r.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[r.jsx("span",{className:"text-sm text-gray-400",children:"for"}),r.jsx("span",{className:"text-sm text-[#37bd7e] font-medium",children:p.full_name||(p.first_name||p.last_name?`${p.first_name||""} ${p.last_name||""}`.trim():p.email)}),p.company&&r.jsxs("span",{className:"text-sm text-gray-500",children:[" ",typeof p.company=="string"?p.company:p.company?.name||"Company"]}),r.jsx("button",{type:"button",onClick:()=>{k(null),T(!0)},className:"text-xs text-gray-400 hover:text-[#37bd7e] ml-2",children:"Change"})]})]})]})}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:o==="meeting"?"Meeting Date":o==="proposal"?"Proposal Date":o==="sale"?"Sale Date":"Date"}),r.jsx("div",{className:"flex gap-2",children:[{label:"Today",date:new Date},{label:"Yesterday",date:Ne(new Date,-1)},{label:"Last Week",date:Yt(new Date,-1)}].map(C=>r.jsx("button",{type:"button",onClick:()=>{c(C.date),h(!1)},className:`px-2.5 py-1 text-xs font-medium rounded-lg border transition-all ${be(l,"yyyy-MM-dd")===be(C.date,"yyyy-MM-dd")?"bg-[#37bd7e]/20 border-[#37bd7e] text-[#37bd7e]":"bg-gray-800/30 border-gray-700/30 text-gray-300 hover:bg-gray-700/50"}`,children:C.label},C.label))})]}),r.jsxs("button",{type:"button",onClick:()=>h(!d),className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-xl px-3 py-2.5 text-white text-left hover:bg-gray-700/50 transition-all flex items-center justify-between group",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Dr,{className:"w-4 h-4 text-[#37bd7e]"}),r.jsx("span",{className:"text-sm",children:be(l,"EEEE, MMMM d, yyyy")})]}),r.jsx("span",{className:"text-xs text-gray-400",children:"Change"})]}),d&&r.jsx("div",{className:"absolute left-0 right-0 mt-2 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-xl p-4 z-20 shadow-xl",children:r.jsx(Nn,{mode:"single",selected:l,onSelect:C=>{C&&(c(C),h(!1))},className:"bg-transparent [&_.rdp-day]:text-white [&_.rdp-day_button:hover]:bg-[#37bd7e]/20 [&_.rdp-day_button:focus]:bg-[#37bd7e]/20 [&_.rdp-day_selected]:!bg-[#37bd7e] [&_.rdp-day_selected]:hover:!bg-[#2da76c] [&_.rdp-caption]:text-white [&_.rdp-head_cell]:text-gray-400"})})]}),o==="meeting"&&r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("label",{className:"block text-xs font-medium text-gray-400",children:["Type ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{required:!0,className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 transition-colors",value:y.details,onChange:C=>O({...y,details:C.target.value}),children:[r.jsx("option",{value:"",children:"Select type"}),r.jsx("option",{value:"Discovery",children:"Discovery"}),r.jsx("option",{value:"Demo",children:"Demo"}),r.jsx("option",{value:"Follow-up",children:"Follow-up"}),r.jsx("option",{value:"Proposal",children:"Proposal Review"}),r.jsx("option",{value:"Client Call",children:"Client Call"}),r.jsx("option",{value:"Other",children:"Other"})]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Status"}),r.jsxs("select",{className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-violet-500/20 focus:border-violet-500/50 transition-colors",value:y.status,onChange:C=>O({...y,status:C.target.value}),children:[r.jsx("option",{value:"completed",children:"Completed"}),r.jsx("option",{value:"pending",children:"Scheduled"}),r.jsx("option",{value:"cancelled",children:"Cancelled"}),r.jsx("option",{value:"no_show",children:"No Show"})]})]})]}),o==="proposal"&&r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Proposal Value ()"}),r.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"Enter proposal value",className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500/50 transition-colors",value:y.amount||"",onChange:C=>O({...y,amount:C.target.value})})]}),o==="sale"&&r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"Monthly Subscription ()"}),r.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500/50 transition-colors",value:y.monthlyMrr||"",onChange:C=>O({...y,monthlyMrr:C.target.value})})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"block text-xs font-medium text-gray-400",children:"One-off Amount ()"}),r.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500/50 transition-colors",value:y.oneOffRevenue||"",onChange:C=>O({...y,oneOffRevenue:C.target.value})})]})]}),(y.monthlyMrr||y.oneOffRevenue)&&r.jsx("div",{className:"px-2 py-1.5 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:r.jsxs("p",{className:"text-xs text-emerald-400",children:["Deal Value: ",(parseFloat(y.monthlyMrr||"0")*3+parseFloat(y.oneOffRevenue||"0")).toFixed(2),y.monthlyMrr&&r.jsx("span",{className:"text-emerald-300/60 text-xs",children:" (3mo LTV)"})]})})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{className:"space-y-1",children:[r.jsxs("label",{className:"text-sm font-medium text-gray-400",children:["Company Name ",r.jsx("span",{className:"text-gray-500 text-xs",children:"(or use website below)"})]}),r.jsx("input",{type:"text",placeholder:"Acme Inc.",className:le("w-full bg-gray-800/50 border rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500/50 transition-colors",N.client_name?"border-red-500/50 focus:border-red-500/50 focus:ring-red-500/20":!y.client_name&&o?"border-amber-500/50":"border-gray-600/50"),value:y.client_name||"",onChange:C=>O({...y,client_name:C.target.value}),required:!0}),N.client_name&&r.jsxs("p",{className:"text-red-400 text-xs mt-1 flex items-center gap-1",children:[r.jsx(At,{className:"w-3 h-3"}),N.client_name]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Website"}),r.jsx("input",{type:"text",placeholder:"www.acme.com",className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500/50 transition-colors",value:y.company_website||"",onChange:C=>{let $=C.target.value.trim();$&&!$.startsWith("www.")&&!$.startsWith("http")&&$.includes(".")&&!$.includes(" ")&&($=`www.${$}`),O({...y,company_website:$})}})]})]}),r.jsxs("details",{className:"group",children:[r.jsxs("summary",{className:"cursor-pointer list-none flex items-center justify-between p-3 bg-gray-800/30 rounded-xl hover:bg-gray-800/50 transition-colors",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Eo,{className:"w-4 h-4 text-purple-500"}),r.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Deal Details"}),r.jsx("span",{className:"text-xs text-gray-500",children:"(Optional)"})]}),r.jsx("div",{className:"text-xs text-purple-400",children:o==="sale"?"Signed stage":o==="proposal"?"Opportunity stage":"SQL stage"})]}),r.jsx("div",{className:"mt-2 space-y-2 p-3",children:r.jsx("input",{type:"text",placeholder:"Deal name (auto-generated if empty)",className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-purple-500/20 focus:border-purple-500/50 transition-colors",value:y.deal_name||"",onChange:C=>O({...y,deal_name:C.target.value})})})]}),r.jsx("div",{className:"space-y-1",children:r.jsx("textarea",{rows:2,placeholder:"Additional notes (optional)...",className:"w-full bg-gray-800/50 border border-gray-600/50 rounded-lg px-3 py-2 text-sm text-white focus:ring-2 focus:ring-[#37bd7e]/20 focus:border-[#37bd7e]/50 transition-colors resize-none",value:y.description||"",onChange:C=>O({...y,description:C.target.value})})}),r.jsxs("div",{className:"flex gap-3 pt-2",children:[r.jsx("button",{type:"button",onClick:()=>i(null),className:"flex-1 py-2.5 px-4 bg-gray-800/30 text-gray-300 rounded-lg hover:bg-gray-700/50 transition-colors text-sm font-medium",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:_,className:le("flex-1 py-2.5 px-4 text-white rounded-lg transition-all text-sm font-medium shadow-lg flex items-center justify-center gap-2",D==="success"?"bg-green-600 hover:bg-green-700":_?"bg-gray-600 cursor-not-allowed":"bg-gradient-to-r from-[#37bd7e] to-[#2da76c] hover:from-[#2da76c] hover:to-[#228b57]"),children:_?r.jsxs(r.Fragment,{children:[r.jsx(nr,{className:"w-4 h-4 animate-spin"}),"Creating..."]}):D==="success"?r.jsxs(r.Fragment,{children:[r.jsx(da,{className:"w-4 h-4"}),"Created!"]}):r.jsxs(r.Fragment,{children:["Create ",o==="sale"?"Sale":o==="meeting"?"Meeting":"Proposal"]})})]})]})}):null:r.jsx(ne.div,{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-4",variants:{show:{transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:V.map(C=>r.jsxs(ne.button,{type:"button",variants:{hidden:{y:20,opacity:0},show:{y:0,opacity:1}},transition:{type:"spring",stiffness:400,damping:30},whileHover:{scale:1.02},whileTap:{scale:.98},onClick:$=>{$.preventDefault(),$.stopPropagation(),C.id==="deal"||C.id==="meeting"||C.id==="proposal"||C.id==="sale"?(i(C.id),T(!0)):i(C.id)},className:`flex flex-col items-center justify-center p-4 sm:p-6 rounded-xl ${C.color==="blue"?"bg-blue-400/5":C.color==="orange"?"bg-orange-500/10":C.color==="indigo"?"bg-indigo-500/10":C.color==="purple"?"bg-purple-500/10":`bg-${C.color}-500/10`} border ${C.color==="blue"?"border-blue-500/10":C.color==="orange"?"border-orange-500/20":C.color==="indigo"?"border-indigo-500/20":C.color==="purple"?"border-purple-500/20":`border-${C.color}-500/20`} hover:bg-${C.color}-500/20 transition-all duration-300 group backdrop-blur-sm`,children:[r.jsx("div",{className:`p-3 rounded-xl ${C.color==="blue"?"bg-blue-400/5":C.color==="orange"?"bg-orange-500/10":C.color==="indigo"?"bg-indigo-500/10":C.color==="purple"?"bg-purple-500/10":`bg-${C.color}-500/10`} transition-all duration-300 group-hover:scale-110 group-hover:bg-${C.color}-500/20 ring-1 ${C.color==="blue"?"ring-blue-500/50 group-hover:ring-blue-500/60":C.color==="orange"?"ring-orange-500/30 group-hover:ring-orange-500/50":C.color==="indigo"?"ring-indigo-500/30 group-hover:ring-indigo-500/50":C.color==="purple"?"ring-purple-500/30 group-hover:ring-purple-500/50":`ring-${C.color}-500/30 group-hover:ring-${C.color}-500/50`} backdrop-blur-sm mb-3`,children:r.jsx(C.icon,{className:`w-6 h-6 ${C.color==="blue"?"text-blue-500":C.color==="orange"?"text-orange-500":C.color==="indigo"?"text-indigo-500":C.color==="purple"?"text-purple-500":`text-${C.color}-500`}`})}),r.jsx("span",{className:"text-sm font-medium text-white/90",children:C.label})]},C.id))})]}),r.jsx(Dn,{isOpen:b,actionType:o,onClose:()=>{f(!1),i(null),k(null),t()},onDealCreated:C=>{f(!1),o==="deal"||o==="proposal"||o==="sale"||o==="meeting"?ae():o==="meeting"&&O($=>({...$,deal_id:C.id,selectedDeal:C,client_name:C.company||$.client_name}))},initialData:{clientName:y.client_name||p?.company,contactEmail:p?.email||y.contactIdentifier,contactName:p?p.full_name||(p.first_name||p.last_name?`${p.first_name||""} ${p.last_name||""}`.trim():p.email):y.contact_name,dealValue:parseFloat(y.amount)||0,oneOffRevenue:parseFloat(y.oneOffRevenue||"0")||0,monthlyMrr:parseFloat(y.monthlyMrr||"0")||0,saleType:y.saleType,companyWebsite:y.company_website}})]}),I&&r.jsx(kn,{isOpen:I,onClose:()=>{T(!1)},onContactSelect:C=>{const $=C.full_name||(C.first_name||C.last_name?`${C.first_name||""} ${C.last_name||""}`.trim():C.email);let B="",H="";if((C._form_website||C.company_website)&&(H=C._form_website||C.company_website,!B&&H)){const J=H.replace(/^(https?:\/\/)?(www\.)?/,"").split(".")[0];B=J.charAt(0).toUpperCase()+J.slice(1)}if(C.company||C.company_name)B=C.company||C.company_name;else if(C.companies?.name)B=C.companies.name,H||(H=C.companies.website||"");else if(!B){const Y=C.email?.split("@")[1];if(Y&&!["gmail.com","outlook.com","hotmail.com","yahoo.com","icloud.com"].includes(Y.toLowerCase())){const J=Y.split(".");J.length>=2&&(B=J[0].charAt(0).toUpperCase()+J[0].slice(1),H||(H=`www.${Y}`))}}O(Y=>({...Y,contact_name:$,contactIdentifier:C.email,contactIdentifierType:"email",client_name:B||Y.client_name,company_website:H||Y.company_website})),k(C),T(!1),o==="deal"&&setTimeout(()=>{f(!0)},100)}})]})}var Ud=Object.defineProperty,Bd=(e,t,a)=>t in e?Ud(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Mn=(e,t,a)=>Bd(e,typeof t!="symbol"?t+"":t,a);const Tn=class Bt{constructor(){Mn(this,"isEnabled",!1)}static getInstance(){return Bt.instance||(Bt.instance=new Bt),Bt.instance}async logAuthEvent(t){if(!this.isEnabled){v.log("Auth logging disabled - skipping event:",t.event_type);return}try{const{data:a,error:s}=await R.functions.invoke("auth-logger",{body:t});s&&v.warn("Failed to log auth event:",s)}catch{}}disable(){this.isEnabled=!1}enable(){this.isEnabled=!0}};Mn(Tn,"instance");let Vd=Tn;const ha=Vd.getInstance(),In=g.createContext(void 0),Hr=()=>{const e=g.useContext(In);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},qd=({children:e})=>{const[t,a]=g.useState(null),[s,n]=g.useState(null),[o,i]=g.useState(!0),l=jr();g.useEffect(()=>{let u=!0,p=!0;(async()=>{try{const{data:{session:T},error:_}=await R.auth.getSession();u&&(_?(v.error("Error getting session:",_),he.clearAuthStorage()):(n(T),a(T?.user??null),T?.user&&p&&(v.log(" Session restored for:",T.user.email),ha.logAuthEvent({event_type:"SIGNED_IN",user_id:T.user.id,email:T.user.email}))),i(!1))}catch{u&&(he.clearAuthStorage(),i(!1))}})();const{data:{subscription:I}}=R.auth.onAuthStateChange(async(T,_)=>{if(u){switch(n(_),a(_?.user??null),T){case"SIGNED_IN":p||v.log(" Manual sign-in successful for:",_?.user?.email),l.invalidateQueries(),_?.user&&ha.logAuthEvent({event_type:"SIGNED_IN",user_id:_.user.id,email:_.user.email});break;case"SIGNED_OUT":L.success("Successfully signed out!"),l.clear(),he.clearAuthStorage();break;case"TOKEN_REFRESHED":_?.user&&ha.logAuthEvent({event_type:"TOKEN_REFRESHED",user_id:_.user.id});break;case"PASSWORD_RECOVERY":_?.user&&ha.logAuthEvent({event_type:"PASSWORD_RECOVERY",user_id:_.user.id,email:_.user.email});break}i(!1)}p=!1});return()=>{u=!1,I.unsubscribe()}},[l]);const c=g.useCallback(async(u,p)=>{try{const{error:k}=await R.auth.signInWithPassword({email:u.toLowerCase().trim(),password:p});return k?{error:{message:he.formatAuthError(k)}}:{error:null}}catch(k){return{error:{message:he.formatAuthError(k)}}}},[]),d=g.useCallback(async(u,p,k)=>{try{const{error:I}=await R.auth.signUp({email:u.toLowerCase().trim(),password:p,options:{data:k||{}}});return I?{error:{message:he.formatAuthError(I)}}:{error:null}}catch(I){return{error:{message:he.formatAuthError(I)}}}},[]),h=g.useCallback(async()=>{try{const{error:u}=await R.auth.signOut();return u?{error:{message:he.formatAuthError(u)}}:{error:null}}catch(u){return{error:{message:he.formatAuthError(u)}}}},[]),b=g.useCallback(async u=>{try{const p=wl("/auth/reset-password");v.log("Reset password redirect URL:",p);const{error:k}=await R.auth.resetPasswordForEmail(u.toLowerCase().trim(),{redirectTo:p});return k?{error:{message:he.formatAuthError(k)}}:{error:null}}catch(p){return{error:{message:he.formatAuthError(p)}}}},[]),f=g.useCallback(async u=>{try{const{error:p}=await R.auth.updateUser({password:u});return p?{error:{message:he.formatAuthError(p)}}:{error:null}}catch(p){return{error:{message:he.formatAuthError(p)}}}},[]),m=he.isAuthenticated(s),M=he.getUserId(s),x={user:t,session:s,loading:o,signIn:c,signUp:d,signOut:h,resetPassword:b,updatePassword:f,isAuthenticated:m,userId:M};return r.jsx(In.Provider,{value:x,children:e})};function Wd(){const{isViewMode:e,viewedUser:t,exitViewMode:a}=Ar();if(!e||!t)return null;const s=t.full_name||`${t.first_name||""} ${t.last_name||""}`.trim()||t.email;return r.jsx("div",{className:"relative bg-amber-500 text-white shadow-lg",children:r.jsx("div",{className:"px-4 py-2",children:r.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"font-semibold",children:"View Mode:"}),r.jsxs("span",{children:["Viewing data as ",s]})]}),r.jsxs(Cn,{variant:"ghost",size:"sm",onClick:a,className:"text-white hover:bg-amber-600 hover:text-white",children:[r.jsx(xt,{className:"h-4 w-4 mr-1"}),"Exit View Mode"]})]})})})}function je({children:e}){const{userData:t,isImpersonating:a,stopImpersonating:s}=Ge(),{signOut:n}=Hr(),o=Fs(),[i,l]=g.useState(!1),[c,d]=qo(!1,!0),[h,b]=g.useState(!1),[f,m]=g.useState(!1),M=async()=>{try{if(a)await s();else{const{error:u}=await n();u&&L.error("Error logging out: "+u.message)}}catch{L.error(a?"Error stopping impersonation":"Error logging out")}};g.useEffect(()=>{b(!0)},[]);const x=[{icon:Do,label:"Dashboard",href:"/"},{icon:Mo,label:"Pipeline",href:"/pipeline"},{icon:ba,label:"Tasks",href:"/tasks"},{icon:Jt,label:"CRM",href:"/crm"},{icon:Ve,label:"Clients",href:"/clients"},{icon:Ea,label:"Activity",href:"/activity"},{icon:To,label:"Insights",href:"/insights"},{icon:Io,label:"Roadmap",href:"/roadmap"},{icon:Po,label:"Releases",href:"/releases"},...t?.is_admin?[{icon:Ao,label:"Admin",href:"/admin"}]:[]];return r.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950 text-gray-100",children:[r.jsx(Wd,{}),r.jsxs("div",{className:"flex",children:[a&&r.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-amber-500/10 backdrop-blur-sm text-center py-1 px-2 text-amber-400 text-xs font-medium border-b border-amber-500/20",children:r.jsxs("span",{className:"flex items-center justify-center gap-1",children:[r.jsx(xa,{className:"w-3 h-3"})," You are impersonating ",t?.first_name," ",t?.last_name]})}),r.jsxs("div",{className:le("fixed top-0 left-0 right-0 flex items-center justify-between z-50 p-4 bg-gray-950/50 backdrop-blur-sm border-b border-gray-800/50 lg:hidden",a?"mt-6":""),children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg overflow-hidden",children:t?.avatar_url?r.jsx("img",{src:t.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-[#37bd7e]/20 flex items-center justify-center",children:r.jsxs("span",{className:"text-sm font-medium text-[#37bd7e]",children:[t?.first_name?.[0]||"",t?.last_name?.[0]||""]})})}),r.jsxs("div",{className:"flex flex-col",children:[r.jsxs("span",{className:"text-sm font-semibold text-white/90",children:[t?.first_name," ",t?.last_name]}),r.jsx("span",{className:"text-xs text-gray-400",children:t?.stage})]})]}),r.jsx(ne.button,{animate:c?{opacity:0}:{opacity:1},onClick:()=>d(),className:"p-2 rounded-xl bg-gray-800/50 hover:bg-gray-800/70 transition-colors lg:hidden",children:r.jsx(ls,{className:"w-6 h-6 text-gray-400"})})]}),r.jsx(ne.button,{type:"button",whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>m(!0),className:"fixed bottom-6 right-6 p-4 rounded-full bg-[#37bd7e] hover:bg-[#2da76c] transition-colors shadow-lg shadow-[#37bd7e]/20 z-50",children:r.jsx(Ws,{className:"w-6 h-6 text-white"})}),r.jsx(Le,{children:c&&r.jsxs(r.Fragment,{children:[r.jsx(ne.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40 lg:hidden",onClick:()=>d()}),r.jsx(ne.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",bounce:0,duration:.4},className:"fixed right-0 top-0 bottom-0 w-full max-w-[280px] bg-gray-900/50 backdrop-blur-xl border-l border-gray-800/50 p-6 z-50 lg:hidden",children:r.jsxs("div",{className:"relative h-full",children:[r.jsxs("div",{className:"flex items-center justify-between mb-8",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded-lg overflow-hidden",children:t?.avatar_url?r.jsx("img",{src:t.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-[#37bd7e]/20 flex items-center justify-center",children:r.jsxs("span",{className:"text-sm font-medium text-[#37bd7e]",children:[t?.first_name?.[0],t?.last_name?.[0]]})})}),r.jsxs("div",{className:"flex flex-col",children:[r.jsxs("span",{className:"text-sm font-semibold text-white/90",children:[t?.first_name," ",t?.last_name]}),r.jsx("span",{className:"text-xs text-gray-400",children:t?.stage})]})]}),r.jsx("button",{onClick:()=>d(),className:"p-2 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(xt,{className:"w-5 h-5 text-gray-400"})})]}),r.jsx("nav",{className:"space-y-2",children:x.map(u=>r.jsxs("div",{children:[r.jsxs(lt,{to:u.href,onClick:()=>d(),className:le("w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-colors",o.pathname===u.href||u.subItems&&u.subItems.some(p=>o.pathname===p.href)?"bg-[#37bd7e]/10 text-white border border-[#37bd7e]/20":"text-gray-400/80 hover:bg-gray-800/20"),children:[r.jsx(u.icon,{className:le("w-5 h-5",o.pathname===u.href||u.subItems&&u.subItems.some(p=>o.pathname===p.href)?"text-white":"text-gray-400/80")}),r.jsx("span",{children:u.label})]}),u.subItems&&r.jsx("div",{className:"ml-8 mt-1 space-y-1",children:u.subItems.map(p=>r.jsxs(lt,{to:p.href,onClick:()=>d(),className:le("w-full flex items-center gap-3 px-4 py-2 rounded-xl text-xs font-medium transition-colors",o.pathname===p.href?"bg-[#37bd7e]/10 text-white border border-[#37bd7e]/20":"text-gray-400/80 hover:bg-gray-800/20"),children:[r.jsx(p.icon,{className:"w-4 h-4"}),r.jsx("span",{children:p.label})]},p.href+p.label))})]},u.href+u.label))}),r.jsxs("div",{className:"absolute bottom-0 left-0 p-6 border-t border-gray-800/50 w-full space-y-2",children:[r.jsxs(lt,{to:"/profile",onClick:()=>d(),className:"flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium text-gray-400 hover:bg-gray-800/50 transition-colors",children:[r.jsx(cs,{className:"w-5 h-5"}),"Settings"]}),r.jsx("button",{onClick:M,className:le("w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-colors",a?"text-amber-400 hover:bg-amber-500/10":"text-red-400 hover:bg-red-500/10"),children:a?r.jsxs(r.Fragment,{children:[r.jsx(xa,{className:"w-5 h-5"}),"Stop Impersonation"]}):r.jsxs(r.Fragment,{children:[r.jsx(ds,{className:"w-5 h-5"}),"Logout"]})})]})]})})]})}),r.jsxs(ne.div,{initial:h?!1:{opacity:0,x:-20},animate:h?!1:{opacity:1,x:0},className:le("fixed left-0 h-screen bg-gray-900/50 backdrop-blur-xl border-r border-gray-800/50 p-6","transition-[width] duration-300 ease-in-out flex-shrink-0",i?"w-[80px]":"w-[256px]","hidden lg:block z-[100]",a?"top-6":"top-0"),children:[r.jsx("div",{className:le("flex items-center gap-3 mb-8",i&&"justify-center"),children:i?r.jsx("button",{onClick:()=>l(!1),className:"p-2 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(ls,{className:"w-5 h-5 text-gray-400"})}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-8 h-8 rounded-lg overflow-hidden",children:t?.avatar_url?r.jsx("img",{src:t.avatar_url,alt:"Profile",className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full bg-[#37bd7e]/20 flex items-center justify-center",children:r.jsxs("span",{className:"text-sm font-medium text-[#37bd7e]",children:[t?.first_name?.[0],t?.last_name?.[0]]})})}),r.jsx(Le,{children:r.jsx(ne.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"overflow-hidden",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsxs("span",{className:"text-sm font-semibold text-white/90",children:[t?.first_name," ",t?.last_name]}),r.jsx("span",{className:"text-xs text-gray-400",children:t?.stage})]})})}),r.jsx("button",{onClick:()=>l(!0),className:"absolute right-2 top-6 p-2 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(xt,{className:"w-5 h-5 text-gray-400"})})]})}),r.jsx("nav",{className:"space-y-2",children:x.map(u=>r.jsxs("div",{children:[r.jsxs(lt,{to:u.href,className:le("w-full flex items-center gap-3 px-2 py-2.5 rounded-xl text-sm font-medium transition-colors",o.pathname===u.href||u.subItems&&u.subItems.some(p=>o.pathname===p.href)?"bg-[#37bd7e]/10 text-white border border-[#37bd7e]/20":"text-gray-400/80 hover:bg-gray-800/20"),children:[r.jsx(ne.div,{animate:{x:0,scale:i?1.1:1},className:le("relative z-10 min-w-[20px] flex items-center justify-center",o.pathname===u.href||u.subItems&&u.subItems.some(p=>o.pathname===p.href)?"text-white":"text-gray-400/80"),children:r.jsx(u.icon,{className:"w-4 h-4"})}),r.jsx(Le,{children:!i&&r.jsx(ne.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"overflow-hidden whitespace-nowrap",children:u.label})})]}),u.subItems&&!i&&r.jsx("div",{className:"ml-8 mt-1 space-y-1",children:u.subItems.map(p=>r.jsxs(lt,{to:p.href,className:le("w-full flex items-center gap-3 px-2 py-2 rounded-xl text-xs font-medium transition-colors",o.pathname===p.href?"bg-[#37bd7e]/10 text-white border border-[#37bd7e]/20":"text-gray-400/80 hover:bg-gray-800/20"),children:[r.jsx(p.icon,{className:"w-3.5 h-3.5"}),r.jsx("span",{children:p.label})]},p.href+p.label))})]},u.href+u.label))}),r.jsx("div",{className:le("absolute bottom-0 left-0 p-6 border-t border-gray-800/50 w-full"),children:r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsxs(lt,{to:"/profile",className:"flex items-center gap-3 px-4 py-2.5 rounded-xl text-sm font-medium text-gray-400 hover:bg-gray-800/50 transition-colors",children:[r.jsx(cs,{className:"w-4 h-4"}),r.jsx(Le,{children:!i&&r.jsx(ne.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"overflow-hidden whitespace-nowrap",children:"Settings"})})]}),r.jsx("button",{onClick:M,className:le("flex items-center gap-3 px-4 py-2.5 rounded-xl text-sm font-medium transition-colors",a?"text-amber-400 hover:bg-amber-500/10":"text-red-400 hover:bg-red-500/10"),children:a?r.jsxs(r.Fragment,{children:[r.jsx(xa,{className:"w-4 h-4"}),r.jsx(Le,{children:!i&&r.jsx(ne.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"overflow-hidden whitespace-nowrap",children:"Stop Impersonation"})})]}):r.jsxs(r.Fragment,{children:[r.jsx(ds,{className:"w-4 h-4"}),r.jsx(Le,{children:!i&&r.jsx(ne.span,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"overflow-hidden whitespace-nowrap",children:"Logout"})})]})})]})})]}),r.jsxs("main",{className:le("flex-1 transition-[margin] duration-300 ease-in-out",i?"lg:ml-[80px]":"lg:ml-[256px]","ml-0",a?"pt-22 lg:pt-6":"pt-16 lg:pt-0"),children:[e,r.jsx(zd,{isOpen:f,onClose:()=>m(!1)})]})]})]})}let Ht=null;function Pn(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}function An(e){if(Ht=e,localStorage.setItem("audit_session_id",e),typeof window<"u")try{R.rpc("set_config",{setting_name:"app.session_id",setting_value:e,is_local:!0}).catch(t=>{})}catch{}}function Hd(){if(Ht)return Ht;if(typeof window<"u"){const e=localStorage.getItem("audit_session_id");if(e)return Ht=e,e}return null}function Gd(){const e=Pn();return An(e),e}function Es(){Ht=null,typeof window<"u"&&localStorage.removeItem("audit_session_id")}function Yd(){const{userData:e}=Ge(),[t,a]=g.useState(null),[s,n]=g.useState(!1);return g.useEffect(()=>{if(e?.id&&!s){let l=Hd();l||(l=Gd()),a(l),n(!0)}},[e?.id,s]),g.useEffect(()=>{!e?.id&&s&&(Es(),a(null),n(!1))},[e?.id,s]),{sessionId:t,renewSession:()=>{const l=Pn();return An(l),a(l),l},endSession:()=>{Es(),a(null)},isInitialized:s}}function Jd(){const{sessionId:e,isInitialized:t}=Yd();return g.useEffect(()=>{},[e,t]),{sessionId:e,isInitialized:t}}const Qd=["/auth/login","/auth/signup","/auth/forgot-password","/auth/reset-password"];function Ds({children:e,redirectTo:t="/auth/login"}){const{isAuthenticated:a,loading:s}=Hr(),n=Ma(),o=Fs(),i=Qd.includes(o.pathname),l=o.pathname==="/auth/reset-password"&&o.hash.includes("type=recovery");return g.useEffect(()=>{if(!s){if(a&&i&&!l){n("/");return}if(!a&&!i&&!l){const c=o.pathname+o.search;n(t,{state:{from:c},replace:!0});return}}},[a,s,i,l,n,t,o]),s?r.jsxs("div",{className:"min-h-screen flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(74,74,117,0.25),transparent)] pointer-events-none"}),r.jsx(nr,{className:"w-8 h-8 text-[#37bd7e] animate-spin"})]}):l?r.jsx(r.Fragment,{children:e}):i?r.jsx(r.Fragment,{children:e}):a?r.jsx(r.Fragment,{children:e}):null}var Kd=Object.defineProperty,Zd=(e,t,a)=>t in e?Kd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,hr=(e,t,a)=>Zd(e,typeof t!="symbol"?t+"":t,a);const Xd=(e,t="normal")=>{if(typeof window>"u")return;const a=document.createElement("link");a.rel=t==="critical"?"preload":"prefetch",a.href=e,a.as="style",t==="critical"&&(a.onload=()=>{a.rel="stylesheet"}),document.head.appendChild(a)},eu=(e,t="woff2")=>{if(typeof window>"u")return;const a=document.createElement("link");a.rel="preload",a.href=e,a.as="font",a.type=`font/${t}`,a.crossOrigin="anonymous",document.head.appendChild(a)},tu=e=>{if(typeof window>"u")return;const t=document.createElement("link");t.rel="dns-prefetch",t.href=e,document.head.appendChild(t)},Ms=e=>{if(typeof window>"u")return;const t=document.createElement("link");t.rel="preconnect",t.href=e,t.crossOrigin="anonymous",document.head.appendChild(t)},On=class Vt{constructor(){hr(this,"metrics",{totalSize:0,loadedChunks:[],pendingChunks:[],errorChunks:[],loadTime:0}),hr(this,"startTime",Date.now())}static getInstance(){return Vt.instance||(Vt.instance=new Vt),Vt.instance}trackChunkLoad(t,a){this.metrics.loadedChunks.push(t),this.metrics.totalSize+=a;const s=this.metrics.pendingChunks.indexOf(t);s>-1&&this.metrics.pendingChunks.splice(s,1),this.updateLoadTime()}trackChunkError(t){this.metrics.errorChunks.push(t);const a=this.metrics.pendingChunks.indexOf(t);a>-1&&this.metrics.pendingChunks.splice(a,1)}trackPendingChunk(t){this.metrics.pendingChunks.includes(t)||this.metrics.pendingChunks.push(t)}updateLoadTime(){this.metrics.loadTime=Date.now()-this.startTime}getMetrics(){return{...this.metrics}}reset(){this.metrics={totalSize:0,loadedChunks:[],pendingChunks:[],errorChunks:[],loadTime:0},this.startTime=Date.now()}};hr(On,"instance");let au=On;const ru=async()=>{if(Ms("https://fonts.googleapis.com"),Ms("https://fonts.gstatic.com"),tu("https://api.supabase.co"),eu("/fonts/inter-var.woff2","woff2"),document.querySelector('link[href*="tailwind"]')){const e=document.querySelector('link[href*="tailwind"]');e&&Xd(e.href,"critical")}},ut={immediate:[],onInteraction:[],onIdle:[],add:(e,t)=>{ut[e].push(t)},executeImmediate:async()=>{const e=ut.immediate.splice(0);await Promise.allSettled(e.map(t=>t()))},executeOnInteraction:async()=>{const e=ut.onInteraction.splice(0);await Promise.allSettled(e.map(t=>t()))},executeOnIdle:async()=>{const e=ut.onIdle.splice(0);await Promise.allSettled(e.map(t=>t()))}},gt={navigationHistory:[],recordNavigation:e=>{gt.navigationHistory.push(e),gt.navigationHistory.length>10&&gt.navigationHistory.shift()},predictNextRoute:()=>{const e=gt.navigationHistory;if(e.length<2)return null;const t=e[e.length-1],s={"/":["/pipeline","/activity","/companies"],"/pipeline":["/crm/deals","/companies"],"/companies":["/crm/contacts","/pipeline"],"/activity":["/pipeline","/companies"]}[t];return s&&s.length>0?s[0]:null},preloadPredictedRoute:()=>{gt.predictNextRoute()}},su=(e={})=>{const{enableResourcePreloading:t=!0,enableSmartPreloading:a=!0,enableBundleMonitoring:s=!0,enableMemoryCleanup:n=!0,debugMode:o=!1}=e,i=g.useRef(0),l=g.useRef(au.getInstance()),c=g.useRef(null),d=g.useRef([]),h=g.useRef(0);g.useEffect(()=>{if(i.current++,o&&i.current>10){const x=Date.now();x-h.current>5e3&&(v.warn(`Component re-rendered ${i.current} times, consider optimization`),h.current=x)}}),g.useEffect(()=>{if(!t)return;(async()=>{try{await ru(),await ut.executeImmediate(),o&&v.log("Critical resources loaded")}catch{}})()},[t,o]),g.useEffect(()=>{if(!a)return;let x;const u=["mousedown","touchstart","keydown","scroll"],p=[],k=()=>{const _=window.location.pathname;gt.recordNavigation(_),gt.preloadPredictedRoute()},I=()=>{clearTimeout(x),x=setTimeout(()=>{ut.executeOnInteraction()},100)};k(),window.addEventListener("popstate",k),p.push({target:window,event:"popstate",listener:k}),u.forEach(_=>{document.addEventListener(_,I,{passive:!0}),p.push({target:document,event:_,listener:I})});const T=()=>{x&&clearTimeout(x),p.forEach(({target:_,event:S,listener:N})=>{_.removeEventListener(S,N)}),p.length=0};return d.current.push(T),T},[a]),g.useEffect(()=>{if(!s||typeof window>"u")return;if(document.querySelectorAll("script[src]").forEach(u=>{const p=u.src;(p.includes("chunk")||p.includes("vendor"))&&(l.current.trackPendingChunk(p),u.addEventListener("load",()=>{l.current.trackChunkLoad(p,0)}),u.addEventListener("error",()=>{l.current.trackChunkError(p)}))}),"PerformanceObserver"in window)try{c.current=new PerformanceObserver(u=>{u.getEntries().forEach(k=>{k.entryType==="measure"&&o&&v.log(`Performance measure: ${k.name} - ${k.duration}ms`)})}),c.current.observe({entryTypes:["measure","navigation"]})}catch{}return()=>{c.current&&c.current.disconnect()}},[s,o]),g.useEffect(()=>{if(!n)return;const x=()=>{ut.executeOnIdle(),typeof window<"u"&&"caches"in window&&caches.keys().then(p=>{p.filter(I=>I.includes("old")||I.includes("temp")).forEach(I=>{caches.delete(I)})}).catch(p=>v.warn("Cache cleanup failed:",p))};let u;return"requestIdleCallback"in window?u=requestIdleCallback(x,{timeout:5e3}):u=setTimeout(x,5e3),()=>{"cancelIdleCallback"in window?cancelIdleCallback(u):clearTimeout(u)}},[n]),g.useEffect(()=>()=>{d.current.forEach(x=>x())},[]);const b=g.useMemo(()=>{const x=l.current.getMetrics();return{componentRenders:i.current,memoryUsage:performance.memory?.usedJSHeapSize||0,bundleSize:x.totalSize,loadTime:x.loadTime,interactionDelay:0}},[]),f=g.useCallback((x,u)=>{if(!o){u();return}const p=performance.now();performance.mark(`${x}-start`),u(),performance.mark(`${x}-end`),performance.measure(x,`${x}-start`,`${x}-end`);const k=performance.now();k-p>16&&v.warn(`Performance warning: ${x} took ${(k-p).toFixed(2)}ms`)},[o]),m=g.useCallback((x,u="medium")=>{ut.add("onIdle",()=>import(x))},[]),M=g.useCallback(x=>{d.current.push(x)},[]);return{performanceMetrics:b,measurePerformance:f,preloadModule:m,addCleanup:M,bundleMonitor:l.current,renderCount:i.current}},ce=U.forwardRef(({className:e,...t},a)=>r.jsx("div",{ref:a,className:le("animate-pulse rounded-md bg-muted bg-gray-200",e),...t}));ce.displayName="Skeleton";const Zt=({height:e="400px",className:t="",variant:a="skeleton"})=>a==="spinner"?r.jsx("div",{className:`flex items-center justify-center ${t}`,style:{height:e},children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})}):a==="dots"?r.jsxs("div",{className:`flex items-center justify-center space-x-2 ${t}`,style:{height:e},children:[r.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-bounce"}),r.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),r.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}):r.jsxs("div",{className:`space-y-4 p-4 ${t}`,style:{height:e},children:[r.jsx(ce,{className:"h-8 w-1/3"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(ce,{className:"h-4 w-full"}),r.jsx(ce,{className:"h-4 w-5/6"}),r.jsx(ce,{className:"h-4 w-4/6"})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-8",children:[r.jsx(ce,{className:"h-24 w-full"}),r.jsx(ce,{className:"h-24 w-full"}),r.jsx(ce,{className:"h-24 w-full"})]})]}),Rn=({rows:e=5,className:t=""})=>r.jsxs("div",{className:`space-y-3 ${t}`,children:[r.jsxs("div",{className:"flex space-x-4",children:[r.jsx(ce,{className:"h-4 w-32"}),r.jsx(ce,{className:"h-4 w-24"}),r.jsx(ce,{className:"h-4 w-20"}),r.jsx(ce,{className:"h-4 w-16"})]}),Array.from({length:e}).map((a,s)=>r.jsxs("div",{className:"flex space-x-4",children:[r.jsx(ce,{className:"h-4 w-32"}),r.jsx(ce,{className:"h-4 w-24"}),r.jsx(ce,{className:"h-4 w-20"}),r.jsx(ce,{className:"h-4 w-16"})]},s))]}),Gr=({className:e=""})=>r.jsxs("div",{className:`space-y-6 ${e}`,children:[r.jsx(ce,{className:"h-8 w-48"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx(ce,{className:"h-4 w-24"}),r.jsx(ce,{className:"h-10 w-full"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(ce,{className:"h-4 w-24"}),r.jsx(ce,{className:"h-10 w-full"})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx(ce,{className:"h-4 w-24"}),r.jsx(ce,{className:"h-24 w-full"})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx(ce,{className:"h-10 w-20"}),r.jsx(ce,{className:"h-10 w-20"})]})]})]}),nu=({height:e=400,className:t=""})=>r.jsxs("div",{className:`space-y-4 ${t}`,children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx(ce,{className:"h-6 w-32"}),r.jsx(ce,{className:"h-8 w-24"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(ce,{className:"w-full",style:{height:`${e}px`}}),r.jsxs("div",{className:"absolute inset-0 p-4 space-y-2",children:[r.jsx("div",{className:"absolute left-0 top-8 bottom-8 w-8 flex flex-col justify-between",children:[...Array(5)].map((a,s)=>r.jsx(ce,{className:"h-3 w-6"},s))}),r.jsx("div",{className:"absolute left-12 right-4 top-8 bottom-12 flex items-end justify-between",children:[...Array(7)].map((a,s)=>r.jsx(ce,{className:"w-8",style:{height:`${Math.random()*60+20}%`}},s))})]})]})]}),Ye=(e,t={loader:Zt})=>{const a=g.lazy(e),s=n=>{const{loader:o=Zt,fallback:i}=t;return r.jsx(g.Suspense,{fallback:i?r.jsx("fallback",{...n}):r.jsx(o,{}),children:r.jsx(a,{...n})})};return s.preload=()=>{const n=t.preloadDelay||0;setTimeout(()=>{e().catch(o=>v.warn("Failed to preload component:",o))},n)},s};Ye(()=>te(()=>import("./table-C4c75fDG.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),{loader:()=>r.jsx(Rn,{}),preloadDelay:1e3});const ou=Ye(()=>te(()=>import("./ui-animation-Dzb4KUJ1.js"),__vite__mapDeps([8,2])).then(e=>({default:e.motion.div})),{loader:()=>r.jsx(Zt,{height:"auto",variant:"dots"}),preloadDelay:2e3});Ye(()=>te(()=>import("./ui-animation-Dzb4KUJ1.js"),__vite__mapDeps([8,2])).then(e=>({default:e.AnimatePresence})),{preloadDelay:2e3});const iu=Ye(()=>te(()=>import("./index-IRLd9rcZ.js"),__vite__mapDeps([10,1,2,11,12,13,14,6,7,3,4,5,8,9,15,16,17,18,19,20,21,22,23,24,25,26,27])),{loader:()=>r.jsx(Zt,{height:"600px"}),preloadDelay:1500}),lu=Ye(()=>te(()=>import("./ChartLoader-C5qHLK1n.js"),__vite__mapDeps([28,4,2,1,3,5,6,7,8,9])),{loader:()=>r.jsx(nu,{}),preloadDelay:1e3});Ye(()=>te(()=>import("./dialog-BBMx1wit.js"),__vite__mapDeps([14,1,2,6,7,3,4,5,8,9])),{loader:()=>r.jsx(Zt,{height:"300px",variant:"spinner"})});const cu=Ye(()=>te(()=>Promise.resolve().then(()=>Fd),void 0),{loader:()=>r.jsx(Gr,{}),preloadDelay:2e3}),du=Ye(()=>te(()=>import("./index-CMN_0IMp.js"),__vite__mapDeps([29,13,1,2,14,6,7,3,4,5,8,9,15,16,17,18,19,20,21,22,23,24,25,26])),{loader:()=>r.jsx(Gr,{}),preloadDelay:1500}),uu=Ye(()=>te(()=>import("./AuditLogViewer-3eVDmxd9.js"),__vite__mapDeps([30,1,2,31,20,5,7,3,4,6,8,9])),{loader:()=>r.jsx(Rn,{rows:10}),preloadDelay:3e3}),mu=Ye(()=>te(()=>import("./BulkActivityImport-CzjAGYa9.js"),__vite__mapDeps([32,1,2,33,5,7,3,4,6,8,9])),{loader:()=>r.jsx(Gr,{}),preloadDelay:3e3}),fu=()=>{U.useEffect(()=>{const e=setTimeout(()=>{const t=window.location.pathname;t==="/"?iu.preload?.():t==="/pipeline"?(du.preload?.(),cu.preload?.()):t.includes("/admin")&&(uu.preload?.(),mu.preload?.())},2e3);return()=>clearTimeout(e)},[])},hu=()=>(fu(),U.useEffect(()=>{const e=()=>{lu.preload?.(),ou.preload?.()},t=()=>{e(),window.removeEventListener("mousemove",t),window.removeEventListener("scroll",t),window.removeEventListener("keydown",t)};return window.addEventListener("mousemove",t,{once:!0}),window.addEventListener("scroll",t,{once:!0}),window.addEventListener("keydown",t,{once:!0}),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("scroll",t),window.removeEventListener("keydown",t)}},[]),null);let Ln=-1;const Tt=e=>{addEventListener("pageshow",t=>{t.persisted&&(Ln=t.timeStamp,e(t))},!0)},We=(e,t,a,s)=>{let n,o;return i=>{t.value>=0&&(i||s)&&(o=t.value-(n??0),(o||n===void 0)&&(n=t.value,t.delta=o,t.rating=((l,c)=>l>c[1]?"poor":l>c[0]?"needs-improvement":"good")(t.value,a),e(t)))}},Yr=e=>{requestAnimationFrame(()=>requestAnimationFrame(()=>e()))},Jr=()=>{const e=performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},ra=()=>Jr()?.activationStart??0,He=(e,t=-1)=>{const a=Jr();let s="navigate";return Ln>=0?s="back-forward-cache":a&&(document.prerendering||ra()>0?s="prerender":document.wasDiscarded?s="restore":a.type&&(s=a.type.replace(/_/g,"-"))),{name:e,value:t,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:s}},tr=new WeakMap;function Qr(e,t){return tr.get(e)||tr.set(e,new t),tr.get(e)}class pu{constructor(){Ce(this,"t");Ce(this,"i",0);Ce(this,"o",[])}h(t){if(t.hadRecentInput)return;const a=this.o[0],s=this.o.at(-1);this.i&&a&&s&&t.startTime-s.startTime<1e3&&t.startTime-a.startTime<5e3?(this.i+=t.value,this.o.push(t)):(this.i=t.value,this.o=[t]),this.t?.(t)}}const sa=(e,t,a={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const s=new PerformanceObserver(n=>{Promise.resolve().then(()=>{t(n.getEntries())})});return s.observe({type:e,buffered:!0,...a}),s}}catch{}},Kr=e=>{let t=!1;return()=>{t||(e(),t=!0)}};let St=-1;const $n=new Set,Ts=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,pr=e=>{if(document.visibilityState==="hidden"){if(e.type==="visibilitychange")for(const t of $n)t();isFinite(St)||(St=e.type==="visibilitychange"?e.timeStamp:0,removeEventListener("prerenderingchange",pr,!0))}},Pa=()=>{if(St<0){const e=ra();St=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter(a=>a.name==="hidden"&&a.startTime>e)[0]?.startTime)??Ts(),addEventListener("visibilitychange",pr,!0),addEventListener("prerenderingchange",pr,!0),Tt(()=>{setTimeout(()=>{St=Ts()})})}return{get firstHiddenTime(){return St},onHidden(e){$n.add(e)}}},Aa=e=>{document.prerendering?addEventListener("prerenderingchange",()=>e(),!0):e()},gr=[1800,3e3],Zr=(e,t={})=>{Aa(()=>{const a=Pa();let s,n=He("FCP");const o=sa("paint",i=>{for(const l of i)l.name==="first-contentful-paint"&&(o.disconnect(),l.startTime<a.firstHiddenTime&&(n.value=Math.max(l.startTime-ra(),0),n.entries.push(l),s(!0)))});o&&(s=We(e,n,gr,t.reportAllChanges),Tt(i=>{n=He("FCP"),s=We(e,n,gr,t.reportAllChanges),Yr(()=>{n.value=performance.now()-i.timeStamp,s(!0)})}))})},yr=[.1,.25],Fn=(e,t={})=>{const a=Pa();Zr(Kr(()=>{let s,n=He("CLS",0);const o=Qr(t,pu),i=c=>{for(const d of c)o.h(d);o.i>n.value&&(n.value=o.i,n.entries=o.o,s())},l=sa("layout-shift",i);l&&(s=We(e,n,yr,t.reportAllChanges),a.onHidden(()=>{i(l.takeRecords()),s(!0)}),Tt(()=>{o.i=0,n=He("CLS",0),s=We(e,n,yr,t.reportAllChanges),Yr(()=>s())}),setTimeout(s))}))};let zn=0,ar=1/0,pa=0;const gu=e=>{for(const t of e)t.interactionId&&(ar=Math.min(ar,t.interactionId),pa=Math.max(pa,t.interactionId),zn=pa?(pa-ar)/7+1:0)};let vr;const Is=()=>vr?zn:performance.interactionCount??0,yu=()=>{"interactionCount"in performance||vr||(vr=sa("event",gu,{type:"event",buffered:!0,durationThreshold:0}))};let Ps=0;class vu{constructor(){Ce(this,"u",[]);Ce(this,"l",new Map);Ce(this,"m");Ce(this,"p")}v(){Ps=Is(),this.u.length=0,this.l.clear()}L(){const t=Math.min(this.u.length-1,Math.floor((Is()-Ps)/50));return this.u[t]}h(t){if(this.m?.(t),!t.interactionId&&t.entryType!=="first-input")return;const a=this.u.at(-1);let s=this.l.get(t.interactionId);if(s||this.u.length<10||t.duration>a.P){if(s?t.duration>s.P?(s.entries=[t],s.P=t.duration):t.duration===s.P&&t.startTime===s.entries[0].startTime&&s.entries.push(t):(s={id:t.interactionId,entries:[t],P:t.duration},this.l.set(s.id,s),this.u.push(s)),this.u.sort((n,o)=>o.P-n.P),this.u.length>10){const n=this.u.splice(10);for(const o of n)this.l.delete(o.id)}this.p?.(s)}}}const Un=e=>{const t=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?e():(e=Kr(e),addEventListener("visibilitychange",e,{once:!0,capture:!0}),t(()=>{e(),removeEventListener("visibilitychange",e,{capture:!0})}))},br=[200,500],bu=(e,t={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;const a=Pa();Aa(()=>{yu();let s,n=He("INP");const o=Qr(t,vu),i=c=>{Un(()=>{for(const h of c)o.h(h);const d=o.L();d&&d.P!==n.value&&(n.value=d.P,n.entries=d.entries,s())})},l=sa("event",i,{durationThreshold:t.durationThreshold??40});s=We(e,n,br,t.reportAllChanges),l&&(l.observe({type:"first-input",buffered:!0}),a.onHidden(()=>{i(l.takeRecords()),s(!0)}),Tt(()=>{o.v(),n=He("INP"),s=We(e,n,br,t.reportAllChanges)}))})};class xu{constructor(){Ce(this,"m")}h(t){this.m?.(t)}}const xr=[2500,4e3],Bn=(e,t={})=>{Aa(()=>{const a=Pa();let s,n=He("LCP");const o=Qr(t,xu),i=c=>{t.reportAllChanges||(c=c.slice(-1));for(const d of c)o.h(d),d.startTime<a.firstHiddenTime&&(n.value=Math.max(d.startTime-ra(),0),n.entries=[d],s())},l=sa("largest-contentful-paint",i);if(l){s=We(e,n,xr,t.reportAllChanges);const c=Kr(()=>{i(l.takeRecords()),l.disconnect(),s(!0)}),d=h=>{h.isTrusted&&(Un(c),removeEventListener(h.type,d,{capture:!0}))};for(const h of["keydown","click","visibilitychange"])addEventListener(h,d,{capture:!0});Tt(h=>{n=He("LCP"),s=We(e,n,xr,t.reportAllChanges),Yr(()=>{n.value=performance.now()-h.timeStamp,s(!0)})})}})},wr=[800,1800],_r=e=>{document.prerendering?Aa(()=>_r(e)):document.readyState!=="complete"?addEventListener("load",()=>_r(e),!0):setTimeout(e)},Vn=(e,t={})=>{let a=He("TTFB"),s=We(e,a,wr,t.reportAllChanges);_r(()=>{const n=Jr();n&&(a.value=Math.max(n.responseStart-ra(),0),a.entries=[n],s(!0),Tt(()=>{a=He("TTFB",0),s=We(e,a,wr,t.reportAllChanges),s(!0)}))})},wu=Object.freeze(Object.defineProperty({__proto__:null,CLSThresholds:yr,FCPThresholds:gr,INPThresholds:br,LCPThresholds:xr,TTFBThresholds:wr,onCLS:Fn,onFCP:Zr,onINP:bu,onLCP:Bn,onTTFB:Vn},Symbol.toStringTag,{value:"Module"}));var _u=Object.defineProperty,ju=(e,t,a)=>t in e?_u(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,Ca=(e,t,a)=>ju(e,typeof t!="symbol"?t+"":t,a);const Cu={LCP:{good:2500,needs_improvement:4e3},CLS:{good:.1,needs_improvement:.25},FCP:{good:1800,needs_improvement:3e3},TTFB:{good:800,needs_improvement:1800}},qn=class qt{constructor(){Ca(this,"metrics",new Map),Ca(this,"observers",[]),Ca(this,"analyticsEnabled",!1)}static getInstance(){return qt.instance||(qt.instance=new qt),qt.instance}initializeMonitoring(t=!1){this.analyticsEnabled=t,Bn(this.handleMetric.bind(this)),Fn(this.handleMetric.bind(this)),Zr(this.handleMetric.bind(this)),Vn(this.handleMetric.bind(this)),this.optimizeLCP(),this.optimizeCLS()}handleMetric(t){const a={name:t.name,value:t.value,rating:t.rating,delta:t.delta,entries:t.entries,id:t.id};this.metrics.set(t.name,a),this.analyticsEnabled&&this.sendToAnalytics(a),t.rating!=="good"&&v.warn(` ${t.name} needs improvement:`,{value:t.value,rating:t.rating,threshold:this.getThreshold(t.name)})}optimizeLCP(){this.preloadCriticalResources(),this.optimizeImages(),this.addResourceHints()}optimizePerformance(){this.breakUpLongTasks(),this.initializeWebWorkers(),this.optimizeEventListeners()}optimizeCLS(){this.setImageDimensions(),this.reserveSpaceForDynamicContent(),this.optimizeFontLoading()}preloadCriticalResources(){{const t=Array.from(document.querySelectorAll('link[rel="stylesheet"]'));Array.from(document.querySelectorAll("script[src]")),t.forEach(a=>{const s=a.getAttribute("href");if(s&&!document.querySelector(`link[rel="preload"][href="${s}"]`)){const n=document.createElement("link");n.rel="preload",n.href=s,n.as="style",n.onload=()=>{n.onload=null},document.head.appendChild(n)}})}}optimizeImages(){const t=new IntersectionObserver(a=>{a.forEach(s=>{if(s.isIntersecting){const n=s.target;n.dataset.src&&(n.src=n.dataset.src,n.classList.remove("lazy"),t.unobserve(n))}})},{rootMargin:"50px 0px"});this.observers.push(t),document.querySelectorAll("img[data-src]").forEach(a=>{t.observe(a)})}addResourceHints(){[{rel:"dns-prefetch",href:"//fonts.googleapis.com"},{rel:"preconnect",href:"https://fonts.gstatic.com",crossorigin:!0},{rel:"dns-prefetch",href:"//api.sixty.com"}].forEach(a=>{const s=document.createElement("link");s.rel=a.rel,s.href=a.href,a.crossorigin&&(s.crossOrigin="anonymous"),document.head.appendChild(s)})}breakUpLongTasks(){const t=a=>{"scheduler"in window&&"postTask"in window.scheduler?window.scheduler.postTask(a,{priority:"user-blocking"}):"requestIdleCallback"in window?requestIdleCallback(a):setTimeout(a,0)};window.optimizedScheduler=t}initializeWebWorkers(){if(typeof Worker<"u"){const t=`
        self.onmessage = function(e) {
          const { type, data } = e.data;
          
          switch(type) {
            case 'PROCESS_DATA':
              // Heavy data processing
              const result = processLargeDataset(data);
              self.postMessage({ type: 'DATA_PROCESSED', result });
              break;
              
            case 'CALCULATE_METRICS':
              // Metric calculations
              const metrics = calculateComplexMetrics(data);
              self.postMessage({ type: 'METRICS_CALCULATED', metrics });
              break;
          }
        };
        
        function processLargeDataset(data) {
          // Simulate heavy processing
          return data.map(item => ({
            ...item,
            processed: true,
            timestamp: Date.now()
          }));
        }
        
        function calculateComplexMetrics(data) {
          // Complex calculations
          return {
            total: data.length,
            sum: data.reduce((acc, item) => acc + (item.value || 0), 0),
            average: data.length > 0 ? data.reduce((acc, item) => acc + (item.value || 0), 0) / data.length : 0
          };
        }
      `,a=new Blob([t],{type:"application/javascript"}),s=new Worker(URL.createObjectURL(a));window.dataProcessor=s}}optimizeEventListeners(){const t=["scroll","wheel","touchstart","touchmove"];t.forEach(a=>{const s=EventTarget.prototype.addEventListener;EventTarget.prototype.addEventListener=function(n,o,i){return t.includes(n)&&typeof i>"u"?i={passive:!0}:t.includes(n)&&typeof i=="boolean"&&(i={passive:!0,capture:i}),s.call(this,n,o,i)}})}setImageDimensions(){document.querySelectorAll("img:not([width]):not([height])").forEach(t=>{const a=t;a.loading||(a.loading="lazy"),a.style.aspectRatio||(a.style.aspectRatio="auto")})}reserveSpaceForDynamicContent(){const t=document.createElement("style");t.textContent=`
      .skeleton-loader {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }
      
      @keyframes loading {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }
      
      .content-placeholder {
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
    `,document.head.appendChild(t)}optimizeFontLoading(){const t=document.createElement("link");t.rel="preload",t.href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap",t.as="style",t.onload=()=>{t.onload=null,t.rel="stylesheet"},setTimeout(()=>{t.rel!=="stylesheet"&&(t.rel="stylesheet")},100),document.head.appendChild(t);const a=document.createElement("style");a.textContent=`
      * {
        font-display: swap;
      }
      
      /* Fallback font stack matching Inter */
      body {
        font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      }
    `,document.head.appendChild(a)}getThreshold(t){return Cu[t]}sendToAnalytics(t){typeof gtag<"u"&&window.gtag("event",t.name,{event_category:"Web Vitals",event_label:t.id,value:Math.round(t.name==="CLS"?t.value*1e3:t.value),custom_map:{metric_rating:t.rating}}),fetch("/api/analytics/web-vitals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent})}).catch(()=>{})}getMetricsReport(){return{lcp:this.metrics.get("LCP"),cls:this.metrics.get("CLS"),fcp:this.metrics.get("FCP"),ttfb:this.metrics.get("TTFB"),timestamp:Date.now(),url:window.location.href,userAgent:navigator.userAgent}}cleanup(){this.observers.forEach(t=>t.disconnect()),this.observers=[]}};Ca(qn,"instance");let Nu=qn;const Su=Nu.getInstance();async function ku(){try{v.log(' Removing "Signed & Paid" stage...');const{data:e,error:t}=await R.from("deal_stages").select("id, name").eq("name","Signed & Paid").single();if(t&&t.code!=="PGRST116")return v.error(" Error finding Signed & Paid stage:",t),!1;if(!e)return v.log(' "Signed & Paid" stage not found - already removed'),!0;v.log(' Found "Signed & Paid" stage:',e);const{data:a,error:s}=await R.from("deals").select("id, name").eq("stage_id",e.id);if(s)return v.error(" Error checking deals using stage:",s),!1;if(a&&a.length>0){v.log(` Found ${a.length} deals using "Signed & Paid" stage`);const{data:o,error:i}=await R.from("deal_stages").select("id, name").eq("name","Signed").single();if(i||!o)return v.error(' Cannot find "Signed" stage to migrate deals to:',i),!1;v.log(' Migrating deals from "Signed & Paid" to "Signed"...');const{error:l}=await R.from("deals").update({stage_id:o.id}).eq("stage_id",e.id);if(l)return v.error(" Error migrating deals:",l),!1;v.log(` Successfully migrated ${a.length} deals to "Signed" stage`)}const{error:n}=await R.from("deal_stages").delete().eq("id",e.id);return n?(v.error(' Error deleting "Signed & Paid" stage:',n),!1):(v.log(' Successfully removed "Signed & Paid" stage'),!0)}catch{return!1}}var Eu=Object.defineProperty,Du=(e,t,a)=>t in e?Eu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,pt=(e,t,a)=>Du(e,typeof t!="symbol"?t+"":t,a);class Mu extends g.Component{constructor(){super(...arguments),pt(this,"retryCount",0),pt(this,"maxRetries",3),pt(this,"state",{hasError:!1,error:null,errorInfo:null,isRetrying:!1}),pt(this,"handleRetry",()=>{this.retryCount<this.maxRetries&&(this.setState({isRetrying:!0}),this.retryCount++,setTimeout(()=>{this.setState({hasError:!1,error:null,errorInfo:null,isRetrying:!1})},1e3))}),pt(this,"handleRefresh",()=>{window.location.reload()}),pt(this,"handleGoHome",()=>{window.location.href="/"}),pt(this,"copyErrorDetails",()=>{const t=`
Error: ${this.state.error?.message||"Unknown error"}
Stack: ${this.state.error?.stack||"No stack trace"}
Component Stack: ${this.state.errorInfo?.componentStack||"No component stack"}
URL: ${window.location.href}
User Agent: ${navigator.userAgent}
Timestamp: ${new Date().toISOString()}
    `.trim();navigator.clipboard.writeText(t).then(()=>{})})}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null,isRetrying:!1}}componentDidCatch(t,a){this.setState({error:t,errorInfo:a}),this.props.onError&&this.props.onError(t,a),typeof window<"u"&&window.Sentry&&window.Sentry.captureException(t,{contexts:{react:{componentStack:a.componentStack}}})}render(){return this.state.hasError?this.props.fallback?this.props.fallback:r.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:r.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md w-full bg-gray-800/50 backdrop-blur-xl rounded-2xl border border-gray-700/50 p-8 text-center",children:[r.jsx(ne.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1},className:"w-16 h-16 mx-auto mb-6 bg-red-500/10 rounded-full flex items-center justify-center",children:r.jsx(Oo,{className:"w-8 h-8 text-red-400"})}),r.jsxs(ne.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},children:[r.jsx("h1",{className:"text-xl font-semibold text-white mb-3",children:"Something went wrong"}),r.jsx("p",{className:"text-gray-400 mb-6",children:"We encountered an unexpected error. This has been automatically reported."}),this.state.error&&r.jsxs("details",{className:"mb-6 text-left",children:[r.jsx("summary",{className:"cursor-pointer text-gray-500 hover:text-gray-300 transition-colors text-sm mb-2",children:"Technical details"}),r.jsxs("div",{className:"bg-gray-900/50 rounded-lg p-3 text-xs text-gray-400 font-mono break-all",children:[r.jsxs("div",{className:"mb-2",children:[r.jsx("strong",{className:"text-red-400",children:"Error:"})," ",this.state.error.message]}),this.state.error.stack&&r.jsxs("div",{className:"max-h-32 overflow-y-auto",children:[r.jsx("strong",{className:"text-gray-300",children:"Stack:"}),r.jsx("pre",{className:"whitespace-pre-wrap",children:this.state.error.stack})]})]})]}),r.jsxs("div",{className:"space-y-3",children:[this.retryCount<this.maxRetries&&r.jsx(ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.handleRetry,disabled:this.state.isRetrying,className:"w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:this.state.isRetrying?r.jsxs(r.Fragment,{children:[r.jsx(Va,{className:"w-4 h-4 animate-spin"}),"Retrying..."]}):r.jsxs(r.Fragment,{children:[r.jsx(Va,{className:"w-4 h-4"}),"Try Again (",this.maxRetries-this.retryCount," left)"]})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[r.jsxs(ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.handleRefresh,className:"py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:[r.jsx(Va,{className:"w-4 h-4"}),"Refresh Page"]}),r.jsxs(ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.handleGoHome,className:"py-2.5 px-4 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors font-medium flex items-center justify-center gap-2",children:[r.jsx(Ro,{className:"w-4 h-4"}),"Go Home"]})]}),r.jsxs(ne.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:this.copyErrorDetails,className:"w-full py-2 px-4 bg-gray-800 hover:bg-gray-700 text-gray-300 rounded-lg transition-colors text-sm flex items-center justify-center gap-2 border border-gray-600",children:[r.jsx(Lo,{className:"w-3 h-3"}),"Copy Error Details"]})]}),r.jsxs("p",{className:"text-xs text-gray-500 mt-6",children:["Error ID: ",this.state.error?.name,"-",Date.now().toString(36)]})]})]})}):this.props.children}}function Tu(e){const[t,a]=g.useState({id:"mock-target-1",user_id:e||"default",revenue_target:5e4,outbound_target:100,meetings_target:50,proposal_target:20,start_date:new Date().toISOString(),end_date:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),[s,n]=g.useState(!1),[o,i]=g.useState(null);return g.useEffect(()=>{e&&a({id:"mock-target-1",user_id:e,revenue_target:5e4,outbound_target:100,meetings_target:50,proposal_target:20,start_date:new Date().toISOString(),end_date:new Date().toISOString(),created_at:new Date().toISOString(),updated_at:new Date().toISOString()})},[e]),{data:t,isLoading:s,error:o}}const As={type:void 0,dateRange:{start:we(new Date),end:new Date},searchQuery:"",salesRep:void 0,status:void 0,priority:void 0,saleType:void 0,meetingType:void 0,outboundType:void 0,minAmount:void 0,maxAmount:void 0,clientName:void 0},Wn=eo(e=>({filters:As,setFilters:t=>e(a=>({filters:{...a.filters,...t}})),resetFilters:()=>e({filters:{...As}}),clearSubTypeFilters:()=>e(t=>({filters:{...t.filters,saleType:void 0,meetingType:void 0,outboundType:void 0}}))})),Iu=({selectedMonth:e})=>{const[t,a]=g.useState("daily"),[s,n]=g.useState(!1),{activities:o}=Ta();Ge();const i=g.useMemo(()=>{if(t==="daily"){const b=we(e),f=Be(e);return xo({start:b,end:f}).map(M=>{const x=be(M,"yyyy-MM-dd"),u=o.filter(p=>be(new Date(p.date),"yyyy-MM-dd")===x);return{name:be(M,"MMM d"),Outbound:u.filter(p=>p.type==="outbound").reduce((p,k)=>p+(k.quantity||1),0)||.1,Meetings:u.filter(p=>p.type==="meeting").reduce((p,k)=>p+(k.quantity||1),0)||.1,Proposals:u.filter(p=>p.type==="proposal").reduce((p,k)=>p+(k.quantity||1),0)||.1,Sales:u.filter(p=>p.type==="sale").reduce((p,k)=>p+(k.quantity||1),0)||.1}})}if(t==="weekly"){const b=we(e),f=Be(e),m=Xt(b),M=ka(f);return wo({start:m,end:M}).map(u=>{const p=ka(u),k=o.filter(I=>{const T=new Date(I.date);return T>=u&&T<=p});return{name:`WC ${be(u,"MMM d")}`,Outbound:k.filter(I=>I.type==="outbound").reduce((I,T)=>I+(T.quantity||1),0)||.1,Meetings:k.filter(I=>I.type==="meeting").reduce((I,T)=>I+(T.quantity||1),0)||.1,Proposals:k.filter(I=>I.type==="proposal").reduce((I,T)=>I+(T.quantity||1),0)||.1,Sales:k.filter(I=>I.type==="sale").reduce((I,T)=>I+(T.quantity||1),0)||.1}})}const d=[],h=Be(e);for(let b=11;b>=0;b--){const f=zt(h,b),m=we(f),M=Be(f),x=o.filter(u=>{const p=new Date(u.date);return p>=m&&p<=M});d.push({name:be(f,"MMM yyyy"),Outbound:x.filter(u=>u.type==="outbound").reduce((u,p)=>u+(p.quantity||1),0)||.1,Meetings:x.filter(u=>u.type==="meeting").reduce((u,p)=>u+(p.quantity||1),0)||.1,Proposals:x.filter(u=>u.type==="proposal").reduce((u,p)=>u+(p.quantity||1),0)||.1,Sales:x.filter(u=>u.type==="sale").reduce((u,p)=>u+(p.quantity||1),0)||.1})}return d},[o,t,e]),l=[{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"}],c=({active:d,payload:h,label:b})=>!d||!h?null:r.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-xl p-3 shadow-xl",children:[r.jsx("p",{className:"text-gray-400 text-sm font-medium mb-2",children:b}),h.map((f,m)=>r.jsxs("div",{className:"flex items-center justify-between gap-4 text-sm",children:[r.jsxs("span",{style:{color:f.color},children:[f.name,":"]}),r.jsx("span",{className:"text-white font-medium",children:f.value>.1?Math.round(f.value):0})]},m))]});return r.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-3xl p-6 border border-gray-800/50",children:[r.jsxs("div",{className:"flex items-center justify-between mb-6",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-xl font-bold text-white",children:"Sales Activities Overview"}),r.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[t==="daily"?"Last 14 days":t==="weekly"?"Last 12 weeks":"Year to date"," breakdown of all sales activities"]})]}),r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>n(!s),className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-gray-800/50 text-gray-300 hover:bg-[#37bd7e]/20 hover:text-white transition-all duration-300 text-sm border border-transparent hover:border-[#37bd7e]/30",children:[r.jsx(Dr,{className:"w-4 h-4"}),r.jsx("span",{className:"capitalize",children:t}),r.jsx($o,{className:"w-4 h-4"})]}),s&&r.jsx(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute right-0 mt-2 w-40 bg-gray-900/95 backdrop-blur-xl border border-gray-800/50 rounded-xl shadow-xl z-10",children:l.map(d=>r.jsx("button",{onClick:()=>{a(d.value),n(!1)},className:"w-full px-4 py-2 text-left text-sm text-gray-300 hover:bg-[#37bd7e]/20 hover:text-white first:rounded-t-xl last:rounded-b-xl",children:d.label},d.value))})]})]}),r.jsx("div",{className:"h-[400px]",children:r.jsx(Wo,{width:"100%",height:"100%",children:r.jsxs(Ho,{data:i,margin:{top:20,right:30,left:20,bottom:5},children:[r.jsxs("defs",{children:[r.jsxs("linearGradient",{id:"outboundGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"5%",stopColor:"#3B82F6",stopOpacity:.8}),r.jsx("stop",{offset:"95%",stopColor:"#3B82F6",stopOpacity:.2})]}),r.jsxs("linearGradient",{id:"meetingsGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"5%",stopColor:"#8B5CF6",stopOpacity:.8}),r.jsx("stop",{offset:"95%",stopColor:"#8B5CF6",stopOpacity:.2})]}),r.jsxs("linearGradient",{id:"proposalsGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"5%",stopColor:"#F59E0B",stopOpacity:.8}),r.jsx("stop",{offset:"95%",stopColor:"#F59E0B",stopOpacity:.2})]}),r.jsxs("linearGradient",{id:"salesGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[r.jsx("stop",{offset:"5%",stopColor:"#10B981",stopOpacity:.8}),r.jsx("stop",{offset:"95%",stopColor:"#10B981",stopOpacity:.2})]})]}),r.jsx(Go,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.1)",vertical:!1}),r.jsx(Yo,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fill:"#9CA3AF",fontSize:12},dy:10,scale:"band",padding:{left:10,right:10}}),r.jsx(Jo,{axisLine:!1,tickLine:!1,tick:{fill:"#9CA3AF",fontSize:12},dx:-10,scale:"log",domain:[.1,"auto"],allowDataOverflow:!1,tickFormatter:d=>d<=.1?0:Math.round(d),children:r.jsx(Qo,{value:"Count (log scale)",angle:-90,position:"insideLeft",style:{fill:"#9CA3AF",fontSize:12}})}),r.jsx(Ko,{content:r.jsx(c,{})}),r.jsx(Zo,{verticalAlign:"top",height:36,iconType:"circle",iconSize:8,wrapperStyle:{paddingTop:"1rem",color:"#9CA3AF",fontSize:"12px"}}),r.jsx(ua,{dataKey:"Outbound",fill:"url(#outboundGradient)",maxBarSize:40,isAnimationActive:!0,animationDuration:1e3,animationBegin:0,minPointSize:2}),r.jsx(ua,{dataKey:"Meetings",fill:"url(#meetingsGradient)",maxBarSize:40,isAnimationActive:!0,animationDuration:1e3,animationBegin:200,minPointSize:2}),r.jsx(ua,{dataKey:"Proposals",fill:"url(#proposalsGradient)",maxBarSize:40,isAnimationActive:!0,animationDuration:1e3,animationBegin:400,minPointSize:2}),r.jsx(ua,{dataKey:"Sales",fill:"url(#salesGradient)",maxBarSize:40,isAnimationActive:!0,animationDuration:1e3,animationBegin:600,minPointSize:2})]})})})]})},Pu={emerald:{bg:"bg-emerald-500/10",border:"border-emerald-500/20",text:"text-emerald-500",hover:"hover:border-emerald-500/50"},cyan:{bg:"bg-cyan-500/10",border:"border-cyan-500/20",text:"text-cyan-500",hover:"hover:border-cyan-500/50"},blue:{bg:"bg-blue-500/10",border:"border-blue-500/20",text:"text-blue-500",hover:"hover:border-blue-500/50"},violet:{bg:"bg-violet-500/10",border:"border-violet-500/20",text:"text-violet-500",hover:"hover:border-violet-500/50"},orange:{bg:"bg-orange-500/10",border:"border-orange-500/20",text:"text-orange-500",hover:"hover:border-orange-500/50"},red:{bg:"bg-red-500/10",border:"border-red-500/20",text:"text-red-500",hover:"hover:border-red-500/50"},yellow:{bg:"bg-yellow-500/10",border:"border-yellow-500/20",text:"text-yellow-500",hover:"hover:border-yellow-500/50"}};function ga({title:e,primaryValue:t,secondaryValue:a,percentageValue:s,trendPercentage:n,periodContext:o,icon:i,color:l,variant:c="default",onClick:d,className:h}){const b=Pu[l],f=()=>n===void 0||n===0?Fo:n>0?Mr:Hs,m=()=>n===void 0||n===0?"text-gray-500":c==="no-show"?n>0?"text-red-500":"text-emerald-500":n>0?"text-emerald-500":"text-red-500",M=()=>n===void 0||n===0?"0%":`${n>0?"+":""}${n.toFixed(1)}%`,x=f();return r.jsxs(ne.div,{whileHover:{y:-2},className:le("bg-gray-900/50 backdrop-blur-xl rounded-xl p-5 border border-gray-800/50 transition-all duration-300",b.hover,d&&"cursor-pointer",h),onClick:d,children:[r.jsxs("div",{className:"flex items-start justify-between mb-4",children:[r.jsx("div",{className:le("p-2.5 rounded-lg border",b.bg,b.border),children:r.jsx(i,{className:le("w-5 h-5",b.text)})}),n!==void 0&&r.jsxs("div",{className:"flex flex-col items-end",children:[r.jsxs("div",{className:le("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",m(),"bg-gray-800/50"),children:[r.jsx(x,{className:"w-3 h-3"}),M()]}),r.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-500",children:[r.jsx(Dr,{className:"w-3 h-3"}),o]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-sm font-medium text-gray-400",children:e}),r.jsxs("div",{className:"flex items-baseline gap-2",children:[r.jsx("span",{className:"text-2xl font-bold text-white",children:t}),s!==void 0&&r.jsxs("span",{className:le("text-sm font-medium",b.text),children:["(",s.toFixed(1),"%)"]})]}),a&&r.jsx("div",{className:"text-sm text-gray-500",children:a})]}),c==="no-show"&&r.jsxs("div",{className:"flex items-center gap-1 mt-3 pt-3 border-t border-gray-800/50",children:[r.jsx(xa,{className:"w-3 h-3 text-orange-500"}),r.jsx("span",{className:"text-xs text-orange-400",children:"Lost Opportunities"})]})]})}function Au(){const[e,t]=g.useState([]),[a,s]=g.useState(!1);g.useEffect(()=>{n()},[]);const n=async()=>{try{s(!0);const{data:{user:c}}=await R.auth.getUser();if(!c){v.log("No authenticated user"),t([]);return}v.log("Using direct profiles query method");const{data:d,error:h}=await R.from("profiles").select("*").order("created_at",{ascending:!1});if(h)throw h;const{data:{user:b}}=await R.auth.getUser(),f=(d||[]).map(m=>({id:m.id,email:m.email||`user_${m.id.slice(0,8)}@private.local`,first_name:m.first_name||m.full_name?.split(" ")[0]||null,last_name:m.last_name||m.full_name?.split(" ").slice(1).join(" ")||null,stage:m.stage||"Trainee",avatar_url:m.avatar_url,is_admin:m.is_admin||!1,created_at:m.created_at||m.updated_at||new Date().toISOString(),last_sign_in_at:null,targets:[]}));t(f)}catch(c){c.message?.includes("auth.users")?L.error("User management requires additional permissions. Please contact your administrator."):L.error("Failed to load users: "+c.message),t([])}finally{s(!1)}};return{users:e,isLoading:a,updateUser:async({userId:c,updates:d})=>{if(!c){L.error("Cannot update user: User ID missing.");return}try{const{targets:h,...b}=d;if(Object.keys(b).length>0){const f={};("first_name"in b||"last_name"in b)&&(f.full_name=[b.first_name,b.last_name].filter(Boolean).join(" ")||null),"avatar_url"in b&&(f.avatar_url=b.avatar_url);const{error:m}=await R.from("profiles").update(f).eq("id",c);if(m)throw m}L.success("User updated successfully"),await n()}catch(h){L.error("Failed to update user: "+(h.message||"Unknown error"))}},deleteUser:async c=>{try{const{error:d}=await R.from("profiles").delete().eq("id",c);if(d)throw d;L.success("User deleted successfully"),await n()}catch(d){L.error("Failed to delete user: "+(d.message||"Unknown error"))}},impersonateUser:async c=>{try{const{data:{user:d}}=await R.auth.getUser();if(!d)throw new Error("No authenticated user found");if(!d.email)throw new Error("Current user does not have an email address");const{data:h,error:b}=await R.functions.invoke("impersonate-user",{body:{userId:c,adminId:d.id,adminEmail:d.email,redirectTo:Or()}});if(b)throw b;if(v.log("Impersonate response:",h),h?.email&&h?.password){v.warn("Edge Function is returning old format. Using fallback password-based impersonation."),Ja(d.id,d.email);const{error:f}=await R.auth.signInWithPassword({email:h.email,password:h.password});if(f)throw f;L.success("Impersonation started (legacy mode)"),window.location.reload();return}if(h?.session){Ja(d.id,d.email);const{error:f}=await R.auth.setSession(h.session);if(f)throw f;L.success("Impersonation started successfully!"),window.location.reload()}else if(h?.magicLink)Ja(d.id,d.email),L.success("Starting impersonation..."),window.location.href=h.magicLink;else throw v.error("Unexpected response format:",h),new Error("Failed to start impersonation. Response: "+JSON.stringify(h))}catch(d){L.error("Failed to impersonate user: "+(d.message||"Unknown error"))}}}}function dt(e){const t=e?.message||"Unknown error";return v.error("Client operation error (sanitized for user):",{message:t,timestamp:new Date().toISOString()}),t.includes("duplicate key")?"A record with this information already exists":t.includes("foreign key")?"Referenced record not found":t.includes("PGRST")?"Database connection error":t.includes("JWT")?"Authentication required":"Operation failed. Please try again."}function Nm(e){const[t,a]=g.useState([]),[s,n]=g.useState(!0),[o,i]=g.useState(null),l=g.useCallback(async()=>{try{n(!0),i(null),v.log(" Starting clients fetch for owner:",e);const{data:{session:m}}=await R.auth.getSession();if(!m){v.log(" No session found, using service key fallback");let M,x;try{v.log(" Trying basic clients query with service key...");let p=qe.from("clients").select("*");e&&(p=p.eq("owner_id",e));const k=await p.order("created_at",{ascending:!1});if(M=k.data,x=k.error,x)throw v.error(" Service key basic query failed:",x),x;v.log(` Service key query successful: ${M?.length||0} clients found`)}catch(p){throw v.error(" Service client query failed:",p),p}const u=M?.map(p=>({...p,subscription_amount:parseFloat(p.subscription_amount||0),subscription_days:p.subscription_start_date?Math.floor((new Date().getTime()-new Date(p.subscription_start_date).getTime())/(1e3*60*60*24)):0}))||[];a(u),n(!1);return}v.log(" Session found, trying authenticated queries");try{v.log(" Trying Edge Functions...");const M=new URLSearchParams;e&&M.append("owner_id",e);const u=(await Ue(`${pe}/clients?${M.toString()}`))?.map(p=>({...p,subscription_amount:parseFloat(p.subscription_amount||0),subscription_days:p.subscription_start_date?Math.floor((new Date().getTime()-new Date(p.subscription_start_date).getTime())/(1e3*60*60*24)):0}))||[];v.log(` Edge Functions successful: ${u.length} clients processed`),a(u),n(!1);return}catch(M){v.warn(" Edge Function failed, falling back to direct Supabase client:",M);let x,u;try{v.log(" Trying basic Supabase client query...");let k=R.from("clients").select("*");e&&(k=k.eq("owner_id",e));const I=await k.order("created_at",{ascending:!1});x=I.data,u=I.error,u?v.error(" Basic Supabase query failed:",u):v.log(` Basic Supabase query successful: ${x?.length||0} clients found`)}catch(k){v.error(" Supabase query failed:",k),u=k}if(u)try{v.log(" Last resort: trying service key...");let k=qe.from("clients").select("*");e&&(k=k.eq("owner_id",e));const I=await k.order("created_at",{ascending:!1});x=I.data;const T=I.error;if(T)throw v.error(" Service key fallback failed:",T),T;v.log(` Service key fallback successful: ${x?.length||0} clients found`)}catch(k){throw v.error(" All fallbacks failed:",k),k}const p=x?.map(k=>({...k,subscription_amount:parseFloat(k.subscription_amount||0),subscription_days:k.subscription_start_date?Math.floor((new Date().getTime()-new Date(k.subscription_start_date).getTime())/(1e3*60*60*24)):0}))||[];v.log(` Final processing complete: ${p.length} clients ready`),a(p),n(!1)}}catch(m){const M=dt(m);i(M),L.error(M)}finally{n(!1)}},[e]);return g.useEffect(()=>{l()},[e,l]),{clients:t,isLoading:s,error:o,createClient:async m=>{try{try{const M=await Ue(`${pe}/clients`,{method:"POST",body:JSON.stringify(m)},{maxRetries:1,retryDelay:1e3,showToast:!1});return L.success("Client created successfully"),await l(),!0}catch{const{data:x,error:u}=await R.from("clients").insert(m).select().single();if(u)throw u;return L.success("Client created successfully"),await l(),!0}}catch(M){const x=dt(M);return M.message&&M.message.includes("unique_deal_conversion")?L.error("This deal has already been converted to a client"):L.error(x),!1}},updateClient:async(m,M)=>{try{v.log(" Updating client with data:",M);try{const x=await Ue(`${pe}/clients/${m}`,{method:"PUT",body:JSON.stringify(M)},{maxRetries:1,retryDelay:1e3,showToast:!1});return v.log(" Edge Function update successful"),L.success("Client updated successfully"),await l(),!0}catch(x){v.warn(" Edge Function failed, trying direct Supabase client:",x);const{data:u,error:p}=await R.from("clients").update(M).eq("id",m).select().single();if(p)throw p;return v.log(" Direct Supabase update successful"),L.success("Client updated successfully"),await l(),!0}}catch(x){const u=dt(x);return L.error(u),!1}},deleteClient:async m=>{try{try{const M=await Ue(`${pe}/clients/${m}`,{method:"DELETE"},{maxRetries:1,retryDelay:1e3,showToast:!1});return L.success("Client deleted successfully"),await l(),!0}catch{const{error:x}=await R.from("clients").delete().eq("id",m);if(x)throw x;return L.success("Client deleted successfully"),await l(),!0}}catch(M){const x=dt(M);return L.error(x),!1}},convertDealToClient:async(m,M={})=>{try{try{const x=await Ue(`${pe}/deals/${m}/convert-to-subscription`,{method:"POST",body:JSON.stringify(M)},{maxRetries:1,retryDelay:1e3,showToast:!1});return L.success("Deal converted to subscription successfully"),await l(),x}catch(x){throw v.error("Deal conversion via Edge Function failed:",x),x}}catch(x){const u=dt(x);return x.message&&x.message.includes("already been converted")?L.error("This deal has already been converted to a subscription"):x.message&&x.message.includes("not found")?L.error("Deal not found"):L.error(u),null}},refreshClients:l}}function Sm(e){const[t,a]=g.useState([]),[s,n]=g.useState(!0),[o,i]=g.useState(null),{users:l}=Au(),c=g.useCallback(h=>{const b=l.find(m=>m.id===h);return b?[b.first_name,b.last_name].filter(Boolean).join(" ")||b.email||`User ${h.slice(0,8)}`:/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(h)?`User ${h.slice(0,8)}`:h},[l]),d=g.useCallback(async()=>{try{n(!0),i(null),v.log(" Fetching aggregated client data...");const{data:{session:h}}=await R.auth.getSession();let b,f,m;if(h){let u=R.from("clients").select("*");e&&(u=u.eq("owner_id",e));const{data:p}=await u;let k=R.from("deals").select("*").eq("status","won");e&&(k=k.eq("owner_id",e));const{data:I}=await k;let T=R.from("activities").select("*").eq("type","sale").eq("status","completed");e&&(T=T.eq("user_id",e));const{data:_}=await T;b=p||[],f=I||[],m=_||[]}else{let u=qe.from("clients").select("*");e&&(u=u.eq("owner_id",e));const{data:p}=await u;let k=qe.from("deals").select("*").eq("status","won");e&&(k=k.eq("owner_id",e));const{data:I}=await k;let T=qe.from("activities").select("*").eq("type","sale").eq("status","completed");e&&(T=T.eq("user_id",e));const{data:_}=await T;b=p||[],f=I||[],m=_||[]}const M=new Map;f.forEach(u=>{const p=u.company;if(!M.has(p)){const D=b.find(O=>O.company_name?.toLowerCase()===p.toLowerCase()||O.deal_id===u.id);let j="Unknown";const y=m.find(O=>O.deal_id===u.id);y?.sales_rep?j=c(y.sales_rep):u.assigned_to?j=c(u.assigned_to):u.owner_id&&(j=c(u.owner_id)),M.set(p,{id:D?.id||`generated-${p.toLowerCase().replace(/\s+/g,"-")}`,client_name:p,total_payments_count:0,total_lifetime_value:0,total_one_off:0,total_monthly_mrr:0,active_subscriptions:0,last_payment_date:null,status:D?.status||"active",contact_identifier:D?.contact_email||D?.contact_name||u.contact_name,sales_rep:j,notice_given_date:D?.notice_given_date||null,final_billing_date:D?.final_billing_date||null,churn_date:D?.churn_date||null,churn_reason:D?.churn_reason||null,total_churn_amount:0,remaining_revenue_estimate:0,deals:[]})}const k=M.get(p),I=u.one_off_revenue||0,T=u.monthly_mrr||0,_=T>0?"subscription":"one-off",S=T*3+I,A=m.find(D=>D.deal_id===u.id)?.date||u.stage_changed_at||u.created_at;k.deals.push({id:u.id,name:u.name,value:S,deal_type:_,signed_date:A,monthly_mrr:T,one_off_revenue:I,annual_value:u.annual_value||0}),k.total_payments_count+=1,k.total_lifetime_value+=S,k.total_one_off+=I,k.total_monthly_mrr+=T,_==="subscription"&&T>0&&(k.active_subscriptions+=1),(!k.last_payment_date||new Date(A)>new Date(k.last_payment_date))&&(k.last_payment_date=A)}),M.forEach(u=>{if(u.status==="churned"&&u.churn_date)u.total_churn_amount=u.total_monthly_mrr*12;else if(u.status==="notice_given"&&u.final_billing_date){const p=new Date(u.final_billing_date),k=new Date,I=Math.ceil((p.getTime()-k.getTime())/(1e3*60*60*24*30));u.remaining_revenue_estimate=Math.max(0,u.total_monthly_mrr*I)}});const x=Array.from(M.values()).sort((u,p)=>{const k=u.last_payment_date?new Date(u.last_payment_date).getTime():0;return(p.last_payment_date?new Date(p.last_payment_date).getTime():0)-k});v.log(" Aggregated clients data:",{totalClients:x.length,clients:x.map(u=>({name:u.client_name,deals:u.total_payments_count,value:u.total_lifetime_value,mrr:u.total_monthly_mrr}))}),a(x)}catch(h){const b=dt(h);i(b)}finally{n(!1)}},[e,c]);return g.useEffect(()=>{d()},[d]),{aggregatedClients:t,isLoading:s,error:o,refreshAggregatedClients:d}}function Ou(e){const[t,a]=g.useState(null),[s,n]=g.useState([]),[o,i]=g.useState(!1),[l,c]=g.useState(null),d=g.useCallback(async()=>{try{i(!0),c(null),v.log(" Calculating MRR summary directly (Edge Function endpoint not available)");let b=qe.from("clients").select("*");e&&(b=b.eq("owner_id",e));const{data:f,error:m}=await b;if(m)throw v.error(" Error fetching clients for MRR:",m),m;const M=f?.length||0,x=f?.filter(A=>A.status!=="churned")||[],u=f?.filter(A=>A.status==="churned")||[],p=f?.filter(A=>A.status==="paused")||[],k=x.map(A=>parseFloat(A.subscription_amount?.toString()||"0")).filter(A=>A>0),I=k.reduce((A,D)=>A+D,0),T=k.length>0?I/k.length:0,_=k.length>0?Math.min(...k):0,S=k.length>0?Math.max(...k):0,N={total_clients:M,active_clients:x.length,churned_clients:u.length,paused_clients:p.length,total_mrr:I,avg_mrr:T,min_mrr:_,max_mrr:S,churn_rate:M>0?u.length/M*100:0,active_rate:M>0?x.length/M*100:0};a(N)}catch(b){const f=dt(b);c(f)}finally{i(!1)}},[e]),h=g.useCallback(async()=>{try{i(!0),c(null),v.log(" Calculating MRR by owner directly (Edge Function endpoint not available)");const{data:b,error:f}=await qe.from("clients").select(`
          owner_id,
          subscription_amount,
          status,
          profiles:owner_id (
            first_name,
            last_name,
            full_name
          )
        `);if(f)throw v.error(" Error fetching clients for MRR by owner:",f),f;const m=new Map;b.forEach(x=>{const u=x.owner_id;m.has(u)||m.set(u,{owner_id:u,owner_name:x.profiles?.full_name||`${x.profiles?.first_name||""} ${x.profiles?.last_name||""}`.trim()||"Unknown",total_clients:0,active_clients:0,churned_clients:0,paused_clients:0,total_mrr:0,amounts:[]});const p=m.get(u);if(p.total_clients++,x.status!=="churned"){p.active_clients++;const k=parseFloat(x.subscription_amount||0);p.total_mrr+=k,p.amounts.push(k)}x.status==="churned"?p.churned_clients++:x.status==="paused"&&p.paused_clients++});const M=Array.from(m.values()).map(x=>({owner_id:x.owner_id,owner_name:x.owner_name,total_clients:x.total_clients,active_clients:x.active_clients,churned_clients:x.churned_clients,paused_clients:x.paused_clients,total_mrr:x.total_mrr,avg_mrr:x.amounts.length>0?x.total_mrr/x.amounts.length:0,churn_rate:x.total_clients>0?x.churned_clients/x.total_clients*100:0})).sort((x,u)=>u.total_mrr-x.total_mrr);n(M)}catch(b){const f=dt(b);c(f)}finally{i(!1)}},[]);return{mrrSummary:t,mrrByOwner:s,isLoading:o,error:l,fetchMRRSummary:d,fetchMRRByOwner:h}}var Ru=Object.defineProperty,Lu=(e,t,a)=>t in e?Ru(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,$u=(e,t,a)=>Lu(e,t+"",a);const Xr={revenue:{allowNegative:!1,minValue:0,maxValue:1e7,allowZero:!0,fieldName:"revenue"},mrr:{allowNegative:!1,minValue:0,maxValue:1e6,allowZero:!0,fieldName:"monthly_mrr"},dealValue:{allowNegative:!1,minValue:0,maxValue:1e7,allowZero:!0,fieldName:"deal_value"}};class Se{static setLogLevel(t){this.logLevel=t}static log(t,a,s){if(["critical","high"].includes(t))switch(new Date().toISOString(),t){case"critical":break;case"high":break;case"medium":break;case"low":this.logLevel;break}}static getLogs(){try{return JSON.parse(sessionStorage.getItem("financial_validation_logs")||"[]")}catch{return[]}}static clearLogs(){sessionStorage.removeItem("financial_validation_logs")}}$u(Se,"logLevel","warn");function Oa(e,t={}){const{allowNegative:a=!1,minValue:s=0,maxValue:n=Number.MAX_SAFE_INTEGER,allowZero:o=!0,fieldName:i="financial_field",logErrors:l=!0}=t,c={isValid:!1,value:0,originalValue:e,errors:[],warnings:[],severity:"low"};if(e==null||e==="")return c.value=0,c.isValid=o,o||(c.errors.push(`${i} cannot be empty`),c.severity="medium"),l&&c.errors.length>0&&Se.log(c.severity,`Empty value for ${i}`,{value:e,options:t}),c;if(typeof e=="boolean")return c.errors.push(`${i} cannot be a boolean value`),c.severity="high",l&&Se.log("high",`Boolean value detected for ${i}`,{value:e,options:t}),c;if(typeof e=="object"&&e!==null)return c.errors.push(`${i} cannot be an object or array`),c.severity="critical",l&&Se.log("critical",`Object/array value detected for ${i}`,{value:e,options:t}),c;let d;if(typeof e=="string"){const h=e.replace(/[$,\s]/g,"").replace(/[^\d.-]/g,"");if((h.match(/\./g)||[]).length>1)return c.errors.push(`${i} has invalid decimal format`),c.severity="high",l&&Se.log("high",`Multiple decimal points in ${i}`,{value:e,cleanedValue:h,options:t}),c;const b=(h.match(/-/g)||[]).length;if(b>1||b===1&&!h.startsWith("-"))return c.errors.push(`${i} has invalid negative format`),c.severity="high",l&&Se.log("high",`Invalid negative format in ${i}`,{value:e,cleanedValue:h,options:t}),c;d=parseFloat(h)}else d=Number(e);return isNaN(d)?(c.errors.push(`${i} is not a valid number`),c.severity="high",l&&Se.log("high",`NaN detected for ${i}`,{value:e,numericValue:d,options:t}),c):isFinite(d)?(Number.isSafeInteger(d*100)||(c.warnings.push(`${i} may lose precision due to size`),c.severity=Math.max(c.severity==="low"?0:1,1)===0?"low":"medium",l&&Se.log("medium",`Unsafe integer precision for ${i}`,{value:e,numericValue:d,options:t})),d<0&&!a?(c.errors.push(`${i} cannot be negative`),c.severity="medium",l&&Se.log("medium",`Negative value not allowed for ${i}`,{value:e,numericValue:d,options:t}),c):d===0&&!o?(c.errors.push(`${i} cannot be zero`),c.severity="medium",l&&Se.log("medium",`Zero value not allowed for ${i}`,{value:e,numericValue:d,options:t}),c):d<s?(c.errors.push(`${i} must be at least ${s}`),c.severity="medium",l&&Se.log("medium",`Value below minimum for ${i}`,{value:e,numericValue:d,minValue:s,options:t}),c):d>n?(c.errors.push(`${i} cannot exceed ${n}`),c.severity="high",l&&Se.log("high",`Value exceeds maximum for ${i}`,{value:e,numericValue:d,maxValue:n,options:t}),c):(d>1e6&&(c.warnings.push(`${i} is unusually large (>1M)`),l&&Se.log("low",`Unusually large value for ${i}`,{value:e,numericValue:d,options:t})),d=Math.round(d*100)/100,c.isValid=!0,c.value=d,l&&(c.warnings.length>0||e!==d)&&Se.log("low",`Successfully validated ${i}`,{originalValue:e,validatedValue:d,warnings:c.warnings,options:t}),c)):(c.errors.push(`${i} cannot be infinite`),c.severity="critical",l&&Se.log("critical",`Infinite value detected for ${i}`,{value:e,numericValue:d,options:t}),c)}function Fu(e){return Oa(e,Xr.revenue)}function zu(e){return Oa(e,Xr.mrr)}function Uu(e){return Oa(e,Xr.dealValue)}function Nt(e,t=0,a){const s=Oa(e,a);return s.isValid?s.value:(Se.log("medium","Using fallback value for financial data",{originalValue:e,fallbackValue:t,errors:s.errors,fieldName:a?.fieldName||"unknown"}),t)}function km(e,t){const a=zu(e),s=Fu(t),n=[];a.isValid||n.push(...a.errors.map(d=>`MRR: ${d}`)),s.isValid||n.push(...s.errors.map(d=>`One-off Revenue: ${d}`));const o=a.isValid?a.value:0,i=s.isValid?s.value:0,l=o*3+i,c=Uu(l);return c.isValid||n.push(...c.errors.map(d=>`Lifetime Value: ${d}`)),{value:c.value,isValid:n.length===0,errors:n}}const Bu=({className:e,onClick:t})=>{const{userData:a}=Ge(),{mrrSummary:s,isLoading:n,error:o,fetchMRRSummary:i}=Ou(a?.id),l=g.useCallback(()=>{a?.id&&i()},[a?.id,i]);g.useEffect(()=>{l()},[l]);const c=g.useMemo(()=>({total_clients:0,active_clients:0,churned_clients:0,paused_clients:0,total_mrr:0,avg_mrr:0,min_mrr:0,max_mrr:0,churn_rate:0,active_rate:100}),[]),d=g.useMemo(()=>{const f=s||c;return{total_clients:Math.max(0,Math.floor(f.total_clients||0)),active_clients:Math.max(0,Math.floor(f.active_clients||0)),churned_clients:Math.max(0,Math.floor(f.churned_clients||0)),paused_clients:Math.max(0,Math.floor(f.paused_clients||0)),total_mrr:Nt(f.total_mrr||0,0,{fieldName:"total_mrr",allowZero:!0}),avg_mrr:Nt(f.avg_mrr||0,0,{fieldName:"avg_mrr",allowZero:!0}),min_mrr:Nt(f.min_mrr||0,0,{fieldName:"min_mrr",allowZero:!0}),max_mrr:Nt(f.max_mrr||0,0,{fieldName:"max_mrr",allowZero:!0}),churn_rate:Math.max(0,Math.min(100,Nt(f.churn_rate||0,0,{fieldName:"churn_rate",allowZero:!0}))),active_rate:Math.max(0,Math.min(100,Nt(f.active_rate||100,100,{fieldName:"active_rate",allowZero:!1})))}},[s,c]),h=g.useMemo(()=>({mrrTrend:12,clientTrend:8,churnTrend:-15,avgTrend:5}),[]),b=g.useCallback(f=>new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(f),[]);return n?r.jsx("div",{className:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 ${e}`,children:[1,2,3,4].map(f=>r.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-5 border border-gray-800/50 animate-pulse",children:[r.jsx("div",{className:"h-4 bg-gray-700 rounded w-3/4 mb-3"}),r.jsx("div",{className:"h-8 bg-gray-700 rounded w-1/2"})]},f))}):o?r.jsx("div",{className:`bg-red-500/10 border border-red-500/20 rounded-xl p-4 ${e}`,children:r.jsxs("p",{className:"text-red-400 text-sm",children:["Error loading subscription stats: ",o]})}):r.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 ${e}`,children:[r.jsx(ga,{title:"Total MRR",primaryValue:b(d.total_mrr),trendPercentage:h.mrrTrend,periodContext:"vs last month",icon:zo,color:"emerald",onClick:()=>t?.("Total MRR")}),r.jsx(ga,{title:"Active Clients",primaryValue:d.active_clients,secondaryValue:`${d.total_clients} total clients`,percentageValue:d.active_rate,trendPercentage:h.clientTrend,periodContext:"vs last month",icon:Ve,color:"blue",onClick:()=>t?.("Active Clients")}),r.jsx(ga,{title:"Avg Client Value",primaryValue:b(d.avg_mrr),secondaryValue:`Range: ${b(d.min_mrr)} - ${b(d.max_mrr)}`,trendPercentage:h.avgTrend,periodContext:"vs last month",icon:Mr,color:"violet",onClick:()=>t?.("Avg Client Value")}),r.jsx(ga,{title:"Monthly Churn",primaryValue:`${d.churn_rate.toFixed(1)}%`,secondaryValue:`${d.churned_clients} churned clients`,trendPercentage:h.churnTrend,periodContext:"vs last month",icon:Jt,color:"orange",variant:"no-show",onClick:()=>t?.("Monthly Churn")})]})},Vu=U.memo(Bu),Os=({show:e,content:t,position:a})=>e?$s.createPortal(r.jsxs("div",{style:{position:"fixed",top:a.y-10,left:a.x,transform:"translate(-50%, -100%)",zIndex:9999},className:"bg-gray-900/95 text-white text-xs rounded-lg p-2.5 w-48 shadow-xl border border-gray-700",children:[r.jsx("div",{className:"text-center font-medium mb-2",children:t.title}),r.jsx("div",{className:"flex justify-center items-center gap-1",children:r.jsx("span",{className:t.positive?"text-emerald-400":"text-red-400",children:t.message})}),r.jsx("div",{className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 translate-y-1/2 rotate-45 w-2 h-2 bg-gray-900 border-r border-b border-gray-700"})]}),document.body):null,ya=({title:e,value:t,target:a,trend:s,icon:n,type:o,dateRange:i,previousMonthTotal:l})=>{const c=Ma(),{setFilters:d}=Wn(),[h,b]=g.useState(!1),[f,m]=g.useState(!1),[M,x]=g.useState({x:0,y:0}),[u,p]=g.useState({x:0,y:0}),k=g.useRef(null),I=g.useRef(null),T=()=>{try{o&&(d({type:o,dateRange:i}),c("/activity",{state:{preserveFilters:!0}}))}catch{}},_=y=>{switch(y){case"Revenue":return"emerald";case"Outbound":return"blue";case"Meetings":return"violet";case"Proposals":return"orange";default:return"gray"}},S=g.useMemo(()=>{try{return!l||l===0?0:Math.round((t-l)/l*100)}catch{return 0}},[t,l]),N=y=>y>=0?"text-emerald-500":"text-red-500",A=y=>y>=0?"bg-emerald-500/10 border-emerald-500/30":"bg-red-500/10 border-red-500/30",D=()=>{try{if(k.current){const y=k.current.getBoundingClientRect();x({x:y.left+y.width/2,y:y.top}),b(!0)}}catch{}},j=()=>{try{if(I.current){const y=I.current.getBoundingClientRect();p({x:y.left+y.width/2,y:y.top}),m(!0)}}catch{}};return r.jsxs(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onClick:T,className:"relative overflow-visible bg-gradient-to-br from-gray-900/80 to-gray-900/40 backdrop-blur-xl rounded-3xl p-6 border border-gray-800/50",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:`p-2.5 rounded-xl ${e==="Outbound"?"bg-blue-500/5 border-blue-500/50":`bg-${_(e)}-500/10 border border-${_(e)}-500/20`}`,children:r.jsx(n,{className:`w-5 h-5 ${e==="Outbound"?"text-blue-400":`text-${_(e)}-500`}`})}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-sm font-medium text-white bg-gradient-to-r from-white to-white/70 bg-clip-text text-transparent",children:e}),r.jsx("span",{className:"text-xs text-gray-500",children:"This month"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{ref:k,className:`p-2 rounded-lg ${A(s)} backdrop-blur-sm relative transition-all duration-300 hover:scale-105 shadow-lg`,onMouseEnter:D,onMouseLeave:()=>b(!1),children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[s>=0?r.jsx(Mr,{className:`w-4 h-4 ${N(s)}`}):r.jsx(Hs,{className:`w-4 h-4 ${N(s)}`}),r.jsxs("span",{className:`text-xs font-semibold ${N(s)}`,children:[s>=0?"+":"",s,"%"]})]})}),r.jsx("div",{ref:I,className:`p-2 rounded-lg ${A(S)} backdrop-blur-sm relative transition-all duration-300 hover:scale-105 shadow-lg`,onMouseEnter:j,onMouseLeave:()=>m(!1),children:r.jsxs("div",{className:"flex items-center gap-1.5",children:[S>=0?r.jsx(Uo,{className:`w-4 h-4 ${N(S)}`}):r.jsx(Bo,{className:`w-4 h-4 ${N(S)}`}),r.jsxs("span",{className:`text-xs font-semibold ${N(S)}`,children:[S>=0?"+":"",S,"%"]})]})}),r.jsx(Os,{show:h,position:M,content:{title:"Vs. same point last month",message:s>=0?"Growing faster":"Growing slower",positive:s>=0}}),r.jsx(Os,{show:f,position:u,content:{title:"Vs. previous month's total",message:S>=0?"Already ahead of last month":"Behind last month's performance",positive:S>=0}})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-baseline gap-2",children:[r.jsx("span",{className:"text-3xl font-bold text-white",children:e==="Revenue"?`${t.toLocaleString()}`:t}),r.jsxs("span",{className:"text-sm text-gray-500 font-medium",children:["/ ",e==="Revenue"?`${a.toLocaleString()}`:a]})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"h-2.5 bg-gray-900/80 rounded-full overflow-hidden",children:r.jsx("div",{className:`h-full rounded-full ${e==="Revenue"?"bg-emerald-500/80":e==="Outbound"?"bg-blue-500/80":e==="Meetings"?"bg-violet-500/80":"bg-orange-500/80"}`,style:{width:`${Math.min(100,t/a*100)}%`}})}),r.jsxs("div",{className:"text-xs text-gray-400 flex justify-between",children:[r.jsx("span",{children:"Progress"}),r.jsxs("span",{children:[Math.round(t/a*100),"%"]})]})]})]})]})};function qu(){return r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8 mt-12 lg:mt-0 animate-pulse",children:[r.jsxs("div",{className:"space-y-1 mb-6 sm:mb-8",children:[r.jsx("div",{className:"h-8 w-48 bg-gray-800 rounded-lg mb-2"}),r.jsx("div",{className:"h-4 w-64 bg-gray-800 rounded-lg"})]}),r.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8",children:[1,2,3,4].map(e=>r.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-800 rounded-lg"}),r.jsxs("div",{children:[r.jsx("div",{className:"h-4 w-24 bg-gray-800 rounded-lg mb-1"}),r.jsx("div",{className:"h-3 w-16 bg-gray-800 rounded-lg"})]})]}),r.jsx("div",{className:"flex gap-2",children:r.jsx("div",{className:"w-16 h-8 bg-gray-800 rounded-lg"})})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"h-8 w-32 bg-gray-800 rounded-lg mb-2"}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("div",{className:"h-2 bg-gray-800 rounded-full"}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("div",{className:"h-3 w-16 bg-gray-800 rounded-lg"}),r.jsx("div",{className:"h-3 w-8 bg-gray-800 rounded-lg"})]})]})]})]},e))}),r.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50 mb-8",children:[r.jsx("div",{className:"h-6 w-48 bg-gray-800 rounded-lg mb-8"}),r.jsx("div",{className:"h-64 w-full bg-gray-800 rounded-lg"})]}),r.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("div",{className:"h-6 w-36 bg-gray-800 rounded-lg"}),r.jsx("div",{className:"h-9 w-48 bg-gray-800 rounded-lg"})]}),r.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>r.jsx("div",{className:"bg-gray-800/50 rounded-xl p-4",children:r.jsxs("div",{className:"flex items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 bg-gray-700 rounded-lg"}),r.jsxs("div",{children:[r.jsx("div",{className:"h-5 w-32 bg-gray-700 rounded-lg mb-1"}),r.jsx("div",{className:"h-4 w-48 bg-gray-700 rounded-lg"})]})]}),r.jsxs("div",{children:[r.jsx("div",{className:"h-6 w-24 bg-gray-700 rounded-lg mb-1"}),r.jsx("div",{className:"h-4 w-16 bg-gray-700 rounded-lg"})]})]})},e))})]})]})}function Wu(){const[e,t]=g.useState(""),[a,s]=g.useState(!1),[n,o]=g.useState(new Date),i=()=>{try{o(j=>{const y=zt(j,1);return isNaN(y.getTime())?(v.error("Invalid date after subtracting month"),j):y})}catch{}},l=()=>{try{o(j=>{const y=Fe(j,1);return isNaN(y.getTime())?(v.error("Invalid date after adding month"),j):y>new Date?j:y})}catch{}},{userData:c}=Ge(),d=Ma(),{activities:h,isLoading:b}=Ta(),{data:f,isLoading:m}=Tu(c?.id),{setFilters:M}=Wn(),x=g.useMemo(()=>({start:we(n),end:Be(n)}),[n]),u=g.useMemo(()=>{try{return ns(new Date)}catch{return 1}},[]),p=g.useMemo(()=>{try{return!h||!Array.isArray(h)?[]:h.filter(j=>{try{if(!j?.date)return!1;const y=new Date(j.date);return isNaN(y.getTime())?!1:y>=x.start&&y<=x.end}catch(y){return v.error("Error filtering activity:",y),!1}})}catch{return[]}},[h,x]),k=g.useMemo(()=>{try{if(!h||!Array.isArray(h))return[];const j=we(zt(n,1)),y=Math.min(u,ns(Be(j))),O=new Date(j);return O.setDate(y),h.filter(G=>{try{if(!G?.date)return!1;const Q=new Date(G.date);return isNaN(Q.getTime())?!1:Q>=j&&Q<=O}catch(Q){return v.error("Error filtering previous month activity:",Q),!1}})}catch{return[]}},[h,n,u]),I=g.useMemo(()=>{try{return{revenue:p.filter(j=>j.type==="sale").reduce((j,y)=>j+(y.amount||0),0),outbound:p.filter(j=>j.type==="outbound").reduce((j,y)=>j+(y.quantity||1),0),meetings:p.filter(j=>j.type==="meeting").reduce((j,y)=>j+(y.quantity||1),0),proposals:p.filter(j=>j.type==="proposal").reduce((j,y)=>j+(y.quantity||1),0)}}catch{return{revenue:0,outbound:0,meetings:0,proposals:0}}},[p]),T=g.useMemo(()=>({revenue:k.filter(j=>j.type==="sale").reduce((j,y)=>j+(y.amount||0),0),outbound:k.filter(j=>j.type==="outbound").reduce((j,y)=>j+(y.quantity||1),0),meetings:k.filter(j=>j.type==="meeting").reduce((j,y)=>j+(y.quantity||1),0),proposals:k.filter(j=>j.type==="proposal").reduce((j,y)=>j+(y.quantity||1),0)}),[k]),_=g.useMemo(()=>{try{const j=we(zt(n,1)),y=Be(zt(n,1)),O=h?.filter(G=>{try{if(!G?.date)return!1;const Q=new Date(G.date);return isNaN(Q.getTime())?!1:!Sr(Q,j)&&!Sa(Q,y)}catch(Q){return v.error("Error filtering previous month total activity:",Q),!1}})||[];return{revenue:O.filter(G=>G.type==="sale").reduce((G,Q)=>G+(Q.amount||0),0),outbound:O.filter(G=>G.type==="outbound").reduce((G,Q)=>G+(Q.quantity||1),0),meetings:O.filter(G=>G.type==="meeting").reduce((G,Q)=>G+(Q.quantity||1),0),proposals:O.filter(G=>G.type==="proposal").reduce((G,Q)=>G+(Q.quantity||1),0)}}catch{return{revenue:0,outbound:0,meetings:0,proposals:0}}},[h,n]),S=(j,y)=>y===0?0:Math.round((j-y)/y*100),N=g.useMemo(()=>({revenue:S(I.revenue,T.revenue),outbound:S(I.outbound,T.outbound),meetings:S(I.meetings,T.meetings),proposals:S(I.proposals,T.proposals)}),[I,T]),A=g.useMemo(()=>p.filter(j=>j.type==="sale"&&(j.client_name.toLowerCase().includes(e.toLowerCase())||j.amount?.toString().includes(e)||j.details?.toLowerCase().includes(e.toLowerCase()))),[p,e]),D=b||m||!c;return g.useEffect(()=>{let j;return!D&&!a&&(j=window.setTimeout(()=>{s(!0)},500)),()=>{j&&window.clearTimeout(j)}},[D]),a?f?r.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-8",children:[r.jsxs("div",{className:"space-y-1 mt-12 lg:mt-0 mb-6 sm:mb-8",children:[r.jsxs("h1",{className:"text-3xl font-bold",children:["Welcome back, ",c?.first_name]}),r.jsxs("div",{className:"flex items-center justify-between mt-2",children:[r.jsx("p",{className:"text-gray-400",children:"Here's how your sales performance is tracking"}),r.jsxs("div",{className:"flex items-center gap-3 bg-gray-900/50 backdrop-blur-xl rounded-xl p-2 border border-gray-800/50",children:[r.jsx("button",{onClick:i,className:"p-1.5 hover:bg-gray-800/50 rounded-lg transition-colors",children:r.jsx(Vs,{className:"w-4 h-4 text-gray-400"})}),r.jsx("span",{className:"text-sm font-medium text-white min-w-[100px] text-center",children:(()=>{try{return be(n,"MMMM yyyy")}catch{return"Invalid Date"}})()}),r.jsx("button",{onClick:l,className:"p-1.5 hover:bg-gray-800/50 rounded-lg transition-colors",disabled:n>=new Date,children:r.jsx(Bs,{className:"w-4 h-4 text-gray-400"})})]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6 mb-8",children:[r.jsx(ya,{title:"Revenue",value:I.revenue,target:f.revenue_target,trend:N.revenue,icon:Qt,type:"sale",dateRange:x,previousMonthTotal:_.revenue}),r.jsx(ya,{title:"Outbound",value:I.outbound,target:f.outbound_target,trend:N.outbound,icon:Er,type:"outbound",dateRange:x,previousMonthTotal:_.outbound}),r.jsx(ya,{title:"Meetings",value:I.meetings,target:f.meetings_target,trend:N.meetings,icon:Ve,type:"meeting",dateRange:x,previousMonthTotal:_.meetings}),r.jsx(ya,{title:"Proposals",value:I.proposals,target:f.proposal_target,trend:N.proposals,icon:Ea,type:"proposal",dateRange:x,previousMonthTotal:_.proposals})]}),r.jsxs("div",{className:"mb-8",children:[r.jsxs("div",{className:"mb-4",children:[r.jsx("h2",{className:"text-xl font-semibold text-white",children:"Subscription Revenue"}),r.jsx("p",{className:"text-sm text-gray-400",children:"Track your monthly recurring revenue and client metrics"})]}),r.jsx(Vu,{onClick:j=>{d("/subscriptions")}})]}),r.jsx("div",{className:"mb-8",children:r.jsx(Iu,{selectedMonth:n})}),r.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800/50 mb-8",children:[r.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4",children:[r.jsx("h2",{className:"text-xl font-semibold text-white",children:"Recent Deals"}),r.jsx("div",{className:"relative w-full sm:w-64",children:r.jsx("input",{type:"text",value:e,onChange:j=>t(j.target.value),placeholder:"Search by client or amount...",className:"w-full py-2 px-3 bg-gray-800 border border-gray-700 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-1 focus:ring-violet-500 focus:border-violet-500"})})]}),r.jsxs("div",{className:"space-y-3",children:[A.map(j=>r.jsxs(ne.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.02,transition:{duration:.2}},whileTap:{scale:.98},className:"bg-gray-800/50 rounded-xl p-3 sm:p-4 hover:bg-gray-800/70 transition-all duration-300 group hover:shadow-lg hover:shadow-emerald-500/10 border border-transparent hover:border-emerald-500/20 relative overflow-hidden cursor-pointer",onClick:()=>{M({type:"sale",dateRange:{start:new Date(j.date),end:new Date(j.date)}}),d("/activity")},children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/[0.03] to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-1000"}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(ne.div,{className:"w-10 h-10 rounded-lg bg-emerald-500/10 border border-emerald-500/20 flex items-center justify-center group-hover:scale-110 transition-transform duration-300",whileHover:{rotate:[0,-10,10,-5,5,0]},transition:{duration:.5},onClick:y=>{y.stopPropagation(),M({type:"sale",dateRange:{start:new Date(j.date),end:new Date(j.date)}}),d("/activity")},children:r.jsx(Qt,{className:"w-5 h-5 text-emerald-500"})}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-white group-hover:text-emerald-500 transition-colors duration-300",children:j.client_name}),r.jsxs("p",{className:"text-sm text-gray-400",children:[j.details,"  ",be(new Date(j.date),"MMM d, yyyy")]})]})]}),r.jsxs("div",{className:"text-left sm:text-right",children:[r.jsxs("div",{className:"text-lg font-bold text-white group-hover:text-emerald-400 transition-colors duration-300",children:["",(j.amount||0).toLocaleString()]}),r.jsx("div",{className:"text-sm text-emerald-500 group-hover:text-emerald-400 transition-colors duration-300",children:"Signed"})]})]})]},j.id)),A.length===0&&r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"text-gray-400",children:"No matching deals found"}),e&&r.jsx("button",{onClick:()=>t(""),className:"mt-2 text-violet-500 hover:text-violet-400 text-sm",children:"Clear search"})]})]})]})]}):null:r.jsx(qu,{})}function Hu(){const[e,t]=g.useState(!1),[a,s]=g.useState({email:"",password:""}),n=Ma(),{signIn:o}=Hr(),i=async l=>{l.preventDefault(),t(!0);try{const{error:c}=await o(a.email,a.password);c?L.error(c.message):n("/")}catch{L.error("An unexpected error occurred. Please try again.")}finally{t(!1)}};return r.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950",children:[r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(74,74,117,0.25),transparent)] pointer-events-none"}),r.jsx(ne.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"w-full max-w-md",children:r.jsxs("div",{className:"relative bg-gray-900/50 backdrop-blur-xl rounded-2xl border border-gray-800/50 p-6 sm:p-8 overflow-hidden",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900/90 via-gray-900/70 to-gray-900/30 rounded-2xl -z-10"}),r.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top,rgba(74,74,117,0.15),transparent)] rounded-2xl -z-10"}),r.jsx("div",{className:"absolute -right-20 -top-20 w-40 h-40 bg-[#37bd7e]/10 blur-3xl rounded-full"}),r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold mb-2 text-white",children:"Welcome back"}),r.jsx("p",{className:"text-gray-400",children:"Sign in to your account to continue"})]}),r.jsxs("form",{onSubmit:i,className:"space-y-6",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Email Address"}),r.jsxs("div",{className:"relative",children:[r.jsx(qs,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),r.jsx("input",{type:"email",required:!0,value:a.email,onChange:l=>s({...a,email:l.target.value}),className:"w-full bg-gray-800/30 border border-gray-700/30 rounded-xl pl-10 pr-4 py-2.5 text-white placeholder-gray-500 focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent transition-colors hover:bg-gray-800/50",placeholder:"sarah@example.com",disabled:e})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("label",{className:"text-sm font-medium text-gray-400",children:"Password"}),r.jsx(lt,{to:"/auth/forgot-password",className:"text-xs text-[#37bd7e] hover:text-[#2da76c] font-medium transition-colors",children:"Forgot Password?"})]}),r.jsxs("div",{className:"relative",children:[r.jsx(Vo,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),r.jsx("input",{type:"password",required:!0,value:a.password,onChange:l=>s({...a,password:l.target.value}),className:"w-full bg-gray-800/30 border border-gray-700/30 rounded-xl pl-10 pr-4 py-2.5 text-white placeholder-gray-500 focus:ring-2 focus:ring-[#37bd7e] focus:border-transparent transition-colors hover:bg-gray-800/50",placeholder:"",disabled:e})]})]}),r.jsx("button",{type:"submit",disabled:e,className:"w-full bg-[#37bd7e] text-white py-2.5 rounded-xl font-medium hover:bg-[#2da76c] focus:outline-none focus:ring-2 focus:ring-[#37bd7e] focus:ring-offset-2 focus:ring-offset-gray-900 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg shadow-[#37bd7e]/20",children:e?"Signing in...":"Sign in"})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsxs(lt,{to:"/auth/signup",className:"text-[#37bd7e] hover:text-[#2da76c] text-sm font-medium inline-flex items-center gap-1 transition-all duration-300 hover:gap-2",children:["Create an account",r.jsx(sr,{className:"w-4 h-4"})]})})]})})]})}const Gu=g.lazy(()=>te(()=>import("./ActivityLog-86luPf7c.js"),__vite__mapDeps([34,1,2,35,24,6,14,7,3,4,5,8,9,36,33,26,15,16,17,23,22,37,0,20,19])));g.lazy(()=>te(()=>import("./Heatmap-C6k8t_u6.js"),__vite__mapDeps([38,1,2,8,5,3,7,4,6,9])));g.lazy(()=>te(()=>import("./SalesFunnel-BcKu3Dt3.js"),__vite__mapDeps([39,1,2,5,3,7,8,4,6,9])));const Yu=g.lazy(()=>te(()=>import("./Profile-BBpRzkv9.js"),__vite__mapDeps([40,1,2,7,8,3,4,5,6,9])));g.lazy(()=>te(()=>import("./Users-CGYoGBLp.js"),__vite__mapDeps([41,1,2,42,24,6,3,7,8,5,4,9])));g.lazy(()=>te(()=>import("./PipelineSettings-C27Yogpw.js"),__vite__mapDeps([43,1,2,15,21,0,3,4,5,6,7,8,9,25])));g.lazy(()=>te(()=>import("./AuditLogs-BwZMEndr.js"),__vite__mapDeps([44,1,2,31,20,5,15,21,7,3,4,6,8,9])));g.lazy(()=>te(()=>import("./SmartTasksAdmin-jrwIPl-M.js"),__vite__mapDeps([45,1,2,3,7,4,5,6,8,9])));const Ju=g.lazy(()=>te(()=>import("./signup-pPB50Fbe.js"),__vite__mapDeps([46,1,2,3,8,7,4,5,6,9]))),Qu=g.lazy(()=>te(()=>import("./forgot-password-7yQEiJ9S.js"),__vite__mapDeps([47,1,2,3,8,7,4,5,6,9]))),Ku=g.lazy(()=>te(()=>import("./reset-password-q5OOf1Qj.js"),__vite__mapDeps([48,1,2,3,8,7,4,5,6,9]))),Zu=g.lazy(()=>te(()=>import("./PipelinePage-RsqAjjt9.js"),__vite__mapDeps([49,1,2,12,11,13,14,6,7,3,4,5,8,9,15,16,17,18,19,20,21,22,23,24,25,26,27])).then(e=>({default:e.PipelinePage})));g.lazy(()=>te(()=>import("./ActivityProcessingPage-CB6W46ue.js"),__vite__mapDeps([37,1,2,33,5,0,3,4,6,7,8,9,20,19,35,24,14,15,16,17,22])));const Xu=g.lazy(()=>te(()=>import("./TasksPage-C15_yeM6.js"),__vite__mapDeps([50,1,2,21,20,5,19,6,15,22,7,8,51,18,16,17,14,3,4,9,23,24,12,42]))),Rs=g.lazy(()=>te(()=>import("./Roadmap-zWcEjyfa.js"),__vite__mapDeps([52,1,2,12,7,5,3,8,4,6,9]))),em=g.lazy(()=>te(()=>import("./Releases-6jF2f1gQ.js"),__vite__mapDeps([53,1,2,20,5,7,8,3,4,6,9]))),tm=g.lazy(()=>te(()=>import("./Clients-B5cZmK1s.js"),__vite__mapDeps([54,1,2,27,7,14,6,3,4,5,8,9]))),am=g.lazy(()=>te(()=>import("./TestFallback-DL2391KY.js"),__vite__mapDeps([55,1,2,4,3,5,6,7,8,9]))),rm=g.lazy(()=>te(()=>import("./MeetingsPage-DldHtPln.js"),__vite__mapDeps([56,1,2,20,5,0,3,4,6,7,8,9,35,24,57]))),sm=g.lazy(()=>te(()=>import("./DebugMeetings-BK-fRRKx.js"),__vite__mapDeps([58,1,2,3,4,5,6,7,8,9])));g.lazy(()=>te(()=>import("./ApiTesting-CIY3JNkz.js"),__vite__mapDeps([59,1,2,20,5,14,6,7,3,4,8,9,57])));const nm=g.lazy(()=>te(()=>import("./CRM-BnrcBHtU.js"),__vite__mapDeps([60,1,2,35,24,6,61,20,5,15,22,7,0,3,4,8,9,27,14,62,63,49,12,11,13,16,17,18,19,21,23,25,26,56,57]))),om=g.lazy(()=>te(()=>import("./Admin-BsDGSaah.js"),__vite__mapDeps([64,1,2,35,24,6,41,42,3,7,8,5,4,9,43,15,21,0,25,44,31,20,45,59,14,57]))),im=g.lazy(()=>te(()=>import("./Insights-BaZsGlJ8.js"),__vite__mapDeps([65,1,2,35,24,6,39,5,3,7,8,4,9,38])));g.lazy(()=>te(()=>import("./CompaniesTable-BFCo6620.js"),__vite__mapDeps([61,1,2,20,5,15,22,6,7,0,3,4,8,9,27,14,62])));const Ls=g.lazy(()=>te(()=>import("./CompanyProfile-D7-dvoYh.js"),__vite__mapDeps([66,1,2,7,8,5,3,4,6,9])));g.lazy(()=>te(()=>import("./ContactsTable-BcgOUcB-.js"),__vite__mapDeps([63,4,2,1,3,20,5,15,22,6,7,0,8,9,14,62])));const lm=g.lazy(()=>te(()=>import("./ContactRecord-EYkXdPE-.js"),__vite__mapDeps([67,1,2,33,5,20,14,6,7,3,4,8,9,15,16,17,51,18,22,23,24]))),cm=g.lazy(()=>te(()=>import("./DealRecord-DvkzLLra.js"),__vite__mapDeps([68,1,2,3,20,5,7,4,6,8,9]))),dm=()=>r.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-500"})}),Hn=new to({defaultOptions:{queries:{staleTime:5*60*1e3,retry:1}}});window.queryClient=Hn;function um(){Jd();const{performanceMetrics:e,measurePerformance:t,addCleanup:a}=su({enableResourcePreloading:!0,enableSmartPreloading:!0,enableBundleMonitoring:!0,enableMemoryCleanup:!0,debugMode:!1});return g.useEffect(()=>{const s=rl(pe,3e4);s.start();const n=()=>s.stop();return a(n),n},[a]),g.useEffect(()=>{(async()=>{try{await ku(),v.log(" Database migrations completed successfully")}catch{}})()},[]),g.useEffect(()=>{const s=il.getInstance();s.setEnabled(!0),Su.initializeMonitoring(!0);const n=()=>s.cleanup();return a(n),n},[t,e,a]),r.jsx(Mu,{onError:(s,n)=>{},children:r.jsx(ao,{client:Hn,children:r.jsx(qd,{children:r.jsxs(hl,{children:[r.jsx(hu,{}),r.jsx(Ds,{children:r.jsx(g.Suspense,{fallback:r.jsx(dm,{}),children:r.jsxs(so,{children:[r.jsx(ie,{path:"/auth/login",element:r.jsx(Hu,{})}),r.jsx(ie,{path:"/auth/signup",element:r.jsx(Ju,{})}),r.jsx(ie,{path:"/auth/forgot-password",element:r.jsx(Qu,{})}),r.jsx(ie,{path:"/auth/reset-password",element:r.jsx(Ku,{})}),r.jsx(ie,{path:"/",element:r.jsx(je,{children:r.jsx(Wu,{})})}),r.jsx(ie,{path:"/activity",element:r.jsx(je,{children:r.jsx(Gu,{})})}),r.jsx(ie,{path:"/insights",element:r.jsx(je,{children:r.jsx(im,{})})}),r.jsx(ie,{path:"/crm",element:r.jsx(je,{children:r.jsx(nm,{})})}),r.jsx(ie,{path:"/admin",element:r.jsx(je,{children:r.jsx(om,{})})}),r.jsx(ie,{path:"/pipeline",element:r.jsx(je,{children:r.jsx(Zu,{})})}),r.jsx(ie,{path:"/tasks",element:r.jsx(je,{children:r.jsx(Xu,{})})}),r.jsx(ie,{path:"/heatmap",element:r.jsx(Te,{to:"/insights",replace:!0})}),r.jsx(ie,{path:"/funnel",element:r.jsx(Te,{to:"/insights",replace:!0})}),r.jsx(ie,{path:"/activity-processing",element:r.jsx(Te,{to:"/activity",replace:!0})}),r.jsx(ie,{path:"/api-testing",element:r.jsx(Te,{to:"/admin",replace:!0})}),r.jsx(ie,{path:"/admin/users",element:r.jsx(Te,{to:"/admin",replace:!0})}),r.jsx(ie,{path:"/admin/pipeline-settings",element:r.jsx(Te,{to:"/admin",replace:!0})}),r.jsx(ie,{path:"/admin/audit-logs",element:r.jsx(Te,{to:"/admin",replace:!0})}),r.jsx(ie,{path:"/admin/smart-tasks",element:r.jsx(Te,{to:"/admin",replace:!0})}),r.jsx(ie,{path:"/companies",element:r.jsx(Te,{to:"/crm",replace:!0})}),r.jsx(ie,{path:"/crm/companies",element:r.jsx(Te,{to:"/crm",replace:!0})}),r.jsx(ie,{path:"/crm/contacts",element:r.jsx(Te,{to:"/crm",replace:!0})}),r.jsx(ie,{path:"/companies/:companyId",element:r.jsx(je,{children:r.jsx(Ls,{})})}),r.jsx(ie,{path:"/crm/companies/:companyId",element:r.jsx(je,{children:r.jsx(Ls,{})})}),r.jsx(ie,{path:"/crm/contacts/:id",element:r.jsx(je,{children:r.jsx(lm,{})})}),r.jsx(ie,{path:"/crm/deals/:id",element:r.jsx(je,{children:r.jsx(cm,{})})}),r.jsx(ie,{path:"/payments",element:r.jsx(Te,{to:"/clients",replace:!0})}),r.jsx(ie,{path:"/clients",element:r.jsx(je,{children:r.jsx(tm,{})})}),r.jsx(ie,{path:"/subscriptions",element:r.jsx(Te,{to:"/clients",replace:!0})}),r.jsx(ie,{path:"/profile",element:r.jsx(je,{children:r.jsx(Yu,{})})}),r.jsx(ie,{path:"/roadmap",element:r.jsx(je,{children:r.jsx(Rs,{})})}),r.jsx(ie,{path:"/roadmap/ticket/:ticketId",element:r.jsx(je,{children:r.jsx(Rs,{})})}),r.jsx(ie,{path:"/releases",element:r.jsx(je,{children:r.jsx(em,{})})}),r.jsx(ie,{path:"/meetings/*",element:r.jsx(je,{children:r.jsx(rm,{})})}),r.jsx(ie,{path:"/debug-meetings",element:r.jsx(je,{children:r.jsx(sm,{})})}),r.jsx(ie,{path:"/test-fallback",element:r.jsx(Ds,{children:r.jsx(am,{})})})]})})}),r.jsx(el,{}),r.jsx("div",{className:"fixed inset-0 bg-[radial-gradient(ellipse_at_top,rgba(74,74,117,0.15),transparent)] pointer-events-none"})]})})})})}or.createRoot(document.getElementById("root")).render(r.jsx(U.StrictMode,{children:r.jsx(Xs,{children:r.jsx(no,{children:r.jsx(um,{})})})}));export{pe as A,Cn as B,on as C,Nn as D,Rd as E,Se as F,Cm as G,_m as H,$d as I,Ss as J,ce as K,Vu as S,jm as U,L as a,Ta as b,Ge as c,Wn as d,Hr as e,jl as f,le as g,Nt as h,km as i,Fu as j,Sm as k,v as l,Au as m,Nm as n,Ou as o,Lr as p,Ld as q,Ar as r,R as s,qe as t,Sn as u,zu as v,En as w,Tu as x,ct as y,st as z};
