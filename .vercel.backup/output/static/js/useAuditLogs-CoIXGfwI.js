import{r as g}from"./vendor-react-DoYyFkVR.js";import{c as _,s as f}from"./index.html-Cwo_Unfk.js";function A(){const{userData:l}=_(),[d,n]=g.useState(!1),[a,s]=g.useState(null),c=l?.is_admin||!1;return{isAdmin:c,loading:d,error:a,getAuditHistory:async(e,t,r=50)=>{if(!c)throw new Error("Only administrators can view audit logs");n(!0),s(null);try{const{data:o,error:i}=await f.rpc("get_audit_history",{p_table_name:e,p_record_id:t,p_limit:r});if(i)throw i;return o||[]}catch(o){const i=o instanceof Error?o.message:"Failed to fetch audit history";throw s(i),o}finally{n(!1)}},getFieldHistory:async(e,t,r,o=50)=>{if(!c)throw new Error("Only administrators can view audit logs");n(!0),s(null);try{const{data:i,error:u}=await f.rpc("get_field_history",{p_table_name:e,p_record_id:t,p_field_name:r,p_limit:o});if(u)throw u;return i||[]}catch(i){const u=i instanceof Error?i.message:"Failed to fetch field history";throw s(u),i}finally{n(!1)}},getRecentAuditLogs:async(e=100,t)=>{if(!c)throw new Error("Only administrators can view audit logs");n(!0),s(null);try{let r=f.from("audit_logs").select("*").order("changed_at",{ascending:!1}).limit(e);t&&(r=r.eq("table_name",t));const{data:o,error:i}=await r;if(i)throw i;return o||[]}catch(r){const o=r instanceof Error?r.message:"Failed to fetch audit logs";throw s(o),r}finally{n(!1)}},searchAuditLogs:async e=>{if(!c)throw new Error("Only administrators can view audit logs");n(!0),s(null);try{let t=f.from("audit_logs").select("*").order("changed_at",{ascending:!1});e.tableName&&(t=t.eq("table_name",e.tableName)),e.recordId&&(t=t.eq("record_id",e.recordId)),e.userId&&(t=t.eq("user_id",e.userId)),e.action&&(t=t.eq("action",e.action)),e.startDate&&(t=t.gte("changed_at",e.startDate.toISOString())),e.endDate&&(t=t.lte("changed_at",e.endDate.toISOString())),e.changedField&&(t=t.contains("changed_fields",[e.changedField]));const{data:r,error:o}=await t;if(o)throw o;return r||[]}catch(t){const r=t instanceof Error?t.message:"Failed to search audit logs";throw s(r),t}finally{n(!1)}}}}function D(l,d,n){return n.map(a=>({field:a,oldValue:l?.[a]??null,newValue:d?.[a]??null}))}function S(l,d,n){const a=d.replace(/s$/,"");switch(l){case"INSERT":return`Created new ${a}`;case"DELETE":return`Deleted ${a}`;case"UPDATE":return n&&n.length>0?`Updated ${n.join(", ")} on ${a}`:`Updated ${a}`;default:return`${l} on ${a}`}}export{D as f,S as g,A as u};
