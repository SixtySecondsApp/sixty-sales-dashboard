import{j as e}from"./vendor-state-CpjwTZNq.js";import{r as n}from"./vendor-react-DoYyFkVR.js";import{c as S,B as g,l as I}from"./index.html-Cwo_Unfk.js";import{c as p}from"./vendor-supabase-BuXd-BBn.js";import"./vendor-router-CQXjpROx.js";import"./vendor-utils-Cb9OXVhE.js";import"./ui-radix-core-CdvL28QE.js";import"./vendor-icons-HRBKouGg.js";import"./ui-animation-Dzb4KUJ1.js";import"./vendor-charts-D4YcUEy1.js";function R(){const{userData:l,isAuthenticated:r}=S(),[c,x]=n.useState([]),[o,d]=n.useState(!1),u=async()=>{d(!0);const s=[];s.push({test:"Authentication Status",status:r?"PASS":"FAIL",details:r?`Logged in as: ${l?.email} (ID: ${l?.id})`:"Not authenticated - This is the main issue!"});try{const t=p("https://ewtuefzeogytgmsnkpmb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4OTQ5MjcsImV4cCI6MjA1MzQ3MDkyN30.O22Zx_xB_UuasB19V66g69fl6GdAdW38vuYQPbGUUf8"),{data:{session:a},error:i}=await t.auth.getSession();s.push({test:"Session Check",status:a?"PASS":"FAIL",details:a?`Session active: ${a.user?.email}, Token present: ${!!a.access_token}`:`No session found. ${i?`Error: ${i.message}`:"Please log in at /auth/login"}`})}catch(t){s.push({test:"Session Check",status:"FAIL",details:`Session check failed: ${t.message}`})}try{I.log("üß™ Testing service role key fallback...");const t=p("https://ewtuefzeogytgmsnkpmb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV3dHVlZnplb2d5dGdtc25rcG1iIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNzg5NDkyNywiZXhwIjoyMDUzNDcwOTI3fQ.jKjwRZn7fi9rJUcmWPe5zBRpq7leefmx0H8U59bfVEs"),{data:a,error:i}=await t.from("deals").select("*, deal_stages(*)").limit(3);i?s.push({test:"Service Key Deals Query",status:"FAIL",details:`Service key failed: ${i.message}`}):s.push({test:"Service Key Deals Query",status:"PASS",details:`‚úÖ Retrieved ${a?.length||0} deals with service key! This proves fallback should work.`});const{data:m,error:h}=await t.from("deal_stages").select("*");h?s.push({test:"Service Key Stages Query",status:"FAIL",details:`Service key stages failed: ${h.message}`}):s.push({test:"Service Key Stages Query",status:"PASS",details:`‚úÖ Retrieved ${m?.length||0} stages: ${m?.map(b=>b.name).join(", ")}`})}catch(t){s.push({test:"Service Key Fallback",status:"FAIL",details:`Service key test failed: ${t.message}`})}s.push({test:"Environment Variables",status:"PASS",details:["VITE_SUPABASE_URL: ‚úÖ Set","VITE_SUPABASE_ANON_KEY: ‚úÖ Set","VITE_SUPABASE_SERVICE_ROLE_KEY: ‚úÖ Set"].join(", ")}),x(s),d(!1)};return n.useEffect(()=>{u()},[r,l]),e.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-white",children:"üß™ Authentication & Fallback Test"}),e.jsxs("div",{className:"mb-6 p-4 bg-blue-900/20 border border-blue-700 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-blue-400 mb-2",children:"üîç Quick Diagnosis"}),e.jsx("p",{className:"text-gray-300 text-sm mb-2",children:"This page tests your authentication status and whether the fallback mechanisms should work."}),!r&&e.jsxs("p",{className:"text-yellow-400 text-sm",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"You are not logged in!"})," Go to ",e.jsx("a",{href:"/auth/login",className:"text-blue-400 underline",children:"/auth/login"})," to sign in first."]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(g,{onClick:u,disabled:o,className:"bg-blue-600 hover:bg-blue-700",children:o?"Running Tests...":"üîÑ Re-run Tests"}),e.jsx(g,{onClick:()=>window.location.href="/auth/login",variant:"outline",children:"üîê Go to Login"})]}),e.jsx("div",{className:"space-y-4",children:c.map((s,t)=>e.jsxs("div",{className:`p-4 rounded-lg border ${s.status==="PASS"?"bg-green-900/20 border-green-700":"bg-red-900/20 border-red-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`text-lg ${s.status==="PASS"?"text-green-400":"text-red-400"}`,children:s.status==="PASS"?"‚úÖ":"‚ùå"}),e.jsx("h3",{className:"font-semibold text-white",children:s.test}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${s.status==="PASS"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:s.status})]}),e.jsx("p",{className:"text-gray-300 text-sm whitespace-pre-wrap",children:s.details})]},t))}),c.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400 mx-auto"}),e.jsx("p",{className:"text-gray-400 mt-2",children:"Running tests..."})]})]})}export{R as default};
